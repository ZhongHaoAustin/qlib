[3093195:MainThread](2024-04-25 05:11:13,812) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[3093195:MainThread](2024-04-25 05:11:13,815) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[3093195:MainThread](2024-04-25 05:11:13,815) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:11:19,465) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:11:24,824) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_43.
[3093195:MainThread](2024-04-25 05:11:24,879) INFO - qlib.workflow - [exp.py:258] - Experiment 64 starts running ...
[3093195:MainThread](2024-04-25 05:11:26,580) INFO - qlib.workflow - [recorder.py:341] - Recorder c9142f8837a84d85a4668f9015001ee9 starts running under Experiment 64 ...
[3093195:MainThread](2024-04-25 05:11:31,500) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:11:31,501) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:11:31,501) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:11:39,475) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:11:39,793) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998442
[3093195:MainThread](2024-04-25 05:11:39,798) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:11:39,799) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:11:46,658) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:11:46,975) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998991
[3093195:MainThread](2024-04-25 05:11:46,976) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:11:46,976) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:11:53,832) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:11:54,151) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997948
[3093195:MainThread](2024-04-25 05:11:54,154) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:11:54,154) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:12:01,089) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:12:01,407) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999768
[3093195:MainThread](2024-04-25 05:12:01,408) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:12:01,408) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:12:08,307) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:12:08,624) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -1.000167
[3093195:MainThread](2024-04-25 05:12:08,624) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:12:08,625) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:12:15,530) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:12:15,849) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999129
[3093195:MainThread](2024-04-25 05:12:15,849) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:12:15,850) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:12:22,697) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:12:23,014) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998916
[3093195:MainThread](2024-04-25 05:12:23,015) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3093195:MainThread](2024-04-25 05:12:23,015) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:12:29,939) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:12:30,256) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998422
[3093195:MainThread](2024-04-25 05:12:30,256) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:12:30,257) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.997948 @ 2
[3093195:MainThread](2024-04-25 05:12:30,286) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_43.
[3093195:MainThread](2024-04-25 05:12:30,577) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue.
[3093195:MainThread](2024-04-25 05:12:30,633) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:12:30,646) INFO - qlib.workflow - [recorder.py:341] - Recorder d1ee006d8be44843abc36015e021040f starts running under Experiment 65 ...
{'IC': 0.020637454956468574,
 'ICIR': 0.1363977555593439,
 'Rank IC': 0.04052653939231223,
 'Rank ICIR': 0.2709675937829445}
[3093195:MainThread](2024-04-25 05:12:37,569) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:13:13,246) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:13:13,249) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:13:19,627) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f454bb3ed60>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 4/971 [00:00<00:26, 37.16it/s]backtest loop:   1%|          | 10/971 [00:00<00:20, 47.53it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:18, 50.97it/s]backtest loop:   2%|▏         | 22/971 [00:00<00:19, 48.48it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:18, 50.69it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 48.71it/s]backtest loop:   4%|▍         | 40/971 [00:00<00:18, 50.71it/s]backtest loop:   5%|▍         | 46/971 [00:00<00:17, 52.00it/s]backtest loop:   5%|▌         | 52/971 [00:01<00:17, 52.98it/s]backtest loop:   6%|▌         | 58/971 [00:01<00:18, 50.40it/s]backtest loop:   7%|▋         | 64/971 [00:01<00:17, 51.75it/s]backtest loop:   7%|▋         | 70/971 [00:01<00:17, 52.66it/s]backtest loop:   8%|▊         | 76/971 [00:01<00:16, 53.62it/s]backtest loop:   8%|▊         | 82/971 [00:01<00:17, 51.27it/s]backtest loop:   9%|▉         | 88/971 [00:01<00:16, 52.54it/s]backtest loop:  10%|▉         | 94/971 [00:01<00:16, 53.08it/s]backtest loop:  10%|█         | 100/971 [00:01<00:16, 53.55it/s]backtest loop:  11%|█         | 106/971 [00:02<00:16, 53.92it/s]backtest loop:  12%|█▏        | 112/971 [00:02<00:16, 50.84it/s]backtest loop:  12%|█▏        | 118/971 [00:02<00:16, 51.91it/s]backtest loop:  13%|█▎        | 124/971 [00:02<00:16, 52.76it/s]backtest loop:  13%|█▎        | 130/971 [00:02<00:16, 50.09it/s]backtest loop:  14%|█▍        | 136/971 [00:02<00:16, 49.30it/s]backtest loop:  15%|█▍        | 142/971 [00:02<00:16, 50.77it/s]backtest loop:  15%|█▌        | 148/971 [00:02<00:15, 51.80it/s]backtest loop:  16%|█▌        | 154/971 [00:02<00:15, 52.81it/s]backtest loop:  16%|█▋        | 160/971 [00:03<00:15, 53.45it/s]backtest loop:  17%|█▋        | 166/971 [00:03<00:15, 50.64it/s]backtest loop:  18%|█▊        | 172/971 [00:03<00:15, 52.44it/s]backtest loop:  18%|█▊        | 178/971 [00:03<00:14, 53.40it/s]backtest loop:  19%|█▉        | 184/971 [00:03<00:14, 53.63it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:15, 50.84it/s]backtest loop:  20%|██        | 196/971 [00:03<00:14, 51.98it/s]backtest loop:  21%|██        | 202/971 [00:03<00:14, 52.50it/s]backtest loop:  21%|██▏       | 208/971 [00:04<00:14, 53.34it/s]backtest loop:  22%|██▏       | 214/971 [00:04<00:14, 50.99it/s]backtest loop:  23%|██▎       | 220/971 [00:04<00:15, 49.17it/s]backtest loop:  23%|██▎       | 226/971 [00:04<00:14, 50.92it/s]backtest loop:  24%|██▍       | 232/971 [00:04<00:14, 51.89it/s]backtest loop:  25%|██▍       | 238/971 [00:04<00:14, 51.98it/s]backtest loop:  25%|██▌       | 244/971 [00:04<00:13, 52.61it/s]backtest loop:  26%|██▌       | 250/971 [00:04<00:14, 49.90it/s]backtest loop:  26%|██▋       | 256/971 [00:04<00:14, 50.73it/s]backtest loop:  27%|██▋       | 262/971 [00:05<00:13, 51.16it/s]backtest loop:  28%|██▊       | 268/971 [00:05<00:14, 48.88it/s]backtest loop:  28%|██▊       | 274/971 [00:05<00:13, 50.16it/s]backtest loop:  29%|██▉       | 280/971 [00:05<00:13, 51.31it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:13, 49.08it/s]backtest loop:  30%|███       | 292/971 [00:05<00:13, 50.24it/s]backtest loop:  31%|███       | 298/971 [00:05<00:13, 51.11it/s]backtest loop:  31%|███▏      | 304/971 [00:05<00:12, 51.89it/s]backtest loop:  32%|███▏      | 310/971 [00:06<00:13, 49.35it/s]backtest loop:  33%|███▎      | 316/971 [00:06<00:12, 50.45it/s]backtest loop:  33%|███▎      | 322/971 [00:06<00:12, 51.21it/s]backtest loop:  34%|███▍      | 328/971 [00:06<00:12, 51.89it/s]backtest loop:  34%|███▍      | 334/971 [00:06<00:12, 52.49it/s]backtest loop:  35%|███▌      | 340/971 [00:06<00:12, 49.87it/s]backtest loop:  36%|███▌      | 346/971 [00:06<00:12, 51.06it/s]backtest loop:  36%|███▋      | 352/971 [00:06<00:11, 52.56it/s]backtest loop:  37%|███▋      | 358/971 [00:06<00:11, 52.68it/s]backtest loop:  37%|███▋      | 364/971 [00:07<00:12, 49.58it/s]backtest loop:  38%|███▊      | 370/971 [00:07<00:12, 47.23it/s]backtest loop:  39%|███▊      | 375/971 [00:07<00:12, 47.90it/s]backtest loop:  39%|███▉      | 380/971 [00:07<00:12, 48.26it/s]backtest loop:  40%|███▉      | 385/971 [00:07<00:12, 48.53it/s]backtest loop:  40%|████      | 391/971 [00:07<00:11, 49.70it/s]backtest loop:  41%|████      | 397/971 [00:07<00:11, 51.03it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:11, 49.30it/s]backtest loop:  42%|████▏     | 409/971 [00:08<00:10, 51.74it/s]backtest loop:  43%|████▎     | 415/971 [00:08<00:10, 52.68it/s]backtest loop:  43%|████▎     | 421/971 [00:08<00:10, 53.17it/s]backtest loop:  44%|████▍     | 427/971 [00:08<00:10, 53.53it/s]backtest loop:  45%|████▍     | 433/971 [00:08<00:10, 50.50it/s]backtest loop:  45%|████▌     | 439/971 [00:08<00:10, 51.55it/s]backtest loop:  46%|████▌     | 445/971 [00:08<00:10, 52.38it/s]backtest loop:  46%|████▋     | 451/971 [00:08<00:09, 52.81it/s]backtest loop:  47%|████▋     | 457/971 [00:08<00:10, 50.11it/s]backtest loop:  48%|████▊     | 463/971 [00:09<00:09, 51.25it/s]backtest loop:  48%|████▊     | 469/971 [00:09<00:09, 52.06it/s]backtest loop:  49%|████▉     | 475/971 [00:09<00:09, 52.52it/s]backtest loop:  50%|████▉     | 481/971 [00:09<00:09, 53.30it/s]backtest loop:  50%|█████     | 487/971 [00:09<00:09, 50.71it/s]backtest loop:  51%|█████     | 493/971 [00:09<00:09, 52.00it/s]backtest loop:  51%|█████▏    | 499/971 [00:09<00:08, 52.94it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:09, 50.50it/s]backtest loop:  53%|█████▎    | 511/971 [00:09<00:08, 51.83it/s]backtest loop:  53%|█████▎    | 517/971 [00:10<00:09, 49.89it/s]backtest loop:  54%|█████▍    | 523/971 [00:10<00:08, 51.41it/s]backtest loop:  54%|█████▍    | 529/971 [00:10<00:08, 52.52it/s]backtest loop:  55%|█████▌    | 535/971 [00:10<00:08, 53.53it/s]backtest loop:  56%|█████▌    | 541/971 [00:10<00:08, 51.00it/s]backtest loop:  56%|█████▋    | 547/971 [00:10<00:08, 52.28it/s]backtest loop:  57%|█████▋    | 553/971 [00:10<00:07, 52.94it/s]backtest loop:  58%|█████▊    | 559/971 [00:10<00:07, 53.64it/s]backtest loop:  58%|█████▊    | 565/971 [00:10<00:07, 54.12it/s]backtest loop:  59%|█████▉    | 571/971 [00:11<00:07, 51.25it/s]backtest loop:  59%|█████▉    | 577/971 [00:11<00:07, 52.51it/s]backtest loop:  60%|██████    | 583/971 [00:11<00:07, 53.34it/s]backtest loop:  61%|██████    | 589/971 [00:11<00:07, 53.89it/s]backtest loop:  61%|██████▏   | 595/971 [00:11<00:06, 54.43it/s]backtest loop:  62%|██████▏   | 601/971 [00:11<00:07, 51.59it/s]backtest loop:  63%|██████▎   | 607/971 [00:11<00:06, 52.67it/s]backtest loop:  63%|██████▎   | 613/971 [00:11<00:06, 53.56it/s]backtest loop:  64%|██████▎   | 619/971 [00:12<00:06, 54.09it/s]backtest loop:  64%|██████▍   | 625/971 [00:12<00:06, 51.44it/s]backtest loop:  65%|██████▍   | 631/971 [00:12<00:06, 52.67it/s]backtest loop:  66%|██████▌   | 637/971 [00:12<00:06, 53.65it/s]backtest loop:  66%|██████▌   | 643/971 [00:12<00:06, 54.23it/s]backtest loop:  67%|██████▋   | 649/971 [00:12<00:05, 54.50it/s]backtest loop:  67%|██████▋   | 655/971 [00:12<00:06, 51.50it/s]backtest loop:  68%|██████▊   | 661/971 [00:12<00:05, 52.50it/s]backtest loop:  69%|██████▊   | 667/971 [00:12<00:05, 53.06it/s]backtest loop:  69%|██████▉   | 673/971 [00:13<00:05, 52.68it/s]backtest loop:  70%|██████▉   | 679/971 [00:13<00:05, 51.60it/s]backtest loop:  71%|███████   | 686/971 [00:13<00:05, 54.71it/s]backtest loop:  71%|███████▏  | 693/971 [00:13<00:04, 56.99it/s]backtest loop:  72%|███████▏  | 699/971 [00:13<00:05, 54.37it/s]backtest loop:  73%|███████▎  | 706/971 [00:13<00:04, 56.62it/s]backtest loop:  73%|███████▎  | 713/971 [00:13<00:04, 58.31it/s]backtest loop:  74%|███████▍  | 719/971 [00:13<00:04, 55.75it/s]backtest loop:  75%|███████▍  | 726/971 [00:13<00:04, 57.74it/s]backtest loop:  75%|███████▌  | 732/971 [00:14<00:04, 54.95it/s]backtest loop:  76%|███████▌  | 738/971 [00:14<00:04, 53.26it/s]backtest loop:  77%|███████▋  | 745/971 [00:14<00:04, 55.97it/s]backtest loop:  77%|███████▋  | 751/971 [00:14<00:04, 52.75it/s]backtest loop:  78%|███████▊  | 757/971 [00:14<00:04, 53.43it/s]backtest loop:  79%|███████▊  | 763/971 [00:14<00:03, 53.96it/s]backtest loop:  79%|███████▉  | 769/971 [00:14<00:03, 54.41it/s]backtest loop:  80%|███████▉  | 775/971 [00:14<00:03, 51.55it/s]backtest loop:  80%|████████  | 781/971 [00:15<00:03, 52.60it/s]backtest loop:  81%|████████  | 787/971 [00:15<00:03, 53.36it/s]backtest loop:  82%|████████▏ | 793/971 [00:15<00:03, 50.76it/s]backtest loop:  82%|████████▏ | 799/971 [00:15<00:03, 51.99it/s]backtest loop:  83%|████████▎ | 805/971 [00:15<00:03, 52.93it/s]backtest loop:  84%|████████▎ | 811/971 [00:15<00:02, 53.63it/s]backtest loop:  84%|████████▍ | 817/971 [00:15<00:02, 54.24it/s]backtest loop:  85%|████████▍ | 823/971 [00:15<00:02, 51.31it/s]backtest loop:  85%|████████▌ | 829/971 [00:15<00:02, 52.46it/s]backtest loop:  86%|████████▌ | 835/971 [00:16<00:02, 53.20it/s]backtest loop:  87%|████████▋ | 841/971 [00:16<00:02, 53.78it/s]backtest loop:  87%|████████▋ | 847/971 [00:16<00:02, 54.22it/s]backtest loop:  88%|████████▊ | 853/971 [00:16<00:02, 50.93it/s]backtest loop:  88%|████████▊ | 859/971 [00:16<00:02, 52.14it/s]backtest loop:  89%|████████▉ | 865/971 [00:16<00:01, 53.00it/s]backtest loop:  90%|████████▉ | 871/971 [00:16<00:01, 53.60it/s]backtest loop:  90%|█████████ | 877/971 [00:16<00:01, 51.07it/s]backtest loop:  91%|█████████ | 883/971 [00:16<00:01, 52.31it/s]backtest loop:  92%|█████████▏| 889/971 [00:17<00:01, 53.17it/s]backtest loop:  92%|█████████▏| 895/971 [00:17<00:01, 53.73it/s]backtest loop:  93%|█████████▎| 901/971 [00:17<00:01, 54.20it/s]backtest loop:  93%|█████████▎| 907/971 [00:17<00:01, 51.29it/s]backtest loop:  94%|█████████▍| 913/971 [00:17<00:01, 52.66it/s]backtest loop:  95%|█████████▍| 919/971 [00:17<00:00, 53.48it/s]backtest loop:  95%|█████████▌| 925/971 [00:17<00:00, 54.07it/s]backtest loop:  96%|█████████▌| 931/971 [00:17<00:00, 51.36it/s]backtest loop:  96%|█████████▋| 937/971 [00:17<00:00, 52.43it/s]backtest loop:  97%|█████████▋| 943/971 [00:18<00:00, 53.23it/s]backtest loop:  98%|█████████▊| 949/971 [00:18<00:00, 53.83it/s]backtest loop:  98%|█████████▊| 955/971 [00:18<00:00, 50.60it/s]backtest loop:  99%|█████████▉| 961/971 [00:18<00:00, 51.84it/s]backtest loop: 100%|█████████▉| 967/971 [00:18<00:00, 52.70it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 52.13it/s]
[3093195:MainThread](2024-04-25 05:13:38,328) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000582
std                0.005418
annualized_return  0.138468
information_ratio  1.656562
max_drawdown      -0.083751
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000383
std                0.005419
annualized_return  0.091187
information_ratio  1.090810
max_drawdown      -0.097468
[3093195:MainThread](2024-04-25 05:13:38,342) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:13:45,007) INFO - qlib.timer - [log.py:127] - Time cost: 0.007s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401],
 'IC': [0.020637454956468574],
 'ICIR': [0.1363977555593439],
 'Rank IC': [0.04052653939231223],
 'Rank ICIR': [0.2709675937829445],
 'mae': [0.8637884690110731],
 'mse': [0.9966288064718065]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:13:48,247) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:13:51,156) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_44.
[3093195:MainThread](2024-04-25 05:13:51,214) INFO - qlib.workflow - [exp.py:258] - Experiment 66 starts running ...
[3093195:MainThread](2024-04-25 05:13:51,232) INFO - qlib.workflow - [recorder.py:341] - Recorder e64202bee6bd4214a18e8e11fa40d492 starts running under Experiment 66 ...
[3093195:MainThread](2024-04-25 05:13:59,211) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:13:59,211) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:13:59,211) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:14:06,304) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:14:06,616) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998091
[3093195:MainThread](2024-04-25 05:14:06,620) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:14:06,620) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:14:13,968) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:14:14,282) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998768
[3093195:MainThread](2024-04-25 05:14:14,282) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:14:14,282) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:14:21,567) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:14:21,882) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997727
[3093195:MainThread](2024-04-25 05:14:21,885) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:14:21,885) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:14:29,063) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:14:29,380) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998855
[3093195:MainThread](2024-04-25 05:14:29,381) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:14:29,381) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:14:36,416) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:14:36,731) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999036
[3093195:MainThread](2024-04-25 05:14:36,731) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:14:36,732) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:14:43,770) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:14:44,084) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998643
[3093195:MainThread](2024-04-25 05:14:44,085) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:14:44,085) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:14:51,042) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:14:51,358) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998792
[3093195:MainThread](2024-04-25 05:14:51,358) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3093195:MainThread](2024-04-25 05:14:51,359) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:14:58,208) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:14:58,522) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998369
[3093195:MainThread](2024-04-25 05:14:58,522) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:14:58,523) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.997727 @ 2
[3093195:MainThread](2024-04-25 05:14:58,553) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_44.
[3093195:MainThread](2024-04-25 05:14:58,820) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:14:58,834) INFO - qlib.workflow - [recorder.py:341] - Recorder a44f835e6ed14d5e8accee0ecc221b55 starts running under Experiment 65 ...
{'IC': 0.018384392846222276,
 'ICIR': 0.12056425663985118,
 'Rank IC': 0.032153968726034154,
 'Rank ICIR': 0.21961644941208022}
[3093195:MainThread](2024-04-25 05:15:05,607) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:15:41,858) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:15:41,861) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:15:47,852) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f44e6e4b2e0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:37,  9.94it/s]backtest loop:   1%|          | 9/971 [00:00<00:38, 25.25it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:27, 35.04it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:24, 38.83it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:21, 42.99it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:20, 46.54it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:20, 46.14it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:18, 48.83it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 50.69it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 48.71it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:17, 50.64it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:17, 52.27it/s]backtest loop:   8%|▊         | 75/971 [00:01<00:16, 53.21it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:16, 53.90it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:17, 51.43it/s]backtest loop:  10%|▉         | 93/971 [00:02<00:16, 52.57it/s]backtest loop:  10%|█         | 99/971 [00:02<00:16, 53.30it/s]backtest loop:  11%|█         | 105/971 [00:02<00:16, 53.93it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:15, 54.44it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:16, 51.39it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:16, 51.93it/s]backtest loop:  13%|█▎        | 129/971 [00:02<00:16, 50.02it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:16, 51.52it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:16, 49.75it/s]backtest loop:  15%|█▌        | 147/971 [00:03<00:16, 51.15it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:15, 52.41it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:15, 53.24it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:14, 53.90it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:15, 51.13it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:15, 52.18it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:14, 53.01it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:14, 53.75it/s]backtest loop:  20%|██        | 195/971 [00:03<00:15, 51.34it/s]backtest loop:  21%|██        | 201/971 [00:04<00:14, 52.65it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:14, 53.44it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:14, 50.78it/s]backtest loop:  23%|██▎       | 219/971 [00:04<00:14, 52.03it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:14, 50.01it/s]backtest loop:  24%|██▍       | 231/971 [00:04<00:20, 35.24it/s]backtest loop:  24%|██▍       | 237/971 [00:04<00:18, 39.53it/s]backtest loop:  25%|██▌       | 243/971 [00:05<00:16, 43.24it/s]backtest loop:  26%|██▌       | 249/971 [00:05<00:16, 44.05it/s]backtest loop:  26%|██▋       | 255/971 [00:05<00:15, 47.66it/s]backtest loop:  27%|██▋       | 261/971 [00:05<00:14, 49.74it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:14, 48.39it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:13, 50.44it/s]backtest loop:  29%|██▊       | 279/971 [00:05<00:13, 51.85it/s]backtest loop:  29%|██▉       | 285/971 [00:05<00:12, 52.87it/s]backtest loop:  30%|██▉       | 291/971 [00:06<00:13, 50.24it/s]backtest loop:  31%|███       | 297/971 [00:06<00:13, 51.56it/s]backtest loop:  31%|███       | 303/971 [00:06<00:12, 52.64it/s]backtest loop:  32%|███▏      | 309/971 [00:06<00:12, 52.74it/s]backtest loop:  32%|███▏      | 315/971 [00:06<00:13, 50.29it/s]backtest loop:  33%|███▎      | 321/971 [00:06<00:12, 51.58it/s]backtest loop:  34%|███▎      | 327/971 [00:06<00:12, 52.66it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:11, 53.65it/s]backtest loop:  35%|███▍      | 339/971 [00:06<00:11, 54.33it/s]backtest loop:  36%|███▌      | 345/971 [00:07<00:12, 51.30it/s]backtest loop:  36%|███▌      | 351/971 [00:07<00:11, 52.56it/s]backtest loop:  37%|███▋      | 357/971 [00:07<00:11, 53.11it/s]backtest loop:  37%|███▋      | 363/971 [00:07<00:11, 50.76it/s]backtest loop:  38%|███▊      | 369/971 [00:07<00:12, 49.08it/s]backtest loop:  39%|███▊      | 375/971 [00:07<00:11, 50.78it/s]backtest loop:  39%|███▉      | 381/971 [00:07<00:11, 52.04it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:11, 52.80it/s]backtest loop:  40%|████      | 393/971 [00:07<00:11, 50.54it/s]backtest loop:  41%|████      | 399/971 [00:08<00:11, 51.87it/s]backtest loop:  42%|████▏     | 405/971 [00:08<00:10, 53.51it/s]backtest loop:  42%|████▏     | 411/971 [00:08<00:10, 54.52it/s]backtest loop:  43%|████▎     | 417/971 [00:08<00:10, 54.49it/s]backtest loop:  44%|████▎     | 423/971 [00:08<00:10, 51.49it/s]backtest loop:  44%|████▍     | 429/971 [00:08<00:10, 52.53it/s]backtest loop:  45%|████▍     | 435/971 [00:08<00:10, 53.38it/s]backtest loop:  45%|████▌     | 441/971 [00:08<00:09, 54.06it/s]backtest loop:  46%|████▌     | 447/971 [00:08<00:10, 50.91it/s]backtest loop:  47%|████▋     | 453/971 [00:09<00:09, 52.10it/s]backtest loop:  47%|████▋     | 459/971 [00:09<00:09, 53.00it/s]backtest loop:  48%|████▊     | 465/971 [00:09<00:09, 53.67it/s]backtest loop:  49%|████▊     | 471/971 [00:09<00:09, 54.13it/s]backtest loop:  49%|████▉     | 477/971 [00:09<00:09, 51.09it/s]backtest loop:  50%|████▉     | 483/971 [00:09<00:09, 52.09it/s]backtest loop:  50%|█████     | 489/971 [00:09<00:09, 52.99it/s]backtest loop:  51%|█████     | 495/971 [00:09<00:09, 50.48it/s]backtest loop:  52%|█████▏    | 501/971 [00:10<00:09, 51.51it/s]backtest loop:  52%|█████▏    | 507/971 [00:10<00:09, 49.33it/s]backtest loop:  53%|█████▎    | 513/971 [00:10<00:08, 50.90it/s]backtest loop:  53%|█████▎    | 519/971 [00:10<00:08, 51.95it/s]backtest loop:  54%|█████▍    | 525/971 [00:10<00:08, 52.88it/s]backtest loop:  55%|█████▍    | 531/971 [00:10<00:08, 50.60it/s]backtest loop:  55%|█████▌    | 537/971 [00:10<00:08, 51.78it/s]backtest loop:  56%|█████▌    | 543/971 [00:10<00:08, 52.79it/s]backtest loop:  57%|█████▋    | 549/971 [00:10<00:07, 53.45it/s]backtest loop:  57%|█████▋    | 555/971 [00:11<00:07, 54.08it/s]backtest loop:  58%|█████▊    | 561/971 [00:11<00:08, 51.20it/s]backtest loop:  58%|█████▊    | 567/971 [00:11<00:07, 51.83it/s]backtest loop:  59%|█████▉    | 573/971 [00:11<00:07, 52.64it/s]backtest loop:  60%|█████▉    | 579/971 [00:11<00:07, 53.41it/s]backtest loop:  60%|██████    | 585/971 [00:11<00:07, 54.56it/s]backtest loop:  61%|██████    | 591/971 [00:11<00:07, 51.51it/s]backtest loop:  61%|██████▏   | 597/971 [00:11<00:07, 52.52it/s]backtest loop:  62%|██████▏   | 603/971 [00:11<00:06, 53.34it/s]backtest loop:  63%|██████▎   | 609/971 [00:12<00:06, 53.98it/s]backtest loop:  63%|██████▎   | 615/971 [00:12<00:06, 51.12it/s]backtest loop:  64%|██████▍   | 621/971 [00:12<00:06, 52.24it/s]backtest loop:  65%|██████▍   | 627/971 [00:12<00:06, 53.16it/s]backtest loop:  65%|██████▌   | 633/971 [00:12<00:06, 53.74it/s]backtest loop:  66%|██████▌   | 639/971 [00:12<00:06, 54.81it/s]backtest loop:  66%|██████▋   | 645/971 [00:12<00:06, 51.66it/s]backtest loop:  67%|██████▋   | 651/971 [00:12<00:06, 52.66it/s]backtest loop:  68%|██████▊   | 657/971 [00:12<00:05, 53.39it/s]backtest loop:  68%|██████▊   | 663/971 [00:13<00:05, 53.94it/s]backtest loop:  69%|██████▉   | 669/971 [00:13<00:05, 54.34it/s]backtest loop:  70%|██████▉   | 675/971 [00:13<00:05, 51.26it/s]backtest loop:  70%|███████   | 681/971 [00:13<00:05, 52.37it/s]backtest loop:  71%|███████   | 687/971 [00:13<00:05, 52.86it/s]backtest loop:  71%|███████▏  | 693/971 [00:13<00:05, 53.52it/s]backtest loop:  72%|███████▏  | 699/971 [00:13<00:05, 50.87it/s]backtest loop:  73%|███████▎  | 705/971 [00:13<00:05, 52.08it/s]backtest loop:  73%|███████▎  | 711/971 [00:14<00:04, 52.99it/s]backtest loop:  74%|███████▍  | 717/971 [00:14<00:04, 53.70it/s]backtest loop:  74%|███████▍  | 723/971 [00:14<00:04, 54.15it/s]backtest loop:  75%|███████▌  | 729/971 [00:14<00:04, 51.29it/s]backtest loop:  76%|███████▌  | 735/971 [00:14<00:04, 49.39it/s]backtest loop:  76%|███████▋  | 741/971 [00:14<00:04, 50.93it/s]backtest loop:  77%|███████▋  | 747/971 [00:14<00:04, 52.35it/s]backtest loop:  78%|███████▊  | 753/971 [00:14<00:04, 50.08it/s]backtest loop:  78%|███████▊  | 759/971 [00:14<00:04, 51.50it/s]backtest loop:  79%|███████▉  | 765/971 [00:15<00:04, 49.60it/s]backtest loop:  79%|███████▉  | 771/971 [00:15<00:03, 51.24it/s]backtest loop:  80%|████████  | 777/971 [00:15<00:03, 52.50it/s]backtest loop:  81%|████████  | 783/971 [00:15<00:03, 50.79it/s]backtest loop:  81%|████████▏ | 789/971 [00:15<00:03, 52.16it/s]backtest loop:  82%|████████▏ | 795/971 [00:15<00:03, 53.03it/s]backtest loop:  82%|████████▏ | 801/971 [00:15<00:03, 53.34it/s]backtest loop:  83%|████████▎ | 807/971 [00:15<00:03, 53.81it/s]backtest loop:  84%|████████▎ | 813/971 [00:15<00:03, 51.18it/s]backtest loop:  84%|████████▍ | 819/971 [00:16<00:02, 52.40it/s]backtest loop:  85%|████████▍ | 825/971 [00:16<00:02, 53.19it/s]backtest loop:  86%|████████▌ | 831/971 [00:16<00:02, 53.59it/s]backtest loop:  86%|████████▌ | 837/971 [00:16<00:02, 53.45it/s]backtest loop:  87%|████████▋ | 843/971 [00:16<00:02, 50.70it/s]backtest loop:  87%|████████▋ | 849/971 [00:16<00:02, 51.94it/s]backtest loop:  88%|████████▊ | 855/971 [00:16<00:02, 52.89it/s]backtest loop:  89%|████████▊ | 861/971 [00:16<00:02, 53.59it/s]backtest loop:  89%|████████▉ | 867/971 [00:17<00:02, 50.75it/s]backtest loop:  90%|████████▉ | 873/971 [00:17<00:01, 51.97it/s]backtest loop:  91%|█████████ | 879/971 [00:17<00:01, 52.90it/s]backtest loop:  91%|█████████ | 885/971 [00:17<00:01, 53.64it/s]backtest loop:  92%|█████████▏| 891/971 [00:17<00:01, 54.09it/s]backtest loop:  92%|█████████▏| 897/971 [00:17<00:01, 51.25it/s]backtest loop:  93%|█████████▎| 903/971 [00:17<00:01, 52.37it/s]backtest loop:  94%|█████████▎| 909/971 [00:17<00:01, 53.09it/s]backtest loop:  94%|█████████▍| 915/971 [00:17<00:01, 53.93it/s]backtest loop:  95%|█████████▍| 921/971 [00:18<00:00, 51.13it/s]backtest loop:  95%|█████████▌| 927/971 [00:18<00:00, 52.38it/s]backtest loop:  96%|█████████▌| 933/971 [00:18<00:00, 53.27it/s]backtest loop:  97%|█████████▋| 939/971 [00:18<00:00, 53.80it/s]backtest loop:  97%|█████████▋| 945/971 [00:18<00:00, 51.26it/s]backtest loop:  98%|█████████▊| 951/971 [00:18<00:00, 52.38it/s]backtest loop:  99%|█████████▊| 957/971 [00:18<00:00, 53.13it/s]backtest loop:  99%|█████████▉| 963/971 [00:18<00:00, 54.02it/s]backtest loop: 100%|█████████▉| 969/971 [00:18<00:00, 54.38it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 51.16it/s]
[3093195:MainThread](2024-04-25 05:16:06,890) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000473
std                0.005471
annualized_return  0.112634
information_ratio  1.334415
max_drawdown      -0.104727
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000274
std                0.005472
annualized_return  0.065317
information_ratio  0.773695
max_drawdown      -0.111838
[3093195:MainThread](2024-04-25 05:16:06,904) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:16:16,091) INFO - qlib.timer - [log.py:127] - Time cost: 0.007s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933],
 'IC': [0.020637454956468574, 0.018384392846222276],
 'ICIR': [0.1363977555593439, 0.12056425663985118],
 'Rank IC': [0.04052653939231223, 0.032153968726034154],
 'Rank ICIR': [0.2709675937829445, 0.21961644941208022],
 'mae': [0.8637884690110731, 0.8641865647866],
 'mse': [0.9966288064718065, 0.9969241793435271]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:16:19,308) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:16:22,207) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_45.
[3093195:MainThread](2024-04-25 05:16:22,265) INFO - qlib.workflow - [exp.py:258] - Experiment 67 starts running ...
[3093195:MainThread](2024-04-25 05:16:22,280) INFO - qlib.workflow - [recorder.py:341] - Recorder dd0284f162a641a79c29a4fd8cfeb459 starts running under Experiment 67 ...
[3093195:MainThread](2024-04-25 05:16:27,276) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:16:27,276) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:16:27,277) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:16:34,142) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:16:34,459) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998184
[3093195:MainThread](2024-04-25 05:16:34,462) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:16:34,463) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:16:41,425) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:16:41,744) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998151
[3093195:MainThread](2024-04-25 05:16:41,748) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:16:41,749) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:16:48,852) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:16:49,169) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998593
[3093195:MainThread](2024-04-25 05:16:49,170) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:16:49,170) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:16:56,059) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:16:56,374) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998232
[3093195:MainThread](2024-04-25 05:16:56,375) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:16:56,375) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:17:03,291) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:17:03,608) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997887
[3093195:MainThread](2024-04-25 05:17:03,611) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:17:03,612) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:17:10,460) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:17:10,777) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998646
[3093195:MainThread](2024-04-25 05:17:10,777) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:17:10,777) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:17:17,876) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:17:18,193) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998701
[3093195:MainThread](2024-04-25 05:17:18,194) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3093195:MainThread](2024-04-25 05:17:18,194) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:17:25,304) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:17:25,619) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999754
[3093195:MainThread](2024-04-25 05:17:25,619) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch8:
[3093195:MainThread](2024-04-25 05:17:25,619) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:17:32,685) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:17:33,000) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -1.000245
[3093195:MainThread](2024-04-25 05:17:33,001) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch9:
[3093195:MainThread](2024-04-25 05:17:33,001) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:17:39,842) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:17:40,157) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999622
[3093195:MainThread](2024-04-25 05:17:40,157) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:17:40,157) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.997887 @ 4
[3093195:MainThread](2024-04-25 05:17:40,186) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_45.
[3093195:MainThread](2024-04-25 05:17:40,458) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:17:40,472) INFO - qlib.workflow - [recorder.py:341] - Recorder a658c5001b2e4a659563889e087aac90 starts running under Experiment 65 ...
{'IC': 0.025241549798749627,
 'ICIR': 0.18055141124592092,
 'Rank IC': 0.036241671519137895,
 'Rank ICIR': 0.25479198875234993}
[3093195:MainThread](2024-04-25 05:17:46,946) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:18:23,810) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:18:23,813) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:18:29,789) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f45532f4cd0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:39,  9.71it/s]backtest loop:   1%|          | 9/971 [00:00<00:37, 25.60it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:25, 38.02it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 40.62it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:19, 47.61it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 48.15it/s]backtest loop:   4%|▍         | 41/971 [00:00<00:17, 52.58it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:16, 55.62it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 53.72it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:16, 56.36it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:16, 54.55it/s]backtest loop:   8%|▊         | 74/971 [00:01<00:15, 57.03it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:14, 59.40it/s]backtest loop:   9%|▉         | 88/971 [00:01<00:15, 57.30it/s]backtest loop:  10%|▉         | 95/971 [00:01<00:14, 59.00it/s]backtest loop:  11%|█         | 102/971 [00:02<00:15, 56.84it/s]backtest loop:  11%|█         | 109/971 [00:02<00:14, 58.56it/s]backtest loop:  12%|█▏        | 116/971 [00:02<00:14, 59.81it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:14, 57.44it/s]backtest loop:  13%|█▎        | 129/971 [00:02<00:15, 55.22it/s]backtest loop:  14%|█▍        | 136/971 [00:02<00:15, 55.05it/s]backtest loop:  15%|█▍        | 143/971 [00:02<00:14, 57.56it/s]backtest loop:  15%|█▌        | 150/971 [00:02<00:13, 59.06it/s]backtest loop:  16%|█▌        | 156/971 [00:02<00:14, 56.41it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:13, 58.21it/s]backtest loop:  18%|█▊        | 170/971 [00:03<00:13, 60.28it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:13, 57.95it/s]backtest loop:  19%|█▉        | 184/971 [00:03<00:13, 59.42it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:13, 56.68it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 58.58it/s]backtest loop:  21%|██        | 204/971 [00:03<00:12, 59.90it/s]backtest loop:  22%|██▏       | 211/971 [00:03<00:13, 57.58it/s]backtest loop:  22%|██▏       | 217/971 [00:04<00:13, 55.34it/s]backtest loop:  23%|██▎       | 224/971 [00:04<00:12, 58.04it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:19, 38.06it/s]backtest loop:  24%|██▍       | 237/971 [00:04<00:16, 43.40it/s]backtest loop:  25%|██▌       | 244/971 [00:04<00:15, 47.99it/s]backtest loop:  26%|██▌       | 250/971 [00:04<00:14, 48.74it/s]backtest loop:  26%|██▋       | 257/971 [00:04<00:13, 53.49it/s]backtest loop:  27%|██▋       | 264/971 [00:05<00:13, 53.14it/s]backtest loop:  28%|██▊       | 271/971 [00:05<00:13, 52.94it/s]backtest loop:  29%|██▊       | 278/971 [00:05<00:12, 55.64it/s]backtest loop:  29%|██▉       | 285/971 [00:05<00:11, 57.67it/s]backtest loop:  30%|██▉       | 291/971 [00:05<00:12, 55.26it/s]backtest loop:  31%|███       | 298/971 [00:05<00:11, 58.27it/s]backtest loop:  31%|███▏      | 305/971 [00:05<00:11, 56.41it/s]backtest loop:  32%|███▏      | 312/971 [00:05<00:11, 58.09it/s]backtest loop:  33%|███▎      | 319/971 [00:05<00:10, 59.61it/s]backtest loop:  34%|███▎      | 326/971 [00:06<00:11, 57.16it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:10, 58.67it/s]backtest loop:  35%|███▌      | 340/971 [00:06<00:11, 56.92it/s]backtest loop:  36%|███▌      | 347/971 [00:06<00:10, 58.66it/s]backtest loop:  36%|███▋      | 354/971 [00:06<00:10, 59.90it/s]backtest loop:  37%|███▋      | 361/971 [00:06<00:10, 57.57it/s]backtest loop:  38%|███▊      | 367/971 [00:06<00:10, 55.21it/s]backtest loop:  38%|███▊      | 373/971 [00:06<00:11, 53.53it/s]backtest loop:  39%|███▉      | 380/971 [00:07<00:10, 55.98it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:10, 58.08it/s]backtest loop:  40%|████      | 393/971 [00:07<00:10, 55.44it/s]backtest loop:  41%|████      | 399/971 [00:07<00:10, 56.08it/s]backtest loop:  42%|████▏     | 406/971 [00:07<00:09, 57.86it/s]backtest loop:  43%|████▎     | 413/971 [00:07<00:09, 55.84it/s]backtest loop:  43%|████▎     | 419/971 [00:07<00:09, 56.87it/s]backtest loop:  44%|████▍     | 426/971 [00:07<00:09, 58.43it/s]backtest loop:  44%|████▍     | 432/971 [00:07<00:09, 55.51it/s]backtest loop:  45%|████▌     | 439/971 [00:08<00:09, 57.53it/s]backtest loop:  46%|████▌     | 446/971 [00:08<00:08, 58.95it/s]backtest loop:  47%|████▋     | 452/971 [00:08<00:09, 55.95it/s]backtest loop:  47%|████▋     | 458/971 [00:08<00:09, 56.56it/s]backtest loop:  48%|████▊     | 465/971 [00:08<00:08, 58.33it/s]backtest loop:  49%|████▊     | 472/971 [00:08<00:08, 56.17it/s]backtest loop:  49%|████▉     | 479/971 [00:08<00:08, 57.82it/s]backtest loop:  50%|█████     | 486/971 [00:08<00:08, 59.25it/s]backtest loop:  51%|█████     | 492/971 [00:08<00:08, 56.18it/s]backtest loop:  51%|█████▏    | 499/971 [00:09<00:08, 57.94it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:08, 55.36it/s]backtest loop:  53%|█████▎    | 512/971 [00:09<00:08, 54.26it/s]backtest loop:  53%|█████▎    | 519/971 [00:09<00:08, 56.50it/s]backtest loop:  54%|█████▍    | 526/971 [00:09<00:08, 55.19it/s]backtest loop:  55%|█████▍    | 533/971 [00:09<00:07, 57.30it/s]backtest loop:  56%|█████▌    | 540/971 [00:09<00:07, 58.82it/s]backtest loop:  56%|█████▌    | 546/971 [00:09<00:07, 55.80it/s]backtest loop:  57%|█████▋    | 553/971 [00:10<00:07, 57.62it/s]backtest loop:  58%|█████▊    | 559/971 [00:10<00:07, 57.56it/s]backtest loop:  58%|█████▊    | 566/971 [00:10<00:07, 55.66it/s]backtest loop:  59%|█████▉    | 573/971 [00:10<00:06, 57.48it/s]backtest loop:  60%|█████▉    | 580/971 [00:10<00:06, 58.84it/s]backtest loop:  60%|██████    | 586/971 [00:10<00:06, 56.12it/s]backtest loop:  61%|██████    | 593/971 [00:10<00:06, 57.84it/s]backtest loop:  62%|██████▏   | 600/971 [00:10<00:06, 55.91it/s]backtest loop:  63%|██████▎   | 607/971 [00:11<00:06, 57.66it/s]backtest loop:  63%|██████▎   | 613/971 [00:11<00:06, 58.22it/s]backtest loop:  64%|██████▍   | 620/971 [00:11<00:06, 56.22it/s]backtest loop:  65%|██████▍   | 627/971 [00:11<00:05, 58.02it/s]backtest loop:  65%|██████▌   | 634/971 [00:11<00:05, 59.26it/s]backtest loop:  66%|██████▌   | 640/971 [00:11<00:05, 56.73it/s]backtest loop:  67%|██████▋   | 646/971 [00:11<00:05, 57.59it/s]backtest loop:  67%|██████▋   | 653/971 [00:11<00:05, 58.96it/s]backtest loop:  68%|██████▊   | 659/971 [00:11<00:05, 58.66it/s]backtest loop:  68%|██████▊   | 665/971 [00:12<00:05, 55.60it/s]backtest loop:  69%|██████▉   | 671/971 [00:12<00:05, 56.76it/s]backtest loop:  70%|██████▉   | 677/971 [00:12<00:05, 57.65it/s]backtest loop:  70%|███████   | 683/971 [00:12<00:04, 58.08it/s]backtest loop:  71%|███████   | 689/971 [00:12<00:05, 55.18it/s]backtest loop:  72%|███████▏  | 696/971 [00:12<00:04, 57.26it/s]backtest loop:  72%|███████▏  | 703/971 [00:12<00:04, 58.74it/s]backtest loop:  73%|███████▎  | 709/971 [00:12<00:04, 55.72it/s]backtest loop:  74%|███████▎  | 716/971 [00:12<00:04, 57.61it/s]backtest loop:  74%|███████▍  | 723/971 [00:13<00:04, 59.12it/s]backtest loop:  75%|███████▌  | 729/971 [00:13<00:04, 56.15it/s]backtest loop:  76%|███████▌  | 735/971 [00:13<00:04, 54.08it/s]backtest loop:  76%|███████▋  | 741/971 [00:13<00:04, 55.59it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 54.34it/s]backtest loop:  78%|███████▊  | 754/971 [00:13<00:03, 55.68it/s]backtest loop:  78%|███████▊  | 760/971 [00:13<00:03, 53.70it/s]backtest loop:  79%|███████▉  | 767/971 [00:13<00:03, 56.20it/s]backtest loop:  80%|███████▉  | 774/971 [00:13<00:03, 58.10it/s]backtest loop:  80%|████████  | 780/971 [00:14<00:03, 55.40it/s]backtest loop:  81%|████████  | 787/971 [00:14<00:03, 57.37it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 54.88it/s]backtest loop:  82%|████████▏ | 799/971 [00:14<00:03, 56.23it/s]backtest loop:  83%|████████▎ | 805/971 [00:14<00:02, 57.18it/s]backtest loop:  84%|████████▎ | 812/971 [00:14<00:02, 58.76it/s]backtest loop:  84%|████████▍ | 818/971 [00:14<00:02, 55.66it/s]backtest loop:  85%|████████▍ | 825/971 [00:14<00:02, 57.56it/s]backtest loop:  86%|████████▌ | 832/971 [00:14<00:02, 58.90it/s]backtest loop:  86%|████████▋ | 838/971 [00:15<00:02, 55.90it/s]backtest loop:  87%|████████▋ | 845/971 [00:15<00:02, 57.70it/s]backtest loop:  88%|████████▊ | 851/971 [00:15<00:02, 58.12it/s]backtest loop:  88%|████████▊ | 857/971 [00:15<00:02, 54.97it/s]backtest loop:  89%|████████▉ | 864/971 [00:15<00:01, 57.17it/s]backtest loop:  90%|████████▉ | 870/971 [00:15<00:01, 57.89it/s]backtest loop:  90%|█████████ | 876/971 [00:15<00:01, 58.44it/s]backtest loop:  91%|█████████ | 882/971 [00:15<00:01, 55.51it/s]backtest loop:  91%|█████████▏| 888/971 [00:15<00:01, 56.62it/s]backtest loop:  92%|█████████▏| 894/971 [00:16<00:01, 57.33it/s]backtest loop:  93%|█████████▎| 901/971 [00:16<00:01, 58.89it/s]backtest loop:  93%|█████████▎| 907/971 [00:16<00:01, 55.78it/s]backtest loop:  94%|█████████▍| 914/971 [00:16<00:00, 57.79it/s]backtest loop:  95%|█████████▍| 921/971 [00:16<00:00, 55.68it/s]backtest loop:  95%|█████████▌| 927/971 [00:16<00:00, 56.57it/s]backtest loop:  96%|█████████▌| 933/971 [00:16<00:00, 57.43it/s]backtest loop:  97%|█████████▋| 939/971 [00:16<00:00, 57.75it/s]backtest loop:  97%|█████████▋| 945/971 [00:16<00:00, 53.54it/s]backtest loop:  98%|█████████▊| 951/971 [00:17<00:00, 53.99it/s]backtest loop:  99%|█████████▊| 957/971 [00:17<00:00, 53.98it/s]backtest loop:  99%|█████████▉| 963/971 [00:17<00:00, 54.30it/s]backtest loop: 100%|█████████▉| 969/971 [00:17<00:00, 54.57it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 55.58it/s]
[3093195:MainThread](2024-04-25 05:18:47,318) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000573
std                0.005181
annualized_return  0.136275
information_ratio  1.704863
max_drawdown      -0.072147
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000377
std                0.005182
annualized_return  0.089683
information_ratio  1.121827
max_drawdown      -0.078463
[3093195:MainThread](2024-04-25 05:18:47,332) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:18:54,212) INFO - qlib.timer - [log.py:127] - Time cost: 0.007s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737,
                                                    0.08968346707466894],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084,
                                                    1.1218265483587289],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933,
                                               -0.07846341666528217],
 'IC': [0.020637454956468574, 0.018384392846222276, 0.025241549798749627],
 'ICIR': [0.1363977555593439, 0.12056425663985118, 0.18055141124592092],
 'Rank IC': [0.04052653939231223, 0.032153968726034154, 0.036241671519137895],
 'Rank ICIR': [0.2709675937829445, 0.21961644941208022, 0.25479198875234993],
 'mae': [0.8637884690110731, 0.8641865647866, 0.8639522385752554],
 'mse': [0.9966288064718065, 0.9969241793435271, 0.9971921815402262]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:18:57,408) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:19:00,310) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_46.
[3093195:MainThread](2024-04-25 05:19:00,369) INFO - qlib.workflow - [exp.py:258] - Experiment 68 starts running ...
[3093195:MainThread](2024-04-25 05:19:00,387) INFO - qlib.workflow - [recorder.py:341] - Recorder 17a1091af8aa485183d0421e380509b0 starts running under Experiment 68 ...
[3093195:MainThread](2024-04-25 05:19:05,375) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:19:05,376) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:19:05,376) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:19:12,504) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:19:12,819) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999872
[3093195:MainThread](2024-04-25 05:19:12,823) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:19:12,823) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:19:19,975) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:19:20,292) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998753
[3093195:MainThread](2024-04-25 05:19:20,296) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:19:20,296) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:19:27,333) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:19:27,650) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999447
[3093195:MainThread](2024-04-25 05:19:27,651) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:19:27,651) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:19:34,565) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:19:34,880) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999066
[3093195:MainThread](2024-04-25 05:19:34,880) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:19:34,881) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:19:41,951) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:19:42,268) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998896
[3093195:MainThread](2024-04-25 05:19:42,268) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:19:42,268) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:19:49,116) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:19:49,433) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998806
[3093195:MainThread](2024-04-25 05:19:49,434) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:19:49,434) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:19:56,278) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:19:56,594) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998494
[3093195:MainThread](2024-04-25 05:19:56,597) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3093195:MainThread](2024-04-25 05:19:56,597) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:20:03,458) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:20:03,775) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998976
[3093195:MainThread](2024-04-25 05:20:03,776) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch8:
[3093195:MainThread](2024-04-25 05:20:03,776) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:20:10,630) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:20:10,947) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999175
[3093195:MainThread](2024-04-25 05:20:10,947) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch9:
[3093195:MainThread](2024-04-25 05:20:10,947) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:20:17,813) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:20:18,126) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998552
[3093195:MainThread](2024-04-25 05:20:18,126) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch10:
[3093195:MainThread](2024-04-25 05:20:18,126) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:20:25,000) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:20:25,315) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998179
[3093195:MainThread](2024-04-25 05:20:25,318) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch11:
[3093195:MainThread](2024-04-25 05:20:25,319) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:20:32,177) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:20:32,492) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998864
[3093195:MainThread](2024-04-25 05:20:32,493) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch12:
[3093195:MainThread](2024-04-25 05:20:32,493) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:20:39,401) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:20:39,715) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998593
[3093195:MainThread](2024-04-25 05:20:39,716) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch13:
[3093195:MainThread](2024-04-25 05:20:39,716) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:20:47,019) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:20:47,335) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997946
[3093195:MainThread](2024-04-25 05:20:47,338) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch14:
[3093195:MainThread](2024-04-25 05:20:47,339) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:20:54,489) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:20:54,801) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997690
[3093195:MainThread](2024-04-25 05:20:54,805) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch15:
[3093195:MainThread](2024-04-25 05:20:54,805) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:21:01,803) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:21:02,118) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998745
[3093195:MainThread](2024-04-25 05:21:02,119) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch16:
[3093195:MainThread](2024-04-25 05:21:02,119) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:21:09,135) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:21:09,451) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997690
[3093195:MainThread](2024-04-25 05:21:09,454) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch17:
[3093195:MainThread](2024-04-25 05:21:09,454) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:21:16,410) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:21:16,725) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997812
[3093195:MainThread](2024-04-25 05:21:16,725) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch18:
[3093195:MainThread](2024-04-25 05:21:16,726) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:21:23,657) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:21:23,972) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999153
[3093195:MainThread](2024-04-25 05:21:23,972) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch19:
[3093195:MainThread](2024-04-25 05:21:23,973) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:21:30,827) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:21:31,143) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999610
[3093195:MainThread](2024-04-25 05:21:31,144) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch20:
[3093195:MainThread](2024-04-25 05:21:31,144) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:21:37,992) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:21:38,307) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999503
[3093195:MainThread](2024-04-25 05:21:38,308) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch21:
[3093195:MainThread](2024-04-25 05:21:38,308) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:21:45,356) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:21:45,670) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999248
[3093195:MainThread](2024-04-25 05:21:45,670) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:21:45,671) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.997690 @ 16
[3093195:MainThread](2024-04-25 05:21:45,704) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_46.
[3093195:MainThread](2024-04-25 05:21:45,980) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:21:45,994) INFO - qlib.workflow - [recorder.py:341] - Recorder 10851b703c374fcca1ef804746d32070 starts running under Experiment 65 ...
{'IC': 0.026925119124198496,
 'ICIR': 0.20625217894659637,
 'Rank IC': 0.03890135583227345,
 'Rank ICIR': 0.2964856332378628}
[3093195:MainThread](2024-04-25 05:21:52,831) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:22:30,103) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:22:30,106) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:22:36,144) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f44e7861430>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:43,  9.36it/s]backtest loop:   1%|          | 9/971 [00:00<00:38, 24.96it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:25, 37.34it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 40.18it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:19, 47.35it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 47.78it/s]backtest loop:   4%|▍         | 41/971 [00:00<00:17, 52.32it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:16, 55.54it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 53.48it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:16, 56.15it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:16, 54.21it/s]backtest loop:   8%|▊         | 73/971 [00:01<00:16, 55.78it/s]backtest loop:   8%|▊         | 80/971 [00:01<00:15, 57.78it/s]backtest loop:   9%|▉         | 86/971 [00:01<00:15, 58.33it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 55.20it/s]backtest loop:  10%|█         | 98/971 [00:01<00:15, 56.40it/s]backtest loop:  11%|█         | 104/971 [00:02<00:15, 57.35it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:14, 59.04it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:15, 55.62it/s]backtest loop:  13%|█▎        | 124/971 [00:02<00:14, 58.56it/s]backtest loop:  13%|█▎        | 130/971 [00:02<00:14, 56.20it/s]backtest loop:  14%|█▍        | 136/971 [00:02<00:15, 53.65it/s]backtest loop:  15%|█▍        | 143/971 [00:02<00:14, 56.09it/s]backtest loop:  15%|█▌        | 150/971 [00:02<00:14, 57.91it/s]backtest loop:  16%|█▌        | 156/971 [00:03<00:14, 55.19it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:14, 57.20it/s]backtest loop:  18%|█▊        | 170/971 [00:03<00:13, 59.21it/s]backtest loop:  18%|█▊        | 176/971 [00:03<00:14, 56.10it/s]backtest loop:  19%|█▊        | 182/971 [00:03<00:14, 55.28it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:14, 55.26it/s]backtest loop:  20%|█▉        | 194/971 [00:03<00:14, 55.40it/s]backtest loop:  21%|██        | 200/971 [00:03<00:14, 52.06it/s]backtest loop:  21%|██        | 206/971 [00:03<00:14, 53.03it/s]backtest loop:  22%|██▏       | 212/971 [00:04<00:14, 53.92it/s]backtest loop:  22%|██▏       | 218/971 [00:04<00:14, 51.34it/s]backtest loop:  23%|██▎       | 224/971 [00:04<00:22, 33.34it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:20, 36.22it/s]backtest loop:  24%|██▍       | 236/971 [00:04<00:18, 40.33it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:16, 43.95it/s]backtest loop:  26%|██▌       | 248/971 [00:04<00:15, 46.76it/s]backtest loop:  26%|██▌       | 254/971 [00:05<00:15, 46.28it/s]backtest loop:  27%|██▋       | 260/971 [00:05<00:14, 48.90it/s]backtest loop:  27%|██▋       | 266/971 [00:05<00:14, 47.78it/s]backtest loop:  28%|██▊       | 272/971 [00:05<00:14, 49.72it/s]backtest loop:  29%|██▊       | 278/971 [00:05<00:13, 51.25it/s]backtest loop:  29%|██▉       | 284/971 [00:05<00:13, 52.31it/s]backtest loop:  30%|██▉       | 290/971 [00:05<00:12, 53.03it/s]backtest loop:  30%|███       | 296/971 [00:05<00:13, 50.79it/s]backtest loop:  31%|███       | 302/971 [00:06<00:12, 51.90it/s]backtest loop:  32%|███▏      | 308/971 [00:06<00:12, 52.76it/s]backtest loop:  32%|███▏      | 314/971 [00:06<00:12, 53.44it/s]backtest loop:  33%|███▎      | 320/971 [00:06<00:12, 50.66it/s]backtest loop:  34%|███▎      | 326/971 [00:06<00:12, 52.04it/s]backtest loop:  34%|███▍      | 332/971 [00:06<00:12, 52.92it/s]backtest loop:  35%|███▍      | 338/971 [00:06<00:11, 53.89it/s]backtest loop:  35%|███▌      | 344/971 [00:06<00:11, 54.21it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:12, 51.37it/s]backtest loop:  37%|███▋      | 356/971 [00:07<00:11, 52.46it/s]backtest loop:  37%|███▋      | 362/971 [00:07<00:11, 53.56it/s]backtest loop:  38%|███▊      | 368/971 [00:07<00:12, 47.93it/s]backtest loop:  39%|███▊      | 374/971 [00:07<00:11, 49.78it/s]backtest loop:  39%|███▉      | 380/971 [00:07<00:11, 51.19it/s]backtest loop:  40%|███▉      | 386/971 [00:07<00:11, 52.27it/s]backtest loop:  40%|████      | 392/971 [00:07<00:10, 53.09it/s]backtest loop:  41%|████      | 398/971 [00:07<00:11, 50.60it/s]backtest loop:  42%|████▏     | 404/971 [00:07<00:10, 51.78it/s]backtest loop:  42%|████▏     | 410/971 [00:08<00:10, 52.82it/s]backtest loop:  43%|████▎     | 416/971 [00:08<00:10, 53.11it/s]backtest loop:  43%|████▎     | 422/971 [00:08<00:10, 53.66it/s]backtest loop:  44%|████▍     | 428/971 [00:08<00:10, 50.82it/s]backtest loop:  45%|████▍     | 434/971 [00:08<00:10, 51.98it/s]backtest loop:  45%|████▌     | 440/971 [00:08<00:10, 52.56it/s]backtest loop:  46%|████▌     | 446/971 [00:08<00:09, 53.43it/s]backtest loop:  47%|████▋     | 452/971 [00:08<00:10, 50.63it/s]backtest loop:  47%|████▋     | 458/971 [00:08<00:09, 51.86it/s]backtest loop:  48%|████▊     | 464/971 [00:09<00:09, 52.24it/s]backtest loop:  48%|████▊     | 470/971 [00:09<00:09, 52.95it/s]backtest loop:  49%|████▉     | 476/971 [00:09<00:09, 53.50it/s]backtest loop:  50%|████▉     | 482/971 [00:09<00:09, 50.36it/s]backtest loop:  50%|█████     | 488/971 [00:09<00:09, 51.50it/s]backtest loop:  51%|█████     | 494/971 [00:09<00:09, 52.57it/s]backtest loop:  51%|█████▏    | 500/971 [00:09<00:09, 50.15it/s]backtest loop:  52%|█████▏    | 506/971 [00:09<00:09, 51.65it/s]backtest loop:  53%|█████▎    | 512/971 [00:10<00:09, 49.37it/s]backtest loop:  53%|█████▎    | 518/971 [00:10<00:08, 51.15it/s]backtest loop:  54%|█████▍    | 524/971 [00:10<00:08, 52.27it/s]backtest loop:  55%|█████▍    | 530/971 [00:10<00:08, 53.54it/s]backtest loop:  55%|█████▌    | 536/971 [00:10<00:08, 50.89it/s]backtest loop:  56%|█████▌    | 542/971 [00:10<00:08, 52.19it/s]backtest loop:  56%|█████▋    | 548/971 [00:10<00:07, 52.94it/s]backtest loop:  57%|█████▋    | 554/971 [00:10<00:07, 53.60it/s]backtest loop:  58%|█████▊    | 560/971 [00:10<00:07, 54.07it/s]backtest loop:  58%|█████▊    | 566/971 [00:11<00:07, 51.14it/s]backtest loop:  59%|█████▉    | 572/971 [00:11<00:07, 52.26it/s]backtest loop:  60%|█████▉    | 578/971 [00:11<00:07, 53.08it/s]backtest loop:  60%|██████    | 584/971 [00:11<00:07, 53.89it/s]backtest loop:  61%|██████    | 590/971 [00:11<00:07, 54.33it/s]backtest loop:  61%|██████▏   | 596/971 [00:11<00:07, 51.37it/s]backtest loop:  62%|██████▏   | 602/971 [00:11<00:07, 52.38it/s]backtest loop:  63%|██████▎   | 608/971 [00:11<00:06, 53.22it/s]backtest loop:  63%|██████▎   | 614/971 [00:11<00:06, 53.81it/s]backtest loop:  64%|██████▍   | 620/971 [00:12<00:06, 50.95it/s]backtest loop:  64%|██████▍   | 626/971 [00:12<00:06, 52.28it/s]backtest loop:  65%|██████▌   | 632/971 [00:12<00:06, 53.07it/s]backtest loop:  66%|██████▌   | 638/971 [00:12<00:06, 54.15it/s]backtest loop:  66%|██████▋   | 644/971 [00:12<00:06, 54.48it/s]backtest loop:  67%|██████▋   | 650/971 [00:12<00:06, 51.35it/s]backtest loop:  68%|██████▊   | 656/971 [00:12<00:06, 52.38it/s]backtest loop:  68%|██████▊   | 662/971 [00:12<00:05, 53.17it/s]backtest loop:  69%|██████▉   | 668/971 [00:12<00:05, 53.74it/s]backtest loop:  69%|██████▉   | 674/971 [00:13<00:05, 50.76it/s]backtest loop:  70%|███████   | 680/971 [00:13<00:05, 51.93it/s]backtest loop:  71%|███████   | 686/971 [00:13<00:05, 52.58it/s]backtest loop:  71%|███████▏  | 692/971 [00:13<00:05, 53.22it/s]backtest loop:  72%|███████▏  | 698/971 [00:13<00:05, 53.72it/s]backtest loop:  73%|███████▎  | 704/971 [00:13<00:05, 50.71it/s]backtest loop:  73%|███████▎  | 710/971 [00:13<00:05, 51.83it/s]backtest loop:  74%|███████▎  | 716/971 [00:13<00:04, 52.78it/s]backtest loop:  74%|███████▍  | 722/971 [00:14<00:04, 53.39it/s]backtest loop:  75%|███████▍  | 728/971 [00:14<00:04, 53.81it/s]backtest loop:  76%|███████▌  | 734/971 [00:14<00:04, 47.93it/s]backtest loop:  76%|███████▌  | 740/971 [00:14<00:04, 49.73it/s]backtest loop:  77%|███████▋  | 746/971 [00:14<00:04, 51.40it/s]backtest loop:  77%|███████▋  | 752/971 [00:14<00:04, 49.56it/s]backtest loop:  78%|███████▊  | 758/971 [00:14<00:04, 50.78it/s]backtest loop:  79%|███████▊  | 764/971 [00:14<00:03, 52.00it/s]backtest loop:  79%|███████▉  | 770/971 [00:14<00:04, 49.75it/s]backtest loop:  80%|███████▉  | 776/971 [00:15<00:03, 51.22it/s]backtest loop:  81%|████████  | 782/971 [00:15<00:03, 52.02it/s]backtest loop:  81%|████████  | 788/971 [00:15<00:03, 49.82it/s]backtest loop:  82%|████████▏ | 794/971 [00:15<00:03, 51.36it/s]backtest loop:  82%|████████▏ | 800/971 [00:15<00:03, 52.36it/s]backtest loop:  83%|████████▎ | 806/971 [00:15<00:03, 53.15it/s]backtest loop:  84%|████████▎ | 812/971 [00:15<00:02, 53.47it/s]backtest loop:  84%|████████▍ | 818/971 [00:15<00:03, 50.76it/s]backtest loop:  85%|████████▍ | 824/971 [00:16<00:02, 51.95it/s]backtest loop:  85%|████████▌ | 830/971 [00:16<00:02, 52.84it/s]backtest loop:  86%|████████▌ | 836/971 [00:16<00:02, 53.48it/s]backtest loop:  87%|████████▋ | 842/971 [00:16<00:02, 53.86it/s]backtest loop:  87%|████████▋ | 848/971 [00:16<00:02, 51.01it/s]backtest loop:  88%|████████▊ | 854/971 [00:16<00:02, 52.15it/s]backtest loop:  89%|████████▊ | 860/971 [00:16<00:02, 53.00it/s]backtest loop:  89%|████████▉ | 866/971 [00:16<00:01, 53.59it/s]backtest loop:  90%|████████▉ | 872/971 [00:16<00:01, 50.76it/s]backtest loop:  90%|█████████ | 878/971 [00:17<00:01, 51.84it/s]backtest loop:  91%|█████████ | 884/971 [00:17<00:01, 52.80it/s]backtest loop:  92%|█████████▏| 890/971 [00:17<00:01, 53.48it/s]backtest loop:  92%|█████████▏| 896/971 [00:17<00:01, 53.94it/s]backtest loop:  93%|█████████▎| 902/971 [00:17<00:01, 51.15it/s]backtest loop:  94%|█████████▎| 908/971 [00:17<00:01, 52.24it/s]backtest loop:  94%|█████████▍| 914/971 [00:17<00:01, 53.07it/s]backtest loop:  95%|█████████▍| 920/971 [00:17<00:00, 53.68it/s]backtest loop:  95%|█████████▌| 926/971 [00:17<00:00, 50.91it/s]backtest loop:  96%|█████████▌| 932/971 [00:18<00:00, 52.19it/s]backtest loop:  97%|█████████▋| 938/971 [00:18<00:00, 53.01it/s]backtest loop:  97%|█████████▋| 944/971 [00:18<00:00, 53.58it/s]backtest loop:  98%|█████████▊| 950/971 [00:18<00:00, 50.83it/s]backtest loop:  98%|█████████▊| 956/971 [00:18<00:00, 52.10it/s]backtest loop:  99%|█████████▉| 962/971 [00:18<00:00, 52.91it/s]backtest loop: 100%|█████████▉| 968/971 [00:18<00:00, 53.55it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 51.58it/s]
[3093195:MainThread](2024-04-25 05:22:55,032) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000669
std                0.004830
annualized_return  0.159320
information_ratio  2.138085
max_drawdown      -0.054983
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000472
std                0.004832
annualized_return  0.112238
information_ratio  1.505797
max_drawdown      -0.069964
[3093195:MainThread](2024-04-25 05:22:55,046) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:23:01,925) INFO - qlib.timer - [log.py:127] - Time cost: 0.006s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737,
                                                    0.08968346707466894,
                                                    0.11223778513394758],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084,
                                                    1.1218265483587289,
                                                    1.5057970219122332],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933,
                                               -0.07846341666528217,
                                               -0.06996440873715659],
 'IC': [0.020637454956468574,
        0.018384392846222276,
        0.025241549798749627,
        0.026925119124198496],
 'ICIR': [0.1363977555593439,
          0.12056425663985118,
          0.18055141124592092,
          0.20625217894659637],
 'Rank IC': [0.04052653939231223,
             0.032153968726034154,
             0.036241671519137895,
             0.03890135583227345],
 'Rank ICIR': [0.2709675937829445,
               0.21961644941208022,
               0.25479198875234993,
               0.2964856332378628],
 'mae': [0.8637884690110731,
         0.8641865647866,
         0.8639522385752554,
         0.8636988725136276],
 'mse': [0.9966288064718065,
         0.9969241793435271,
         0.9971921815402262,
         0.9981024944682831]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:23:05,140) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:23:08,041) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_47.
[3093195:MainThread](2024-04-25 05:23:08,102) INFO - qlib.workflow - [exp.py:258] - Experiment 69 starts running ...
[3093195:MainThread](2024-04-25 05:23:08,115) INFO - qlib.workflow - [recorder.py:341] - Recorder 235be0685cdb46fbab2bd52e661f804e starts running under Experiment 69 ...
[3093195:MainThread](2024-04-25 05:23:13,154) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:23:13,155) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:23:13,155) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:23:20,093) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:23:20,409) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998292
[3093195:MainThread](2024-04-25 05:23:20,412) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:23:20,413) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:23:27,460) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:23:27,776) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998015
[3093195:MainThread](2024-04-25 05:23:27,779) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:23:27,779) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:23:34,878) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:23:35,197) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998390
[3093195:MainThread](2024-04-25 05:23:35,198) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:23:35,198) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:23:42,076) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:23:42,394) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999408
[3093195:MainThread](2024-04-25 05:23:42,394) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:23:42,394) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:23:49,353) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:23:49,670) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998483
[3093195:MainThread](2024-04-25 05:23:49,670) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:23:49,670) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:23:56,536) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:23:56,848) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998520
[3093195:MainThread](2024-04-25 05:23:56,848) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:23:56,848) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:24:03,868) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:24:04,183) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998896
[3093195:MainThread](2024-04-25 05:24:04,183) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:24:04,183) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.998015 @ 1
[3093195:MainThread](2024-04-25 05:24:04,215) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_47.
[3093195:MainThread](2024-04-25 05:24:04,487) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:24:04,501) INFO - qlib.workflow - [recorder.py:341] - Recorder a6be0b5aa9874c56ba6e6ed102cd1988 starts running under Experiment 65 ...
{'IC': 0.014817320525268003,
 'ICIR': 0.09992783537754027,
 'Rank IC': 0.02623694421706984,
 'Rank ICIR': 0.17100811058911927}
[3093195:MainThread](2024-04-25 05:24:11,177) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:24:48,379) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:24:48,383) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:24:54,406) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f455d557490>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:45,  9.14it/s]backtest loop:   1%|          | 8/971 [00:00<00:45, 21.00it/s]backtest loop:   1%|▏         | 14/971 [00:00<00:30, 31.37it/s]backtest loop:   2%|▏         | 19/971 [00:00<00:26, 36.12it/s]backtest loop:   2%|▏         | 24/971 [00:00<00:25, 37.82it/s]backtest loop:   3%|▎         | 29/971 [00:00<00:23, 40.61it/s]backtest loop:   4%|▎         | 35/971 [00:00<00:21, 44.52it/s]backtest loop:   4%|▍         | 40/971 [00:01<00:20, 45.36it/s]backtest loop:   5%|▍         | 46/971 [00:01<00:19, 47.87it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:19, 47.52it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:19, 46.42it/s]backtest loop:   6%|▋         | 62/971 [00:01<00:19, 46.66it/s]backtest loop:   7%|▋         | 68/971 [00:01<00:18, 49.07it/s]backtest loop:   8%|▊         | 73/971 [00:01<00:18, 48.18it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:18, 48.86it/s]backtest loop:   9%|▉         | 85/971 [00:02<00:17, 50.42it/s]backtest loop:   9%|▉         | 91/971 [00:02<00:16, 52.13it/s]backtest loop:  10%|▉         | 97/971 [00:02<00:16, 51.48it/s]backtest loop:  11%|█         | 104/971 [00:02<00:15, 54.65it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:15, 57.18it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:15, 54.89it/s]backtest loop:  13%|█▎        | 124/971 [00:02<00:14, 57.31it/s]backtest loop:  13%|█▎        | 130/971 [00:02<00:15, 54.84it/s]backtest loop:  14%|█▍        | 136/971 [00:02<00:15, 53.48it/s]backtest loop:  15%|█▍        | 143/971 [00:03<00:14, 56.25it/s]backtest loop:  15%|█▌        | 150/971 [00:03<00:14, 58.30it/s]backtest loop:  16%|█▌        | 156/971 [00:03<00:14, 55.56it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:14, 57.50it/s]backtest loop:  18%|█▊        | 170/971 [00:03<00:13, 59.44it/s]backtest loop:  18%|█▊        | 176/971 [00:03<00:14, 56.63it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:13, 58.40it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:13, 56.47it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 58.38it/s]backtest loop:  21%|██        | 204/971 [00:04<00:12, 59.67it/s]backtest loop:  22%|██▏       | 210/971 [00:04<00:13, 56.99it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 55.15it/s]backtest loop:  23%|██▎       | 223/971 [00:04<00:13, 57.26it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:20, 36.91it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:18, 39.92it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:16, 45.17it/s]backtest loop:  26%|██▌       | 249/971 [00:05<00:15, 47.47it/s]backtest loop:  26%|██▋       | 256/971 [00:05<00:13, 51.36it/s]backtest loop:  27%|██▋       | 263/971 [00:05<00:13, 54.34it/s]backtest loop:  28%|██▊       | 269/971 [00:05<00:13, 53.04it/s]backtest loop:  28%|██▊       | 276/971 [00:05<00:13, 52.95it/s]backtest loop:  29%|██▉       | 283/971 [00:05<00:12, 55.47it/s]backtest loop:  30%|██▉       | 290/971 [00:05<00:11, 57.41it/s]backtest loop:  30%|███       | 296/971 [00:05<00:12, 54.89it/s]backtest loop:  31%|███       | 303/971 [00:06<00:11, 56.96it/s]backtest loop:  32%|███▏      | 310/971 [00:06<00:11, 55.36it/s]backtest loop:  33%|███▎      | 316/971 [00:06<00:11, 56.07it/s]backtest loop:  33%|███▎      | 323/971 [00:06<00:11, 58.10it/s]backtest loop:  34%|███▍      | 330/971 [00:06<00:11, 56.16it/s]backtest loop:  35%|███▍      | 337/971 [00:06<00:10, 57.83it/s]backtest loop:  35%|███▌      | 343/971 [00:06<00:10, 58.33it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:11, 56.33it/s]backtest loop:  37%|███▋      | 357/971 [00:06<00:10, 58.23it/s]backtest loop:  37%|███▋      | 363/971 [00:07<00:10, 56.00it/s]backtest loop:  38%|███▊      | 369/971 [00:07<00:11, 54.02it/s]backtest loop:  39%|███▊      | 376/971 [00:07<00:10, 56.42it/s]backtest loop:  39%|███▉      | 383/971 [00:07<00:10, 54.93it/s]backtest loop:  40%|████      | 390/971 [00:07<00:10, 57.05it/s]backtest loop:  41%|████      | 397/971 [00:07<00:09, 58.81it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 55.84it/s]backtest loop:  42%|████▏     | 410/971 [00:07<00:09, 58.05it/s]backtest loop:  43%|████▎     | 416/971 [00:08<00:09, 58.23it/s]backtest loop:  43%|████▎     | 422/971 [00:08<00:09, 58.63it/s]backtest loop:  44%|████▍     | 428/971 [00:08<00:09, 55.68it/s]backtest loop:  45%|████▍     | 435/971 [00:08<00:09, 57.64it/s]backtest loop:  46%|████▌     | 442/971 [00:08<00:09, 55.66it/s]backtest loop:  46%|████▌     | 449/971 [00:08<00:09, 57.49it/s]backtest loop:  47%|████▋     | 455/971 [00:08<00:08, 58.12it/s]backtest loop:  48%|████▊     | 462/971 [00:08<00:09, 56.03it/s]backtest loop:  48%|████▊     | 469/971 [00:08<00:08, 57.89it/s]backtest loop:  49%|████▉     | 476/971 [00:09<00:08, 59.27it/s]backtest loop:  50%|████▉     | 482/971 [00:09<00:08, 56.07it/s]backtest loop:  50%|█████     | 488/971 [00:09<00:08, 56.65it/s]backtest loop:  51%|█████     | 495/971 [00:09<00:08, 55.16it/s]backtest loop:  52%|█████▏    | 502/971 [00:09<00:08, 57.38it/s]backtest loop:  52%|█████▏    | 508/971 [00:09<00:08, 54.96it/s]backtest loop:  53%|█████▎    | 514/971 [00:09<00:08, 56.17it/s]backtest loop:  54%|█████▎    | 521/971 [00:09<00:07, 58.19it/s]backtest loop:  54%|█████▍    | 527/971 [00:09<00:08, 55.40it/s]backtest loop:  55%|█████▍    | 534/971 [00:10<00:07, 57.58it/s]backtest loop:  56%|█████▌    | 541/971 [00:10<00:07, 55.70it/s]backtest loop:  56%|█████▋    | 548/971 [00:10<00:07, 57.61it/s]backtest loop:  57%|█████▋    | 555/971 [00:10<00:07, 59.06it/s]backtest loop:  58%|█████▊    | 561/971 [00:10<00:07, 56.04it/s]backtest loop:  58%|█████▊    | 568/971 [00:10<00:06, 57.85it/s]backtest loop:  59%|█████▉    | 575/971 [00:10<00:06, 59.18it/s]backtest loop:  60%|█████▉    | 581/971 [00:10<00:06, 56.23it/s]backtest loop:  61%|██████    | 588/971 [00:11<00:06, 58.03it/s]backtest loop:  61%|██████▏   | 595/971 [00:11<00:06, 59.30it/s]backtest loop:  62%|██████▏   | 601/971 [00:11<00:06, 56.32it/s]backtest loop:  63%|██████▎   | 608/971 [00:11<00:06, 58.08it/s]backtest loop:  63%|██████▎   | 615/971 [00:11<00:06, 56.11it/s]backtest loop:  64%|██████▍   | 622/971 [00:11<00:06, 57.87it/s]backtest loop:  65%|██████▍   | 629/971 [00:11<00:05, 59.37it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:05, 56.54it/s]backtest loop:  66%|██████▌   | 642/971 [00:11<00:05, 58.35it/s]backtest loop:  67%|██████▋   | 649/971 [00:12<00:05, 59.54it/s]backtest loop:  67%|██████▋   | 655/971 [00:12<00:05, 56.38it/s]backtest loop:  68%|██████▊   | 662/971 [00:12<00:05, 58.10it/s]backtest loop:  69%|██████▉   | 669/971 [00:12<00:05, 59.33it/s]backtest loop:  70%|██████▉   | 675/971 [00:12<00:05, 56.32it/s]backtest loop:  70%|███████   | 681/971 [00:12<00:05, 57.30it/s]backtest loop:  71%|███████   | 687/971 [00:12<00:04, 58.03it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:04, 55.92it/s]backtest loop:  72%|███████▏  | 701/971 [00:12<00:04, 57.83it/s]backtest loop:  73%|███████▎  | 708/971 [00:13<00:04, 59.16it/s]backtest loop:  74%|███████▎  | 714/971 [00:13<00:04, 55.86it/s]backtest loop:  74%|███████▍  | 721/971 [00:13<00:04, 57.73it/s]backtest loop:  75%|███████▍  | 728/971 [00:13<00:04, 59.25it/s]backtest loop:  76%|███████▌  | 734/971 [00:13<00:04, 53.60it/s]backtest loop:  76%|███████▋  | 741/971 [00:13<00:04, 56.04it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 54.87it/s]backtest loop:  78%|███████▊  | 755/971 [00:13<00:04, 53.97it/s]backtest loop:  78%|███████▊  | 762/971 [00:14<00:03, 56.33it/s]backtest loop:  79%|███████▉  | 769/971 [00:14<00:03, 58.01it/s]backtest loop:  80%|███████▉  | 775/971 [00:14<00:03, 55.57it/s]backtest loop:  81%|████████  | 782/971 [00:14<00:03, 57.83it/s]backtest loop:  81%|████████  | 788/971 [00:14<00:03, 55.54it/s]backtest loop:  82%|████████▏ | 795/971 [00:14<00:03, 57.48it/s]backtest loop:  83%|████████▎ | 802/971 [00:14<00:02, 58.85it/s]backtest loop:  83%|████████▎ | 808/971 [00:14<00:02, 55.70it/s]backtest loop:  84%|████████▍ | 814/971 [00:15<00:02, 56.78it/s]backtest loop:  84%|████████▍ | 820/971 [00:15<00:02, 57.66it/s]backtest loop:  85%|████████▌ | 827/971 [00:15<00:02, 59.06it/s]backtest loop:  86%|████████▌ | 833/971 [00:15<00:02, 56.02it/s]backtest loop:  87%|████████▋ | 840/971 [00:15<00:02, 57.84it/s]backtest loop:  87%|████████▋ | 847/971 [00:15<00:02, 59.12it/s]backtest loop:  88%|████████▊ | 853/971 [00:15<00:02, 56.06it/s]backtest loop:  89%|████████▊ | 860/971 [00:15<00:01, 57.86it/s]backtest loop:  89%|████████▉ | 866/971 [00:15<00:01, 56.71it/s]backtest loop:  90%|████████▉ | 872/971 [00:16<00:01, 52.97it/s]backtest loop:  90%|█████████ | 878/971 [00:16<00:01, 53.51it/s]backtest loop:  91%|█████████ | 884/971 [00:16<00:01, 53.87it/s]backtest loop:  92%|█████████▏| 890/971 [00:16<00:01, 54.12it/s]backtest loop:  92%|█████████▏| 896/971 [00:16<00:01, 54.26it/s]backtest loop:  93%|█████████▎| 902/971 [00:16<00:01, 51.07it/s]backtest loop:  94%|█████████▎| 908/971 [00:16<00:01, 52.13it/s]backtest loop:  94%|█████████▍| 914/971 [00:16<00:01, 53.01it/s]backtest loop:  95%|█████████▍| 920/971 [00:16<00:00, 53.58it/s]backtest loop:  95%|█████████▌| 926/971 [00:17<00:00, 50.86it/s]backtest loop:  96%|█████████▌| 932/971 [00:17<00:00, 52.11it/s]backtest loop:  97%|█████████▋| 938/971 [00:17<00:00, 52.95it/s]backtest loop:  97%|█████████▋| 944/971 [00:17<00:00, 53.66it/s]backtest loop:  98%|█████████▊| 950/971 [00:17<00:00, 50.86it/s]backtest loop:  98%|█████████▊| 956/971 [00:17<00:00, 52.04it/s]backtest loop:  99%|█████████▉| 962/971 [00:17<00:00, 52.93it/s]backtest loop: 100%|█████████▉| 968/971 [00:17<00:00, 53.57it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.19it/s]
[3093195:MainThread](2024-04-25 05:25:12,383) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000197
std                0.005839
annualized_return  0.046796
information_ratio  0.519449
max_drawdown      -0.129814
'The following are analysis results of the excess return with cost(1day).'
                           risk
mean              -9.185314e-07
std                5.840572e-03
annualized_return -2.186105e-04
information_ratio -2.426203e-03
max_drawdown      -1.662236e-01
[3093195:MainThread](2024-04-25 05:25:12,396) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:25:19,232) INFO - qlib.timer - [log.py:127] - Time cost: 0.006s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737,
                                                    0.08968346707466894,
                                                    0.11223778513394758,
                                                    -0.0002186104664208714],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084,
                                                    1.1218265483587289,
                                                    1.5057970219122332,
                                                    -0.002426202610177372],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933,
                                               -0.07846341666528217,
                                               -0.06996440873715659,
                                               -0.1662235786401427],
 'IC': [0.020637454956468574,
        0.018384392846222276,
        0.025241549798749627,
        0.026925119124198496,
        0.014817320525268003],
 'ICIR': [0.1363977555593439,
          0.12056425663985118,
          0.18055141124592092,
          0.20625217894659637,
          0.09992783537754027],
 'Rank IC': [0.04052653939231223,
             0.032153968726034154,
             0.036241671519137895,
             0.03890135583227345,
             0.02623694421706984],
 'Rank ICIR': [0.2709675937829445,
               0.21961644941208022,
               0.25479198875234993,
               0.2964856332378628,
               0.17100811058911927],
 'mae': [0.8637884690110731,
         0.8641865647866,
         0.8639522385752554,
         0.8636988725136276,
         0.8644248587081322],
 'mse': [0.9966288064718065,
         0.9969241793435271,
         0.9971921815402262,
         0.9981024944682831,
         0.9973450664619631]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:25:22,484) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:25:25,376) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_48.
[3093195:MainThread](2024-04-25 05:25:25,437) INFO - qlib.workflow - [exp.py:258] - Experiment 70 starts running ...
[3093195:MainThread](2024-04-25 05:25:25,455) INFO - qlib.workflow - [recorder.py:341] - Recorder f4a56a779c1b43bcb611e930b6401fc1 starts running under Experiment 70 ...
[3093195:MainThread](2024-04-25 05:25:30,461) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:25:30,462) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:25:30,462) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:25:37,597) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:25:37,911) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999823
[3093195:MainThread](2024-04-25 05:25:37,915) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:25:37,915) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:25:45,057) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:25:45,372) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999066
[3093195:MainThread](2024-04-25 05:25:45,376) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:25:45,376) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:25:52,376) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:25:52,691) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998478
[3093195:MainThread](2024-04-25 05:25:52,694) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:25:52,695) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:25:59,552) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:25:59,867) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998048
[3093195:MainThread](2024-04-25 05:25:59,870) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:25:59,870) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:26:07,061) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:26:07,375) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997898
[3093195:MainThread](2024-04-25 05:26:07,378) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:26:07,379) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:26:14,330) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:26:14,646) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998465
[3093195:MainThread](2024-04-25 05:26:14,646) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:26:14,646) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:26:21,525) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:26:21,843) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998084
[3093195:MainThread](2024-04-25 05:26:21,843) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3093195:MainThread](2024-04-25 05:26:21,844) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:26:28,713) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:26:29,030) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999442
[3093195:MainThread](2024-04-25 05:26:29,031) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch8:
[3093195:MainThread](2024-04-25 05:26:29,031) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:26:35,939) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:26:36,251) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998203
[3093195:MainThread](2024-04-25 05:26:36,252) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch9:
[3093195:MainThread](2024-04-25 05:26:36,252) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:26:43,291) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:26:43,606) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998811
[3093195:MainThread](2024-04-25 05:26:43,607) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:26:43,607) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.997898 @ 4
[3093195:MainThread](2024-04-25 05:26:43,638) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_48.
[3093195:MainThread](2024-04-25 05:26:43,911) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:26:43,926) INFO - qlib.workflow - [recorder.py:341] - Recorder eee65e93f10b40fcb47dd1f7a5c96ea7 starts running under Experiment 65 ...
{'IC': 0.025456744893419838,
 'ICIR': 0.1815812518355052,
 'Rank IC': 0.04059155499944135,
 'Rank ICIR': 0.291274386612759}
[3093195:MainThread](2024-04-25 05:26:50,854) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:27:28,359) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:27:28,362) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:27:34,454) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f45562b8100>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:44,  9.22it/s]backtest loop:   1%|          | 9/971 [00:00<00:40, 23.75it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:28, 33.59it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:25, 37.41it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:22, 42.54it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:20, 46.10it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:20, 46.00it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:18, 48.87it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 50.70it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 48.99it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:17, 50.79it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:17, 52.30it/s]backtest loop:   8%|▊         | 75/971 [00:01<00:16, 53.16it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:16, 54.08it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:17, 51.26it/s]backtest loop:  10%|▉         | 93/971 [00:02<00:16, 52.54it/s]backtest loop:  10%|█         | 99/971 [00:02<00:16, 52.71it/s]backtest loop:  11%|█         | 105/971 [00:02<00:16, 53.38it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:15, 53.93it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:16, 51.17it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:16, 52.26it/s]backtest loop:  13%|█▎        | 129/971 [00:02<00:16, 50.01it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:16, 51.61it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:16, 49.35it/s]backtest loop:  15%|█▌        | 147/971 [00:03<00:16, 51.03it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:15, 52.21it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:15, 53.09it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:14, 53.74it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:15, 51.30it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:15, 52.10it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:14, 52.96it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:14, 53.94it/s]backtest loop:  20%|██        | 195/971 [00:04<00:15, 51.22it/s]backtest loop:  21%|██        | 201/971 [00:04<00:14, 52.28it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:14, 53.13it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:15, 50.52it/s]backtest loop:  23%|██▎       | 219/971 [00:04<00:14, 51.71it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:23, 32.12it/s]backtest loop:  24%|██▍       | 231/971 [00:04<00:20, 36.57it/s]backtest loop:  25%|██▍       | 238/971 [00:05<00:17, 42.38it/s]backtest loop:  25%|██▌       | 245/971 [00:05<00:16, 45.12it/s]backtest loop:  26%|██▌       | 251/971 [00:05<00:14, 48.43it/s]backtest loop:  26%|██▋       | 257/971 [00:05<00:13, 51.27it/s]backtest loop:  27%|██▋       | 263/971 [00:05<00:13, 52.66it/s]backtest loop:  28%|██▊       | 269/971 [00:05<00:13, 50.75it/s]backtest loop:  28%|██▊       | 275/971 [00:05<00:13, 52.18it/s]backtest loop:  29%|██▉       | 281/971 [00:05<00:13, 50.11it/s]backtest loop:  30%|██▉       | 287/971 [00:05<00:13, 51.46it/s]backtest loop:  30%|███       | 293/971 [00:06<00:12, 52.52it/s]backtest loop:  31%|███       | 299/971 [00:06<00:12, 53.27it/s]backtest loop:  31%|███▏      | 305/971 [00:06<00:13, 50.66it/s]backtest loop:  32%|███▏      | 311/971 [00:06<00:12, 51.91it/s]backtest loop:  33%|███▎      | 317/971 [00:06<00:12, 52.82it/s]backtest loop:  33%|███▎      | 323/971 [00:06<00:12, 53.76it/s]backtest loop:  34%|███▍      | 329/971 [00:06<00:11, 54.22it/s]backtest loop:  35%|███▍      | 335/971 [00:06<00:12, 51.40it/s]backtest loop:  35%|███▌      | 341/971 [00:06<00:11, 52.60it/s]backtest loop:  36%|███▌      | 347/971 [00:07<00:11, 53.38it/s]backtest loop:  36%|███▋      | 353/971 [00:07<00:11, 53.92it/s]backtest loop:  37%|███▋      | 359/971 [00:07<00:11, 54.29it/s]backtest loop:  38%|███▊      | 365/971 [00:07<00:11, 51.84it/s]backtest loop:  38%|███▊      | 371/971 [00:07<00:12, 49.87it/s]backtest loop:  39%|███▉      | 377/971 [00:07<00:11, 51.35it/s]backtest loop:  39%|███▉      | 383/971 [00:07<00:11, 49.43it/s]backtest loop:  40%|████      | 389/971 [00:07<00:11, 50.90it/s]backtest loop:  41%|████      | 395/971 [00:08<00:11, 52.23it/s]backtest loop:  41%|████▏     | 401/971 [00:08<00:10, 53.09it/s]backtest loop:  42%|████▏     | 407/971 [00:08<00:10, 54.12it/s]backtest loop:  43%|████▎     | 413/971 [00:08<00:10, 51.36it/s]backtest loop:  43%|████▎     | 419/971 [00:08<00:10, 52.35it/s]backtest loop:  44%|████▍     | 425/971 [00:08<00:10, 53.14it/s]backtest loop:  44%|████▍     | 431/971 [00:08<00:10, 53.82it/s]backtest loop:  45%|████▌     | 437/971 [00:08<00:10, 50.94it/s]backtest loop:  46%|████▌     | 443/971 [00:08<00:10, 52.11it/s]backtest loop:  46%|████▌     | 449/971 [00:09<00:09, 52.98it/s]backtest loop:  47%|████▋     | 455/971 [00:09<00:09, 53.85it/s]backtest loop:  47%|████▋     | 461/971 [00:09<00:09, 54.22it/s]backtest loop:  48%|████▊     | 467/971 [00:09<00:09, 51.24it/s]backtest loop:  49%|████▊     | 473/971 [00:09<00:09, 52.30it/s]backtest loop:  49%|████▉     | 479/971 [00:09<00:09, 53.19it/s]backtest loop:  50%|████▉     | 485/971 [00:09<00:09, 53.71it/s]backtest loop:  51%|█████     | 491/971 [00:09<00:09, 50.94it/s]backtest loop:  51%|█████     | 497/971 [00:09<00:09, 52.11it/s]backtest loop:  52%|█████▏    | 503/971 [00:10<00:08, 52.95it/s]backtest loop:  52%|█████▏    | 509/971 [00:10<00:09, 50.40it/s]backtest loop:  53%|█████▎    | 515/971 [00:10<00:08, 51.74it/s]backtest loop:  54%|█████▎    | 521/971 [00:10<00:08, 52.80it/s]backtest loop:  54%|█████▍    | 527/971 [00:10<00:08, 50.37it/s]backtest loop:  55%|█████▍    | 533/971 [00:10<00:08, 51.93it/s]backtest loop:  56%|█████▌    | 539/971 [00:10<00:08, 52.90it/s]backtest loop:  56%|█████▌    | 545/971 [00:10<00:07, 53.54it/s]backtest loop:  57%|█████▋    | 551/971 [00:11<00:08, 50.94it/s]backtest loop:  57%|█████▋    | 557/971 [00:11<00:07, 52.12it/s]backtest loop:  58%|█████▊    | 563/971 [00:11<00:07, 53.01it/s]backtest loop:  59%|█████▊    | 569/971 [00:11<00:07, 53.61it/s]backtest loop:  59%|█████▉    | 575/971 [00:11<00:07, 53.80it/s]backtest loop:  60%|█████▉    | 581/971 [00:11<00:07, 51.05it/s]backtest loop:  60%|██████    | 587/971 [00:11<00:07, 51.64it/s]backtest loop:  61%|██████    | 593/971 [00:11<00:07, 53.84it/s]backtest loop:  62%|██████▏   | 600/971 [00:11<00:06, 53.44it/s]backtest loop:  62%|██████▏   | 606/971 [00:12<00:06, 55.15it/s]backtest loop:  63%|██████▎   | 613/971 [00:12<00:06, 57.20it/s]backtest loop:  64%|██████▎   | 619/971 [00:12<00:06, 57.96it/s]backtest loop:  64%|██████▍   | 625/971 [00:12<00:06, 54.80it/s]backtest loop:  65%|██████▌   | 632/971 [00:12<00:05, 56.93it/s]backtest loop:  66%|██████▌   | 639/971 [00:12<00:05, 58.77it/s]backtest loop:  66%|██████▋   | 645/971 [00:12<00:05, 55.75it/s]backtest loop:  67%|██████▋   | 651/971 [00:12<00:05, 56.82it/s]backtest loop:  68%|██████▊   | 657/971 [00:12<00:05, 57.66it/s]backtest loop:  68%|██████▊   | 663/971 [00:13<00:05, 58.31it/s]backtest loop:  69%|██████▉   | 669/971 [00:13<00:05, 58.70it/s]backtest loop:  70%|██████▉   | 675/971 [00:13<00:05, 55.13it/s]backtest loop:  70%|███████   | 681/971 [00:13<00:05, 56.34it/s]backtest loop:  71%|███████   | 687/971 [00:13<00:04, 57.17it/s]backtest loop:  71%|███████▏  | 693/971 [00:13<00:05, 55.02it/s]backtest loop:  72%|███████▏  | 699/971 [00:13<00:05, 51.75it/s]backtest loop:  73%|███████▎  | 705/971 [00:13<00:05, 52.63it/s]backtest loop:  73%|███████▎  | 711/971 [00:13<00:04, 53.26it/s]backtest loop:  74%|███████▍  | 717/971 [00:14<00:04, 53.81it/s]backtest loop:  74%|███████▍  | 723/971 [00:14<00:04, 53.93it/s]backtest loop:  75%|███████▌  | 729/971 [00:14<00:04, 51.09it/s]backtest loop:  76%|███████▌  | 735/971 [00:14<00:04, 49.34it/s]backtest loop:  76%|███████▋  | 741/971 [00:14<00:04, 50.87it/s]backtest loop:  77%|███████▋  | 747/971 [00:14<00:04, 51.81it/s]backtest loop:  78%|███████▊  | 753/971 [00:14<00:04, 49.70it/s]backtest loop:  78%|███████▊  | 759/971 [00:14<00:04, 51.17it/s]backtest loop:  79%|███████▉  | 765/971 [00:14<00:04, 49.10it/s]backtest loop:  79%|███████▉  | 771/971 [00:15<00:03, 50.70it/s]backtest loop:  80%|████████  | 777/971 [00:15<00:03, 51.96it/s]backtest loop:  81%|████████  | 783/971 [00:15<00:03, 49.83it/s]backtest loop:  81%|████████▏ | 789/971 [00:15<00:03, 51.28it/s]backtest loop:  82%|████████▏ | 795/971 [00:15<00:03, 52.32it/s]backtest loop:  82%|████████▏ | 801/971 [00:15<00:03, 53.13it/s]backtest loop:  83%|████████▎ | 807/971 [00:15<00:03, 53.56it/s]backtest loop:  84%|████████▎ | 813/971 [00:15<00:03, 50.44it/s]backtest loop:  84%|████████▍ | 819/971 [00:16<00:02, 51.72it/s]backtest loop:  85%|████████▍ | 825/971 [00:16<00:02, 52.55it/s]backtest loop:  86%|████████▌ | 831/971 [00:16<00:02, 53.31it/s]backtest loop:  86%|████████▌ | 837/971 [00:16<00:02, 53.83it/s]backtest loop:  87%|████████▋ | 843/971 [00:16<00:02, 51.01it/s]backtest loop:  87%|████████▋ | 849/971 [00:16<00:02, 52.17it/s]backtest loop:  88%|████████▊ | 855/971 [00:16<00:02, 53.00it/s]backtest loop:  89%|████████▊ | 861/971 [00:16<00:02, 52.84it/s]backtest loop:  89%|████████▉ | 867/971 [00:16<00:02, 50.22it/s]backtest loop:  90%|████████▉ | 873/971 [00:17<00:01, 51.60it/s]backtest loop:  91%|█████████ | 879/971 [00:17<00:01, 52.57it/s]backtest loop:  91%|█████████ | 885/971 [00:17<00:01, 53.39it/s]backtest loop:  92%|█████████▏| 891/971 [00:17<00:01, 53.91it/s]backtest loop:  92%|█████████▏| 897/971 [00:17<00:01, 51.15it/s]backtest loop:  93%|█████████▎| 903/971 [00:17<00:01, 52.29it/s]backtest loop:  94%|█████████▎| 909/971 [00:17<00:01, 53.07it/s]backtest loop:  94%|█████████▍| 915/971 [00:17<00:01, 53.59it/s]backtest loop:  95%|█████████▍| 921/971 [00:17<00:00, 50.84it/s]backtest loop:  95%|█████████▌| 927/971 [00:18<00:00, 52.09it/s]backtest loop:  96%|█████████▌| 933/971 [00:18<00:00, 52.87it/s]backtest loop:  97%|█████████▋| 939/971 [00:18<00:00, 53.63it/s]backtest loop:  97%|█████████▋| 945/971 [00:18<00:00, 50.89it/s]backtest loop:  98%|█████████▊| 951/971 [00:18<00:00, 52.09it/s]backtest loop:  99%|█████████▊| 957/971 [00:18<00:00, 52.95it/s]backtest loop:  99%|█████████▉| 963/971 [00:18<00:00, 53.56it/s]backtest loop: 100%|█████████▉| 969/971 [00:18<00:00, 53.93it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 51.32it/s]
[3093195:MainThread](2024-04-25 05:27:53,433) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000586
std                0.004859
annualized_return  0.139364
information_ratio  1.859255
max_drawdown      -0.087125
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000387
std                0.004861
annualized_return  0.092061
information_ratio  1.227673
max_drawdown      -0.121404
[3093195:MainThread](2024-04-25 05:27:53,447) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:28:00,340) INFO - qlib.timer - [log.py:127] - Time cost: 0.007s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737,
                                                    0.08968346707466894,
                                                    0.11223778513394758,
                                                    -0.0002186104664208714,
                                                    0.09206051366053564],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084,
                                                    1.1218265483587289,
                                                    1.5057970219122332,
                                                    -0.002426202610177372,
                                                    1.2276726942916574],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933,
                                               -0.07846341666528217,
                                               -0.06996440873715659,
                                               -0.1662235786401427,
                                               -0.1214038195723268],
 'IC': [0.020637454956468574,
        0.018384392846222276,
        0.025241549798749627,
        0.026925119124198496,
        0.014817320525268003,
        0.025456744893419838],
 'ICIR': [0.1363977555593439,
          0.12056425663985118,
          0.18055141124592092,
          0.20625217894659637,
          0.09992783537754027,
          0.1815812518355052],
 'Rank IC': [0.04052653939231223,
             0.032153968726034154,
             0.036241671519137895,
             0.03890135583227345,
             0.02623694421706984,
             0.04059155499944135],
 'Rank ICIR': [0.2709675937829445,
               0.21961644941208022,
               0.25479198875234993,
               0.2964856332378628,
               0.17100811058911927,
               0.291274386612759],
 'mae': [0.8637884690110731,
         0.8641865647866,
         0.8639522385752554,
         0.8636988725136276,
         0.8644248587081322,
         0.8637859079110328],
 'mse': [0.9966288064718065,
         0.9969241793435271,
         0.9971921815402262,
         0.9981024944682831,
         0.9973450664619631,
         0.9969975687883431]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:28:03,543) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:28:06,437) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_49.
[3093195:MainThread](2024-04-25 05:28:06,501) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[3093195:MainThread](2024-04-25 05:28:06,514) INFO - qlib.workflow - [recorder.py:341] - Recorder 16c028f245a8417b8831b7bc06bef9d1 starts running under Experiment 71 ...
[3093195:MainThread](2024-04-25 05:28:11,578) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:28:11,579) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:28:11,579) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:28:18,455) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:28:18,771) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999472
[3093195:MainThread](2024-04-25 05:28:18,774) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:28:18,775) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:28:25,634) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:28:25,952) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999341
[3093195:MainThread](2024-04-25 05:28:25,955) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:28:25,955) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:28:32,820) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:28:33,139) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -1.000460
[3093195:MainThread](2024-04-25 05:28:33,140) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:28:33,140) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:28:40,005) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:28:40,329) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999156
[3093195:MainThread](2024-04-25 05:28:40,361) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:28:40,361) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:28:47,287) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:28:47,604) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999075
[3093195:MainThread](2024-04-25 05:28:47,607) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:28:47,607) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:28:54,492) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:28:54,811) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -1.000369
[3093195:MainThread](2024-04-25 05:28:54,812) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:28:54,812) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:29:01,867) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:29:02,183) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999533
[3093195:MainThread](2024-04-25 05:29:02,183) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3093195:MainThread](2024-04-25 05:29:02,183) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:29:09,306) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:29:09,644) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998374
[3093195:MainThread](2024-04-25 05:29:09,647) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch8:
[3093195:MainThread](2024-04-25 05:29:09,648) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:29:16,773) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:29:17,118) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999909
[3093195:MainThread](2024-04-25 05:29:17,118) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch9:
[3093195:MainThread](2024-04-25 05:29:17,118) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:29:24,500) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:29:24,819) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999927
[3093195:MainThread](2024-04-25 05:29:24,819) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch10:
[3093195:MainThread](2024-04-25 05:29:24,819) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:29:31,944) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:29:32,260) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998572
[3093195:MainThread](2024-04-25 05:29:32,260) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch11:
[3093195:MainThread](2024-04-25 05:29:32,261) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:29:39,328) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:29:39,644) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997893
[3093195:MainThread](2024-04-25 05:29:39,647) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch12:
[3093195:MainThread](2024-04-25 05:29:39,648) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:29:46,496) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:29:46,812) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999064
[3093195:MainThread](2024-04-25 05:29:46,813) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch13:
[3093195:MainThread](2024-04-25 05:29:46,813) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:29:53,673) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:29:53,986) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998241
[3093195:MainThread](2024-04-25 05:29:53,986) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch14:
[3093195:MainThread](2024-04-25 05:29:53,987) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:30:00,820) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:30:01,137) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998976
[3093195:MainThread](2024-04-25 05:30:01,137) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch15:
[3093195:MainThread](2024-04-25 05:30:01,137) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:30:07,973) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:30:08,290) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998395
[3093195:MainThread](2024-04-25 05:30:08,291) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch16:
[3093195:MainThread](2024-04-25 05:30:08,291) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:30:15,245) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:30:15,561) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999067
[3093195:MainThread](2024-04-25 05:30:15,561) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:30:15,562) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.997893 @ 11
[3093195:MainThread](2024-04-25 05:30:15,595) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_49.
[3093195:MainThread](2024-04-25 05:30:16,249) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:30:16,264) INFO - qlib.workflow - [recorder.py:341] - Recorder f14153a55734455c8c01c3c6115f7e81 starts running under Experiment 65 ...
{'IC': 0.028770075229084733,
 'ICIR': 0.21295178834574896,
 'Rank IC': 0.04375107876310477,
 'Rank ICIR': 0.3131100070810173}
[3093195:MainThread](2024-04-25 05:30:23,241) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:31:00,843) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:31:00,846) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:31:06,873) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f455fd3ef10>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:40,  9.65it/s]backtest loop:   1%|          | 9/971 [00:00<00:37, 25.50it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:25, 37.93it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 40.57it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:19, 47.70it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 48.20it/s]backtest loop:   4%|▍         | 41/971 [00:00<00:17, 52.58it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:16, 55.65it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 53.77it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:16, 56.60it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:16, 55.02it/s]backtest loop:   8%|▊         | 74/971 [00:01<00:15, 57.42it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:15, 59.17it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:15, 56.42it/s]backtest loop:  10%|▉         | 94/971 [00:01<00:15, 58.19it/s]backtest loop:  10%|█         | 101/971 [00:01<00:14, 59.52it/s]backtest loop:  11%|█         | 107/971 [00:02<00:15, 56.68it/s]backtest loop:  12%|█▏        | 114/971 [00:02<00:14, 58.45it/s]backtest loop:  12%|█▏        | 121/971 [00:02<00:14, 59.75it/s]backtest loop:  13%|█▎        | 127/971 [00:02<00:15, 53.23it/s]backtest loop:  14%|█▍        | 134/971 [00:02<00:14, 55.82it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:15, 54.69it/s]backtest loop:  15%|█▌        | 148/971 [00:02<00:14, 56.91it/s]backtest loop:  16%|█▌        | 155/971 [00:02<00:13, 58.47it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:14, 55.57it/s]backtest loop:  17%|█▋        | 168/971 [00:03<00:13, 57.73it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:13, 59.88it/s]backtest loop:  19%|█▊        | 182/971 [00:03<00:13, 57.70it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:13, 59.37it/s]backtest loop:  20%|██        | 195/971 [00:03<00:13, 56.11it/s]backtest loop:  21%|██        | 202/971 [00:03<00:13, 58.02it/s]backtest loop:  22%|██▏       | 209/971 [00:03<00:12, 59.75it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 54.59it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:19, 38.38it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:16, 43.65it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:16, 45.19it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:14, 49.59it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:14, 50.36it/s]backtest loop:  26%|██▋       | 256/971 [00:04<00:13, 54.33it/s]backtest loop:  27%|██▋       | 263/971 [00:05<00:12, 56.79it/s]backtest loop:  28%|██▊       | 269/971 [00:05<00:12, 54.90it/s]backtest loop:  28%|██▊       | 276/971 [00:05<00:12, 54.17it/s]backtest loop:  29%|██▉       | 282/971 [00:05<00:12, 55.60it/s]backtest loop:  30%|██▉       | 289/971 [00:05<00:11, 57.52it/s]backtest loop:  30%|███       | 295/971 [00:05<00:12, 55.25it/s]backtest loop:  31%|███       | 302/971 [00:05<00:11, 57.66it/s]backtest loop:  32%|███▏      | 309/971 [00:05<00:11, 59.40it/s]backtest loop:  32%|███▏      | 315/971 [00:05<00:11, 56.13it/s]backtest loop:  33%|███▎      | 321/971 [00:06<00:11, 57.12it/s]backtest loop:  34%|███▍      | 328/971 [00:06<00:10, 58.82it/s]backtest loop:  35%|███▍      | 335/971 [00:06<00:11, 56.87it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:10, 58.46it/s]backtest loop:  36%|███▌      | 349/971 [00:06<00:10, 59.83it/s]backtest loop:  37%|███▋      | 356/971 [00:06<00:10, 57.40it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 56.57it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 54.52it/s]backtest loop:  39%|███▊      | 376/971 [00:06<00:10, 56.87it/s]backtest loop:  39%|███▉      | 382/971 [00:07<00:10, 57.59it/s]backtest loop:  40%|███▉      | 388/971 [00:07<00:10, 55.02it/s]backtest loop:  41%|████      | 395/971 [00:07<00:10, 57.36it/s]backtest loop:  41%|████▏     | 402/971 [00:07<00:09, 58.93it/s]backtest loop:  42%|████▏     | 408/971 [00:07<00:09, 56.55it/s]backtest loop:  43%|████▎     | 415/971 [00:07<00:09, 58.37it/s]backtest loop:  43%|████▎     | 422/971 [00:07<00:09, 59.49it/s]backtest loop:  44%|████▍     | 428/971 [00:07<00:09, 56.55it/s]backtest loop:  45%|████▍     | 435/971 [00:08<00:09, 58.39it/s]backtest loop:  46%|████▌     | 442/971 [00:08<00:09, 56.59it/s]backtest loop:  46%|████▌     | 449/971 [00:08<00:08, 58.68it/s]backtest loop:  47%|████▋     | 456/971 [00:08<00:08, 59.84it/s]backtest loop:  48%|████▊     | 463/971 [00:08<00:08, 57.44it/s]backtest loop:  48%|████▊     | 470/971 [00:08<00:08, 59.01it/s]backtest loop:  49%|████▉     | 477/971 [00:08<00:08, 56.97it/s]backtest loop:  50%|████▉     | 484/971 [00:08<00:08, 58.43it/s]backtest loop:  50%|█████     | 490/971 [00:08<00:08, 55.77it/s]backtest loop:  51%|█████     | 497/971 [00:09<00:08, 57.71it/s]backtest loop:  52%|█████▏    | 504/971 [00:09<00:07, 59.09it/s]backtest loop:  53%|█████▎    | 510/971 [00:09<00:08, 56.07it/s]backtest loop:  53%|█████▎    | 517/971 [00:09<00:08, 54.84it/s]backtest loop:  54%|█████▍    | 524/971 [00:09<00:07, 57.03it/s]backtest loop:  55%|█████▍    | 531/971 [00:09<00:07, 55.66it/s]backtest loop:  55%|█████▌    | 538/971 [00:09<00:07, 57.76it/s]backtest loop:  56%|█████▌    | 545/971 [00:09<00:07, 59.25it/s]backtest loop:  57%|█████▋    | 551/971 [00:10<00:07, 56.24it/s]backtest loop:  57%|█████▋    | 558/971 [00:10<00:07, 58.06it/s]backtest loop:  58%|█████▊    | 565/971 [00:10<00:06, 59.40it/s]backtest loop:  59%|█████▉    | 571/971 [00:10<00:07, 56.34it/s]backtest loop:  60%|█████▉    | 578/971 [00:10<00:06, 58.15it/s]backtest loop:  60%|██████    | 585/971 [00:10<00:06, 59.76it/s]backtest loop:  61%|██████    | 591/971 [00:10<00:06, 56.63it/s]backtest loop:  62%|██████▏   | 598/971 [00:10<00:06, 58.40it/s]backtest loop:  62%|██████▏   | 605/971 [00:10<00:06, 56.37it/s]backtest loop:  63%|██████▎   | 612/971 [00:11<00:06, 58.05it/s]backtest loop:  64%|██████▎   | 619/971 [00:11<00:05, 59.22it/s]backtest loop:  64%|██████▍   | 625/971 [00:11<00:06, 56.25it/s]backtest loop:  65%|██████▌   | 632/971 [00:11<00:05, 58.29it/s]backtest loop:  66%|██████▌   | 639/971 [00:11<00:05, 59.91it/s]backtest loop:  67%|██████▋   | 646/971 [00:11<00:05, 57.35it/s]backtest loop:  67%|██████▋   | 653/971 [00:11<00:05, 58.81it/s]backtest loop:  68%|██████▊   | 660/971 [00:11<00:05, 56.70it/s]backtest loop:  69%|██████▊   | 667/971 [00:12<00:05, 58.34it/s]backtest loop:  69%|██████▉   | 674/971 [00:12<00:05, 56.29it/s]backtest loop:  70%|███████   | 681/971 [00:12<00:04, 58.00it/s]backtest loop:  71%|███████   | 688/971 [00:12<00:04, 59.22it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:04, 56.23it/s]backtest loop:  72%|███████▏  | 701/971 [00:12<00:04, 58.10it/s]backtest loop:  73%|███████▎  | 708/971 [00:12<00:04, 59.40it/s]backtest loop:  74%|███████▎  | 714/971 [00:12<00:04, 56.21it/s]backtest loop:  74%|███████▍  | 721/971 [00:12<00:04, 58.27it/s]backtest loop:  75%|███████▍  | 728/971 [00:13<00:04, 59.83it/s]backtest loop:  76%|███████▌  | 735/971 [00:13<00:04, 54.50it/s]backtest loop:  76%|███████▋  | 742/971 [00:13<00:04, 56.65it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 54.69it/s]backtest loop:  78%|███████▊  | 755/971 [00:13<00:03, 54.00it/s]backtest loop:  78%|███████▊  | 762/971 [00:13<00:03, 56.45it/s]backtest loop:  79%|███████▉  | 769/971 [00:13<00:03, 58.22it/s]backtest loop:  80%|███████▉  | 775/971 [00:13<00:03, 55.65it/s]backtest loop:  81%|████████  | 782/971 [00:14<00:03, 57.74it/s]backtest loop:  81%|████████  | 788/971 [00:14<00:03, 55.27it/s]backtest loop:  82%|████████▏ | 795/971 [00:14<00:03, 57.34it/s]backtest loop:  83%|████████▎ | 802/971 [00:14<00:02, 58.85it/s]backtest loop:  83%|████████▎ | 808/971 [00:14<00:02, 56.12it/s]backtest loop:  84%|████████▍ | 814/971 [00:14<00:02, 57.06it/s]backtest loop:  85%|████████▍ | 821/971 [00:14<00:02, 58.68it/s]backtest loop:  85%|████████▌ | 828/971 [00:14<00:02, 56.51it/s]backtest loop:  86%|████████▌ | 835/971 [00:14<00:02, 58.23it/s]backtest loop:  87%|████████▋ | 842/971 [00:15<00:02, 59.50it/s]backtest loop:  87%|████████▋ | 848/971 [00:15<00:02, 56.41it/s]backtest loop:  88%|████████▊ | 855/971 [00:15<00:01, 58.29it/s]backtest loop:  89%|████████▉ | 862/971 [00:15<00:01, 56.31it/s]backtest loop:  89%|████████▉ | 869/971 [00:15<00:01, 58.08it/s]backtest loop:  90%|█████████ | 876/971 [00:15<00:01, 59.37it/s]backtest loop:  91%|█████████ | 882/971 [00:15<00:01, 56.41it/s]backtest loop:  92%|█████████▏| 889/971 [00:15<00:01, 58.17it/s]backtest loop:  92%|█████████▏| 896/971 [00:16<00:01, 59.47it/s]backtest loop:  93%|█████████▎| 902/971 [00:16<00:01, 56.48it/s]backtest loop:  94%|█████████▎| 909/971 [00:16<00:01, 58.25it/s]backtest loop:  94%|█████████▍| 916/971 [00:16<00:00, 56.41it/s]backtest loop:  95%|█████████▌| 923/971 [00:16<00:00, 58.16it/s]backtest loop:  96%|█████████▌| 930/971 [00:16<00:00, 59.48it/s]backtest loop:  96%|█████████▋| 936/971 [00:16<00:00, 56.34it/s]backtest loop:  97%|█████████▋| 943/971 [00:16<00:00, 58.19it/s]backtest loop:  98%|█████████▊| 950/971 [00:16<00:00, 56.33it/s]backtest loop:  99%|█████████▊| 957/971 [00:17<00:00, 58.11it/s]backtest loop:  99%|█████████▉| 964/971 [00:17<00:00, 59.51it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 56.45it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 56.00it/s]
[3093195:MainThread](2024-04-25 05:31:24,266) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000636
std                0.005323
annualized_return  0.151270
information_ratio  1.842002
max_drawdown      -0.091938
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000438
std                0.005324
annualized_return  0.104303
information_ratio  1.269818
max_drawdown      -0.110152
[3093195:MainThread](2024-04-25 05:31:24,279) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:31:40,454) INFO - qlib.timer - [log.py:127] - Time cost: 0.008s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737,
                                                    0.08968346707466894,
                                                    0.11223778513394758,
                                                    -0.0002186104664208714,
                                                    0.09206051366053564,
                                                    0.10430284734718255],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084,
                                                    1.1218265483587289,
                                                    1.5057970219122332,
                                                    -0.002426202610177372,
                                                    1.2276726942916574,
                                                    1.2698181546880682],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933,
                                               -0.07846341666528217,
                                               -0.06996440873715659,
                                               -0.1662235786401427,
                                               -0.1214038195723268,
                                               -0.11015159185396192],
 'IC': [0.020637454956468574,
        0.018384392846222276,
        0.025241549798749627,
        0.026925119124198496,
        0.014817320525268003,
        0.025456744893419838,
        0.028770075229084733],
 'ICIR': [0.1363977555593439,
          0.12056425663985118,
          0.18055141124592092,
          0.20625217894659637,
          0.09992783537754027,
          0.1815812518355052,
          0.21295178834574896],
 'Rank IC': [0.04052653939231223,
             0.032153968726034154,
             0.036241671519137895,
             0.03890135583227345,
             0.02623694421706984,
             0.04059155499944135,
             0.04375107876310477],
 'Rank ICIR': [0.2709675937829445,
               0.21961644941208022,
               0.25479198875234993,
               0.2964856332378628,
               0.17100811058911927,
               0.291274386612759,
               0.3131100070810173],
 'mae': [0.8637884690110731,
         0.8641865647866,
         0.8639522385752554,
         0.8636988725136276,
         0.8644248587081322,
         0.8637859079110328,
         0.8634155737238998],
 'mse': [0.9966288064718065,
         0.9969241793435271,
         0.9971921815402262,
         0.9981024944682831,
         0.9973450664619631,
         0.9969975687883431,
         0.9965831772565794]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:31:43,701) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:31:46,615) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_50.
[3093195:MainThread](2024-04-25 05:31:46,679) INFO - qlib.workflow - [exp.py:258] - Experiment 72 starts running ...
[3093195:MainThread](2024-04-25 05:31:46,697) INFO - qlib.workflow - [recorder.py:341] - Recorder 084ec73f16184bc0a213f5834fe2556d starts running under Experiment 72 ...
[3093195:MainThread](2024-04-25 05:31:51,676) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:31:51,677) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:31:51,677) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:31:58,724) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:31:59,041) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998133
[3093195:MainThread](2024-04-25 05:31:59,044) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:31:59,045) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:32:05,907) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:32:06,224) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999092
[3093195:MainThread](2024-04-25 05:32:06,224) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:32:06,225) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:32:13,313) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:32:13,629) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999236
[3093195:MainThread](2024-04-25 05:32:13,630) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:32:13,630) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:32:20,584) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:32:20,902) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999252
[3093195:MainThread](2024-04-25 05:32:20,902) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:32:20,903) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:32:27,773) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:32:28,090) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998738
[3093195:MainThread](2024-04-25 05:32:28,090) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:32:28,090) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:32:35,006) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:32:35,323) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998285
[3093195:MainThread](2024-04-25 05:32:35,324) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:32:35,324) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.998133 @ 0
[3093195:MainThread](2024-04-25 05:32:35,356) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_50.
[3093195:MainThread](2024-04-25 05:32:35,620) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:32:35,634) INFO - qlib.workflow - [recorder.py:341] - Recorder 32a9d1e72d04466493864cac727235b1 starts running under Experiment 65 ...
{'IC': 0.005860252527685086,
 'ICIR': 0.03761024116962752,
 'Rank IC': 0.018058733162879374,
 'Rank ICIR': 0.11963601853509603}
[3093195:MainThread](2024-04-25 05:32:42,173) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:33:19,679) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:33:19,682) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:33:25,853) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f45625e5be0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:45,  9.18it/s]backtest loop:   1%|          | 8/971 [00:00<00:44, 21.52it/s]backtest loop:   1%|▏         | 14/971 [00:00<00:29, 32.23it/s]backtest loop:   2%|▏         | 20/971 [00:00<00:24, 39.38it/s]backtest loop:   3%|▎         | 25/971 [00:00<00:23, 40.38it/s]backtest loop:   3%|▎         | 31/971 [00:00<00:21, 44.66it/s]backtest loop:   4%|▍         | 37/971 [00:00<00:19, 47.73it/s]backtest loop:   4%|▍         | 43/971 [00:01<00:18, 49.96it/s]backtest loop:   5%|▌         | 49/971 [00:01<00:19, 48.41it/s]backtest loop:   6%|▌         | 55/971 [00:01<00:18, 50.35it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:17, 51.93it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:18, 50.08it/s]backtest loop:   8%|▊         | 73/971 [00:01<00:17, 51.66it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:16, 52.66it/s]backtest loop:   9%|▉         | 85/971 [00:01<00:16, 53.75it/s]backtest loop:   9%|▉         | 91/971 [00:02<00:16, 54.19it/s]backtest loop:  10%|▉         | 97/971 [00:02<00:17, 51.37it/s]backtest loop:  11%|█         | 103/971 [00:02<00:16, 52.41it/s]backtest loop:  11%|█         | 109/971 [00:02<00:16, 53.16it/s]backtest loop:  12%|█▏        | 115/971 [00:02<00:15, 53.94it/s]backtest loop:  12%|█▏        | 121/971 [00:02<00:15, 54.35it/s]backtest loop:  13%|█▎        | 127/971 [00:02<00:17, 48.40it/s]backtest loop:  14%|█▎        | 133/971 [00:02<00:16, 50.26it/s]backtest loop:  14%|█▍        | 139/971 [00:02<00:16, 51.72it/s]backtest loop:  15%|█▍        | 145/971 [00:03<00:15, 52.70it/s]backtest loop:  16%|█▌        | 151/971 [00:03<00:16, 50.33it/s]backtest loop:  16%|█▌        | 157/971 [00:03<00:15, 51.62it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:15, 52.54it/s]backtest loop:  17%|█▋        | 169/971 [00:03<00:15, 53.29it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:14, 53.82it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:15, 51.10it/s]backtest loop:  19%|█▉        | 187/971 [00:03<00:14, 52.41it/s]backtest loop:  20%|█▉        | 193/971 [00:03<00:14, 53.36it/s]backtest loop:  20%|██        | 199/971 [00:04<00:14, 53.99it/s]backtest loop:  21%|██        | 205/971 [00:04<00:14, 51.14it/s]backtest loop:  22%|██▏       | 211/971 [00:04<00:14, 52.43it/s]backtest loop:  22%|██▏       | 217/971 [00:04<00:14, 50.60it/s]backtest loop:  23%|██▎       | 223/971 [00:04<00:22, 33.21it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:19, 37.81it/s]backtest loop:  24%|██▍       | 235/971 [00:05<00:18, 39.84it/s]backtest loop:  25%|██▍       | 241/971 [00:05<00:16, 43.40it/s]backtest loop:  25%|██▌       | 247/971 [00:05<00:15, 46.40it/s]backtest loop:  26%|██▌       | 253/971 [00:05<00:14, 49.01it/s]backtest loop:  27%|██▋       | 259/971 [00:05<00:14, 47.88it/s]backtest loop:  27%|██▋       | 265/971 [00:05<00:14, 50.06it/s]backtest loop:  28%|██▊       | 271/971 [00:05<00:14, 48.64it/s]backtest loop:  29%|██▊       | 277/971 [00:05<00:13, 50.52it/s]backtest loop:  29%|██▉       | 283/971 [00:05<00:13, 51.72it/s]backtest loop:  30%|██▉       | 289/971 [00:06<00:12, 52.57it/s]backtest loop:  30%|███       | 295/971 [00:06<00:13, 50.17it/s]backtest loop:  31%|███       | 301/971 [00:06<00:12, 51.54it/s]backtest loop:  32%|███▏      | 307/971 [00:06<00:12, 52.61it/s]backtest loop:  32%|███▏      | 313/971 [00:06<00:12, 53.65it/s]backtest loop:  33%|███▎      | 319/971 [00:06<00:12, 54.26it/s]backtest loop:  33%|███▎      | 325/971 [00:06<00:12, 51.08it/s]backtest loop:  34%|███▍      | 331/971 [00:06<00:12, 52.25it/s]backtest loop:  35%|███▍      | 337/971 [00:06<00:11, 53.26it/s]backtest loop:  35%|███▌      | 343/971 [00:07<00:11, 53.71it/s]backtest loop:  36%|███▌      | 349/971 [00:07<00:11, 54.10it/s]backtest loop:  37%|███▋      | 355/971 [00:07<00:12, 51.17it/s]backtest loop:  37%|███▋      | 361/971 [00:07<00:11, 52.39it/s]backtest loop:  38%|███▊      | 367/971 [00:07<00:12, 49.69it/s]backtest loop:  38%|███▊      | 373/971 [00:07<00:12, 48.19it/s]backtest loop:  39%|███▉      | 379/971 [00:07<00:11, 50.05it/s]backtest loop:  40%|███▉      | 385/971 [00:07<00:11, 51.42it/s]backtest loop:  40%|████      | 391/971 [00:07<00:11, 52.44it/s]backtest loop:  41%|████      | 397/971 [00:08<00:10, 53.32it/s]backtest loop:  42%|████▏     | 403/971 [00:08<00:11, 50.68it/s]backtest loop:  42%|████▏     | 409/971 [00:08<00:10, 51.48it/s]backtest loop:  43%|████▎     | 415/971 [00:08<00:10, 52.33it/s]backtest loop:  43%|████▎     | 421/971 [00:08<00:10, 53.15it/s]backtest loop:  44%|████▍     | 427/971 [00:08<00:10, 53.93it/s]backtest loop:  45%|████▍     | 433/971 [00:08<00:10, 50.86it/s]backtest loop:  45%|████▌     | 439/971 [00:08<00:10, 52.00it/s]backtest loop:  46%|████▌     | 445/971 [00:09<00:09, 52.82it/s]backtest loop:  46%|████▋     | 451/971 [00:09<00:09, 53.17it/s]backtest loop:  47%|████▋     | 457/971 [00:09<00:10, 50.53it/s]backtest loop:  48%|████▊     | 463/971 [00:09<00:09, 51.87it/s]backtest loop:  48%|████▊     | 469/971 [00:09<00:09, 52.76it/s]backtest loop:  49%|████▉     | 475/971 [00:09<00:09, 53.45it/s]backtest loop:  50%|████▉     | 481/971 [00:09<00:09, 53.78it/s]backtest loop:  50%|█████     | 487/971 [00:09<00:09, 50.97it/s]backtest loop:  51%|█████     | 493/971 [00:09<00:09, 51.68it/s]backtest loop:  51%|█████▏    | 499/971 [00:10<00:08, 52.73it/s]backtest loop:  52%|█████▏    | 505/971 [00:10<00:09, 50.39it/s]backtest loop:  53%|█████▎    | 511/971 [00:10<00:08, 51.77it/s]backtest loop:  53%|█████▎    | 517/971 [00:10<00:09, 49.85it/s]backtest loop:  54%|█████▍    | 523/971 [00:10<00:08, 51.31it/s]backtest loop:  54%|█████▍    | 529/971 [00:10<00:08, 52.45it/s]backtest loop:  55%|█████▌    | 535/971 [00:10<00:08, 52.90it/s]backtest loop:  56%|█████▌    | 541/971 [00:10<00:08, 50.41it/s]backtest loop:  56%|█████▋    | 547/971 [00:10<00:08, 51.64it/s]backtest loop:  57%|█████▋    | 553/971 [00:11<00:07, 52.77it/s]backtest loop:  58%|█████▊    | 559/971 [00:11<00:07, 53.44it/s]backtest loop:  58%|█████▊    | 565/971 [00:11<00:07, 53.91it/s]backtest loop:  59%|█████▉    | 571/971 [00:11<00:07, 51.03it/s]backtest loop:  59%|█████▉    | 577/971 [00:11<00:07, 51.40it/s]backtest loop:  60%|██████    | 583/971 [00:11<00:07, 52.38it/s]backtest loop:  61%|██████    | 589/971 [00:11<00:07, 53.10it/s]backtest loop:  61%|██████▏   | 595/971 [00:11<00:07, 53.61it/s]backtest loop:  62%|██████▏   | 601/971 [00:12<00:07, 50.75it/s]backtest loop:  63%|██████▎   | 607/971 [00:12<00:07, 51.96it/s]backtest loop:  63%|██████▎   | 613/971 [00:12<00:06, 52.82it/s]backtest loop:  64%|██████▎   | 619/971 [00:12<00:06, 53.52it/s]backtest loop:  64%|██████▍   | 625/971 [00:12<00:06, 50.62it/s]backtest loop:  65%|██████▍   | 631/971 [00:12<00:06, 51.82it/s]backtest loop:  66%|██████▌   | 637/971 [00:12<00:06, 53.10it/s]backtest loop:  66%|██████▌   | 643/971 [00:12<00:06, 53.69it/s]backtest loop:  67%|██████▋   | 649/971 [00:12<00:05, 54.13it/s]backtest loop:  67%|██████▋   | 655/971 [00:13<00:06, 51.21it/s]backtest loop:  68%|██████▊   | 661/971 [00:13<00:05, 52.26it/s]backtest loop:  69%|██████▊   | 667/971 [00:13<00:05, 53.04it/s]backtest loop:  69%|██████▉   | 673/971 [00:13<00:05, 53.53it/s]backtest loop:  70%|██████▉   | 679/971 [00:13<00:05, 50.71it/s]backtest loop:  71%|███████   | 685/971 [00:13<00:05, 51.72it/s]backtest loop:  71%|███████   | 691/971 [00:13<00:05, 52.61it/s]backtest loop:  72%|███████▏  | 697/971 [00:13<00:05, 53.36it/s]backtest loop:  72%|███████▏  | 703/971 [00:13<00:04, 53.89it/s]backtest loop:  73%|███████▎  | 709/971 [00:14<00:05, 51.12it/s]backtest loop:  74%|███████▎  | 715/971 [00:14<00:04, 52.24it/s]backtest loop:  74%|███████▍  | 721/971 [00:14<00:04, 53.04it/s]backtest loop:  75%|███████▍  | 727/971 [00:14<00:04, 53.52it/s]backtest loop:  75%|███████▌  | 733/971 [00:14<00:04, 48.01it/s]backtest loop:  76%|███████▌  | 739/971 [00:14<00:04, 49.77it/s]backtest loop:  77%|███████▋  | 745/971 [00:14<00:04, 51.22it/s]backtest loop:  77%|███████▋  | 751/971 [00:14<00:04, 49.33it/s]backtest loop:  78%|███████▊  | 757/971 [00:15<00:04, 50.88it/s]backtest loop:  79%|███████▊  | 763/971 [00:15<00:03, 52.08it/s]backtest loop:  79%|███████▉  | 769/971 [00:15<00:03, 52.94it/s]backtest loop:  80%|███████▉  | 775/971 [00:15<00:03, 50.44it/s]backtest loop:  80%|████████  | 781/971 [00:15<00:03, 51.72it/s]backtest loop:  81%|████████  | 787/971 [00:15<00:03, 52.68it/s]backtest loop:  82%|████████▏ | 793/971 [00:15<00:03, 50.20it/s]backtest loop:  82%|████████▏ | 799/971 [00:15<00:03, 51.48it/s]backtest loop:  83%|████████▎ | 805/971 [00:15<00:03, 52.40it/s]backtest loop:  84%|████████▎ | 811/971 [00:16<00:02, 53.37it/s]backtest loop:  84%|████████▍ | 817/971 [00:16<00:02, 53.84it/s]backtest loop:  85%|████████▍ | 823/971 [00:16<00:02, 50.99it/s]backtest loop:  85%|████████▌ | 829/971 [00:16<00:02, 52.09it/s]backtest loop:  86%|████████▌ | 835/971 [00:16<00:02, 52.89it/s]backtest loop:  87%|████████▋ | 841/971 [00:16<00:02, 53.51it/s]backtest loop:  87%|████████▋ | 847/971 [00:16<00:02, 53.98it/s]backtest loop:  88%|████████▊ | 853/971 [00:16<00:02, 51.11it/s]backtest loop:  88%|████████▊ | 859/971 [00:16<00:02, 52.14it/s]backtest loop:  89%|████████▉ | 865/971 [00:17<00:01, 53.14it/s]backtest loop:  90%|████████▉ | 871/971 [00:17<00:01, 53.86it/s]backtest loop:  90%|█████████ | 877/971 [00:17<00:01, 50.95it/s]backtest loop:  91%|█████████ | 883/971 [00:17<00:01, 52.10it/s]backtest loop:  92%|█████████▏| 889/971 [00:17<00:01, 52.91it/s]backtest loop:  92%|█████████▏| 895/971 [00:17<00:01, 53.52it/s]backtest loop:  93%|█████████▎| 901/971 [00:17<00:01, 54.00it/s]backtest loop:  93%|█████████▎| 907/971 [00:17<00:01, 51.10it/s]backtest loop:  94%|█████████▍| 913/971 [00:18<00:01, 52.21it/s]backtest loop:  95%|█████████▍| 919/971 [00:18<00:00, 52.98it/s]backtest loop:  95%|█████████▌| 925/971 [00:18<00:00, 53.66it/s]backtest loop:  96%|█████████▌| 931/971 [00:18<00:00, 50.74it/s]backtest loop:  96%|█████████▋| 937/971 [00:18<00:00, 51.93it/s]backtest loop:  97%|█████████▋| 943/971 [00:18<00:00, 53.25it/s]backtest loop:  98%|█████████▊| 949/971 [00:18<00:00, 53.73it/s]backtest loop:  98%|█████████▊| 955/971 [00:18<00:00, 51.02it/s]backtest loop:  99%|█████████▉| 961/971 [00:18<00:00, 52.06it/s]backtest loop: 100%|█████████▉| 967/971 [00:19<00:00, 52.93it/s]backtest loop: 100%|██████████| 971/971 [00:19<00:00, 50.81it/s]
[3093195:MainThread](2024-04-25 05:33:45,024) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000309
std                0.005602
annualized_return  0.073653
information_ratio  0.852198
max_drawdown      -0.156764
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000109
std                0.005602
annualized_return  0.025845
information_ratio  0.299022
max_drawdown      -0.180455
[3093195:MainThread](2024-04-25 05:33:45,038) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:33:51,956) INFO - qlib.timer - [log.py:127] - Time cost: 0.008s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737,
                                                    0.08968346707466894,
                                                    0.11223778513394758,
                                                    -0.0002186104664208714,
                                                    0.09206051366053564,
                                                    0.10430284734718255,
                                                    0.0258446000191289],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084,
                                                    1.1218265483587289,
                                                    1.5057970219122332,
                                                    -0.002426202610177372,
                                                    1.2276726942916574,
                                                    1.2698181546880682,
                                                    0.2990222582252494],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933,
                                               -0.07846341666528217,
                                               -0.06996440873715659,
                                               -0.1662235786401427,
                                               -0.1214038195723268,
                                               -0.11015159185396192,
                                               -0.18045450152410464],
 'IC': [0.020637454956468574,
        0.018384392846222276,
        0.025241549798749627,
        0.026925119124198496,
        0.014817320525268003,
        0.025456744893419838,
        0.028770075229084733,
        0.005860252527685086],
 'ICIR': [0.1363977555593439,
          0.12056425663985118,
          0.18055141124592092,
          0.20625217894659637,
          0.09992783537754027,
          0.1815812518355052,
          0.21295178834574896,
          0.03761024116962752],
 'Rank IC': [0.04052653939231223,
             0.032153968726034154,
             0.036241671519137895,
             0.03890135583227345,
             0.02623694421706984,
             0.04059155499944135,
             0.04375107876310477,
             0.018058733162879374],
 'Rank ICIR': [0.2709675937829445,
               0.21961644941208022,
               0.25479198875234993,
               0.2964856332378628,
               0.17100811058911927,
               0.291274386612759,
               0.3131100070810173,
               0.11963601853509603],
 'mae': [0.8637884690110731,
         0.8641865647866,
         0.8639522385752554,
         0.8636988725136276,
         0.8644248587081322,
         0.8637859079110328,
         0.8634155737238998,
         0.8647950635521966],
 'mse': [0.9966288064718065,
         0.9969241793435271,
         0.9971921815402262,
         0.9981024944682831,
         0.9973450664619631,
         0.9969975687883431,
         0.9965831772565794,
         0.9981951649486968]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:33:55,180) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:33:58,091) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_51.
[3093195:MainThread](2024-04-25 05:33:58,157) INFO - qlib.workflow - [exp.py:258] - Experiment 73 starts running ...
[3093195:MainThread](2024-04-25 05:33:58,175) INFO - qlib.workflow - [recorder.py:341] - Recorder d6e5d14063114c0bbe31b9a73a2f32f7 starts running under Experiment 73 ...
[3093195:MainThread](2024-04-25 05:34:03,151) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:34:03,152) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:34:03,152) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:34:10,085) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:34:10,402) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998596
[3093195:MainThread](2024-04-25 05:34:10,405) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:34:10,406) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:34:17,495) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:34:17,812) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999441
[3093195:MainThread](2024-04-25 05:34:17,812) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:34:17,812) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:34:24,754) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:34:25,071) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998812
[3093195:MainThread](2024-04-25 05:34:25,071) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:34:25,071) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:34:31,952) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:34:32,268) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997706
[3093195:MainThread](2024-04-25 05:34:32,271) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:34:32,272) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:34:39,148) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:34:39,465) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998911
[3093195:MainThread](2024-04-25 05:34:39,465) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:34:39,466) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:34:46,337) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:34:46,656) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997827
[3093195:MainThread](2024-04-25 05:34:46,656) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:34:46,656) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:34:53,544) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:34:53,864) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998500
[3093195:MainThread](2024-04-25 05:34:53,864) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3093195:MainThread](2024-04-25 05:34:53,864) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:35:00,741) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:35:01,058) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999320
[3093195:MainThread](2024-04-25 05:35:01,059) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch8:
[3093195:MainThread](2024-04-25 05:35:01,059) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:35:07,922) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:35:08,239) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998121
[3093195:MainThread](2024-04-25 05:35:08,240) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:35:08,240) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.997706 @ 3
[3093195:MainThread](2024-04-25 05:35:08,270) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_51.
[3093195:MainThread](2024-04-25 05:35:08,534) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:35:08,548) INFO - qlib.workflow - [recorder.py:341] - Recorder 93bbf8ffd71e4ce5ad6bc190dca48de8 starts running under Experiment 65 ...
{'IC': 0.022362232851111805,
 'ICIR': 0.1580777461375568,
 'Rank IC': 0.03676774822632818,
 'Rank ICIR': 0.2545363727936097}
[3093195:MainThread](2024-04-25 05:35:14,829) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:35:52,160) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:35:52,163) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:35:58,173) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f4562497850>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:40,  9.60it/s]backtest loop:   1%|          | 9/971 [00:00<00:37, 25.38it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:25, 37.77it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 40.45it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:19, 47.49it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 48.07it/s]backtest loop:   4%|▍         | 41/971 [00:00<00:17, 52.61it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:16, 55.61it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 53.74it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:16, 56.38it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:16, 54.61it/s]backtest loop:   8%|▊         | 74/971 [00:01<00:15, 57.52it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:15, 59.22it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:15, 56.59it/s]backtest loop:  10%|▉         | 94/971 [00:01<00:15, 58.41it/s]backtest loop:  10%|█         | 101/971 [00:01<00:14, 59.88it/s]backtest loop:  11%|█         | 108/971 [00:02<00:14, 57.70it/s]backtest loop:  12%|█▏        | 115/971 [00:02<00:14, 59.18it/s]backtest loop:  13%|█▎        | 122/971 [00:02<00:14, 57.45it/s]backtest loop:  13%|█▎        | 128/971 [00:02<00:15, 55.73it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:14, 57.71it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:15, 55.29it/s]backtest loop:  15%|█▌        | 148/971 [00:02<00:14, 57.47it/s]backtest loop:  16%|█▌        | 154/971 [00:02<00:14, 56.71it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:14, 55.21it/s]backtest loop:  17%|█▋        | 168/971 [00:03<00:13, 57.60it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:13, 59.61it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:13, 56.77it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:13, 58.90it/s]backtest loop:  20%|██        | 195/971 [00:03<00:13, 56.72it/s]backtest loop:  21%|██        | 202/971 [00:03<00:13, 58.37it/s]backtest loop:  22%|██▏       | 209/971 [00:03<00:12, 59.78it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 54.59it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:20, 36.23it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:17, 41.77it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:16, 43.75it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:15, 48.30it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:14, 49.72it/s]backtest loop:  26%|██▋       | 256/971 [00:04<00:13, 53.83it/s]backtest loop:  27%|██▋       | 263/971 [00:05<00:12, 56.57it/s]backtest loop:  28%|██▊       | 269/971 [00:05<00:12, 54.66it/s]backtest loop:  28%|██▊       | 276/971 [00:05<00:12, 53.88it/s]backtest loop:  29%|██▉       | 283/971 [00:05<00:12, 56.18it/s]backtest loop:  30%|██▉       | 290/971 [00:05<00:11, 58.17it/s]backtest loop:  30%|███       | 296/971 [00:05<00:12, 55.60it/s]backtest loop:  31%|███       | 303/971 [00:05<00:11, 57.59it/s]backtest loop:  32%|███▏      | 310/971 [00:05<00:11, 55.84it/s]backtest loop:  33%|███▎      | 317/971 [00:05<00:11, 57.75it/s]backtest loop:  33%|███▎      | 324/971 [00:06<00:10, 59.16it/s]backtest loop:  34%|███▍      | 330/971 [00:06<00:11, 56.24it/s]backtest loop:  35%|███▍      | 337/971 [00:06<00:10, 58.18it/s]backtest loop:  35%|███▌      | 344/971 [00:06<00:10, 59.36it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:10, 56.60it/s]backtest loop:  37%|███▋      | 357/971 [00:06<00:10, 58.42it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 56.07it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 54.04it/s]backtest loop:  39%|███▊      | 376/971 [00:07<00:10, 56.63it/s]backtest loop:  39%|███▉      | 383/971 [00:07<00:10, 55.16it/s]backtest loop:  40%|████      | 390/971 [00:07<00:10, 57.25it/s]backtest loop:  41%|████      | 397/971 [00:07<00:09, 58.93it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 56.13it/s]backtest loop:  42%|████▏     | 410/971 [00:07<00:09, 58.02it/s]backtest loop:  43%|████▎     | 417/971 [00:07<00:09, 59.36it/s]backtest loop:  44%|████▎     | 423/971 [00:07<00:09, 56.04it/s]backtest loop:  44%|████▍     | 429/971 [00:07<00:09, 57.07it/s]backtest loop:  45%|████▍     | 436/971 [00:08<00:09, 58.70it/s]backtest loop:  46%|████▌     | 442/971 [00:08<00:09, 55.85it/s]backtest loop:  46%|████▌     | 449/971 [00:08<00:09, 57.72it/s]backtest loop:  47%|████▋     | 456/971 [00:08<00:08, 59.11it/s]backtest loop:  48%|████▊     | 462/971 [00:08<00:09, 56.08it/s]backtest loop:  48%|████▊     | 469/971 [00:08<00:08, 57.94it/s]backtest loop:  49%|████▉     | 476/971 [00:08<00:08, 59.36it/s]backtest loop:  50%|████▉     | 482/971 [00:08<00:08, 56.20it/s]backtest loop:  50%|█████     | 489/971 [00:08<00:08, 58.02it/s]backtest loop:  51%|█████     | 495/971 [00:09<00:08, 55.38it/s]backtest loop:  52%|█████▏    | 502/971 [00:09<00:08, 57.45it/s]backtest loop:  52%|█████▏    | 508/971 [00:09<00:08, 54.97it/s]backtest loop:  53%|█████▎    | 515/971 [00:09<00:07, 57.15it/s]backtest loop:  54%|█████▍    | 522/971 [00:09<00:08, 55.23it/s]backtest loop:  54%|█████▍    | 529/971 [00:09<00:07, 57.29it/s]backtest loop:  55%|█████▌    | 536/971 [00:09<00:07, 55.65it/s]backtest loop:  56%|█████▌    | 543/971 [00:09<00:07, 57.46it/s]backtest loop:  57%|█████▋    | 550/971 [00:10<00:07, 58.83it/s]backtest loop:  57%|█████▋    | 556/971 [00:10<00:07, 56.07it/s]backtest loop:  58%|█████▊    | 563/971 [00:10<00:07, 57.83it/s]backtest loop:  59%|█████▊    | 570/971 [00:10<00:06, 59.12it/s]backtest loop:  59%|█████▉    | 576/971 [00:10<00:07, 56.11it/s]backtest loop:  60%|██████    | 583/971 [00:10<00:06, 58.13it/s]backtest loop:  61%|██████    | 590/971 [00:10<00:06, 59.51it/s]backtest loop:  61%|██████▏   | 596/971 [00:10<00:06, 56.37it/s]backtest loop:  62%|██████▏   | 603/971 [00:10<00:06, 58.11it/s]backtest loop:  63%|██████▎   | 610/971 [00:11<00:06, 56.08it/s]backtest loop:  64%|██████▎   | 617/971 [00:11<00:06, 57.93it/s]backtest loop:  64%|██████▍   | 623/971 [00:11<00:05, 58.10it/s]backtest loop:  65%|██████▍   | 630/971 [00:11<00:06, 56.14it/s]backtest loop:  66%|██████▌   | 637/971 [00:11<00:05, 58.30it/s]backtest loop:  66%|██████▋   | 644/971 [00:11<00:05, 59.49it/s]backtest loop:  67%|██████▋   | 650/971 [00:11<00:05, 56.37it/s]backtest loop:  68%|██████▊   | 657/971 [00:11<00:05, 58.08it/s]backtest loop:  68%|██████▊   | 664/971 [00:12<00:05, 59.37it/s]backtest loop:  69%|██████▉   | 670/971 [00:12<00:05, 56.18it/s]backtest loop:  70%|██████▉   | 676/971 [00:12<00:05, 55.37it/s]backtest loop:  70%|███████   | 682/971 [00:12<00:05, 55.25it/s]backtest loop:  71%|███████   | 688/971 [00:12<00:05, 55.10it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:05, 51.81it/s]backtest loop:  72%|███████▏  | 700/971 [00:12<00:05, 52.81it/s]backtest loop:  73%|███████▎  | 706/971 [00:12<00:04, 53.46it/s]backtest loop:  73%|███████▎  | 712/971 [00:12<00:04, 53.93it/s]backtest loop:  74%|███████▍  | 718/971 [00:13<00:04, 53.98it/s]backtest loop:  75%|███████▍  | 724/971 [00:13<00:04, 51.34it/s]backtest loop:  75%|███████▌  | 730/971 [00:13<00:04, 52.57it/s]backtest loop:  76%|███████▌  | 736/971 [00:13<00:04, 50.08it/s]backtest loop:  76%|███████▋  | 742/971 [00:13<00:04, 51.48it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 49.45it/s]backtest loop:  78%|███████▊  | 754/971 [00:13<00:04, 51.01it/s]backtest loop:  78%|███████▊  | 760/971 [00:13<00:04, 49.27it/s]backtest loop:  79%|███████▉  | 766/971 [00:14<00:04, 50.88it/s]backtest loop:  80%|███████▉  | 772/971 [00:14<00:03, 52.21it/s]backtest loop:  80%|████████  | 778/971 [00:14<00:03, 53.07it/s]backtest loop:  81%|████████  | 784/971 [00:14<00:03, 50.67it/s]backtest loop:  81%|████████▏ | 791/971 [00:14<00:03, 54.01it/s]backtest loop:  82%|████████▏ | 798/971 [00:14<00:03, 53.38it/s]backtest loop:  83%|████████▎ | 804/971 [00:14<00:03, 55.09it/s]backtest loop:  83%|████████▎ | 810/971 [00:14<00:02, 54.25it/s]backtest loop:  84%|████████▍ | 816/971 [00:14<00:02, 54.49it/s]backtest loop:  85%|████████▍ | 822/971 [00:15<00:02, 54.65it/s]backtest loop:  85%|████████▌ | 828/971 [00:15<00:02, 51.64it/s]backtest loop:  86%|████████▌ | 834/971 [00:15<00:02, 52.60it/s]backtest loop:  87%|████████▋ | 840/971 [00:15<00:02, 53.30it/s]backtest loop:  87%|████████▋ | 846/971 [00:15<00:02, 53.83it/s]backtest loop:  88%|████████▊ | 852/971 [00:15<00:02, 51.02it/s]backtest loop:  88%|████████▊ | 858/971 [00:15<00:02, 52.15it/s]backtest loop:  89%|████████▉ | 864/971 [00:15<00:02, 52.92it/s]backtest loop:  90%|████████▉ | 870/971 [00:15<00:01, 53.55it/s]backtest loop:  90%|█████████ | 876/971 [00:16<00:01, 54.12it/s]backtest loop:  91%|█████████ | 882/971 [00:16<00:01, 51.30it/s]backtest loop:  91%|█████████▏| 888/971 [00:16<00:01, 52.40it/s]backtest loop:  92%|█████████▏| 894/971 [00:16<00:01, 53.16it/s]backtest loop:  93%|█████████▎| 900/971 [00:16<00:01, 53.54it/s]backtest loop:  93%|█████████▎| 906/971 [00:16<00:01, 54.03it/s]backtest loop:  94%|█████████▍| 912/971 [00:16<00:01, 51.18it/s]backtest loop:  95%|█████████▍| 918/971 [00:16<00:01, 52.28it/s]backtest loop:  95%|█████████▌| 924/971 [00:16<00:00, 53.10it/s]backtest loop:  96%|█████████▌| 930/971 [00:17<00:00, 53.74it/s]backtest loop:  96%|█████████▋| 936/971 [00:17<00:00, 51.18it/s]backtest loop:  97%|█████████▋| 942/971 [00:17<00:00, 52.05it/s]backtest loop:  98%|█████████▊| 948/971 [00:17<00:00, 52.93it/s]backtest loop:  98%|█████████▊| 954/971 [00:17<00:00, 53.53it/s]backtest loop:  99%|█████████▉| 960/971 [00:17<00:00, 50.85it/s]backtest loop:  99%|█████████▉| 966/971 [00:17<00:00, 52.06it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.26it/s]
[3093195:MainThread](2024-04-25 05:36:16,125) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000612
std                0.004993
annualized_return  0.145687
information_ratio  1.891370
max_drawdown      -0.055682
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000413
std                0.004995
annualized_return  0.098330
information_ratio  1.276032
max_drawdown      -0.066625
[3093195:MainThread](2024-04-25 05:36:16,139) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:36:22,993) INFO - qlib.timer - [log.py:127] - Time cost: 0.008s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737,
                                                    0.08968346707466894,
                                                    0.11223778513394758,
                                                    -0.0002186104664208714,
                                                    0.09206051366053564,
                                                    0.10430284734718255,
                                                    0.0258446000191289,
                                                    0.09832990271110983],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084,
                                                    1.1218265483587289,
                                                    1.5057970219122332,
                                                    -0.002426202610177372,
                                                    1.2276726942916574,
                                                    1.2698181546880682,
                                                    0.2990222582252494,
                                                    1.2760323071231925],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933,
                                               -0.07846341666528217,
                                               -0.06996440873715659,
                                               -0.1662235786401427,
                                               -0.1214038195723268,
                                               -0.11015159185396192,
                                               -0.18045450152410464,
                                               -0.06662542225591644],
 'IC': [0.020637454956468574,
        0.018384392846222276,
        0.025241549798749627,
        0.026925119124198496,
        0.014817320525268003,
        0.025456744893419838,
        0.028770075229084733,
        0.005860252527685086,
        0.022362232851111805],
 'ICIR': [0.1363977555593439,
          0.12056425663985118,
          0.18055141124592092,
          0.20625217894659637,
          0.09992783537754027,
          0.1815812518355052,
          0.21295178834574896,
          0.03761024116962752,
          0.1580777461375568],
 'Rank IC': [0.04052653939231223,
             0.032153968726034154,
             0.036241671519137895,
             0.03890135583227345,
             0.02623694421706984,
             0.04059155499944135,
             0.04375107876310477,
             0.018058733162879374,
             0.03676774822632818],
 'Rank ICIR': [0.2709675937829445,
               0.21961644941208022,
               0.25479198875234993,
               0.2964856332378628,
               0.17100811058911927,
               0.291274386612759,
               0.3131100070810173,
               0.11963601853509603,
               0.2545363727936097],
 'mae': [0.8637884690110731,
         0.8641865647866,
         0.8639522385752554,
         0.8636988725136276,
         0.8644248587081322,
         0.8637859079110328,
         0.8634155737238998,
         0.8647950635521966,
         0.8639146257139974],
 'mse': [0.9966288064718065,
         0.9969241793435271,
         0.9971921815402262,
         0.9981024944682831,
         0.9973450664619631,
         0.9969975687883431,
         0.9965831772565794,
         0.9981951649486968,
         0.9970483060183672]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3093195:MainThread](2024-04-25 05:36:26,219) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3093195:MainThread](2024-04-25 05:36:29,135) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankTrue_52.
[3093195:MainThread](2024-04-25 05:36:29,202) INFO - qlib.workflow - [exp.py:258] - Experiment 74 starts running ...
[3093195:MainThread](2024-04-25 05:36:29,217) INFO - qlib.workflow - [recorder.py:341] - Recorder 48bde727f7ff495692ba086a25ad72d9 starts running under Experiment 74 ...
[3093195:MainThread](2024-04-25 05:36:34,336) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3093195:MainThread](2024-04-25 05:36:34,336) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3093195:MainThread](2024-04-25 05:36:34,336) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:36:41,442) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:36:41,758) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999264
[3093195:MainThread](2024-04-25 05:36:41,761) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3093195:MainThread](2024-04-25 05:36:41,762) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:36:48,646) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:36:48,964) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998919
[3093195:MainThread](2024-04-25 05:36:48,968) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3093195:MainThread](2024-04-25 05:36:48,968) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:36:55,849) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:36:56,166) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998395
[3093195:MainThread](2024-04-25 05:36:56,169) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3093195:MainThread](2024-04-25 05:36:56,170) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:37:03,120) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:37:03,438) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999345
[3093195:MainThread](2024-04-25 05:37:03,439) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3093195:MainThread](2024-04-25 05:37:03,439) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:37:10,441) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:37:10,756) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999387
[3093195:MainThread](2024-04-25 05:37:10,757) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3093195:MainThread](2024-04-25 05:37:10,757) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:37:17,764) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:37:18,080) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.999713
[3093195:MainThread](2024-04-25 05:37:18,080) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3093195:MainThread](2024-04-25 05:37:18,080) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:37:24,952) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:37:25,267) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -1.000213
[3093195:MainThread](2024-04-25 05:37:25,268) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3093195:MainThread](2024-04-25 05:37:25,268) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3093195:MainThread](2024-04-25 05:37:32,145) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3093195:MainThread](2024-04-25 05:37:32,466) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.998487
[3093195:MainThread](2024-04-25 05:37:32,466) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3093195:MainThread](2024-04-25 05:37:32,467) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.998395 @ 2
[3093195:MainThread](2024-04-25 05:37:32,500) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankTrue_52.
[3093195:MainThread](2024-04-25 05:37:32,771) INFO - qlib.workflow - [exp.py:258] - Experiment 65 starts running ...
[3093195:MainThread](2024-04-25 05:37:32,785) INFO - qlib.workflow - [recorder.py:341] - Recorder 99f9e9551371435ba04949f2e163170d starts running under Experiment 65 ...
{'IC': 0.022300394199815648,
 'ICIR': 0.14819908892277076,
 'Rank IC': 0.03766523088103903,
 'Rank ICIR': 0.2376078067732463}
[3093195:MainThread](2024-04-25 05:37:39,546) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3093195:MainThread](2024-04-25 05:38:16,971) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:38:16,974) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3093195:MainThread](2024-04-25 05:38:23,200) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f4566ece310>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:45,  9.17it/s]backtest loop:   1%|          | 9/971 [00:00<00:40, 23.66it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:28, 33.26it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:25, 37.39it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:22, 42.41it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:20, 46.06it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:20, 45.68it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:19, 48.29it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 50.22it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 48.34it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:17, 50.49it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:17, 52.18it/s]backtest loop:   8%|▊         | 75/971 [00:01<00:16, 53.08it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:16, 53.61it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:17, 50.73it/s]backtest loop:  10%|▉         | 93/971 [00:02<00:16, 52.03it/s]backtest loop:  10%|█         | 99/971 [00:02<00:16, 52.74it/s]backtest loop:  11%|█         | 105/971 [00:02<00:16, 53.30it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:15, 53.77it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:16, 50.75it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:16, 51.72it/s]backtest loop:  13%|█▎        | 129/971 [00:02<00:17, 49.50it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:16, 50.81it/s]backtest loop:  15%|█▍        | 141/971 [00:03<00:16, 49.03it/s]backtest loop:  15%|█▌        | 147/971 [00:03<00:16, 50.62it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:15, 51.82it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:15, 52.61it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:15, 53.15it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:15, 51.32it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:15, 52.40it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:14, 53.32it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:14, 53.63it/s]backtest loop:  20%|██        | 195/971 [00:04<00:15, 50.76it/s]backtest loop:  21%|██        | 201/971 [00:04<00:14, 51.97it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:14, 52.72it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:14, 50.57it/s]backtest loop:  23%|██▎       | 219/971 [00:04<00:14, 51.40it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:15, 49.28it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:23, 31.43it/s]backtest loop:  24%|██▍       | 236/971 [00:05<00:20, 36.25it/s]backtest loop:  25%|██▍       | 242/971 [00:05<00:18, 40.49it/s]backtest loop:  26%|██▌       | 248/971 [00:05<00:16, 44.09it/s]backtest loop:  26%|██▌       | 254/971 [00:05<00:15, 44.98it/s]backtest loop:  27%|██▋       | 260/971 [00:05<00:14, 47.92it/s]backtest loop:  27%|██▋       | 266/971 [00:05<00:14, 47.34it/s]backtest loop:  28%|██▊       | 272/971 [00:05<00:14, 49.48it/s]backtest loop:  29%|██▊       | 278/971 [00:05<00:13, 51.04it/s]backtest loop:  29%|██▉       | 284/971 [00:05<00:13, 52.11it/s]backtest loop:  30%|██▉       | 290/971 [00:06<00:12, 52.92it/s]backtest loop:  30%|███       | 296/971 [00:06<00:13, 50.39it/s]backtest loop:  31%|███       | 302/971 [00:06<00:12, 51.59it/s]backtest loop:  32%|███▏      | 308/971 [00:06<00:12, 52.65it/s]backtest loop:  32%|███▏      | 314/971 [00:06<00:12, 53.32it/s]backtest loop:  33%|███▎      | 320/971 [00:06<00:12, 50.88it/s]backtest loop:  34%|███▎      | 326/971 [00:06<00:12, 52.20it/s]backtest loop:  34%|███▍      | 332/971 [00:06<00:12, 52.94it/s]backtest loop:  35%|███▍      | 338/971 [00:06<00:11, 53.41it/s]backtest loop:  35%|███▌      | 344/971 [00:07<00:11, 53.98it/s]backtest loop:  36%|███▌      | 350/971 [00:07<00:12, 51.34it/s]backtest loop:  37%|███▋      | 356/971 [00:07<00:11, 52.34it/s]backtest loop:  37%|███▋      | 362/971 [00:07<00:11, 53.61it/s]backtest loop:  38%|███▊      | 368/971 [00:07<00:12, 47.80it/s]backtest loop:  39%|███▊      | 374/971 [00:07<00:11, 49.77it/s]backtest loop:  39%|███▉      | 380/971 [00:07<00:11, 51.34it/s]backtest loop:  40%|███▉      | 386/971 [00:07<00:11, 52.06it/s]backtest loop:  40%|████      | 392/971 [00:08<00:10, 52.88it/s]backtest loop:  41%|████      | 398/971 [00:08<00:11, 49.99it/s]backtest loop:  42%|████▏     | 404/971 [00:08<00:10, 51.79it/s]backtest loop:  42%|████▏     | 410/971 [00:08<00:10, 52.92it/s]backtest loop:  43%|████▎     | 416/971 [00:08<00:10, 52.84it/s]backtest loop:  43%|████▎     | 422/971 [00:08<00:10, 53.39it/s]backtest loop:  44%|████▍     | 428/971 [00:08<00:10, 50.60it/s]backtest loop:  45%|████▍     | 434/971 [00:08<00:10, 51.57it/s]backtest loop:  45%|████▌     | 440/971 [00:08<00:10, 52.60it/s]backtest loop:  46%|████▌     | 446/971 [00:09<00:09, 53.28it/s]backtest loop:  47%|████▋     | 452/971 [00:09<00:10, 50.59it/s]backtest loop:  47%|████▋     | 458/971 [00:09<00:09, 51.69it/s]backtest loop:  48%|████▊     | 464/971 [00:09<00:09, 52.78it/s]backtest loop:  48%|████▊     | 470/971 [00:09<00:09, 53.47it/s]backtest loop:  49%|████▉     | 476/971 [00:09<00:09, 54.12it/s]backtest loop:  50%|████▉     | 482/971 [00:09<00:09, 51.09it/s]backtest loop:  50%|█████     | 488/971 [00:09<00:09, 52.11it/s]backtest loop:  51%|█████     | 494/971 [00:10<00:08, 53.02it/s]backtest loop:  51%|█████▏    | 500/971 [00:10<00:09, 50.38it/s]backtest loop:  52%|█████▏    | 506/971 [00:10<00:08, 51.80it/s]backtest loop:  53%|█████▎    | 512/971 [00:10<00:09, 49.36it/s]backtest loop:  53%|█████▎    | 518/971 [00:10<00:08, 50.96it/s]backtest loop:  54%|█████▍    | 524/971 [00:10<00:08, 52.19it/s]backtest loop:  55%|█████▍    | 530/971 [00:10<00:08, 53.31it/s]backtest loop:  55%|█████▌    | 536/971 [00:10<00:08, 50.79it/s]backtest loop:  56%|█████▌    | 542/971 [00:10<00:08, 52.07it/s]backtest loop:  56%|█████▋    | 548/971 [00:11<00:07, 52.98it/s]backtest loop:  57%|█████▋    | 554/971 [00:11<00:07, 53.28it/s]backtest loop:  58%|█████▊    | 560/971 [00:11<00:07, 53.87it/s]backtest loop:  58%|█████▊    | 566/971 [00:11<00:07, 50.95it/s]backtest loop:  59%|█████▉    | 572/971 [00:11<00:07, 51.90it/s]backtest loop:  60%|█████▉    | 578/971 [00:11<00:07, 52.69it/s]backtest loop:  60%|██████    | 584/971 [00:11<00:07, 53.62it/s]backtest loop:  61%|██████    | 590/971 [00:11<00:07, 53.77it/s]backtest loop:  61%|██████▏   | 596/971 [00:11<00:07, 50.90it/s]backtest loop:  62%|██████▏   | 602/971 [00:12<00:07, 52.04it/s]backtest loop:  63%|██████▎   | 608/971 [00:12<00:06, 52.83it/s]backtest loop:  63%|██████▎   | 614/971 [00:12<00:06, 53.11it/s]backtest loop:  64%|██████▍   | 620/971 [00:12<00:06, 50.36it/s]backtest loop:  64%|██████▍   | 626/971 [00:12<00:06, 51.82it/s]backtest loop:  65%|██████▌   | 632/971 [00:12<00:06, 52.32it/s]backtest loop:  66%|██████▌   | 638/971 [00:12<00:06, 53.11it/s]backtest loop:  66%|██████▋   | 644/971 [00:12<00:06, 53.65it/s]backtest loop:  67%|██████▋   | 650/971 [00:13<00:06, 50.94it/s]backtest loop:  68%|██████▊   | 656/971 [00:13<00:06, 51.98it/s]backtest loop:  68%|██████▊   | 662/971 [00:13<00:05, 52.88it/s]backtest loop:  69%|██████▉   | 668/971 [00:13<00:05, 53.55it/s]backtest loop:  69%|██████▉   | 674/971 [00:13<00:05, 50.79it/s]backtest loop:  70%|███████   | 680/971 [00:13<00:05, 51.84it/s]backtest loop:  71%|███████   | 686/971 [00:13<00:05, 52.57it/s]backtest loop:  71%|███████▏  | 692/971 [00:13<00:05, 53.30it/s]backtest loop:  72%|███████▏  | 698/971 [00:13<00:05, 53.78it/s]backtest loop:  73%|███████▎  | 704/971 [00:14<00:05, 50.99it/s]backtest loop:  73%|███████▎  | 710/971 [00:14<00:04, 52.22it/s]backtest loop:  74%|███████▎  | 716/971 [00:14<00:04, 53.09it/s]backtest loop:  74%|███████▍  | 722/971 [00:14<00:04, 53.67it/s]backtest loop:  75%|███████▍  | 728/971 [00:14<00:04, 54.31it/s]backtest loop:  76%|███████▌  | 734/971 [00:14<00:04, 48.41it/s]backtest loop:  76%|███████▌  | 740/971 [00:14<00:04, 50.26it/s]backtest loop:  77%|███████▋  | 746/971 [00:14<00:04, 51.46it/s]backtest loop:  77%|███████▋  | 752/971 [00:14<00:04, 49.50it/s]backtest loop:  78%|███████▊  | 758/971 [00:15<00:04, 51.04it/s]backtest loop:  79%|███████▊  | 764/971 [00:15<00:03, 52.25it/s]backtest loop:  79%|███████▉  | 770/971 [00:15<00:04, 49.84it/s]backtest loop:  80%|███████▉  | 776/971 [00:15<00:03, 51.31it/s]backtest loop:  81%|████████  | 782/971 [00:15<00:03, 52.59it/s]backtest loop:  81%|████████  | 788/971 [00:15<00:03, 50.48it/s]backtest loop:  82%|████████▏ | 794/971 [00:15<00:03, 51.59it/s]backtest loop:  82%|████████▏ | 800/971 [00:15<00:03, 52.46it/s]backtest loop:  83%|████████▎ | 806/971 [00:16<00:03, 53.21it/s]backtest loop:  84%|████████▎ | 812/971 [00:16<00:02, 53.58it/s]backtest loop:  84%|████████▍ | 818/971 [00:16<00:03, 50.56it/s]backtest loop:  85%|████████▍ | 824/971 [00:16<00:02, 51.76it/s]backtest loop:  85%|████████▌ | 830/971 [00:16<00:02, 52.61it/s]backtest loop:  86%|████████▌ | 836/971 [00:16<00:02, 53.27it/s]backtest loop:  87%|████████▋ | 842/971 [00:16<00:02, 53.52it/s]backtest loop:  87%|████████▋ | 848/971 [00:16<00:02, 50.75it/s]backtest loop:  88%|████████▊ | 854/971 [00:16<00:02, 51.92it/s]backtest loop:  89%|████████▊ | 860/971 [00:17<00:02, 52.74it/s]backtest loop:  89%|████████▉ | 866/971 [00:17<00:01, 53.08it/s]backtest loop:  90%|████████▉ | 872/971 [00:17<00:01, 50.45it/s]backtest loop:  90%|█████████ | 878/971 [00:17<00:01, 51.65it/s]backtest loop:  91%|█████████ | 884/971 [00:17<00:01, 52.64it/s]backtest loop:  92%|█████████▏| 890/971 [00:17<00:01, 52.85it/s]backtest loop:  92%|█████████▏| 896/971 [00:17<00:01, 53.49it/s]backtest loop:  93%|█████████▎| 902/971 [00:17<00:01, 50.85it/s]backtest loop:  94%|█████████▎| 908/971 [00:17<00:01, 52.08it/s]backtest loop:  94%|█████████▍| 914/971 [00:18<00:01, 52.99it/s]backtest loop:  95%|█████████▍| 920/971 [00:18<00:00, 53.45it/s]backtest loop:  95%|█████████▌| 926/971 [00:18<00:00, 50.78it/s]backtest loop:  96%|█████████▌| 932/971 [00:18<00:00, 51.99it/s]backtest loop:  97%|█████████▋| 938/971 [00:18<00:00, 52.87it/s]backtest loop:  97%|█████████▋| 944/971 [00:18<00:00, 53.46it/s]backtest loop:  98%|█████████▊| 950/971 [00:18<00:00, 50.84it/s]backtest loop:  98%|█████████▊| 956/971 [00:18<00:00, 52.02it/s]backtest loop:  99%|█████████▉| 962/971 [00:18<00:00, 52.89it/s]backtest loop: 100%|█████████▉| 968/971 [00:19<00:00, 53.53it/s]backtest loop: 100%|██████████| 971/971 [00:19<00:00, 50.66it/s]
[3093195:MainThread](2024-04-25 05:38:42,429) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000495
std                0.005755
annualized_return  0.117857
information_ratio  1.327515
max_drawdown      -0.083304
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000299
std                0.005756
annualized_return  0.071215
information_ratio  0.801917
max_drawdown      -0.093597
[3093195:MainThread](2024-04-25 05:38:42,443) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 65
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Transformer_crowd_data_csi300_360_rankTrue`.
[3093195:MainThread](2024-04-25 05:38:49,336) INFO - qlib.timer - [log.py:127] - Time cost: 0.007s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.09118674009371884,
                                                    0.06531707710454737,
                                                    0.08968346707466894,
                                                    0.11223778513394758,
                                                    -0.0002186104664208714,
                                                    0.09206051366053564,
                                                    0.10430284734718255,
                                                    0.0258446000191289,
                                                    0.09832990271110983,
                                                    0.07121483161896665],
 '1day.excess_return_with_cost.information_ratio': [1.090810065822808,
                                                    0.7736948154206084,
                                                    1.1218265483587289,
                                                    1.5057970219122332,
                                                    -0.002426202610177372,
                                                    1.2276726942916574,
                                                    1.2698181546880682,
                                                    0.2990222582252494,
                                                    1.2760323071231925,
                                                    0.8019172273825639],
 '1day.excess_return_with_cost.max_drawdown': [-0.09746832897334401,
                                               -0.1118383593736933,
                                               -0.07846341666528217,
                                               -0.06996440873715659,
                                               -0.1662235786401427,
                                               -0.1214038195723268,
                                               -0.11015159185396192,
                                               -0.18045450152410464,
                                               -0.06662542225591644,
                                               -0.09359742364127027],
 'IC': [0.020637454956468574,
        0.018384392846222276,
        0.025241549798749627,
        0.026925119124198496,
        0.014817320525268003,
        0.025456744893419838,
        0.028770075229084733,
        0.005860252527685086,
        0.022362232851111805,
        0.022300394199815648],
 'ICIR': [0.1363977555593439,
          0.12056425663985118,
          0.18055141124592092,
          0.20625217894659637,
          0.09992783537754027,
          0.1815812518355052,
          0.21295178834574896,
          0.03761024116962752,
          0.1580777461375568,
          0.14819908892277076],
 'Rank IC': [0.04052653939231223,
             0.032153968726034154,
             0.036241671519137895,
             0.03890135583227345,
             0.02623694421706984,
             0.04059155499944135,
             0.04375107876310477,
             0.018058733162879374,
             0.03676774822632818,
             0.03766523088103903],
 'Rank ICIR': [0.2709675937829445,
               0.21961644941208022,
               0.25479198875234993,
               0.2964856332378628,
               0.17100811058911927,
               0.291274386612759,
               0.3131100070810173,
               0.11963601853509603,
               0.2545363727936097,
               0.2376078067732463],
 'mae': [0.8637884690110731,
         0.8641865647866,
         0.8639522385752554,
         0.8636988725136276,
         0.8644248587081322,
         0.8637859079110328,
         0.8634155737238998,
         0.8647950635521966,
         0.8639146257139974,
         0.8638945692049793],
 'mse': [0.9966288064718065,
         0.9969241793435271,
         0.9971921815402262,
         0.9981024944682831,
         0.9973450664619631,
         0.9969975687883431,
         0.9965831772565794,
         0.9981951649486968,
         0.9970483060183672,
         0.9970817600547099]}
[3093195:MainThread](2024-04-25 05:38:49,637) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name final_crowd_data_csi300_360_1_Transformer.
[3093195:MainThread](2024-04-25 05:38:49,709) INFO - qlib.workflow - [exp.py:258] - Experiment 75 starts running ...
[3093195:MainThread](2024-04-25 05:38:49,728) INFO - qlib.workflow - [recorder.py:341] - Recorder 8a6bd627cd6849e494ce4644c842812b starts running under Experiment 75 ...
Time cost: 165.57411353588105
{'1day.excess_return_with_cost.annualized_return': [0.07499591542973855,
                                                    0.03426433829481242],
 '1day.excess_return_with_cost.information_ratio': [0.9364164890614932,
                                                    0.45011105397466283],
 '1day.excess_return_with_cost.max_drawdown': [-0.10961908512371987,
                                               0.036279156833359257],
 'IC': [0.021075553695202406, 0.0064127557567170085],
 'ICIR': [0.1482113554180462, 0.050283858104429625],
 'Rank IC': [0.035089482571962025, 0.0073293772642961524],
 'Rank ICIR': [0.2429034367570085, 0.0566905147812976],
 'mae': [0.8639856743700793, 0.0003726772529687065],
 'mse': [0.9972098705352502, 0.0005182432049338996]}
[3093195:MainThread](2024-04-25 05:38:50,243) INFO - qlib.timer - [log.py:127] - Time cost: 0.043s | waiting `async_log` Done
