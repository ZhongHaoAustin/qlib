[3925260:MainThread](2024-04-26 19:23:53,315) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[3925260:MainThread](2024-04-26 19:23:53,317) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[3925260:MainThread](2024-04-26 19:23:53,317) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 19:24:07,849) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 19:24:29,232) INFO - qlib.workflow - [exp.py:258] - Experiment 117 starts running ...
[3925260:MainThread](2024-04-26 19:24:31,297) INFO - qlib.workflow - [recorder.py:341] - Recorder ddd87408b3fd4aed938cda49718efe20 starts running under Experiment 117 ...
[3925260:MainThread](2024-04-26 19:24:39,171) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 19:24:39,172) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 19:24:39,173) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:25:32,550) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:25:53,417) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991679, valid -0.997567
[3925260:MainThread](2024-04-26 19:25:53,426) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 19:25:53,427) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:26:42,459) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:27:03,219) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990859, valid -0.998076
[3925260:MainThread](2024-04-26 19:27:03,220) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 19:27:03,220) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:27:52,421) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:28:13,122) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991378, valid -0.997008
[3925260:MainThread](2024-04-26 19:28:13,126) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 19:28:13,126) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:29:01,831) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:29:22,499) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990171, valid -0.997967
[3925260:MainThread](2024-04-26 19:29:22,499) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 19:29:22,500) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:30:11,474) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:30:32,131) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990952, valid -1.000317
[3925260:MainThread](2024-04-26 19:30:32,131) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 19:30:32,131) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:31:20,723) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:31:41,358) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989568, valid -0.997695
[3925260:MainThread](2024-04-26 19:31:41,358) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 19:31:41,359) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:32:29,980) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:32:49,658) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990813, valid -0.996964
[3925260:MainThread](2024-04-26 19:32:49,662) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 19:32:49,662) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:33:38,239) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:33:58,844) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989855, valid -0.997432
[3925260:MainThread](2024-04-26 19:33:58,844) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch8:
[3925260:MainThread](2024-04-26 19:33:58,845) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:34:47,688) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:35:08,264) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989922, valid -0.998200
[3925260:MainThread](2024-04-26 19:35:08,264) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch9:
[3925260:MainThread](2024-04-26 19:35:08,265) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:35:57,108) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:36:17,692) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988997, valid -0.996894
[3925260:MainThread](2024-04-26 19:36:17,696) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch10:
[3925260:MainThread](2024-04-26 19:36:17,696) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:37:06,158) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:37:26,369) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989384, valid -0.997375
[3925260:MainThread](2024-04-26 19:37:26,369) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch11:
[3925260:MainThread](2024-04-26 19:37:26,370) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:38:15,211) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:38:35,782) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988726, valid -0.997723
[3925260:MainThread](2024-04-26 19:38:35,782) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch12:
[3925260:MainThread](2024-04-26 19:38:35,783) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:39:24,546) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:39:44,178) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988936, valid -0.997420
[3925260:MainThread](2024-04-26 19:39:44,179) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch13:
[3925260:MainThread](2024-04-26 19:39:44,179) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:40:09,972) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:40:19,308) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989077, valid -0.997960
[3925260:MainThread](2024-04-26 19:40:19,308) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch14:
[3925260:MainThread](2024-04-26 19:40:19,309) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:40:41,448) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:40:50,655) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989269, valid -0.998795
[3925260:MainThread](2024-04-26 19:40:50,656) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 19:40:50,656) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.996894 @ 9
[3925260:MainThread](2024-04-26 19:40:50,726) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_43.
[3925260:MainThread](2024-04-26 19:40:51,025) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 19:40:51,050) INFO - qlib.workflow - [recorder.py:341] - Recorder a6b69ea9ef464165bab1b56af80dc7a6 starts running under Experiment 118 ...
{'IC': 0.02734841249253904,
 'ICIR': 0.21236024942574536,
 'Rank IC': 0.035975396383521215,
 'Rank ICIR': 0.2768152718838129}
[3925260:MainThread](2024-04-26 19:41:02,219) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 19:41:38,545) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 19:41:38,548) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 19:41:44,738) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fdab3048340>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 6/971 [00:00<00:16, 58.56it/s]backtest loop:   1%|          | 12/971 [00:00<00:18, 52.92it/s]backtest loop:   2%|▏         | 18/971 [00:00<00:17, 55.85it/s]backtest loop:   2%|▏         | 24/971 [00:00<00:17, 53.17it/s]backtest loop:   3%|▎         | 31/971 [00:00<00:16, 56.57it/s]backtest loop:   4%|▍         | 38/971 [00:00<00:15, 58.66it/s]backtest loop:   5%|▍         | 44/971 [00:00<00:16, 55.39it/s]backtest loop:   5%|▌         | 51/971 [00:00<00:15, 57.55it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:16, 55.02it/s]backtest loop:   7%|▋         | 64/971 [00:01<00:15, 57.35it/s]backtest loop:   7%|▋         | 71/971 [00:01<00:15, 59.04it/s]backtest loop:   8%|▊         | 77/971 [00:01<00:15, 56.07it/s]backtest loop:   9%|▊         | 83/971 [00:01<00:15, 57.12it/s]backtest loop:   9%|▉         | 90/971 [00:01<00:15, 58.64it/s]backtest loop:  10%|▉         | 97/971 [00:01<00:15, 56.51it/s]backtest loop:  11%|█         | 104/971 [00:01<00:14, 58.29it/s]backtest loop:  11%|█▏        | 111/971 [00:01<00:14, 59.60it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:15, 56.52it/s]backtest loop:  13%|█▎        | 124/971 [00:02<00:14, 58.39it/s]backtest loop:  13%|█▎        | 130/971 [00:02<00:15, 55.72it/s]backtest loop:  14%|█▍        | 136/971 [00:02<00:15, 54.62it/s]backtest loop:  15%|█▍        | 143/971 [00:02<00:14, 56.83it/s]backtest loop:  15%|█▌        | 150/971 [00:02<00:14, 58.49it/s]backtest loop:  16%|█▌        | 156/971 [00:02<00:14, 55.58it/s]backtest loop:  17%|█▋        | 163/971 [00:02<00:14, 57.58it/s]backtest loop:  18%|█▊        | 170/971 [00:02<00:13, 59.75it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:13, 57.80it/s]backtest loop:  19%|█▉        | 184/971 [00:03<00:13, 59.16it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:13, 56.07it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 57.92it/s]backtest loop:  21%|██        | 204/971 [00:03<00:12, 59.15it/s]backtest loop:  22%|██▏       | 210/971 [00:03<00:13, 56.33it/s]backtest loop:  22%|██▏       | 216/971 [00:03<00:13, 54.24it/s]backtest loop:  23%|██▎       | 223/971 [00:03<00:13, 56.74it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:13, 55.38it/s]backtest loop:  24%|██▍       | 237/971 [00:04<00:12, 57.49it/s]backtest loop:  25%|██▌       | 244/971 [00:04<00:12, 59.07it/s]backtest loop:  26%|██▌       | 250/971 [00:04<00:12, 56.36it/s]backtest loop:  26%|██▋       | 257/971 [00:04<00:12, 59.29it/s]backtest loop:  27%|██▋       | 264/971 [00:04<00:12, 56.84it/s]backtest loop:  28%|██▊       | 270/971 [00:04<00:12, 57.45it/s]backtest loop:  28%|██▊       | 276/971 [00:04<00:12, 54.98it/s]backtest loop:  29%|██▉       | 282/971 [00:04<00:12, 56.31it/s]backtest loop:  30%|██▉       | 289/971 [00:05<00:11, 58.18it/s]backtest loop:  30%|███       | 295/971 [00:05<00:12, 55.44it/s]backtest loop:  31%|███       | 302/971 [00:05<00:11, 57.49it/s]backtest loop:  32%|███▏      | 309/971 [00:05<00:11, 59.02it/s]backtest loop:  32%|███▏      | 315/971 [00:05<00:11, 55.89it/s]backtest loop:  33%|███▎      | 322/971 [00:05<00:11, 57.86it/s]backtest loop:  34%|███▍      | 329/971 [00:05<00:10, 59.77it/s]backtest loop:  35%|███▍      | 336/971 [00:05<00:11, 57.22it/s]backtest loop:  35%|███▌      | 343/971 [00:05<00:10, 58.72it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:10, 56.78it/s]backtest loop:  37%|███▋      | 357/971 [00:06<00:10, 58.58it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 56.24it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 54.18it/s]backtest loop:  39%|███▊      | 376/971 [00:06<00:10, 56.88it/s]backtest loop:  39%|███▉      | 383/971 [00:06<00:10, 55.32it/s]backtest loop:  40%|████      | 390/971 [00:06<00:10, 57.31it/s]backtest loop:  41%|████      | 397/971 [00:06<00:09, 58.99it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 56.03it/s]backtest loop:  42%|████▏     | 410/971 [00:07<00:09, 58.04it/s]backtest loop:  43%|████▎     | 417/971 [00:07<00:09, 59.35it/s]backtest loop:  44%|████▎     | 423/971 [00:07<00:09, 56.26it/s]backtest loop:  44%|████▍     | 430/971 [00:07<00:09, 58.11it/s]backtest loop:  45%|████▌     | 437/971 [00:07<00:09, 56.09it/s]backtest loop:  46%|████▌     | 444/971 [00:07<00:09, 58.01it/s]backtest loop:  46%|████▋     | 451/971 [00:07<00:08, 59.28it/s]backtest loop:  47%|████▋     | 457/971 [00:08<00:09, 56.23it/s]backtest loop:  48%|████▊     | 464/971 [00:08<00:08, 57.97it/s]backtest loop:  49%|████▊     | 471/971 [00:08<00:08, 59.37it/s]backtest loop:  49%|████▉     | 477/971 [00:08<00:08, 56.27it/s]backtest loop:  50%|████▉     | 484/971 [00:08<00:08, 58.10it/s]backtest loop:  50%|█████     | 490/971 [00:08<00:08, 55.60it/s]backtest loop:  51%|█████     | 497/971 [00:08<00:08, 57.80it/s]backtest loop:  52%|█████▏    | 504/971 [00:08<00:07, 59.30it/s]backtest loop:  53%|█████▎    | 510/971 [00:08<00:08, 56.28it/s]backtest loop:  53%|█████▎    | 517/971 [00:09<00:08, 54.87it/s]backtest loop:  54%|█████▍    | 523/971 [00:09<00:07, 56.06it/s]backtest loop:  55%|█████▍    | 530/971 [00:09<00:07, 57.87it/s]backtest loop:  55%|█████▌    | 536/971 [00:09<00:07, 55.65it/s]backtest loop:  56%|█████▌    | 543/971 [00:09<00:07, 57.82it/s]backtest loop:  57%|█████▋    | 550/971 [00:09<00:07, 59.25it/s]backtest loop:  57%|█████▋    | 556/971 [00:09<00:07, 56.34it/s]backtest loop:  58%|█████▊    | 563/971 [00:09<00:07, 58.12it/s]backtest loop:  59%|█████▊    | 570/971 [00:09<00:06, 59.43it/s]backtest loop:  59%|█████▉    | 576/971 [00:10<00:07, 56.22it/s]backtest loop:  60%|██████    | 583/971 [00:10<00:06, 58.06it/s]backtest loop:  61%|██████    | 590/971 [00:10<00:06, 59.32it/s]backtest loop:  61%|██████▏   | 596/971 [00:10<00:06, 56.23it/s]backtest loop:  62%|██████▏   | 603/971 [00:10<00:06, 58.04it/s]backtest loop:  63%|██████▎   | 610/971 [00:10<00:06, 56.02it/s]backtest loop:  63%|██████▎   | 616/971 [00:10<00:06, 56.82it/s]backtest loop:  64%|██████▍   | 622/971 [00:10<00:06, 57.57it/s]backtest loop:  65%|██████▍   | 629/971 [00:10<00:05, 59.23it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:05, 56.21it/s]backtest loop:  66%|██████▌   | 642/971 [00:11<00:05, 58.10it/s]backtest loop:  67%|██████▋   | 649/971 [00:11<00:05, 58.57it/s]backtest loop:  67%|██████▋   | 655/971 [00:11<00:05, 55.41it/s]backtest loop:  68%|██████▊   | 662/971 [00:11<00:05, 57.48it/s]backtest loop:  69%|██████▉   | 669/971 [00:11<00:05, 58.98it/s]backtest loop:  70%|██████▉   | 675/971 [00:11<00:05, 56.04it/s]backtest loop:  70%|███████   | 682/971 [00:11<00:04, 57.94it/s]backtest loop:  71%|███████   | 689/971 [00:12<00:05, 55.76it/s]backtest loop:  72%|███████▏  | 695/971 [00:12<00:04, 56.84it/s]backtest loop:  72%|███████▏  | 701/971 [00:12<00:04, 57.12it/s]backtest loop:  73%|███████▎  | 707/971 [00:12<00:04, 57.10it/s]backtest loop:  74%|███████▎  | 714/971 [00:12<00:04, 55.26it/s]backtest loop:  74%|███████▍  | 721/971 [00:12<00:04, 57.30it/s]backtest loop:  75%|███████▍  | 728/971 [00:12<00:04, 59.15it/s]backtest loop:  76%|███████▌  | 734/971 [00:12<00:04, 53.16it/s]backtest loop:  76%|███████▋  | 741/971 [00:12<00:04, 55.84it/s]backtest loop:  77%|███████▋  | 747/971 [00:13<00:03, 56.85it/s]backtest loop:  78%|███████▊  | 753/971 [00:13<00:03, 54.52it/s]backtest loop:  78%|███████▊  | 760/971 [00:13<00:03, 53.81it/s]backtest loop:  79%|███████▉  | 767/971 [00:13<00:03, 56.32it/s]backtest loop:  80%|███████▉  | 774/971 [00:13<00:03, 58.15it/s]backtest loop:  80%|████████  | 780/971 [00:13<00:03, 55.52it/s]backtest loop:  81%|████████  | 787/971 [00:13<00:03, 57.67it/s]backtest loop:  82%|████████▏ | 793/971 [00:13<00:03, 55.25it/s]backtest loop:  82%|████████▏ | 799/971 [00:14<00:03, 56.50it/s]backtest loop:  83%|████████▎ | 805/971 [00:14<00:02, 57.39it/s]backtest loop:  84%|████████▎ | 812/971 [00:14<00:02, 59.07it/s]backtest loop:  84%|████████▍ | 818/971 [00:14<00:02, 56.04it/s]backtest loop:  85%|████████▍ | 825/971 [00:14<00:02, 58.02it/s]backtest loop:  86%|████████▌ | 832/971 [00:14<00:02, 59.42it/s]backtest loop:  86%|████████▋ | 838/971 [00:14<00:02, 56.30it/s]backtest loop:  87%|████████▋ | 845/971 [00:14<00:02, 58.11it/s]backtest loop:  88%|████████▊ | 852/971 [00:14<00:02, 56.19it/s]backtest loop:  88%|████████▊ | 858/971 [00:15<00:01, 57.13it/s]backtest loop:  89%|████████▉ | 865/971 [00:15<00:01, 58.76it/s]backtest loop:  90%|████████▉ | 872/971 [00:15<00:01, 56.63it/s]backtest loop:  91%|█████████ | 879/971 [00:15<00:01, 58.31it/s]backtest loop:  91%|█████████ | 886/971 [00:15<00:01, 59.66it/s]backtest loop:  92%|█████████▏| 892/971 [00:15<00:01, 56.54it/s]backtest loop:  93%|█████████▎| 899/971 [00:15<00:01, 58.19it/s]backtest loop:  93%|█████████▎| 906/971 [00:15<00:01, 59.50it/s]backtest loop:  94%|█████████▍| 912/971 [00:15<00:01, 56.34it/s]backtest loop:  95%|█████████▍| 918/971 [00:16<00:00, 57.16it/s]backtest loop:  95%|█████████▌| 925/971 [00:16<00:00, 58.92it/s]backtest loop:  96%|█████████▌| 931/971 [00:16<00:00, 55.95it/s]backtest loop:  96%|█████████▋| 937/971 [00:16<00:00, 56.43it/s]backtest loop:  97%|█████████▋| 944/971 [00:16<00:00, 58.22it/s]backtest loop:  98%|█████████▊| 950/971 [00:16<00:00, 55.38it/s]backtest loop:  98%|█████████▊| 956/971 [00:16<00:00, 55.83it/s]backtest loop:  99%|█████████▉| 962/971 [00:16<00:00, 55.80it/s]backtest loop: 100%|█████████▉| 969/971 [00:16<00:00, 58.25it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 57.11it/s]
[3925260:MainThread](2024-04-26 19:42:01,798) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000431
std                0.004936
annualized_return  0.102658
information_ratio  1.348136
max_drawdown      -0.066946
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000233
std                0.004937
annualized_return  0.055405
information_ratio  0.727498
max_drawdown      -0.089231
[3925260:MainThread](2024-04-26 19:42:01,811) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 19:42:08,674) INFO - qlib.timer - [log.py:127] - Time cost: 0.011s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757],
 'IC': [0.02734841249253904],
 'ICIR': [0.21236024942574536],
 'Rank IC': [0.035975396383521215],
 'Rank ICIR': [0.2768152718838129],
 'mae': [0.8639875715380355],
 'mse': [0.997836837153924]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 19:42:12,197) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 19:42:15,483) INFO - qlib.workflow - [exp.py:258] - Experiment 119 starts running ...
[3925260:MainThread](2024-04-26 19:42:15,508) INFO - qlib.workflow - [recorder.py:341] - Recorder 2551061df2c7478a88078eb994d82f6b starts running under Experiment 119 ...
[3925260:MainThread](2024-04-26 19:42:20,532) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 19:42:20,533) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 19:42:20,533) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:43:09,006) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:43:29,971) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991815, valid -0.997768
[3925260:MainThread](2024-04-26 19:43:29,976) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 19:43:29,976) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:44:18,251) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:44:38,309) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991212, valid -0.997218
[3925260:MainThread](2024-04-26 19:44:38,313) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 19:44:38,314) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:45:26,640) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:45:47,523) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990999, valid -0.996649
[3925260:MainThread](2024-04-26 19:45:47,527) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 19:45:47,527) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:46:35,763) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:46:56,568) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990076, valid -0.997436
[3925260:MainThread](2024-04-26 19:46:56,569) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 19:46:56,569) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:47:44,979) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:48:05,782) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990667, valid -0.997105
[3925260:MainThread](2024-04-26 19:48:05,783) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 19:48:05,783) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:48:54,165) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:49:13,055) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989652, valid -0.997619
[3925260:MainThread](2024-04-26 19:49:13,055) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 19:49:13,055) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:49:38,997) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:49:48,350) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989866, valid -0.998044
[3925260:MainThread](2024-04-26 19:49:48,350) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 19:49:48,351) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:50:10,755) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:50:19,980) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989948, valid -0.997839
[3925260:MainThread](2024-04-26 19:50:19,980) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 19:50:19,981) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.996649 @ 2
[3925260:MainThread](2024-04-26 19:50:20,382) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_44.
[3925260:MainThread](2024-04-26 19:50:20,649) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 19:50:20,674) INFO - qlib.workflow - [recorder.py:341] - Recorder 1848ad02a7814563beed699738b868a4 starts running under Experiment 118 ...
{'IC': 0.022572722047014094,
 'ICIR': 0.1709789532544127,
 'Rank IC': 0.032874066222441635,
 'Rank ICIR': 0.24486868869570597}
[3925260:MainThread](2024-04-26 19:50:29,713) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 19:51:04,065) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 19:51:04,068) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 19:51:10,059) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fda4ba098b0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:34, 10.25it/s]backtest loop:   1%|          | 9/971 [00:00<00:36, 26.55it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:24, 38.88it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 41.24it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:19, 48.10it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 48.55it/s]backtest loop:   4%|▍         | 41/971 [00:00<00:17, 52.85it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:16, 55.94it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 53.93it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:16, 56.47it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:16, 54.08it/s]backtest loop:   8%|▊         | 74/971 [00:01<00:15, 56.91it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:15, 58.81it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:15, 55.75it/s]backtest loop:  10%|▉         | 94/971 [00:01<00:15, 57.81it/s]backtest loop:  10%|█         | 101/971 [00:01<00:14, 59.21it/s]backtest loop:  11%|█         | 107/971 [00:02<00:15, 56.32it/s]backtest loop:  12%|█▏        | 114/971 [00:02<00:14, 58.12it/s]backtest loop:  12%|█▏        | 121/971 [00:02<00:14, 59.59it/s]backtest loop:  13%|█▎        | 127/971 [00:02<00:15, 53.22it/s]backtest loop:  14%|█▍        | 134/971 [00:02<00:14, 55.94it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:15, 54.82it/s]backtest loop:  15%|█▌        | 148/971 [00:02<00:14, 57.03it/s]backtest loop:  16%|█▌        | 154/971 [00:02<00:14, 57.06it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:14, 55.46it/s]backtest loop:  17%|█▋        | 168/971 [00:03<00:13, 57.87it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:13, 60.16it/s]backtest loop:  19%|█▊        | 182/971 [00:03<00:13, 56.86it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:13, 58.59it/s]backtest loop:  20%|██        | 195/971 [00:03<00:13, 55.84it/s]backtest loop:  21%|██        | 202/971 [00:03<00:13, 57.74it/s]backtest loop:  21%|██▏       | 208/971 [00:03<00:13, 58.31it/s]backtest loop:  22%|██▏       | 214/971 [00:03<00:13, 55.61it/s]backtest loop:  23%|██▎       | 220/971 [00:04<00:13, 53.81it/s]backtest loop:  23%|██▎       | 227/971 [00:04<00:13, 56.45it/s]backtest loop:  24%|██▍       | 234/971 [00:04<00:12, 58.27it/s]backtest loop:  25%|██▍       | 240/971 [00:04<00:13, 55.52it/s]backtest loop:  25%|██▌       | 247/971 [00:04<00:12, 57.67it/s]backtest loop:  26%|██▌       | 254/971 [00:04<00:12, 56.05it/s]backtest loop:  27%|██▋       | 260/971 [00:05<00:18, 37.43it/s]backtest loop:  27%|██▋       | 266/971 [00:05<00:17, 40.21it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:15, 45.47it/s]backtest loop:  29%|██▉       | 280/971 [00:05<00:13, 49.87it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:13, 49.83it/s]backtest loop:  30%|███       | 293/971 [00:05<00:12, 53.29it/s]backtest loop:  31%|███       | 300/971 [00:05<00:12, 52.90it/s]backtest loop:  32%|███▏      | 306/971 [00:05<00:12, 54.63it/s]backtest loop:  32%|███▏      | 313/971 [00:05<00:11, 56.86it/s]backtest loop:  33%|███▎      | 320/971 [00:06<00:11, 55.48it/s]backtest loop:  34%|███▎      | 327/971 [00:06<00:11, 57.64it/s]backtest loop:  34%|███▍      | 334/971 [00:06<00:10, 59.20it/s]backtest loop:  35%|███▌      | 340/971 [00:06<00:11, 56.23it/s]backtest loop:  36%|███▌      | 347/971 [00:06<00:10, 58.08it/s]backtest loop:  36%|███▋      | 354/971 [00:06<00:10, 59.65it/s]backtest loop:  37%|███▋      | 361/971 [00:06<00:10, 57.36it/s]backtest loop:  38%|███▊      | 367/971 [00:06<00:11, 54.87it/s]backtest loop:  38%|███▊      | 373/971 [00:06<00:11, 53.46it/s]backtest loop:  39%|███▉      | 380/971 [00:07<00:10, 56.08it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:10, 58.21it/s]backtest loop:  40%|████      | 393/971 [00:07<00:10, 55.42it/s]backtest loop:  41%|████      | 400/971 [00:07<00:09, 57.47it/s]backtest loop:  42%|████▏     | 407/971 [00:07<00:09, 59.71it/s]backtest loop:  43%|████▎     | 414/971 [00:07<00:09, 57.25it/s]backtest loop:  43%|████▎     | 421/971 [00:07<00:09, 58.78it/s]backtest loop:  44%|████▍     | 428/971 [00:07<00:09, 56.72it/s]backtest loop:  45%|████▍     | 435/971 [00:08<00:09, 58.36it/s]backtest loop:  46%|████▌     | 442/971 [00:08<00:09, 56.66it/s]backtest loop:  46%|████▌     | 449/971 [00:08<00:08, 58.27it/s]backtest loop:  47%|████▋     | 456/971 [00:08<00:08, 59.51it/s]backtest loop:  48%|████▊     | 462/971 [00:08<00:09, 56.41it/s]backtest loop:  48%|████▊     | 469/971 [00:08<00:08, 58.16it/s]backtest loop:  49%|████▉     | 476/971 [00:08<00:08, 59.55it/s]backtest loop:  50%|████▉     | 482/971 [00:08<00:08, 56.39it/s]backtest loop:  50%|█████     | 489/971 [00:08<00:08, 58.41it/s]backtest loop:  51%|█████     | 495/971 [00:09<00:08, 55.99it/s]backtest loop:  52%|█████▏    | 502/971 [00:09<00:08, 57.90it/s]backtest loop:  52%|█████▏    | 508/971 [00:09<00:08, 55.51it/s]backtest loop:  53%|█████▎    | 515/971 [00:09<00:07, 57.57it/s]backtest loop:  54%|█████▍    | 522/971 [00:09<00:08, 55.85it/s]backtest loop:  54%|█████▍    | 529/971 [00:09<00:07, 57.85it/s]backtest loop:  55%|█████▌    | 536/971 [00:09<00:07, 56.06it/s]backtest loop:  56%|█████▌    | 542/971 [00:09<00:07, 57.02it/s]backtest loop:  56%|█████▋    | 548/971 [00:10<00:07, 57.68it/s]backtest loop:  57%|█████▋    | 555/971 [00:10<00:07, 59.07it/s]backtest loop:  58%|█████▊    | 561/971 [00:10<00:07, 56.06it/s]backtest loop:  58%|█████▊    | 568/971 [00:10<00:06, 57.89it/s]backtest loop:  59%|█████▉    | 575/971 [00:10<00:06, 59.32it/s]backtest loop:  60%|█████▉    | 581/971 [00:10<00:06, 56.24it/s]backtest loop:  61%|██████    | 588/971 [00:10<00:06, 58.02it/s]backtest loop:  61%|██████▏   | 595/971 [00:10<00:06, 59.35it/s]backtest loop:  62%|██████▏   | 601/971 [00:10<00:06, 56.21it/s]backtest loop:  63%|██████▎   | 608/971 [00:11<00:06, 58.14it/s]backtest loop:  63%|██████▎   | 615/971 [00:11<00:06, 56.13it/s]backtest loop:  64%|██████▍   | 622/971 [00:11<00:06, 57.94it/s]backtest loop:  65%|██████▍   | 629/971 [00:11<00:05, 59.47it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:05, 56.98it/s]backtest loop:  66%|██████▌   | 642/971 [00:11<00:05, 58.83it/s]backtest loop:  67%|██████▋   | 649/971 [00:11<00:05, 59.91it/s]backtest loop:  68%|██████▊   | 656/971 [00:11<00:05, 57.34it/s]backtest loop:  68%|██████▊   | 663/971 [00:12<00:05, 58.82it/s]backtest loop:  69%|██████▉   | 670/971 [00:12<00:05, 56.59it/s]backtest loop:  70%|██████▉   | 677/971 [00:12<00:05, 58.38it/s]backtest loop:  70%|███████   | 683/971 [00:12<00:04, 58.81it/s]backtest loop:  71%|███████   | 689/971 [00:12<00:05, 55.84it/s]backtest loop:  72%|███████▏  | 696/971 [00:12<00:04, 57.73it/s]backtest loop:  72%|███████▏  | 703/971 [00:12<00:04, 59.22it/s]backtest loop:  73%|███████▎  | 709/971 [00:12<00:04, 56.07it/s]backtest loop:  74%|███████▎  | 716/971 [00:12<00:04, 57.98it/s]backtest loop:  74%|███████▍  | 723/971 [00:13<00:04, 59.36it/s]backtest loop:  75%|███████▌  | 729/971 [00:13<00:04, 56.61it/s]backtest loop:  76%|███████▌  | 735/971 [00:13<00:04, 54.33it/s]backtest loop:  76%|███████▋  | 742/971 [00:13<00:04, 56.69it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 54.48it/s]backtest loop:  78%|███████▊  | 755/971 [00:13<00:04, 53.71it/s]backtest loop:  78%|███████▊  | 762/971 [00:13<00:03, 56.25it/s]backtest loop:  79%|███████▉  | 769/971 [00:13<00:03, 58.07it/s]backtest loop:  80%|███████▉  | 775/971 [00:13<00:03, 55.39it/s]backtest loop:  81%|████████  | 782/971 [00:14<00:03, 57.41it/s]backtest loop:  81%|████████  | 788/971 [00:14<00:03, 55.07it/s]backtest loop:  82%|████████▏ | 795/971 [00:14<00:03, 57.23it/s]backtest loop:  83%|████████▎ | 802/971 [00:14<00:02, 58.71it/s]backtest loop:  83%|████████▎ | 808/971 [00:14<00:02, 56.11it/s]backtest loop:  84%|████████▍ | 814/971 [00:14<00:02, 57.12it/s]backtest loop:  85%|████████▍ | 821/971 [00:14<00:02, 58.71it/s]backtest loop:  85%|████████▌ | 828/971 [00:14<00:02, 56.51it/s]backtest loop:  86%|████████▌ | 835/971 [00:15<00:02, 58.13it/s]backtest loop:  87%|████████▋ | 842/971 [00:15<00:02, 59.37it/s]backtest loop:  87%|████████▋ | 848/971 [00:15<00:02, 56.29it/s]backtest loop:  88%|████████▊ | 855/971 [00:15<00:01, 58.06it/s]backtest loop:  89%|████████▉ | 862/971 [00:15<00:01, 56.10it/s]backtest loop:  89%|████████▉ | 869/971 [00:15<00:01, 58.18it/s]backtest loop:  90%|█████████ | 876/971 [00:15<00:01, 59.53it/s]backtest loop:  91%|█████████ | 882/971 [00:15<00:01, 56.25it/s]backtest loop:  91%|█████████▏| 888/971 [00:15<00:01, 57.22it/s]backtest loop:  92%|█████████▏| 894/971 [00:16<00:01, 57.87it/s]backtest loop:  93%|█████████▎| 901/971 [00:16<00:01, 59.16it/s]backtest loop:  93%|█████████▎| 907/971 [00:16<00:01, 55.98it/s]backtest loop:  94%|█████████▍| 914/971 [00:16<00:00, 57.88it/s]backtest loop:  95%|█████████▍| 921/971 [00:16<00:00, 56.04it/s]backtest loop:  95%|█████████▌| 927/971 [00:16<00:00, 56.96it/s]backtest loop:  96%|█████████▌| 934/971 [00:16<00:00, 58.70it/s]backtest loop:  97%|█████████▋| 940/971 [00:16<00:00, 55.78it/s]backtest loop:  98%|█████████▊| 947/971 [00:16<00:00, 57.82it/s]backtest loop:  98%|█████████▊| 954/971 [00:17<00:00, 59.27it/s]backtest loop:  99%|█████████▉| 960/971 [00:17<00:00, 56.19it/s]backtest loop: 100%|█████████▉| 967/971 [00:17<00:00, 57.95it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 55.82it/s]
[3925260:MainThread](2024-04-26 19:51:27,510) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000330
std                0.004766
annualized_return  0.078655
information_ratio  1.069755
max_drawdown      -0.078230
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000133
std                0.004767
annualized_return  0.031737
information_ratio  0.431561
max_drawdown      -0.109843
[3925260:MainThread](2024-04-26 19:51:27,523) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 19:51:34,493) INFO - qlib.timer - [log.py:127] - Time cost: 0.010s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557],
 'IC': [0.02734841249253904, 0.022572722047014094],
 'ICIR': [0.21236024942574536, 0.1709789532544127],
 'Rank IC': [0.035975396383521215, 0.032874066222441635],
 'Rank ICIR': [0.2768152718838129, 0.24486868869570597],
 'mae': [0.8639875715380355, 0.8641355173474249],
 'mse': [0.997836837153924, 0.9970882453499194]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 19:51:37,848) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 19:51:41,187) INFO - qlib.workflow - [exp.py:258] - Experiment 120 starts running ...
[3925260:MainThread](2024-04-26 19:51:41,214) INFO - qlib.workflow - [recorder.py:341] - Recorder 1543510e2cc540939713e0a09c0c81b7 starts running under Experiment 120 ...
[3925260:MainThread](2024-04-26 19:51:46,340) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 19:51:46,340) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 19:51:46,341) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:52:34,835) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:52:55,631) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991032, valid -0.997084
[3925260:MainThread](2024-04-26 19:52:55,635) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 19:52:55,635) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:53:44,893) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:54:05,502) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990204, valid -0.997226
[3925260:MainThread](2024-04-26 19:54:05,502) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 19:54:05,503) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:54:54,450) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:55:15,071) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990291, valid -0.996897
[3925260:MainThread](2024-04-26 19:55:15,075) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 19:55:15,075) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:56:03,663) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:56:24,236) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989855, valid -0.997552
[3925260:MainThread](2024-04-26 19:56:24,237) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 19:56:24,237) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:57:12,832) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:57:33,391) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989419, valid -0.997193
[3925260:MainThread](2024-04-26 19:57:33,392) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 19:57:33,392) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:58:22,033) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:58:42,576) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989327, valid -0.997974
[3925260:MainThread](2024-04-26 19:58:42,576) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 19:58:42,577) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:59:08,808) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:59:18,141) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989689, valid -0.998041
[3925260:MainThread](2024-04-26 19:59:18,141) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 19:59:18,142) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 19:59:40,923) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 19:59:50,156) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991493, valid -1.000143
[3925260:MainThread](2024-04-26 19:59:50,156) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 19:59:50,157) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.996897 @ 2
[3925260:MainThread](2024-04-26 19:59:50,245) INFO - qlib.timer - [log.py:127] - Time cost: 0.001s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_45.
[3925260:MainThread](2024-04-26 19:59:50,521) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 19:59:50,548) INFO - qlib.workflow - [recorder.py:341] - Recorder a14caa90d4e2417b96fc95114af61240 starts running under Experiment 118 ...
{'IC': 0.026684936706207103,
 'ICIR': 0.19340628575351163,
 'Rank IC': 0.03798482714314599,
 'Rank ICIR': 0.2617583327848503}
[3925260:MainThread](2024-04-26 20:00:01,481) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 20:00:38,969) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:00:38,973) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:00:45,338) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fdac68a3f10>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<03:20,  4.83it/s]backtest loop:   1%|          | 9/971 [00:00<01:03, 15.13it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:39, 24.46it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:30, 31.03it/s]backtest loop:   3%|▎         | 28/971 [00:01<00:24, 39.12it/s]backtest loop:   4%|▎         | 34/971 [00:01<00:22, 42.00it/s]backtest loop:   4%|▍         | 40/971 [00:01<00:20, 46.52it/s]backtest loop:   5%|▍         | 46/971 [00:01<00:18, 50.05it/s]backtest loop:   5%|▌         | 53/971 [00:01<00:17, 53.69it/s]backtest loop:   6%|▌         | 59/971 [00:01<00:17, 52.25it/s]backtest loop:   7%|▋         | 66/971 [00:01<00:16, 55.62it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 53.23it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:15, 56.09it/s]backtest loop:   9%|▉         | 86/971 [00:02<00:15, 57.96it/s]backtest loop:   9%|▉         | 92/971 [00:02<00:16, 54.35it/s]backtest loop:  10%|█         | 98/971 [00:02<00:15, 55.85it/s]backtest loop:  11%|█         | 105/971 [00:02<00:14, 57.83it/s]backtest loop:  12%|█▏        | 112/971 [00:02<00:15, 55.96it/s]backtest loop:  12%|█▏        | 119/971 [00:02<00:14, 57.80it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:15, 54.96it/s]backtest loop:  13%|█▎        | 131/971 [00:02<00:15, 53.05it/s]backtest loop:  14%|█▍        | 138/971 [00:03<00:14, 55.81it/s]backtest loop:  15%|█▍        | 145/971 [00:03<00:14, 57.68it/s]backtest loop:  16%|█▌        | 151/971 [00:03<00:14, 55.09it/s]backtest loop:  16%|█▌        | 157/971 [00:03<00:14, 56.29it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:14, 57.27it/s]backtest loop:  18%|█▊        | 170/971 [00:03<00:13, 59.31it/s]backtest loop:  18%|█▊        | 176/971 [00:03<00:14, 56.54it/s]backtest loop:  19%|█▊        | 182/971 [00:03<00:13, 57.32it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:13, 56.52it/s]backtest loop:  20%|█▉        | 194/971 [00:03<00:13, 57.31it/s]backtest loop:  21%|██        | 200/971 [00:04<00:14, 54.63it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:13, 56.88it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:13, 54.66it/s]backtest loop:  23%|██▎       | 220/971 [00:04<00:13, 53.73it/s]backtest loop:  23%|██▎       | 227/971 [00:04<00:13, 56.33it/s]backtest loop:  24%|██▍       | 233/971 [00:04<00:12, 57.22it/s]backtest loop:  25%|██▍       | 239/971 [00:04<00:12, 57.75it/s]backtest loop:  25%|██▌       | 245/971 [00:04<00:13, 54.94it/s]backtest loop:  26%|██▌       | 252/971 [00:05<00:12, 57.47it/s]backtest loop:  27%|██▋       | 258/971 [00:05<00:12, 57.29it/s]backtest loop:  27%|██▋       | 264/971 [00:05<00:21, 33.16it/s]backtest loop:  28%|██▊       | 271/971 [00:05<00:18, 37.39it/s]backtest loop:  29%|██▊       | 277/971 [00:05<00:16, 41.07it/s]backtest loop:  29%|██▉       | 283/971 [00:05<00:15, 44.36it/s]backtest loop:  30%|██▉       | 289/971 [00:05<00:14, 46.99it/s]backtest loop:  30%|███       | 295/971 [00:06<00:14, 46.61it/s]backtest loop:  31%|███       | 301/971 [00:06<00:13, 48.71it/s]backtest loop:  32%|███▏      | 307/971 [00:06<00:13, 50.42it/s]backtest loop:  32%|███▏      | 313/971 [00:06<00:12, 51.48it/s]backtest loop:  33%|███▎      | 319/971 [00:06<00:12, 52.47it/s]backtest loop:  33%|███▎      | 325/971 [00:06<00:12, 50.36it/s]backtest loop:  34%|███▍      | 331/971 [00:06<00:12, 51.77it/s]backtest loop:  35%|███▍      | 337/971 [00:06<00:11, 52.94it/s]backtest loop:  35%|███▌      | 343/971 [00:06<00:11, 53.36it/s]backtest loop:  36%|███▌      | 349/971 [00:07<00:11, 53.90it/s]backtest loop:  37%|███▋      | 355/971 [00:07<00:12, 50.89it/s]backtest loop:  37%|███▋      | 361/971 [00:07<00:11, 52.16it/s]backtest loop:  38%|███▊      | 367/971 [00:07<00:12, 49.20it/s]backtest loop:  38%|███▊      | 373/971 [00:07<00:12, 47.78it/s]backtest loop:  39%|███▉      | 379/971 [00:07<00:11, 49.57it/s]backtest loop:  40%|███▉      | 385/971 [00:07<00:11, 50.93it/s]backtest loop:  40%|████      | 391/971 [00:07<00:11, 51.92it/s]backtest loop:  41%|████      | 397/971 [00:08<00:10, 53.13it/s]backtest loop:  42%|████▏     | 403/971 [00:08<00:11, 49.98it/s]backtest loop:  42%|████▏     | 409/971 [00:08<00:10, 51.44it/s]backtest loop:  43%|████▎     | 415/971 [00:08<00:10, 52.29it/s]backtest loop:  43%|████▎     | 421/971 [00:08<00:10, 52.90it/s]backtest loop:  44%|████▍     | 427/971 [00:08<00:10, 53.49it/s]backtest loop:  45%|████▍     | 433/971 [00:08<00:10, 50.44it/s]backtest loop:  45%|████▌     | 439/971 [00:08<00:10, 51.66it/s]backtest loop:  46%|████▌     | 445/971 [00:08<00:10, 52.25it/s]backtest loop:  46%|████▋     | 451/971 [00:09<00:09, 52.78it/s]backtest loop:  47%|████▋     | 457/971 [00:09<00:10, 50.05it/s]backtest loop:  48%|████▊     | 463/971 [00:09<00:09, 51.27it/s]backtest loop:  48%|████▊     | 469/971 [00:09<00:09, 52.21it/s]backtest loop:  49%|████▉     | 475/971 [00:09<00:09, 53.05it/s]backtest loop:  50%|████▉     | 481/971 [00:09<00:09, 53.70it/s]backtest loop:  50%|█████     | 487/971 [00:09<00:09, 50.54it/s]backtest loop:  51%|█████     | 493/971 [00:09<00:09, 51.81it/s]backtest loop:  51%|█████▏    | 499/971 [00:10<00:08, 52.63it/s]backtest loop:  52%|█████▏    | 505/971 [00:10<00:09, 50.24it/s]backtest loop:  53%|█████▎    | 511/971 [00:10<00:08, 51.53it/s]backtest loop:  53%|█████▎    | 517/971 [00:10<00:09, 49.27it/s]backtest loop:  54%|█████▍    | 523/971 [00:10<00:08, 50.80it/s]backtest loop:  54%|█████▍    | 529/971 [00:10<00:08, 51.94it/s]backtest loop:  55%|█████▌    | 535/971 [00:10<00:08, 52.94it/s]backtest loop:  56%|█████▌    | 541/971 [00:10<00:08, 50.47it/s]backtest loop:  56%|█████▋    | 547/971 [00:10<00:08, 51.69it/s]backtest loop:  57%|█████▋    | 553/971 [00:11<00:07, 52.57it/s]backtest loop:  58%|█████▊    | 559/971 [00:11<00:07, 53.17it/s]backtest loop:  58%|█████▊    | 565/971 [00:11<00:07, 53.60it/s]backtest loop:  59%|█████▉    | 571/971 [00:11<00:07, 50.70it/s]backtest loop:  59%|█████▉    | 577/971 [00:11<00:07, 51.34it/s]backtest loop:  60%|██████    | 583/971 [00:11<00:07, 52.33it/s]backtest loop:  61%|██████    | 589/971 [00:11<00:07, 53.02it/s]backtest loop:  61%|██████▏   | 595/971 [00:11<00:07, 53.49it/s]backtest loop:  62%|██████▏   | 601/971 [00:12<00:07, 50.60it/s]backtest loop:  63%|██████▎   | 607/971 [00:12<00:07, 51.79it/s]backtest loop:  63%|██████▎   | 613/971 [00:12<00:06, 52.59it/s]backtest loop:  64%|██████▎   | 619/971 [00:12<00:06, 53.25it/s]backtest loop:  64%|██████▍   | 625/971 [00:12<00:06, 50.39it/s]backtest loop:  65%|██████▍   | 631/971 [00:12<00:06, 51.68it/s]backtest loop:  66%|██████▌   | 637/971 [00:12<00:06, 52.60it/s]backtest loop:  66%|██████▌   | 643/971 [00:12<00:06, 53.16it/s]backtest loop:  67%|██████▋   | 649/971 [00:12<00:06, 53.66it/s]backtest loop:  67%|██████▋   | 655/971 [00:13<00:06, 50.67it/s]backtest loop:  68%|██████▊   | 661/971 [00:13<00:05, 51.81it/s]backtest loop:  69%|██████▊   | 667/971 [00:13<00:05, 52.64it/s]backtest loop:  69%|██████▉   | 673/971 [00:13<00:05, 53.29it/s]backtest loop:  70%|██████▉   | 679/971 [00:13<00:05, 50.46it/s]backtest loop:  71%|███████   | 685/971 [00:13<00:05, 51.56it/s]backtest loop:  71%|███████   | 691/971 [00:13<00:05, 52.40it/s]backtest loop:  72%|███████▏  | 697/971 [00:13<00:05, 53.02it/s]backtest loop:  72%|███████▏  | 703/971 [00:13<00:05, 53.51it/s]backtest loop:  73%|███████▎  | 709/971 [00:14<00:05, 50.53it/s]backtest loop:  74%|███████▎  | 715/971 [00:14<00:04, 51.68it/s]backtest loop:  74%|███████▍  | 721/971 [00:14<00:04, 52.54it/s]backtest loop:  75%|███████▍  | 727/971 [00:14<00:04, 53.34it/s]backtest loop:  75%|███████▌  | 733/971 [00:14<00:04, 47.72it/s]backtest loop:  76%|███████▌  | 739/971 [00:14<00:04, 49.47it/s]backtest loop:  77%|███████▋  | 745/971 [00:14<00:04, 51.06it/s]backtest loop:  77%|███████▋  | 751/971 [00:14<00:04, 49.02it/s]backtest loop:  78%|███████▊  | 757/971 [00:15<00:04, 50.56it/s]backtest loop:  79%|███████▊  | 763/971 [00:15<00:04, 51.76it/s]backtest loop:  79%|███████▉  | 769/971 [00:15<00:03, 52.58it/s]backtest loop:  80%|███████▉  | 775/971 [00:15<00:03, 49.95it/s]backtest loop:  80%|████████  | 781/971 [00:15<00:03, 50.96it/s]backtest loop:  81%|████████  | 787/971 [00:15<00:03, 52.20it/s]backtest loop:  82%|████████▏ | 793/971 [00:15<00:03, 49.82it/s]backtest loop:  82%|████████▏ | 799/971 [00:15<00:03, 51.27it/s]backtest loop:  83%|████████▎ | 805/971 [00:15<00:03, 52.24it/s]backtest loop:  84%|████████▎ | 811/971 [00:16<00:03, 53.07it/s]backtest loop:  84%|████████▍ | 817/971 [00:16<00:02, 53.56it/s]backtest loop:  85%|████████▍ | 823/971 [00:16<00:02, 50.10it/s]backtest loop:  85%|████████▌ | 829/971 [00:16<00:02, 51.34it/s]backtest loop:  86%|████████▌ | 835/971 [00:16<00:02, 52.27it/s]backtest loop:  87%|████████▋ | 841/971 [00:16<00:02, 52.85it/s]backtest loop:  87%|████████▋ | 847/971 [00:16<00:02, 53.18it/s]backtest loop:  88%|████████▊ | 853/971 [00:16<00:02, 50.33it/s]backtest loop:  88%|████████▊ | 859/971 [00:16<00:02, 51.36it/s]backtest loop:  89%|████████▉ | 865/971 [00:17<00:02, 51.88it/s]backtest loop:  90%|████████▉ | 871/971 [00:17<00:01, 52.80it/s]backtest loop:  90%|█████████ | 877/971 [00:17<00:01, 50.17it/s]backtest loop:  91%|█████████ | 883/971 [00:17<00:01, 51.46it/s]backtest loop:  92%|█████████▏| 889/971 [00:17<00:01, 52.37it/s]backtest loop:  92%|█████████▏| 895/971 [00:17<00:01, 53.00it/s]backtest loop:  93%|█████████▎| 901/971 [00:17<00:01, 53.49it/s]backtest loop:  93%|█████████▎| 907/971 [00:17<00:01, 50.55it/s]backtest loop:  94%|█████████▍| 913/971 [00:18<00:01, 51.71it/s]backtest loop:  95%|█████████▍| 919/971 [00:18<00:00, 52.62it/s]backtest loop:  95%|█████████▌| 925/971 [00:18<00:00, 53.27it/s]backtest loop:  96%|█████████▌| 931/971 [00:18<00:00, 50.44it/s]backtest loop:  96%|█████████▋| 937/971 [00:18<00:00, 51.63it/s]backtest loop:  97%|█████████▋| 943/971 [00:18<00:00, 52.51it/s]backtest loop:  98%|█████████▊| 949/971 [00:18<00:00, 53.21it/s]backtest loop:  98%|█████████▊| 955/971 [00:18<00:00, 50.40it/s]backtest loop:  99%|█████████▉| 961/971 [00:18<00:00, 51.62it/s]backtest loop: 100%|█████████▉| 967/971 [00:19<00:00, 52.46it/s]backtest loop: 100%|██████████| 971/971 [00:19<00:00, 50.70it/s]
[3925260:MainThread](2024-04-26 20:01:04,550) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000507
std                0.005122
annualized_return  0.120725
information_ratio  1.527857
max_drawdown      -0.082437
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000310
std                0.005124
annualized_return  0.073887
information_ratio  0.934738
max_drawdown      -0.094923
[3925260:MainThread](2024-04-26 20:01:04,564) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 20:01:12,598) INFO - qlib.timer - [log.py:127] - Time cost: 0.009s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772,
                                                    0.07388724568850046],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167,
                                                    0.9347375159430679],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557,
                                               -0.09492334235123748],
 'IC': [0.02734841249253904, 0.022572722047014094, 0.026684936706207103],
 'ICIR': [0.21236024942574536, 0.1709789532544127, 0.19340628575351163],
 'Rank IC': [0.035975396383521215, 0.032874066222441635, 0.03798482714314599],
 'Rank ICIR': [0.2768152718838129, 0.24486868869570597, 0.2617583327848503],
 'mae': [0.8639875715380355, 0.8641355173474249, 0.8637491718650353],
 'mse': [0.997836837153924, 0.9970882453499194, 0.9969328092652393]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 20:01:16,956) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 20:01:20,153) INFO - qlib.workflow - [exp.py:258] - Experiment 121 starts running ...
[3925260:MainThread](2024-04-26 20:01:20,175) INFO - qlib.workflow - [recorder.py:341] - Recorder 9449e2a2d0f04a44ba534bf8cb428c3b starts running under Experiment 121 ...
[3925260:MainThread](2024-04-26 20:01:31,402) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 20:01:31,402) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 20:01:31,402) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:02:16,458) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:02:40,212) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.992168, valid -0.998228
[3925260:MainThread](2024-04-26 20:02:40,216) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 20:02:40,216) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:03:25,359) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:03:49,361) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991583, valid -0.998950
[3925260:MainThread](2024-04-26 20:03:49,362) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 20:03:49,363) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:04:34,251) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:04:58,063) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990200, valid -0.998567
[3925260:MainThread](2024-04-26 20:04:58,063) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 20:04:58,064) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:05:42,866) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:06:06,579) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990358, valid -0.998181
[3925260:MainThread](2024-04-26 20:06:06,584) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 20:06:06,585) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:06:51,707) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:07:15,624) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989840, valid -0.998308
[3925260:MainThread](2024-04-26 20:07:15,625) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 20:07:15,625) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:08:00,642) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:08:24,695) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989479, valid -0.997331
[3925260:MainThread](2024-04-26 20:08:24,700) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 20:08:24,700) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:09:09,190) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:09:33,222) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989084, valid -0.997535
[3925260:MainThread](2024-04-26 20:09:33,222) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 20:09:33,223) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:10:18,059) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:10:41,803) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989007, valid -0.997087
[3925260:MainThread](2024-04-26 20:10:41,807) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch8:
[3925260:MainThread](2024-04-26 20:10:41,807) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:11:26,227) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:11:50,011) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989692, valid -0.998205
[3925260:MainThread](2024-04-26 20:11:50,012) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch9:
[3925260:MainThread](2024-04-26 20:11:50,012) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:12:34,547) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:12:57,829) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988972, valid -0.997202
[3925260:MainThread](2024-04-26 20:12:57,829) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch10:
[3925260:MainThread](2024-04-26 20:12:57,830) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:13:43,228) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:14:07,491) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988907, valid -0.997005
[3925260:MainThread](2024-04-26 20:14:07,495) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch11:
[3925260:MainThread](2024-04-26 20:14:07,495) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:14:51,602) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:15:15,765) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988852, valid -0.997616
[3925260:MainThread](2024-04-26 20:15:15,766) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch12:
[3925260:MainThread](2024-04-26 20:15:15,766) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:16:00,204) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:16:24,396) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988788, valid -0.997091
[3925260:MainThread](2024-04-26 20:16:24,397) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch13:
[3925260:MainThread](2024-04-26 20:16:24,397) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:17:08,515) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:17:21,695) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988923, valid -0.997725
[3925260:MainThread](2024-04-26 20:17:21,695) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch14:
[3925260:MainThread](2024-04-26 20:17:21,696) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:17:44,058) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:17:53,408) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989164, valid -0.997957
[3925260:MainThread](2024-04-26 20:17:53,409) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch15:
[3925260:MainThread](2024-04-26 20:17:53,409) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:18:15,671) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:18:24,884) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989057, valid -0.997122
[3925260:MainThread](2024-04-26 20:18:24,884) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 20:18:24,885) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.997005 @ 10
[3925260:MainThread](2024-04-26 20:18:25,302) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_46.
[3925260:MainThread](2024-04-26 20:18:25,650) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 20:18:25,676) INFO - qlib.workflow - [recorder.py:341] - Recorder 13015fa7a4444009b98493f0b6a725bf starts running under Experiment 118 ...
{'IC': 0.02664763367970717,
 'ICIR': 0.20007151364249662,
 'Rank IC': 0.039716791710446786,
 'Rank ICIR': 0.29471520276399354}
[3925260:MainThread](2024-04-26 20:18:36,860) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 20:19:13,601) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:19:13,604) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:19:19,664) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fda65c08760>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<03:16,  4.92it/s]backtest loop:   1%|          | 9/971 [00:00<01:03, 15.25it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:36, 26.21it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:30, 30.90it/s]backtest loop:   3%|▎         | 28/971 [00:01<00:24, 39.16it/s]backtest loop:   4%|▎         | 34/971 [00:01<00:22, 42.08it/s]backtest loop:   4%|▍         | 41/971 [00:01<00:19, 47.84it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:17, 52.03it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 51.26it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:16, 54.54it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:17, 53.09it/s]backtest loop:   8%|▊         | 74/971 [00:01<00:15, 56.14it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:15, 58.12it/s]backtest loop:   9%|▉         | 87/971 [00:02<00:15, 55.29it/s]backtest loop:  10%|▉         | 94/971 [00:02<00:15, 57.40it/s]backtest loop:  10%|█         | 101/971 [00:02<00:14, 58.89it/s]backtest loop:  11%|█         | 107/971 [00:02<00:15, 55.96it/s]backtest loop:  12%|█▏        | 114/971 [00:02<00:14, 57.68it/s]backtest loop:  12%|█▏        | 121/971 [00:02<00:14, 59.14it/s]backtest loop:  13%|█▎        | 127/971 [00:02<00:15, 52.96it/s]backtest loop:  14%|█▍        | 134/971 [00:02<00:14, 56.92it/s]backtest loop:  15%|█▍        | 141/971 [00:03<00:14, 56.30it/s]backtest loop:  15%|█▌        | 148/971 [00:03<00:14, 58.10it/s]backtest loop:  16%|█▌        | 154/971 [00:03<00:13, 58.57it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:14, 56.38it/s]backtest loop:  17%|█▋        | 168/971 [00:03<00:13, 58.57it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:12, 61.44it/s]backtest loop:  19%|█▊        | 182/971 [00:03<00:13, 58.47it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:13, 59.89it/s]backtest loop:  20%|██        | 196/971 [00:03<00:13, 57.46it/s]backtest loop:  21%|██        | 203/971 [00:04<00:13, 58.80it/s]backtest loop:  22%|██▏       | 209/971 [00:04<00:12, 59.02it/s]backtest loop:  22%|██▏       | 215/971 [00:04<00:14, 53.46it/s]backtest loop:  23%|██▎       | 221/971 [00:04<00:13, 55.17it/s]backtest loop:  23%|██▎       | 228/971 [00:04<00:12, 57.33it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:13, 55.64it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:12, 57.58it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:12, 55.80it/s]backtest loop:  26%|██▋       | 256/971 [00:05<00:12, 57.91it/s]backtest loop:  27%|██▋       | 262/971 [00:05<00:17, 39.74it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:17, 41.14it/s]backtest loop:  28%|██▊       | 274/971 [00:05<00:15, 45.93it/s]backtest loop:  29%|██▉       | 281/971 [00:05<00:14, 47.62it/s]backtest loop:  30%|██▉       | 288/971 [00:05<00:13, 51.48it/s]backtest loop:  30%|███       | 295/971 [00:05<00:13, 51.76it/s]backtest loop:  31%|███       | 302/971 [00:06<00:12, 54.59it/s]backtest loop:  32%|███▏      | 308/971 [00:06<00:11, 55.64it/s]backtest loop:  32%|███▏      | 315/971 [00:06<00:12, 54.51it/s]backtest loop:  33%|███▎      | 321/971 [00:06<00:12, 53.91it/s]backtest loop:  34%|███▎      | 327/971 [00:06<00:11, 55.07it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:11, 56.08it/s]backtest loop:  35%|███▌      | 340/971 [00:06<00:11, 54.66it/s]backtest loop:  36%|███▌      | 346/971 [00:06<00:11, 55.69it/s]backtest loop:  36%|███▋      | 353/971 [00:06<00:10, 57.80it/s]backtest loop:  37%|███▋      | 360/971 [00:07<00:10, 55.86it/s]backtest loop:  38%|███▊      | 367/971 [00:07<00:11, 54.55it/s]backtest loop:  38%|███▊      | 373/971 [00:07<00:11, 52.31it/s]backtest loop:  39%|███▉      | 380/971 [00:07<00:10, 55.15it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:10, 57.30it/s]backtest loop:  40%|████      | 393/971 [00:07<00:10, 55.01it/s]backtest loop:  41%|████      | 400/971 [00:07<00:09, 57.26it/s]backtest loop:  42%|████▏     | 407/971 [00:07<00:09, 58.80it/s]backtest loop:  43%|████▎     | 413/971 [00:08<00:09, 55.99it/s]backtest loop:  43%|████▎     | 419/971 [00:08<00:09, 56.82it/s]backtest loop:  44%|████▍     | 426/971 [00:08<00:09, 58.67it/s]backtest loop:  44%|████▍     | 432/971 [00:08<00:09, 55.70it/s]backtest loop:  45%|████▌     | 439/971 [00:08<00:09, 56.58it/s]backtest loop:  46%|████▌     | 445/971 [00:08<00:09, 55.74it/s]backtest loop:  46%|████▋     | 451/971 [00:08<00:09, 56.84it/s]backtest loop:  47%|████▋     | 457/971 [00:08<00:09, 54.35it/s]backtest loop:  48%|████▊     | 464/971 [00:08<00:08, 56.65it/s]backtest loop:  49%|████▊     | 471/971 [00:09<00:08, 58.40it/s]backtest loop:  49%|████▉     | 477/971 [00:09<00:08, 55.60it/s]backtest loop:  50%|████▉     | 483/971 [00:09<00:08, 55.88it/s]backtest loop:  50%|█████     | 489/971 [00:09<00:08, 56.40it/s]backtest loop:  51%|█████     | 495/971 [00:09<00:08, 53.00it/s]backtest loop:  52%|█████▏    | 501/971 [00:09<00:08, 54.80it/s]backtest loop:  52%|█████▏    | 507/971 [00:09<00:08, 53.24it/s]backtest loop:  53%|█████▎    | 514/971 [00:09<00:08, 56.05it/s]backtest loop:  54%|█████▎    | 521/971 [00:09<00:07, 58.00it/s]backtest loop:  54%|█████▍    | 527/971 [00:10<00:08, 54.92it/s]backtest loop:  55%|█████▍    | 534/971 [00:10<00:07, 57.06it/s]backtest loop:  56%|█████▌    | 541/971 [00:10<00:07, 55.44it/s]backtest loop:  56%|█████▋    | 547/971 [00:10<00:07, 55.87it/s]backtest loop:  57%|█████▋    | 553/971 [00:10<00:07, 55.93it/s]backtest loop:  58%|█████▊    | 560/971 [00:10<00:07, 57.78it/s]backtest loop:  58%|█████▊    | 566/971 [00:10<00:07, 55.03it/s]backtest loop:  59%|█████▉    | 572/971 [00:10<00:07, 56.32it/s]backtest loop:  60%|█████▉    | 579/971 [00:10<00:06, 58.08it/s]backtest loop:  60%|██████    | 585/971 [00:11<00:06, 58.51it/s]backtest loop:  61%|██████    | 591/971 [00:11<00:06, 55.39it/s]backtest loop:  61%|██████▏   | 597/971 [00:11<00:06, 56.51it/s]backtest loop:  62%|██████▏   | 603/971 [00:11<00:06, 56.71it/s]backtest loop:  63%|██████▎   | 609/971 [00:11<00:06, 56.71it/s]backtest loop:  63%|██████▎   | 615/971 [00:11<00:06, 54.27it/s]backtest loop:  64%|██████▍   | 622/971 [00:11<00:06, 56.81it/s]backtest loop:  65%|██████▍   | 629/971 [00:11<00:05, 58.67it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:05, 56.13it/s]backtest loop:  66%|██████▌   | 641/971 [00:12<00:05, 56.94it/s]backtest loop:  67%|██████▋   | 648/971 [00:12<00:05, 58.60it/s]backtest loop:  67%|██████▋   | 655/971 [00:12<00:05, 56.30it/s]backtest loop:  68%|██████▊   | 662/971 [00:12<00:05, 58.08it/s]backtest loop:  69%|██████▉   | 669/971 [00:12<00:05, 59.23it/s]backtest loop:  70%|██████▉   | 675/971 [00:12<00:05, 55.30it/s]backtest loop:  70%|███████   | 681/971 [00:12<00:05, 56.08it/s]backtest loop:  71%|███████   | 687/971 [00:12<00:04, 57.12it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:05, 55.19it/s]backtest loop:  72%|███████▏  | 700/971 [00:13<00:04, 56.46it/s]backtest loop:  73%|███████▎  | 706/971 [00:13<00:04, 57.43it/s]backtest loop:  73%|███████▎  | 713/971 [00:13<00:04, 59.01it/s]backtest loop:  74%|███████▍  | 719/971 [00:13<00:04, 54.81it/s]backtest loop:  75%|███████▍  | 725/971 [00:13<00:04, 56.07it/s]backtest loop:  75%|███████▌  | 731/971 [00:13<00:04, 53.79it/s]backtest loop:  76%|███████▌  | 737/971 [00:13<00:04, 55.44it/s]backtest loop:  77%|███████▋  | 743/971 [00:13<00:04, 53.42it/s]backtest loop:  77%|███████▋  | 749/971 [00:13<00:04, 54.83it/s]backtest loop:  78%|███████▊  | 755/971 [00:14<00:04, 52.56it/s]backtest loop:  78%|███████▊  | 761/971 [00:14<00:03, 53.48it/s]backtest loop:  79%|███████▉  | 767/971 [00:14<00:03, 54.59it/s]backtest loop:  80%|███████▉  | 773/971 [00:14<00:03, 55.07it/s]backtest loop:  80%|████████  | 780/971 [00:14<00:03, 54.07it/s]backtest loop:  81%|████████  | 787/971 [00:14<00:03, 57.05it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 54.69it/s]backtest loop:  82%|████████▏ | 799/971 [00:14<00:03, 56.06it/s]backtest loop:  83%|████████▎ | 805/971 [00:14<00:02, 56.75it/s]backtest loop:  84%|████████▎ | 812/971 [00:15<00:02, 58.42it/s]backtest loop:  84%|████████▍ | 818/971 [00:15<00:02, 54.91it/s]backtest loop:  85%|████████▍ | 824/971 [00:15<00:02, 55.59it/s]backtest loop:  86%|████████▌ | 831/971 [00:15<00:02, 57.54it/s]backtest loop:  86%|████████▌ | 837/971 [00:15<00:02, 58.20it/s]backtest loop:  87%|████████▋ | 843/971 [00:15<00:02, 54.97it/s]backtest loop:  88%|████████▊ | 850/971 [00:15<00:02, 57.10it/s]backtest loop:  88%|████████▊ | 857/971 [00:15<00:02, 55.31it/s]backtest loop:  89%|████████▉ | 863/971 [00:16<00:01, 56.31it/s]backtest loop:  90%|████████▉ | 870/971 [00:16<00:01, 58.03it/s]backtest loop:  90%|█████████ | 877/971 [00:16<00:01, 56.07it/s]backtest loop:  91%|█████████ | 884/971 [00:16<00:01, 57.92it/s]backtest loop:  92%|█████████▏| 891/971 [00:16<00:01, 59.21it/s]backtest loop:  92%|█████████▏| 897/971 [00:16<00:01, 56.23it/s]backtest loop:  93%|█████████▎| 903/971 [00:16<00:01, 57.22it/s]backtest loop:  94%|█████████▎| 910/971 [00:16<00:01, 58.72it/s]backtest loop:  94%|█████████▍| 916/971 [00:16<00:00, 55.75it/s]backtest loop:  95%|█████████▌| 923/971 [00:17<00:00, 57.66it/s]backtest loop:  96%|█████████▌| 929/971 [00:17<00:00, 57.75it/s]backtest loop:  96%|█████████▋| 936/971 [00:17<00:00, 55.77it/s]backtest loop:  97%|█████████▋| 943/971 [00:17<00:00, 57.66it/s]backtest loop:  98%|█████████▊| 950/971 [00:17<00:00, 55.79it/s]backtest loop:  99%|█████████▊| 957/971 [00:17<00:00, 57.65it/s]backtest loop:  99%|█████████▉| 964/971 [00:17<00:00, 59.10it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 55.68it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.21it/s]
[3925260:MainThread](2024-04-26 20:19:37,637) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000460
std                0.004749
annualized_return  0.109507
information_ratio  1.494798
max_drawdown      -0.067979
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000266
std                0.004751
annualized_return  0.063342
information_ratio  0.864290
max_drawdown      -0.079556
[3925260:MainThread](2024-04-26 20:19:37,650) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 20:19:44,475) INFO - qlib.timer - [log.py:127] - Time cost: 0.010s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772,
                                                    0.07388724568850046,
                                                    0.06334240221765423],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167,
                                                    0.9347375159430679,
                                                    0.8642895289298118],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557,
                                               -0.09492334235123748,
                                               -0.07955619464075078],
 'IC': [0.02734841249253904,
        0.022572722047014094,
        0.026684936706207103,
        0.02664763367970717],
 'ICIR': [0.21236024942574536,
          0.1709789532544127,
          0.19340628575351163,
          0.20007151364249662],
 'Rank IC': [0.035975396383521215,
             0.032874066222441635,
             0.03798482714314599,
             0.039716791710446786],
 'Rank ICIR': [0.2768152718838129,
               0.24486868869570597,
               0.2617583327848503,
               0.29471520276399354],
 'mae': [0.8639875715380355,
         0.8641355173474249,
         0.8637491718650353,
         0.863803688204625],
 'mse': [0.997836837153924,
         0.9970882453499194,
         0.9969328092652393,
         0.9973319905581113]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 20:19:47,871) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 20:19:51,157) INFO - qlib.workflow - [exp.py:258] - Experiment 122 starts running ...
[3925260:MainThread](2024-04-26 20:19:51,178) INFO - qlib.workflow - [recorder.py:341] - Recorder 6848f3a5d7e24c3d9e69c310272e7217 starts running under Experiment 122 ...
[3925260:MainThread](2024-04-26 20:19:56,263) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 20:19:56,264) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 20:19:56,264) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:20:42,580) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:21:05,113) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.992997, valid -0.999464
[3925260:MainThread](2024-04-26 20:21:05,117) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 20:21:05,118) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:21:51,545) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:22:14,511) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990942, valid -0.997490
[3925260:MainThread](2024-04-26 20:22:14,516) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 20:22:14,516) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:23:00,146) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:23:22,898) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990207, valid -0.997409
[3925260:MainThread](2024-04-26 20:23:22,903) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 20:23:22,903) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:24:09,079) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:24:31,990) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990287, valid -0.997864
[3925260:MainThread](2024-04-26 20:24:31,990) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 20:24:31,991) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:25:18,030) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:25:40,584) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990184, valid -0.996901
[3925260:MainThread](2024-04-26 20:25:40,588) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 20:25:40,589) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:26:26,879) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:26:49,811) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989905, valid -0.998073
[3925260:MainThread](2024-04-26 20:26:49,812) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 20:26:49,812) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:27:35,632) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:27:58,499) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989623, valid -0.997850
[3925260:MainThread](2024-04-26 20:27:58,500) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 20:27:58,500) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:28:44,324) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:29:00,611) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989243, valid -0.997518
[3925260:MainThread](2024-04-26 20:29:00,611) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch8:
[3925260:MainThread](2024-04-26 20:29:00,612) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:29:23,283) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:29:32,573) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989433, valid -0.998136
[3925260:MainThread](2024-04-26 20:29:32,574) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch9:
[3925260:MainThread](2024-04-26 20:29:32,575) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:29:55,028) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:30:04,162) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989055, valid -0.997651
[3925260:MainThread](2024-04-26 20:30:04,163) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 20:30:04,163) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.996901 @ 4
[3925260:MainThread](2024-04-26 20:30:04,266) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_47.
[3925260:MainThread](2024-04-26 20:30:04,542) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 20:30:04,570) INFO - qlib.workflow - [recorder.py:341] - Recorder b2ef20d2c4b84192a955d2c35489148c starts running under Experiment 118 ...
{'IC': 0.026817068213703485,
 'ICIR': 0.19259407177488486,
 'Rank IC': 0.038525681522365414,
 'Rank ICIR': 0.2652645078116241}
[3925260:MainThread](2024-04-26 20:30:15,929) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 20:30:54,194) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:30:54,197) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:31:00,384) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fdac6e21be0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<03:11,  5.07it/s]backtest loop:   1%|          | 9/971 [00:00<01:01, 15.68it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:35, 26.72it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:31, 30.20it/s]backtest loop:   3%|▎         | 27/971 [00:01<00:25, 36.54it/s]backtest loop:   3%|▎         | 33/971 [00:01<00:22, 41.15it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:22, 42.21it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:20, 45.59it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:19, 48.09it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:19, 46.83it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:18, 49.24it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:17, 51.11it/s]backtest loop:   8%|▊         | 75/971 [00:01<00:17, 52.26it/s]backtest loop:   8%|▊         | 81/971 [00:02<00:16, 53.20it/s]backtest loop:   9%|▉         | 87/971 [00:02<00:17, 50.58it/s]backtest loop:  10%|▉         | 93/971 [00:02<00:16, 51.85it/s]backtest loop:  10%|█         | 99/971 [00:02<00:16, 52.52it/s]backtest loop:  11%|█         | 105/971 [00:02<00:16, 53.26it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:16, 53.52it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:16, 50.76it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:16, 52.12it/s]backtest loop:  13%|█▎        | 129/971 [00:03<00:16, 49.70it/s]backtest loop:  14%|█▍        | 135/971 [00:03<00:16, 51.57it/s]backtest loop:  15%|█▍        | 141/971 [00:03<00:16, 49.48it/s]backtest loop:  15%|█▌        | 147/971 [00:03<00:16, 50.84it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:15, 51.90it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:15, 52.45it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:15, 53.05it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:15, 51.14it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:15, 52.47it/s]backtest loop:  19%|█▉        | 183/971 [00:04<00:14, 53.11it/s]backtest loop:  19%|█▉        | 189/971 [00:04<00:14, 53.60it/s]backtest loop:  20%|██        | 195/971 [00:04<00:15, 50.66it/s]backtest loop:  21%|██        | 201/971 [00:04<00:14, 51.71it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:14, 52.67it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:15, 50.51it/s]backtest loop:  23%|██▎       | 219/971 [00:04<00:14, 51.79it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:15, 49.62it/s]backtest loop:  24%|██▍       | 231/971 [00:05<00:21, 34.44it/s]backtest loop:  24%|██▍       | 237/971 [00:05<00:18, 38.74it/s]backtest loop:  25%|██▌       | 243/971 [00:05<00:17, 42.46it/s]backtest loop:  26%|██▌       | 249/971 [00:05<00:16, 43.39it/s]backtest loop:  26%|██▋       | 255/971 [00:05<00:15, 46.93it/s]backtest loop:  27%|██▋       | 261/971 [00:05<00:14, 49.11it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:14, 47.79it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:14, 49.59it/s]backtest loop:  29%|██▊       | 279/971 [00:06<00:13, 50.85it/s]backtest loop:  29%|██▉       | 285/971 [00:06<00:13, 52.04it/s]backtest loop:  30%|██▉       | 291/971 [00:06<00:13, 49.64it/s]backtest loop:  31%|███       | 297/971 [00:06<00:13, 51.14it/s]backtest loop:  31%|███       | 303/971 [00:06<00:12, 52.15it/s]backtest loop:  32%|███▏      | 309/971 [00:06<00:12, 52.99it/s]backtest loop:  32%|███▏      | 315/971 [00:06<00:13, 50.17it/s]backtest loop:  33%|███▎      | 321/971 [00:06<00:12, 51.58it/s]backtest loop:  34%|███▎      | 327/971 [00:07<00:12, 53.02it/s]backtest loop:  34%|███▍      | 333/971 [00:07<00:11, 53.60it/s]backtest loop:  35%|███▍      | 339/971 [00:07<00:11, 53.96it/s]backtest loop:  36%|███▌      | 345/971 [00:07<00:12, 50.73it/s]backtest loop:  36%|███▌      | 351/971 [00:07<00:11, 52.16it/s]backtest loop:  37%|███▋      | 357/971 [00:07<00:11, 52.99it/s]backtest loop:  37%|███▋      | 363/971 [00:07<00:12, 50.48it/s]backtest loop:  38%|███▊      | 369/971 [00:07<00:12, 48.69it/s]backtest loop:  39%|███▊      | 375/971 [00:07<00:11, 50.27it/s]backtest loop:  39%|███▉      | 381/971 [00:08<00:11, 51.47it/s]backtest loop:  40%|███▉      | 387/971 [00:08<00:11, 52.35it/s]backtest loop:  40%|████      | 393/971 [00:08<00:11, 49.94it/s]backtest loop:  41%|████      | 399/971 [00:08<00:11, 51.36it/s]backtest loop:  42%|████▏     | 405/971 [00:08<00:10, 52.76it/s]backtest loop:  42%|████▏     | 411/971 [00:08<00:10, 53.52it/s]backtest loop:  43%|████▎     | 417/971 [00:08<00:10, 53.84it/s]backtest loop:  44%|████▎     | 423/971 [00:08<00:10, 50.76it/s]backtest loop:  44%|████▍     | 429/971 [00:08<00:10, 51.78it/s]backtest loop:  45%|████▍     | 435/971 [00:09<00:10, 52.55it/s]backtest loop:  45%|████▌     | 441/971 [00:09<00:09, 53.25it/s]backtest loop:  46%|████▌     | 447/971 [00:09<00:10, 50.37it/s]backtest loop:  47%|████▋     | 453/971 [00:09<00:10, 51.54it/s]backtest loop:  47%|████▋     | 459/971 [00:09<00:09, 52.41it/s]backtest loop:  48%|████▊     | 465/971 [00:09<00:09, 53.03it/s]backtest loop:  49%|████▊     | 471/971 [00:09<00:09, 53.51it/s]backtest loop:  49%|████▉     | 477/971 [00:09<00:09, 50.87it/s]backtest loop:  50%|████▉     | 483/971 [00:10<00:09, 51.74it/s]backtest loop:  50%|█████     | 489/971 [00:10<00:09, 52.51it/s]backtest loop:  51%|█████     | 495/971 [00:10<00:09, 50.04it/s]backtest loop:  52%|█████▏    | 501/971 [00:10<00:09, 51.26it/s]backtest loop:  52%|█████▏    | 507/971 [00:10<00:09, 49.06it/s]backtest loop:  53%|█████▎    | 513/971 [00:10<00:09, 50.57it/s]backtest loop:  53%|█████▎    | 519/971 [00:10<00:08, 51.91it/s]backtest loop:  54%|█████▍    | 525/971 [00:10<00:08, 52.69it/s]backtest loop:  55%|█████▍    | 531/971 [00:10<00:08, 50.43it/s]backtest loop:  55%|█████▌    | 537/971 [00:11<00:08, 51.75it/s]backtest loop:  56%|█████▌    | 543/971 [00:11<00:08, 52.65it/s]backtest loop:  57%|█████▋    | 549/971 [00:11<00:07, 52.94it/s]backtest loop:  57%|█████▋    | 555/971 [00:11<00:07, 53.51it/s]backtest loop:  58%|█████▊    | 561/971 [00:11<00:08, 50.38it/s]backtest loop:  58%|█████▊    | 567/971 [00:11<00:07, 51.57it/s]backtest loop:  59%|█████▉    | 573/971 [00:11<00:07, 52.62it/s]backtest loop:  60%|█████▉    | 579/971 [00:11<00:07, 53.19it/s]backtest loop:  60%|██████    | 585/971 [00:11<00:07, 53.82it/s]backtest loop:  61%|██████    | 591/971 [00:12<00:07, 50.72it/s]backtest loop:  61%|██████▏   | 597/971 [00:12<00:07, 51.83it/s]backtest loop:  62%|██████▏   | 603/971 [00:12<00:06, 52.59it/s]backtest loop:  63%|██████▎   | 609/971 [00:12<00:06, 53.11it/s]backtest loop:  63%|██████▎   | 615/971 [00:12<00:07, 50.18it/s]backtest loop:  64%|██████▍   | 621/971 [00:12<00:06, 51.34it/s]backtest loop:  65%|██████▍   | 627/971 [00:12<00:06, 52.41it/s]backtest loop:  65%|██████▌   | 633/971 [00:12<00:06, 53.11it/s]backtest loop:  66%|██████▌   | 639/971 [00:13<00:06, 53.57it/s]backtest loop:  66%|██████▋   | 645/971 [00:13<00:06, 50.71it/s]backtest loop:  67%|██████▋   | 651/971 [00:13<00:06, 51.87it/s]backtest loop:  68%|██████▊   | 657/971 [00:13<00:05, 52.55it/s]backtest loop:  68%|██████▊   | 663/971 [00:13<00:05, 53.08it/s]backtest loop:  69%|██████▉   | 669/971 [00:13<00:05, 54.94it/s]backtest loop:  70%|██████▉   | 675/971 [00:13<00:05, 53.08it/s]backtest loop:  70%|███████   | 681/971 [00:13<00:05, 54.83it/s]backtest loop:  71%|███████   | 687/971 [00:13<00:05, 56.08it/s]backtest loop:  71%|███████▏  | 693/971 [00:14<00:04, 57.10it/s]backtest loop:  72%|███████▏  | 699/971 [00:14<00:04, 54.40it/s]backtest loop:  73%|███████▎  | 705/971 [00:14<00:04, 55.87it/s]backtest loop:  73%|███████▎  | 711/971 [00:14<00:04, 56.96it/s]backtest loop:  74%|███████▍  | 717/971 [00:14<00:04, 57.73it/s]backtest loop:  74%|███████▍  | 723/971 [00:14<00:04, 58.33it/s]backtest loop:  75%|███████▌  | 729/971 [00:14<00:04, 55.17it/s]backtest loop:  76%|███████▌  | 735/971 [00:14<00:04, 53.13it/s]backtest loop:  76%|███████▋  | 741/971 [00:14<00:04, 53.02it/s]backtest loop:  77%|███████▋  | 747/971 [00:15<00:04, 53.46it/s]backtest loop:  78%|███████▊  | 753/971 [00:15<00:04, 50.54it/s]backtest loop:  78%|███████▊  | 759/971 [00:15<00:04, 51.80it/s]backtest loop:  79%|███████▉  | 765/971 [00:15<00:04, 49.52it/s]backtest loop:  79%|███████▉  | 771/971 [00:15<00:03, 50.93it/s]backtest loop:  80%|████████  | 777/971 [00:15<00:03, 51.99it/s]backtest loop:  81%|████████  | 783/971 [00:15<00:03, 49.55it/s]backtest loop:  81%|████████▏ | 789/971 [00:15<00:03, 51.01it/s]backtest loop:  82%|████████▏ | 795/971 [00:15<00:03, 51.50it/s]backtest loop:  82%|████████▏ | 801/971 [00:16<00:03, 52.46it/s]backtest loop:  83%|████████▎ | 807/971 [00:16<00:03, 53.23it/s]backtest loop:  84%|████████▎ | 813/971 [00:16<00:03, 50.32it/s]backtest loop:  84%|████████▍ | 819/971 [00:16<00:02, 51.48it/s]backtest loop:  85%|████████▍ | 825/971 [00:16<00:02, 52.37it/s]backtest loop:  86%|████████▌ | 831/971 [00:16<00:02, 53.01it/s]backtest loop:  86%|████████▌ | 837/971 [00:16<00:02, 53.44it/s]backtest loop:  87%|████████▋ | 843/971 [00:16<00:02, 50.52it/s]backtest loop:  87%|████████▋ | 849/971 [00:17<00:02, 51.66it/s]backtest loop:  88%|████████▊ | 855/971 [00:17<00:02, 52.50it/s]backtest loop:  89%|████████▊ | 861/971 [00:17<00:02, 53.16it/s]backtest loop:  89%|████████▉ | 867/971 [00:17<00:02, 50.05it/s]backtest loop:  90%|████████▉ | 873/971 [00:17<00:01, 51.29it/s]backtest loop:  91%|█████████ | 879/971 [00:17<00:01, 52.18it/s]backtest loop:  91%|█████████ | 885/971 [00:17<00:01, 52.92it/s]backtest loop:  92%|█████████▏| 891/971 [00:17<00:01, 53.38it/s]backtest loop:  92%|█████████▏| 897/971 [00:17<00:01, 50.55it/s]backtest loop:  93%|█████████▎| 903/971 [00:18<00:01, 51.64it/s]backtest loop:  94%|█████████▎| 909/971 [00:18<00:01, 52.48it/s]backtest loop:  94%|█████████▍| 915/971 [00:18<00:01, 53.14it/s]backtest loop:  95%|█████████▍| 921/971 [00:18<00:00, 50.43it/s]backtest loop:  95%|█████████▌| 927/971 [00:18<00:00, 51.66it/s]backtest loop:  96%|█████████▌| 933/971 [00:18<00:00, 52.47it/s]backtest loop:  97%|█████████▋| 939/971 [00:18<00:00, 53.05it/s]backtest loop:  97%|█████████▋| 945/971 [00:18<00:00, 49.75it/s]backtest loop:  98%|█████████▊| 951/971 [00:18<00:00, 51.03it/s]backtest loop:  99%|█████████▊| 957/971 [00:19<00:00, 52.01it/s]backtest loop:  99%|█████████▉| 963/971 [00:19<00:00, 52.75it/s]backtest loop: 100%|█████████▉| 969/971 [00:19<00:00, 53.30it/s]backtest loop: 100%|██████████| 971/971 [00:19<00:00, 50.16it/s]
[3925260:MainThread](2024-04-26 20:31:19,800) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000445
std                0.005139
annualized_return  0.105962
information_ratio  1.336417
max_drawdown      -0.080697
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000251
std                0.005140
annualized_return  0.059676
information_ratio  0.752555
max_drawdown      -0.094345
[3925260:MainThread](2024-04-26 20:31:19,814) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 20:31:26,717) INFO - qlib.timer - [log.py:127] - Time cost: 0.011s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772,
                                                    0.07388724568850046,
                                                    0.06334240221765423,
                                                    0.05967591966440727],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167,
                                                    0.9347375159430679,
                                                    0.8642895289298118,
                                                    0.7525545858988472],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557,
                                               -0.09492334235123748,
                                               -0.07955619464075078,
                                               -0.09434548234612129],
 'IC': [0.02734841249253904,
        0.022572722047014094,
        0.026684936706207103,
        0.02664763367970717,
        0.026817068213703485],
 'ICIR': [0.21236024942574536,
          0.1709789532544127,
          0.19340628575351163,
          0.20007151364249662,
          0.19259407177488486],
 'Rank IC': [0.035975396383521215,
             0.032874066222441635,
             0.03798482714314599,
             0.039716791710446786,
             0.038525681522365414],
 'Rank ICIR': [0.2768152718838129,
               0.24486868869570597,
               0.2617583327848503,
               0.29471520276399354,
               0.2652645078116241],
 'mae': [0.8639875715380355,
         0.8641355173474249,
         0.8637491718650353,
         0.863803688204625,
         0.8637314001679426],
 'mse': [0.997836837153924,
         0.9970882453499194,
         0.9969328092652393,
         0.9973319905581113,
         0.9968970210618471]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 20:31:29,858) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 20:31:32,976) INFO - qlib.workflow - [exp.py:258] - Experiment 123 starts running ...
[3925260:MainThread](2024-04-26 20:31:32,994) INFO - qlib.workflow - [recorder.py:341] - Recorder 16b1739ad5854cc6812b6ba937527431 starts running under Experiment 123 ...
[3925260:MainThread](2024-04-26 20:31:45,406) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 20:31:45,407) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 20:31:45,407) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:32:29,693) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:32:54,685) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991386, valid -0.997686
[3925260:MainThread](2024-04-26 20:32:54,691) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 20:32:54,692) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:33:38,683) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:34:03,359) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990613, valid -0.998230
[3925260:MainThread](2024-04-26 20:34:03,360) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 20:34:03,360) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:34:46,812) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:35:11,721) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990285, valid -0.998314
[3925260:MainThread](2024-04-26 20:35:11,722) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 20:35:11,722) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:35:55,521) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:36:20,220) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989622, valid -0.997447
[3925260:MainThread](2024-04-26 20:36:20,224) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 20:36:20,225) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:37:03,635) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:37:28,518) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989313, valid -0.997429
[3925260:MainThread](2024-04-26 20:37:28,522) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 20:37:28,523) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:38:12,904) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:38:37,744) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990166, valid -0.997937
[3925260:MainThread](2024-04-26 20:38:37,745) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 20:38:37,745) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:39:22,017) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:39:46,954) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989382, valid -0.998134
[3925260:MainThread](2024-04-26 20:39:46,955) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 20:39:46,955) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:40:28,186) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:40:37,427) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990290, valid -0.999832
[3925260:MainThread](2024-04-26 20:40:37,428) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch8:
[3925260:MainThread](2024-04-26 20:40:37,428) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:41:00,261) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:41:09,510) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989191, valid -0.997771
[3925260:MainThread](2024-04-26 20:41:09,512) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch9:
[3925260:MainThread](2024-04-26 20:41:09,512) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:41:31,890) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:41:41,087) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989289, valid -0.997710
[3925260:MainThread](2024-04-26 20:41:41,087) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 20:41:41,088) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.997429 @ 4
[3925260:MainThread](2024-04-26 20:41:41,168) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_48.
[3925260:MainThread](2024-04-26 20:41:41,518) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 20:41:41,544) INFO - qlib.workflow - [recorder.py:341] - Recorder b7e84931176647f394459d3a013258a5 starts running under Experiment 118 ...
{'IC': 0.02397007256994346,
 'ICIR': 0.17317919939853219,
 'Rank IC': 0.033958569759792695,
 'Rank ICIR': 0.24470378820376362}
[3925260:MainThread](2024-04-26 20:41:50,814) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 20:42:29,256) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:42:29,259) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:42:35,458) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fdac40f4f40>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:52,  8.58it/s]backtest loop:   1%|          | 9/971 [00:00<00:42, 22.79it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:29, 32.66it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:25, 36.91it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:22, 42.07it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:20, 45.79it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:20, 45.41it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:19, 48.21it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 50.12it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 48.36it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:18, 50.28it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:17, 51.86it/s]backtest loop:   8%|▊         | 75/971 [00:01<00:16, 52.76it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:16, 53.62it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:17, 50.75it/s]backtest loop:  10%|▉         | 93/971 [00:02<00:16, 52.01it/s]backtest loop:  10%|█         | 99/971 [00:02<00:16, 52.72it/s]backtest loop:  11%|█         | 105/971 [00:02<00:16, 53.33it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:15, 53.88it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:16, 50.88it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:16, 52.31it/s]backtest loop:  13%|█▎        | 129/971 [00:02<00:16, 49.89it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:16, 52.15it/s]backtest loop:  15%|█▍        | 141/971 [00:03<00:16, 49.88it/s]backtest loop:  15%|█▌        | 147/971 [00:03<00:16, 51.28it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:15, 52.31it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:15, 53.00it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:15, 53.62it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:15, 51.39it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:15, 52.68it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:14, 53.44it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:14, 53.98it/s]backtest loop:  20%|██        | 195/971 [00:04<00:15, 51.08it/s]backtest loop:  21%|██        | 201/971 [00:04<00:14, 52.42it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:14, 53.14it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:14, 50.66it/s]backtest loop:  23%|██▎       | 219/971 [00:04<00:14, 52.05it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:14, 50.08it/s]backtest loop:  24%|██▍       | 231/971 [00:04<00:21, 34.48it/s]backtest loop:  24%|██▍       | 237/971 [00:05<00:18, 38.71it/s]backtest loop:  25%|██▌       | 243/971 [00:05<00:17, 42.51it/s]backtest loop:  26%|██▌       | 249/971 [00:05<00:16, 43.24it/s]backtest loop:  26%|██▋       | 255/971 [00:05<00:15, 46.21it/s]backtest loop:  27%|██▋       | 261/971 [00:05<00:14, 48.50it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:14, 47.45it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:14, 49.42it/s]backtest loop:  29%|██▊       | 279/971 [00:05<00:13, 51.16it/s]backtest loop:  29%|██▉       | 285/971 [00:05<00:13, 52.20it/s]backtest loop:  30%|██▉       | 291/971 [00:06<00:13, 49.77it/s]backtest loop:  31%|███       | 297/971 [00:06<00:13, 51.30it/s]backtest loop:  31%|███       | 303/971 [00:06<00:12, 52.29it/s]backtest loop:  32%|███▏      | 309/971 [00:06<00:12, 53.19it/s]backtest loop:  32%|███▏      | 315/971 [00:06<00:13, 50.15it/s]backtest loop:  33%|███▎      | 321/971 [00:06<00:12, 51.38it/s]backtest loop:  34%|███▎      | 327/971 [00:06<00:12, 52.57it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:11, 53.28it/s]backtest loop:  35%|███▍      | 339/971 [00:06<00:11, 53.79it/s]backtest loop:  36%|███▌      | 345/971 [00:07<00:12, 50.79it/s]backtest loop:  36%|███▌      | 351/971 [00:07<00:11, 52.08it/s]backtest loop:  37%|███▋      | 357/971 [00:07<00:11, 52.98it/s]backtest loop:  37%|███▋      | 363/971 [00:07<00:11, 50.84it/s]backtest loop:  38%|███▊      | 369/971 [00:07<00:12, 48.87it/s]backtest loop:  39%|███▊      | 375/971 [00:07<00:11, 50.62it/s]backtest loop:  39%|███▉      | 381/971 [00:07<00:11, 51.76it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:11, 52.27it/s]backtest loop:  40%|████      | 393/971 [00:08<00:11, 49.91it/s]backtest loop:  41%|████      | 399/971 [00:08<00:11, 51.32it/s]backtest loop:  42%|████▏     | 405/971 [00:08<00:10, 52.80it/s]backtest loop:  42%|████▏     | 411/971 [00:08<00:10, 53.53it/s]backtest loop:  43%|████▎     | 417/971 [00:08<00:10, 53.89it/s]backtest loop:  44%|████▎     | 423/971 [00:08<00:10, 50.85it/s]backtest loop:  44%|████▍     | 429/971 [00:08<00:10, 51.94it/s]backtest loop:  45%|████▍     | 435/971 [00:08<00:10, 52.76it/s]backtest loop:  45%|████▌     | 441/971 [00:08<00:09, 53.49it/s]backtest loop:  46%|████▌     | 447/971 [00:09<00:10, 50.55it/s]backtest loop:  47%|████▋     | 453/971 [00:09<00:09, 51.82it/s]backtest loop:  47%|████▋     | 459/971 [00:09<00:09, 52.69it/s]backtest loop:  48%|████▊     | 465/971 [00:09<00:09, 52.67it/s]backtest loop:  49%|████▊     | 471/971 [00:09<00:09, 53.20it/s]backtest loop:  49%|████▉     | 477/971 [00:09<00:09, 50.62it/s]backtest loop:  50%|████▉     | 483/971 [00:09<00:09, 51.68it/s]backtest loop:  50%|█████     | 489/971 [00:09<00:09, 51.49it/s]backtest loop:  51%|█████     | 495/971 [00:10<00:09, 50.66it/s]backtest loop:  52%|█████▏    | 501/971 [00:10<00:08, 53.00it/s]backtest loop:  52%|█████▏    | 507/971 [00:10<00:08, 51.92it/s]backtest loop:  53%|█████▎    | 514/971 [00:10<00:08, 54.90it/s]backtest loop:  54%|█████▎    | 520/971 [00:10<00:08, 56.22it/s]backtest loop:  54%|█████▍    | 526/971 [00:10<00:08, 53.79it/s]backtest loop:  55%|█████▍    | 533/971 [00:10<00:07, 56.61it/s]backtest loop:  56%|█████▌    | 540/971 [00:10<00:07, 58.30it/s]backtest loop:  56%|█████▌    | 546/971 [00:10<00:07, 54.94it/s]backtest loop:  57%|█████▋    | 552/971 [00:11<00:07, 56.20it/s]backtest loop:  57%|█████▋    | 558/971 [00:11<00:07, 57.17it/s]backtest loop:  58%|█████▊    | 565/971 [00:11<00:06, 58.66it/s]backtest loop:  59%|█████▉    | 571/971 [00:11<00:07, 55.63it/s]backtest loop:  59%|█████▉    | 577/971 [00:11<00:06, 56.69it/s]backtest loop:  60%|██████    | 584/971 [00:11<00:06, 58.30it/s]backtest loop:  61%|██████    | 590/971 [00:11<00:06, 58.68it/s]backtest loop:  61%|██████▏   | 596/971 [00:11<00:06, 55.45it/s]backtest loop:  62%|██████▏   | 602/971 [00:11<00:06, 56.58it/s]backtest loop:  63%|██████▎   | 608/971 [00:12<00:06, 57.51it/s]backtest loop:  63%|██████▎   | 614/971 [00:12<00:06, 58.08it/s]backtest loop:  64%|██████▍   | 620/971 [00:12<00:06, 54.93it/s]backtest loop:  64%|██████▍   | 626/971 [00:12<00:06, 56.34it/s]backtest loop:  65%|██████▌   | 633/971 [00:12<00:05, 58.25it/s]backtest loop:  66%|██████▌   | 640/971 [00:12<00:05, 56.43it/s]backtest loop:  67%|██████▋   | 646/971 [00:12<00:05, 57.35it/s]backtest loop:  67%|██████▋   | 653/971 [00:12<00:05, 58.84it/s]backtest loop:  68%|██████▊   | 660/971 [00:12<00:05, 56.45it/s]backtest loop:  69%|██████▊   | 666/971 [00:13<00:05, 57.34it/s]backtest loop:  69%|██████▉   | 672/971 [00:13<00:05, 58.02it/s]backtest loop:  70%|██████▉   | 679/971 [00:13<00:05, 55.90it/s]backtest loop:  71%|███████   | 685/971 [00:13<00:05, 56.78it/s]backtest loop:  71%|███████   | 691/971 [00:13<00:04, 57.62it/s]backtest loop:  72%|███████▏  | 697/971 [00:13<00:04, 58.20it/s]backtest loop:  73%|███████▎  | 704/971 [00:13<00:04, 55.96it/s]backtest loop:  73%|███████▎  | 710/971 [00:13<00:04, 56.84it/s]backtest loop:  74%|███████▎  | 716/971 [00:13<00:04, 57.71it/s]backtest loop:  74%|███████▍  | 722/971 [00:13<00:04, 58.29it/s]backtest loop:  75%|███████▌  | 729/971 [00:14<00:04, 56.09it/s]backtest loop:  76%|███████▌  | 735/971 [00:14<00:04, 53.74it/s]backtest loop:  76%|███████▋  | 741/971 [00:14<00:04, 55.32it/s]backtest loop:  77%|███████▋  | 747/971 [00:14<00:03, 56.44it/s]backtest loop:  78%|███████▊  | 753/971 [00:14<00:04, 53.94it/s]backtest loop:  78%|███████▊  | 759/971 [00:14<00:03, 55.49it/s]backtest loop:  79%|███████▉  | 765/971 [00:14<00:03, 53.49it/s]backtest loop:  79%|███████▉  | 771/971 [00:14<00:03, 55.10it/s]backtest loop:  80%|████████  | 777/971 [00:15<00:03, 56.47it/s]backtest loop:  81%|████████  | 783/971 [00:15<00:03, 53.93it/s]backtest loop:  81%|████████▏ | 789/971 [00:15<00:03, 55.56it/s]backtest loop:  82%|████████▏ | 795/971 [00:15<00:03, 56.48it/s]backtest loop:  82%|████████▏ | 801/971 [00:15<00:02, 57.38it/s]backtest loop:  83%|████████▎ | 807/971 [00:15<00:02, 58.03it/s]backtest loop:  84%|████████▎ | 813/971 [00:15<00:02, 54.85it/s]backtest loop:  84%|████████▍ | 819/971 [00:15<00:02, 56.15it/s]backtest loop:  85%|████████▍ | 825/971 [00:15<00:02, 57.11it/s]backtest loop:  86%|████████▌ | 831/971 [00:15<00:02, 57.83it/s]backtest loop:  86%|████████▌ | 837/971 [00:16<00:02, 58.37it/s]backtest loop:  87%|████████▋ | 843/971 [00:16<00:02, 55.13it/s]backtest loop:  87%|████████▋ | 849/971 [00:16<00:02, 56.41it/s]backtest loop:  88%|████████▊ | 855/971 [00:16<00:02, 57.34it/s]backtest loop:  89%|████████▊ | 861/971 [00:16<00:01, 57.99it/s]backtest loop:  89%|████████▉ | 867/971 [00:16<00:01, 54.87it/s]backtest loop:  90%|████████▉ | 873/971 [00:16<00:01, 56.18it/s]backtest loop:  91%|█████████ | 879/971 [00:16<00:01, 56.98it/s]backtest loop:  91%|█████████ | 885/971 [00:16<00:01, 57.81it/s]backtest loop:  92%|█████████▏| 891/971 [00:17<00:01, 58.37it/s]backtest loop:  92%|█████████▏| 897/971 [00:17<00:01, 55.24it/s]backtest loop:  93%|█████████▎| 903/971 [00:17<00:01, 56.46it/s]backtest loop:  94%|█████████▎| 909/971 [00:17<00:01, 57.37it/s]backtest loop:  94%|█████████▍| 915/971 [00:17<00:00, 58.12it/s]backtest loop:  95%|█████████▍| 921/971 [00:17<00:00, 54.95it/s]backtest loop:  95%|█████████▌| 927/971 [00:17<00:00, 56.35it/s]backtest loop:  96%|█████████▌| 933/971 [00:17<00:00, 57.27it/s]backtest loop:  97%|█████████▋| 939/971 [00:17<00:00, 57.87it/s]backtest loop:  97%|█████████▋| 945/971 [00:17<00:00, 54.79it/s]backtest loop:  98%|█████████▊| 952/971 [00:18<00:00, 57.07it/s]backtest loop:  99%|█████████▉| 959/971 [00:18<00:00, 58.66it/s]backtest loop:  99%|█████████▉| 965/971 [00:18<00:00, 55.34it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 56.50it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 52.70it/s]
[3925260:MainThread](2024-04-26 20:42:53,941) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000491
std                0.004969
annualized_return  0.116776
information_ratio  1.523431
max_drawdown      -0.063294
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000292
std                0.004970
annualized_return  0.069520
information_ratio  0.906610
max_drawdown      -0.074217
[3925260:MainThread](2024-04-26 20:42:53,954) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 20:43:00,769) INFO - qlib.timer - [log.py:127] - Time cost: 0.012s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772,
                                                    0.07388724568850046,
                                                    0.06334240221765423,
                                                    0.05967591966440727,
                                                    0.06951970806773994],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167,
                                                    0.9347375159430679,
                                                    0.8642895289298118,
                                                    0.7525545858988472,
                                                    0.9066095451789402],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557,
                                               -0.09492334235123748,
                                               -0.07955619464075078,
                                               -0.09434548234612129,
                                               -0.07421695280613762],
 'IC': [0.02734841249253904,
        0.022572722047014094,
        0.026684936706207103,
        0.02664763367970717,
        0.026817068213703485,
        0.02397007256994346],
 'ICIR': [0.21236024942574536,
          0.1709789532544127,
          0.19340628575351163,
          0.20007151364249662,
          0.19259407177488486,
          0.17317919939853219],
 'Rank IC': [0.035975396383521215,
             0.032874066222441635,
             0.03798482714314599,
             0.039716791710446786,
             0.038525681522365414,
             0.033958569759792695],
 'Rank ICIR': [0.2768152718838129,
               0.24486868869570597,
               0.2617583327848503,
               0.29471520276399354,
               0.2652645078116241,
               0.24470378820376362],
 'mae': [0.8639875715380355,
         0.8641355173474249,
         0.8637491718650353,
         0.863803688204625,
         0.8637314001679426,
         0.8641202803551714],
 'mse': [0.997836837153924,
         0.9970882453499194,
         0.9969328092652393,
         0.9973319905581113,
         0.9968970210618471,
         0.9980745120409013]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 20:43:04,172) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 20:43:07,205) INFO - qlib.workflow - [exp.py:258] - Experiment 124 starts running ...
[3925260:MainThread](2024-04-26 20:43:07,223) INFO - qlib.workflow - [recorder.py:341] - Recorder b45a3d66980146e3a74c4ad9974f3506 starts running under Experiment 124 ...
[3925260:MainThread](2024-04-26 20:43:18,642) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 20:43:18,643) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 20:43:18,643) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:44:02,560) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:44:27,500) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.992135, valid -0.999759
[3925260:MainThread](2024-04-26 20:44:27,504) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 20:44:27,504) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:45:11,046) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:45:36,027) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990638, valid -0.997935
[3925260:MainThread](2024-04-26 20:45:36,033) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 20:45:36,033) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:46:19,347) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:46:44,151) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990974, valid -0.997757
[3925260:MainThread](2024-04-26 20:46:44,156) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 20:46:44,156) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:47:27,603) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:47:52,114) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989479, valid -0.997464
[3925260:MainThread](2024-04-26 20:47:52,119) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 20:47:52,119) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:48:36,039) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:49:00,951) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989655, valid -0.998933
[3925260:MainThread](2024-04-26 20:49:00,951) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 20:49:00,952) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:49:44,706) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:50:09,495) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989307, valid -0.997804
[3925260:MainThread](2024-04-26 20:50:09,496) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 20:50:09,496) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:50:53,207) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:51:17,935) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989094, valid -0.998190
[3925260:MainThread](2024-04-26 20:51:17,936) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 20:51:17,936) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:52:02,111) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:52:26,825) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989296, valid -0.996879
[3925260:MainThread](2024-04-26 20:52:26,829) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch8:
[3925260:MainThread](2024-04-26 20:52:26,829) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:53:10,525) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:53:35,187) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989388, valid -0.999090
[3925260:MainThread](2024-04-26 20:53:35,188) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch9:
[3925260:MainThread](2024-04-26 20:53:35,188) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:54:19,010) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:54:43,691) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989441, valid -0.999679
[3925260:MainThread](2024-04-26 20:54:43,692) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch10:
[3925260:MainThread](2024-04-26 20:54:43,692) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:55:20,099) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:55:29,372) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988905, valid -0.997474
[3925260:MainThread](2024-04-26 20:55:29,372) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch11:
[3925260:MainThread](2024-04-26 20:55:29,373) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:55:51,747) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:56:01,001) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988669, valid -0.997181
[3925260:MainThread](2024-04-26 20:56:01,002) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch12:
[3925260:MainThread](2024-04-26 20:56:01,002) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:56:23,180) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:56:32,366) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989732, valid -0.998333
[3925260:MainThread](2024-04-26 20:56:32,367) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 20:56:32,367) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.996879 @ 7
[3925260:MainThread](2024-04-26 20:56:32,614) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_49.
[3925260:MainThread](2024-04-26 20:56:32,929) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 20:56:32,957) INFO - qlib.workflow - [recorder.py:341] - Recorder c6035bebbcb348968e830631c8c6330e starts running under Experiment 118 ...
{'IC': 0.025976119025929705,
 'ICIR': 0.19772653653050484,
 'Rank IC': 0.035890706881287766,
 'Rank ICIR': 0.2707421471174453}
[3925260:MainThread](2024-04-26 20:56:43,957) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 20:57:20,605) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:57:20,608) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 20:57:27,012) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fda3dba7280>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<03:17,  4.90it/s]backtest loop:   1%|          | 9/971 [00:00<01:03, 15.24it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:36, 26.25it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:30, 31.03it/s]backtest loop:   3%|▎         | 28/971 [00:01<00:23, 39.35it/s]backtest loop:   4%|▎         | 34/971 [00:01<00:22, 42.29it/s]backtest loop:   4%|▍         | 41/971 [00:01<00:19, 47.85it/s]backtest loop:   5%|▍         | 47/971 [00:01<00:18, 50.74it/s]backtest loop:   5%|▌         | 53/971 [00:01<00:17, 53.23it/s]backtest loop:   6%|▌         | 59/971 [00:01<00:17, 51.69it/s]backtest loop:   7%|▋         | 66/971 [00:01<00:16, 55.07it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 53.53it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:15, 56.29it/s]backtest loop:   9%|▉         | 86/971 [00:02<00:15, 58.09it/s]backtest loop:   9%|▉         | 92/971 [00:02<00:15, 55.58it/s]backtest loop:  10%|█         | 99/971 [00:02<00:15, 57.57it/s]backtest loop:  11%|█         | 106/971 [00:02<00:14, 59.05it/s]backtest loop:  12%|█▏        | 112/971 [00:02<00:15, 56.10it/s]backtest loop:  12%|█▏        | 118/971 [00:02<00:14, 57.08it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:15, 55.56it/s]backtest loop:  13%|█▎        | 131/971 [00:03<00:22, 37.07it/s]backtest loop:  14%|█▍        | 138/971 [00:03<00:19, 42.97it/s]backtest loop:  15%|█▍        | 145/971 [00:03<00:17, 47.72it/s]backtest loop:  16%|█▌        | 151/971 [00:03<00:17, 48.16it/s]backtest loop:  16%|█▋        | 158/971 [00:03<00:15, 51.92it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:14, 54.82it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:14, 53.89it/s]backtest loop:  18%|█▊        | 178/971 [00:03<00:14, 56.47it/s]backtest loop:  19%|█▉        | 185/971 [00:03<00:14, 55.10it/s]backtest loop:  20%|█▉        | 192/971 [00:04<00:13, 57.11it/s]backtest loop:  20%|██        | 199/971 [00:04<00:13, 58.72it/s]backtest loop:  21%|██        | 205/971 [00:04<00:13, 56.05it/s]backtest loop:  22%|██▏       | 212/971 [00:04<00:12, 58.88it/s]backtest loop:  22%|██▏       | 218/971 [00:04<00:13, 56.33it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:13, 55.34it/s]backtest loop:  24%|██▍       | 232/971 [00:04<00:12, 57.42it/s]backtest loop:  25%|██▍       | 239/971 [00:04<00:12, 59.03it/s]backtest loop:  25%|██▌       | 245/971 [00:05<00:12, 56.19it/s]backtest loop:  26%|██▌       | 252/971 [00:05<00:12, 58.19it/s]backtest loop:  27%|██▋       | 259/971 [00:05<00:12, 56.22it/s]backtest loop:  27%|██▋       | 266/971 [00:05<00:12, 55.01it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:12, 57.29it/s]backtest loop:  29%|██▉       | 280/971 [00:05<00:11, 58.93it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:12, 56.04it/s]backtest loop:  30%|███       | 293/971 [00:05<00:11, 57.97it/s]backtest loop:  31%|███       | 300/971 [00:05<00:11, 56.17it/s]backtest loop:  32%|███▏      | 307/971 [00:06<00:11, 57.98it/s]backtest loop:  32%|███▏      | 314/971 [00:06<00:11, 59.16it/s]backtest loop:  33%|███▎      | 320/971 [00:06<00:11, 56.08it/s]backtest loop:  34%|███▎      | 326/971 [00:06<00:11, 56.97it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:10, 58.72it/s]backtest loop:  35%|███▌      | 340/971 [00:06<00:11, 56.45it/s]backtest loop:  36%|███▌      | 347/971 [00:06<00:10, 58.29it/s]backtest loop:  36%|███▋      | 354/971 [00:06<00:10, 59.63it/s]backtest loop:  37%|███▋      | 360/971 [00:07<00:10, 56.78it/s]backtest loop:  38%|███▊      | 367/971 [00:07<00:10, 55.25it/s]backtest loop:  38%|███▊      | 373/971 [00:07<00:11, 53.61it/s]backtest loop:  39%|███▉      | 379/971 [00:07<00:10, 54.86it/s]backtest loop:  40%|███▉      | 386/971 [00:07<00:10, 56.99it/s]backtest loop:  40%|████      | 392/971 [00:07<00:10, 57.36it/s]backtest loop:  41%|████      | 398/971 [00:07<00:10, 54.59it/s]backtest loop:  42%|████▏     | 405/971 [00:07<00:09, 56.90it/s]backtest loop:  42%|████▏     | 412/971 [00:07<00:09, 58.75it/s]backtest loop:  43%|████▎     | 418/971 [00:08<00:09, 55.84it/s]backtest loop:  44%|████▍     | 425/971 [00:08<00:09, 57.83it/s]backtest loop:  44%|████▍     | 432/971 [00:08<00:09, 55.82it/s]backtest loop:  45%|████▌     | 439/971 [00:08<00:09, 57.70it/s]backtest loop:  46%|████▌     | 446/971 [00:08<00:08, 59.10it/s]backtest loop:  47%|████▋     | 452/971 [00:08<00:09, 55.98it/s]backtest loop:  47%|████▋     | 459/971 [00:08<00:08, 57.86it/s]backtest loop:  48%|████▊     | 466/971 [00:08<00:08, 59.18it/s]backtest loop:  49%|████▊     | 472/971 [00:09<00:08, 56.13it/s]backtest loop:  49%|████▉     | 479/971 [00:09<00:08, 58.01it/s]backtest loop:  50%|█████     | 486/971 [00:09<00:08, 59.51it/s]backtest loop:  51%|█████     | 492/971 [00:09<00:08, 56.54it/s]backtest loop:  51%|█████▏    | 498/971 [00:09<00:08, 56.48it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:08, 55.17it/s]backtest loop:  53%|█████▎    | 512/971 [00:09<00:08, 54.24it/s]backtest loop:  53%|█████▎    | 519/971 [00:09<00:07, 56.62it/s]backtest loop:  54%|█████▍    | 526/971 [00:09<00:08, 54.94it/s]backtest loop:  55%|█████▍    | 533/971 [00:10<00:07, 57.20it/s]backtest loop:  56%|█████▌    | 540/971 [00:10<00:07, 58.89it/s]backtest loop:  56%|█████▌    | 546/971 [00:10<00:07, 55.97it/s]backtest loop:  57%|█████▋    | 552/971 [00:10<00:07, 57.02it/s]backtest loop:  58%|█████▊    | 559/971 [00:10<00:07, 58.55it/s]backtest loop:  58%|█████▊    | 565/971 [00:10<00:06, 58.80it/s]backtest loop:  59%|█████▉    | 571/971 [00:10<00:07, 55.83it/s]backtest loop:  60%|█████▉    | 578/971 [00:10<00:06, 57.73it/s]backtest loop:  60%|██████    | 585/971 [00:10<00:06, 59.18it/s]backtest loop:  61%|██████    | 591/971 [00:11<00:06, 56.04it/s]backtest loop:  62%|██████▏   | 598/971 [00:11<00:06, 57.86it/s]backtest loop:  62%|██████▏   | 605/971 [00:11<00:06, 55.91it/s]backtest loop:  63%|██████▎   | 612/971 [00:11<00:06, 57.80it/s]backtest loop:  64%|██████▎   | 619/971 [00:11<00:05, 59.16it/s]backtest loop:  64%|██████▍   | 625/971 [00:11<00:06, 56.09it/s]backtest loop:  65%|██████▌   | 632/971 [00:11<00:05, 58.04it/s]backtest loop:  66%|██████▌   | 639/971 [00:11<00:05, 59.89it/s]backtest loop:  67%|██████▋   | 646/971 [00:12<00:05, 56.74it/s]backtest loop:  67%|██████▋   | 653/971 [00:12<00:05, 58.42it/s]backtest loop:  68%|██████▊   | 659/971 [00:12<00:05, 58.79it/s]backtest loop:  68%|██████▊   | 665/971 [00:12<00:05, 55.71it/s]backtest loop:  69%|██████▉   | 672/971 [00:12<00:05, 57.63it/s]backtest loop:  70%|██████▉   | 679/971 [00:12<00:05, 55.92it/s]backtest loop:  71%|███████   | 685/971 [00:12<00:05, 56.88it/s]backtest loop:  71%|███████▏  | 692/971 [00:12<00:04, 58.44it/s]backtest loop:  72%|███████▏  | 698/971 [00:12<00:04, 58.86it/s]backtest loop:  73%|███████▎  | 704/971 [00:13<00:04, 55.83it/s]backtest loop:  73%|███████▎  | 711/971 [00:13<00:04, 57.75it/s]backtest loop:  74%|███████▍  | 718/971 [00:13<00:04, 59.24it/s]backtest loop:  75%|███████▍  | 724/971 [00:13<00:04, 56.06it/s]backtest loop:  75%|███████▌  | 730/971 [00:13<00:04, 56.35it/s]backtest loop:  76%|███████▌  | 736/971 [00:13<00:04, 53.72it/s]backtest loop:  77%|███████▋  | 743/971 [00:13<00:04, 53.09it/s]backtest loop:  77%|███████▋  | 750/971 [00:13<00:04, 52.75it/s]backtest loop:  78%|███████▊  | 757/971 [00:14<00:03, 55.38it/s]backtest loop:  79%|███████▊  | 764/971 [00:14<00:03, 57.39it/s]backtest loop:  79%|███████▉  | 770/971 [00:14<00:03, 54.86it/s]backtest loop:  80%|████████  | 777/971 [00:14<00:03, 56.94it/s]backtest loop:  81%|████████  | 783/971 [00:14<00:03, 55.02it/s]backtest loop:  81%|████████▏ | 790/971 [00:14<00:03, 57.47it/s]backtest loop:  82%|████████▏ | 797/971 [00:14<00:02, 58.92it/s]backtest loop:  83%|████████▎ | 803/971 [00:14<00:03, 55.90it/s]backtest loop:  83%|████████▎ | 810/971 [00:14<00:02, 57.84it/s]backtest loop:  84%|████████▍ | 816/971 [00:15<00:02, 57.97it/s]backtest loop:  85%|████████▍ | 823/971 [00:15<00:02, 55.92it/s]backtest loop:  85%|████████▌ | 830/971 [00:15<00:02, 57.73it/s]backtest loop:  86%|████████▌ | 836/971 [00:15<00:02, 58.33it/s]backtest loop:  87%|████████▋ | 843/971 [00:15<00:02, 56.17it/s]backtest loop:  88%|████████▊ | 850/971 [00:15<00:02, 57.93it/s]backtest loop:  88%|████████▊ | 857/971 [00:15<00:02, 55.95it/s]backtest loop:  89%|████████▉ | 864/971 [00:15<00:01, 57.73it/s]backtest loop:  90%|████████▉ | 871/971 [00:15<00:01, 59.16it/s]backtest loop:  90%|█████████ | 877/971 [00:16<00:01, 56.17it/s]backtest loop:  91%|█████████ | 884/971 [00:16<00:01, 58.00it/s]backtest loop:  92%|█████████▏| 891/971 [00:16<00:01, 58.92it/s]backtest loop:  92%|█████████▏| 897/971 [00:16<00:01, 55.99it/s]backtest loop:  93%|█████████▎| 904/971 [00:16<00:01, 57.75it/s]backtest loop:  94%|█████████▍| 911/971 [00:16<00:01, 59.13it/s]backtest loop:  94%|█████████▍| 917/971 [00:16<00:00, 56.02it/s]backtest loop:  95%|█████████▌| 924/971 [00:16<00:00, 57.86it/s]backtest loop:  96%|█████████▌| 931/971 [00:17<00:00, 55.92it/s]backtest loop:  97%|█████████▋| 938/971 [00:17<00:00, 57.72it/s]backtest loop:  97%|█████████▋| 945/971 [00:17<00:00, 55.85it/s]backtest loop:  98%|█████████▊| 951/971 [00:17<00:00, 56.84it/s]backtest loop:  99%|█████████▊| 957/971 [00:17<00:00, 57.45it/s]backtest loop:  99%|█████████▉| 964/971 [00:17<00:00, 59.00it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 56.27it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.70it/s]
[3925260:MainThread](2024-04-26 20:57:44,824) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000351
std                0.004892
annualized_return  0.083508
information_ratio  1.106510
max_drawdown      -0.076923
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000154
std                0.004893
annualized_return  0.036609
information_ratio  0.484958
max_drawdown      -0.097284
[3925260:MainThread](2024-04-26 20:57:44,839) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 20:57:51,903) INFO - qlib.timer - [log.py:127] - Time cost: 0.011s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772,
                                                    0.07388724568850046,
                                                    0.06334240221765423,
                                                    0.05967591966440727,
                                                    0.06951970806773994,
                                                    0.036608956380170296],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167,
                                                    0.9347375159430679,
                                                    0.8642895289298118,
                                                    0.7525545858988472,
                                                    0.9066095451789402,
                                                    0.4849580835385126],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557,
                                               -0.09492334235123748,
                                               -0.07955619464075078,
                                               -0.09434548234612129,
                                               -0.07421695280613762,
                                               -0.09728363430060544],
 'IC': [0.02734841249253904,
        0.022572722047014094,
        0.026684936706207103,
        0.02664763367970717,
        0.026817068213703485,
        0.02397007256994346,
        0.025976119025929705],
 'ICIR': [0.21236024942574536,
          0.1709789532544127,
          0.19340628575351163,
          0.20007151364249662,
          0.19259407177488486,
          0.17317919939853219,
          0.19772653653050484],
 'Rank IC': [0.035975396383521215,
             0.032874066222441635,
             0.03798482714314599,
             0.039716791710446786,
             0.038525681522365414,
             0.033958569759792695,
             0.035890706881287766],
 'Rank ICIR': [0.2768152718838129,
               0.24486868869570597,
               0.2617583327848503,
               0.29471520276399354,
               0.2652645078116241,
               0.24470378820376362,
               0.2707421471174453],
 'mae': [0.8639875715380355,
         0.8641355173474249,
         0.8637491718650353,
         0.863803688204625,
         0.8637314001679426,
         0.8641202803551714,
         0.864028247883684],
 'mse': [0.997836837153924,
         0.9970882453499194,
         0.9969328092652393,
         0.9973319905581113,
         0.9968970210618471,
         0.9980745120409013,
         0.9979026326879935]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 20:57:55,291) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 20:57:58,625) INFO - qlib.workflow - [exp.py:258] - Experiment 125 starts running ...
[3925260:MainThread](2024-04-26 20:57:58,648) INFO - qlib.workflow - [recorder.py:341] - Recorder 04ed2ee0369f47a48dcf5c57c6fe79dd starts running under Experiment 125 ...
[3925260:MainThread](2024-04-26 20:58:04,058) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 20:58:04,058) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 20:58:04,059) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:58:48,415) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 20:59:13,051) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991919, valid -0.997549
[3925260:MainThread](2024-04-26 20:59:13,056) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 20:59:13,056) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 20:59:56,984) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:00:27,566) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990734, valid -0.997236
[3925260:MainThread](2024-04-26 21:00:27,570) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 21:00:27,571) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:01:22,399) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:01:51,447) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990060, valid -0.997464
[3925260:MainThread](2024-04-26 21:01:51,447) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 21:01:51,448) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:02:35,537) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:03:00,104) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990620, valid -0.998089
[3925260:MainThread](2024-04-26 21:03:00,105) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 21:03:00,105) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:03:43,924) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:04:08,358) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990269, valid -0.997214
[3925260:MainThread](2024-04-26 21:04:08,362) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 21:04:08,363) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:04:52,600) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:05:17,479) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989480, valid -0.997173
[3925260:MainThread](2024-04-26 21:05:17,483) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 21:05:17,484) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:06:01,156) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:06:25,930) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989141, valid -0.997830
[3925260:MainThread](2024-04-26 21:06:25,930) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 21:06:25,931) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:07:09,610) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:07:33,946) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989514, valid -0.998737
[3925260:MainThread](2024-04-26 21:07:33,947) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch8:
[3925260:MainThread](2024-04-26 21:07:33,947) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:08:17,531) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:08:42,264) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989021, valid -0.997185
[3925260:MainThread](2024-04-26 21:08:42,265) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch9:
[3925260:MainThread](2024-04-26 21:08:42,265) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:09:25,783) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:09:50,538) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989064, valid -0.996948
[3925260:MainThread](2024-04-26 21:09:50,543) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch10:
[3925260:MainThread](2024-04-26 21:09:50,543) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:10:33,948) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:10:58,402) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988836, valid -0.997203
[3925260:MainThread](2024-04-26 21:10:58,402) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch11:
[3925260:MainThread](2024-04-26 21:10:58,403) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:11:41,795) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:12:06,344) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988927, valid -0.998035
[3925260:MainThread](2024-04-26 21:12:06,345) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch12:
[3925260:MainThread](2024-04-26 21:12:06,345) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:12:47,475) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:12:57,043) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990098, valid -0.997804
[3925260:MainThread](2024-04-26 21:12:57,044) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch13:
[3925260:MainThread](2024-04-26 21:12:57,044) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:13:19,404) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:13:28,734) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988952, valid -0.997132
[3925260:MainThread](2024-04-26 21:13:28,735) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch14:
[3925260:MainThread](2024-04-26 21:13:28,735) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:13:50,967) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:14:00,142) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988952, valid -0.997352
[3925260:MainThread](2024-04-26 21:14:00,143) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 21:14:00,143) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.996948 @ 9
[3925260:MainThread](2024-04-26 21:14:00,498) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_50.
[3925260:MainThread](2024-04-26 21:14:00,779) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 21:14:00,805) INFO - qlib.workflow - [recorder.py:341] - Recorder c3ac0c8788ee49a8ba79f0a5737113b3 starts running under Experiment 118 ...
{'IC': 0.02432957604632545,
 'ICIR': 0.18784734107543133,
 'Rank IC': 0.03227040856322236,
 'Rank ICIR': 0.2465444111128172}
[3925260:MainThread](2024-04-26 21:14:09,894) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 21:14:45,649) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 21:14:45,652) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 21:14:51,805) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fdacc235f10>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:45,  9.18it/s]backtest loop:   1%|          | 9/971 [00:00<00:39, 24.62it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:25, 37.20it/s]backtest loop:   2%|▏         | 22/971 [00:00<00:22, 41.37it/s]backtest loop:   3%|▎         | 29/971 [00:00<00:20, 45.31it/s]backtest loop:   4%|▎         | 36/971 [00:00<00:18, 50.39it/s]backtest loop:   4%|▍         | 43/971 [00:01<00:17, 54.23it/s]backtest loop:   5%|▌         | 49/971 [00:01<00:17, 52.85it/s]backtest loop:   6%|▌         | 56/971 [00:01<00:16, 55.79it/s]backtest loop:   6%|▋         | 62/971 [00:01<00:16, 54.01it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:15, 56.71it/s]backtest loop:   8%|▊         | 76/971 [00:01<00:15, 58.54it/s]backtest loop:   8%|▊         | 82/971 [00:01<00:16, 55.45it/s]backtest loop:   9%|▉         | 89/971 [00:01<00:15, 57.72it/s]backtest loop:  10%|▉         | 96/971 [00:01<00:14, 59.54it/s]backtest loop:  11%|█         | 103/971 [00:02<00:15, 57.11it/s]backtest loop:  11%|█▏        | 110/971 [00:02<00:14, 58.83it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:15, 56.73it/s]backtest loop:  13%|█▎        | 124/971 [00:02<00:14, 58.60it/s]backtest loop:  13%|█▎        | 130/971 [00:02<00:15, 55.88it/s]backtest loop:  14%|█▍        | 136/971 [00:02<00:15, 54.69it/s]backtest loop:  15%|█▍        | 143/971 [00:02<00:14, 57.05it/s]backtest loop:  15%|█▌        | 150/971 [00:02<00:13, 58.75it/s]backtest loop:  16%|█▌        | 156/971 [00:02<00:14, 56.06it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:13, 58.05it/s]backtest loop:  18%|█▊        | 170/971 [00:03<00:13, 60.33it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:13, 58.12it/s]backtest loop:  19%|█▉        | 184/971 [00:03<00:13, 59.48it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:13, 56.49it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 58.21it/s]backtest loop:  21%|██        | 204/971 [00:03<00:12, 59.69it/s]backtest loop:  22%|██▏       | 210/971 [00:03<00:13, 56.96it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 54.82it/s]backtest loop:  23%|██▎       | 223/971 [00:04<00:13, 57.40it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:13, 55.79it/s]backtest loop:  24%|██▍       | 237/971 [00:04<00:12, 57.89it/s]backtest loop:  25%|██▌       | 244/971 [00:04<00:12, 59.31it/s]backtest loop:  26%|██▌       | 250/971 [00:04<00:12, 56.61it/s]backtest loop:  26%|██▋       | 257/971 [00:04<00:11, 59.55it/s]backtest loop:  27%|██▋       | 263/971 [00:05<00:18, 38.31it/s]backtest loop:  28%|██▊       | 268/971 [00:05<00:17, 39.99it/s]backtest loop:  28%|██▊       | 275/971 [00:05<00:15, 45.53it/s]backtest loop:  29%|██▉       | 281/971 [00:05<00:14, 46.65it/s]backtest loop:  30%|██▉       | 288/971 [00:05<00:13, 50.96it/s]backtest loop:  30%|███       | 295/971 [00:05<00:13, 51.59it/s]backtest loop:  31%|███       | 302/971 [00:05<00:12, 54.55it/s]backtest loop:  32%|███▏      | 309/971 [00:05<00:11, 56.94it/s]backtest loop:  32%|███▏      | 315/971 [00:05<00:11, 54.82it/s]backtest loop:  33%|███▎      | 322/971 [00:06<00:11, 57.06it/s]backtest loop:  34%|███▍      | 329/971 [00:06<00:10, 59.06it/s]backtest loop:  35%|███▍      | 335/971 [00:06<00:11, 56.21it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:10, 58.16it/s]backtest loop:  36%|███▌      | 349/971 [00:06<00:10, 59.77it/s]backtest loop:  37%|███▋      | 356/971 [00:06<00:10, 57.39it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 56.06it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 54.00it/s]backtest loop:  39%|███▊      | 376/971 [00:07<00:10, 56.44it/s]backtest loop:  39%|███▉      | 383/971 [00:07<00:10, 55.09it/s]backtest loop:  40%|████      | 390/971 [00:07<00:10, 57.25it/s]backtest loop:  41%|████      | 397/971 [00:07<00:09, 59.09it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 56.32it/s]backtest loop:  42%|████▏     | 410/971 [00:07<00:09, 58.37it/s]backtest loop:  43%|████▎     | 416/971 [00:07<00:09, 58.31it/s]backtest loop:  44%|████▎     | 423/971 [00:07<00:09, 56.34it/s]backtest loop:  44%|████▍     | 430/971 [00:07<00:09, 58.20it/s]backtest loop:  45%|████▌     | 437/971 [00:08<00:09, 56.27it/s]backtest loop:  46%|████▌     | 444/971 [00:08<00:09, 58.35it/s]backtest loop:  46%|████▋     | 451/971 [00:08<00:08, 59.69it/s]backtest loop:  47%|████▋     | 458/971 [00:08<00:08, 57.21it/s]backtest loop:  48%|████▊     | 464/971 [00:08<00:08, 57.61it/s]backtest loop:  49%|████▊     | 471/971 [00:08<00:08, 59.13it/s]backtest loop:  49%|████▉     | 477/971 [00:08<00:08, 56.43it/s]backtest loop:  50%|████▉     | 484/971 [00:08<00:08, 58.28it/s]backtest loop:  50%|█████     | 490/971 [00:09<00:08, 55.77it/s]backtest loop:  51%|█████     | 497/971 [00:09<00:08, 57.96it/s]backtest loop:  52%|█████▏    | 504/971 [00:09<00:07, 59.36it/s]backtest loop:  53%|█████▎    | 510/971 [00:09<00:08, 55.81it/s]backtest loop:  53%|█████▎    | 517/971 [00:09<00:08, 54.67it/s]backtest loop:  54%|█████▍    | 524/971 [00:09<00:07, 56.90it/s]backtest loop:  55%|█████▍    | 531/971 [00:09<00:07, 55.61it/s]backtest loop:  55%|█████▌    | 538/971 [00:09<00:07, 57.60it/s]backtest loop:  56%|█████▌    | 545/971 [00:09<00:07, 59.12it/s]backtest loop:  57%|█████▋    | 551/971 [00:10<00:07, 56.16it/s]backtest loop:  57%|█████▋    | 557/971 [00:10<00:07, 57.00it/s]backtest loop:  58%|█████▊    | 564/971 [00:10<00:06, 58.67it/s]backtest loop:  59%|█████▉    | 571/971 [00:10<00:07, 56.62it/s]backtest loop:  60%|█████▉    | 578/971 [00:10<00:06, 58.33it/s]backtest loop:  60%|██████    | 585/971 [00:10<00:06, 59.59it/s]backtest loop:  61%|██████    | 591/971 [00:10<00:06, 56.40it/s]backtest loop:  62%|██████▏   | 598/971 [00:10<00:06, 58.13it/s]backtest loop:  62%|██████▏   | 604/971 [00:10<00:06, 58.50it/s]backtest loop:  63%|██████▎   | 610/971 [00:11<00:06, 55.63it/s]backtest loop:  64%|██████▎   | 617/971 [00:11<00:06, 57.71it/s]backtest loop:  64%|██████▍   | 624/971 [00:11<00:05, 59.20it/s]backtest loop:  65%|██████▍   | 630/971 [00:11<00:06, 56.26it/s]backtest loop:  66%|██████▌   | 637/971 [00:11<00:05, 58.62it/s]backtest loop:  66%|██████▋   | 644/971 [00:11<00:05, 59.91it/s]backtest loop:  67%|██████▋   | 651/971 [00:11<00:05, 57.12it/s]backtest loop:  68%|██████▊   | 658/971 [00:11<00:05, 58.68it/s]backtest loop:  68%|██████▊   | 665/971 [00:12<00:05, 56.56it/s]backtest loop:  69%|██████▉   | 672/971 [00:12<00:05, 58.26it/s]backtest loop:  70%|██████▉   | 679/971 [00:12<00:05, 56.37it/s]backtest loop:  71%|███████   | 686/971 [00:12<00:04, 58.03it/s]backtest loop:  71%|███████▏  | 693/971 [00:12<00:04, 59.32it/s]backtest loop:  72%|███████▏  | 699/971 [00:12<00:04, 55.81it/s]backtest loop:  73%|███████▎  | 706/971 [00:12<00:04, 57.61it/s]backtest loop:  73%|███████▎  | 713/971 [00:12<00:04, 59.06it/s]backtest loop:  74%|███████▍  | 719/971 [00:12<00:04, 56.06it/s]backtest loop:  75%|███████▍  | 726/971 [00:13<00:04, 58.32it/s]backtest loop:  75%|███████▌  | 732/971 [00:13<00:04, 55.64it/s]backtest loop:  76%|███████▌  | 738/971 [00:13<00:04, 53.71it/s]backtest loop:  77%|███████▋  | 744/971 [00:13<00:04, 54.58it/s]backtest loop:  77%|███████▋  | 750/971 [00:13<00:04, 52.59it/s]backtest loop:  78%|███████▊  | 756/971 [00:13<00:03, 54.55it/s]backtest loop:  78%|███████▊  | 762/971 [00:13<00:03, 56.00it/s]backtest loop:  79%|███████▉  | 769/971 [00:13<00:03, 57.89it/s]backtest loop:  80%|███████▉  | 775/971 [00:13<00:03, 55.25it/s]backtest loop:  81%|████████  | 782/971 [00:14<00:03, 57.43it/s]backtest loop:  81%|████████  | 788/971 [00:14<00:03, 54.98it/s]backtest loop:  82%|████████▏ | 795/971 [00:14<00:03, 57.33it/s]backtest loop:  83%|████████▎ | 802/971 [00:14<00:02, 58.91it/s]backtest loop:  83%|████████▎ | 808/971 [00:14<00:02, 56.11it/s]backtest loop:  84%|████████▍ | 814/971 [00:14<00:02, 57.10it/s]backtest loop:  85%|████████▍ | 821/971 [00:14<00:02, 58.72it/s]backtest loop:  85%|████████▌ | 828/971 [00:14<00:02, 56.48it/s]backtest loop:  86%|████████▌ | 835/971 [00:15<00:02, 58.12it/s]backtest loop:  87%|████████▋ | 842/971 [00:15<00:02, 59.43it/s]backtest loop:  87%|████████▋ | 848/971 [00:15<00:02, 56.35it/s]backtest loop:  88%|████████▊ | 855/971 [00:15<00:01, 58.12it/s]backtest loop:  89%|████████▉ | 862/971 [00:15<00:01, 56.15it/s]backtest loop:  89%|████████▉ | 869/971 [00:15<00:01, 57.96it/s]backtest loop:  90%|█████████ | 876/971 [00:15<00:01, 59.35it/s]backtest loop:  91%|█████████ | 882/971 [00:15<00:01, 56.35it/s]backtest loop:  92%|█████████▏| 889/971 [00:15<00:01, 58.05it/s]backtest loop:  92%|█████████▏| 896/971 [00:16<00:01, 59.29it/s]backtest loop:  93%|█████████▎| 902/971 [00:16<00:01, 56.25it/s]backtest loop:  94%|█████████▎| 908/971 [00:16<00:01, 57.18it/s]backtest loop:  94%|█████████▍| 915/971 [00:16<00:00, 58.78it/s]backtest loop:  95%|█████████▍| 921/971 [00:16<00:00, 55.93it/s]backtest loop:  96%|█████████▌| 928/971 [00:16<00:00, 57.96it/s]backtest loop:  96%|█████████▋| 935/971 [00:16<00:00, 59.45it/s]backtest loop:  97%|█████████▋| 941/971 [00:16<00:00, 56.30it/s]backtest loop:  98%|█████████▊| 948/971 [00:16<00:00, 58.10it/s]backtest loop:  98%|█████████▊| 955/971 [00:17<00:00, 56.23it/s]backtest loop:  99%|█████████▉| 962/971 [00:17<00:00, 57.94it/s]backtest loop: 100%|█████████▉| 969/971 [00:17<00:00, 59.87it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 55.82it/s]
[3925260:MainThread](2024-04-26 21:15:09,260) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000335
std                0.004982
annualized_return  0.079810
information_ratio  1.038478
max_drawdown      -0.074846
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000140
std                0.004983
annualized_return  0.033234
information_ratio  0.432282
max_drawdown      -0.102417
[3925260:MainThread](2024-04-26 21:15:09,273) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 21:15:16,202) INFO - qlib.timer - [log.py:127] - Time cost: 0.011s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772,
                                                    0.07388724568850046,
                                                    0.06334240221765423,
                                                    0.05967591966440727,
                                                    0.06951970806773994,
                                                    0.036608956380170296,
                                                    0.03323431426334486],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167,
                                                    0.9347375159430679,
                                                    0.8642895289298118,
                                                    0.7525545858988472,
                                                    0.9066095451789402,
                                                    0.4849580835385126,
                                                    0.4322815474654364],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557,
                                               -0.09492334235123748,
                                               -0.07955619464075078,
                                               -0.09434548234612129,
                                               -0.07421695280613762,
                                               -0.09728363430060544,
                                               -0.1024171389574715],
 'IC': [0.02734841249253904,
        0.022572722047014094,
        0.026684936706207103,
        0.02664763367970717,
        0.026817068213703485,
        0.02397007256994346,
        0.025976119025929705,
        0.02432957604632545],
 'ICIR': [0.21236024942574536,
          0.1709789532544127,
          0.19340628575351163,
          0.20007151364249662,
          0.19259407177488486,
          0.17317919939853219,
          0.19772653653050484,
          0.18784734107543133],
 'Rank IC': [0.035975396383521215,
             0.032874066222441635,
             0.03798482714314599,
             0.039716791710446786,
             0.038525681522365414,
             0.033958569759792695,
             0.035890706881287766,
             0.03227040856322236],
 'Rank ICIR': [0.2768152718838129,
               0.24486868869570597,
               0.2617583327848503,
               0.29471520276399354,
               0.2652645078116241,
               0.24470378820376362,
               0.2707421471174453,
               0.2465444111128172],
 'mae': [0.8639875715380355,
         0.8641355173474249,
         0.8637491718650353,
         0.863803688204625,
         0.8637314001679426,
         0.8641202803551714,
         0.864028247883684,
         0.8641853522762293],
 'mse': [0.997836837153924,
         0.9970882453499194,
         0.9969328092652393,
         0.9973319905581113,
         0.9968970210618471,
         0.9980745120409013,
         0.9979026326879935,
         0.9981963689283235]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 21:15:19,541) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 21:15:22,857) INFO - qlib.workflow - [exp.py:258] - Experiment 126 starts running ...
[3925260:MainThread](2024-04-26 21:15:22,884) INFO - qlib.workflow - [recorder.py:341] - Recorder ab415bb8c94d41f59e69828851b9f117 starts running under Experiment 126 ...
[3925260:MainThread](2024-04-26 21:15:29,153) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 21:15:29,154) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 21:15:29,154) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:16:17,820) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:16:38,512) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991858, valid -0.997741
[3925260:MainThread](2024-04-26 21:16:38,516) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 21:16:38,516) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:17:27,729) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:17:48,273) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990671, valid -0.998790
[3925260:MainThread](2024-04-26 21:17:48,274) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 21:17:48,274) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:18:37,306) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:18:57,871) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990144, valid -0.998236
[3925260:MainThread](2024-04-26 21:18:57,872) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 21:18:57,873) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:19:46,613) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:20:06,999) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990061, valid -0.998297
[3925260:MainThread](2024-04-26 21:20:07,000) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 21:20:07,000) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:20:33,240) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:20:42,637) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990237, valid -0.998230
[3925260:MainThread](2024-04-26 21:20:42,638) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 21:20:42,638) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:21:05,558) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:21:14,756) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.989677, valid -0.998013
[3925260:MainThread](2024-04-26 21:21:14,756) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 21:21:14,757) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.997741 @ 0
[3925260:MainThread](2024-04-26 21:21:14,849) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_51.
[3925260:MainThread](2024-04-26 21:21:15,133) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 21:21:15,161) INFO - qlib.workflow - [recorder.py:341] - Recorder 63f79fcbf589410489b49b8ecdc3c723 starts running under Experiment 118 ...
{'IC': 0.02133756727805252,
 'ICIR': 0.14564948068328532,
 'Rank IC': 0.033161639307825896,
 'Rank ICIR': 0.22272480347302476}
[3925260:MainThread](2024-04-26 21:21:25,983) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 21:22:04,413) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 21:22:04,416) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 21:22:10,790) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fdacc663e80>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<03:23,  4.76it/s]backtest loop:   1%|          | 9/971 [00:00<01:05, 14.65it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:40, 23.46it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:32, 29.14it/s]backtest loop:   3%|▎         | 27/971 [00:01<00:26, 35.33it/s]backtest loop:   3%|▎         | 33/971 [00:01<00:23, 40.29it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:22, 41.07it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:20, 45.61it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 49.23it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 49.15it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:17, 51.67it/s]backtest loop:   7%|▋         | 70/971 [00:01<00:16, 54.76it/s]backtest loop:   8%|▊         | 76/971 [00:01<00:15, 56.12it/s]backtest loop:   8%|▊         | 82/971 [00:02<00:16, 53.72it/s]backtest loop:   9%|▉         | 88/971 [00:02<00:15, 55.43it/s]backtest loop:  10%|▉         | 94/971 [00:02<00:15, 56.69it/s]backtest loop:  10%|█         | 100/971 [00:02<00:15, 57.41it/s]backtest loop:  11%|█         | 107/971 [00:02<00:15, 55.55it/s]backtest loop:  12%|█▏        | 113/971 [00:02<00:15, 56.32it/s]backtest loop:  12%|█▏        | 119/971 [00:02<00:14, 57.26it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:15, 54.58it/s]backtest loop:  13%|█▎        | 131/971 [00:02<00:15, 52.88it/s]backtest loop:  14%|█▍        | 138/971 [00:03<00:14, 55.82it/s]backtest loop:  15%|█▍        | 145/971 [00:03<00:14, 57.95it/s]backtest loop:  16%|█▌        | 151/971 [00:03<00:14, 55.05it/s]backtest loop:  16%|█▌        | 157/971 [00:03<00:14, 56.06it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:23, 34.53it/s]backtest loop:  17%|█▋        | 169/971 [00:03<00:20, 39.40it/s]backtest loop:  18%|█▊        | 176/971 [00:04<00:18, 43.01it/s]backtest loop:  19%|█▉        | 183/971 [00:04<00:16, 47.71it/s]backtest loop:  20%|█▉        | 190/971 [00:04<00:15, 49.04it/s]backtest loop:  20%|██        | 197/971 [00:04<00:14, 52.50it/s]backtest loop:  21%|██        | 204/971 [00:04<00:13, 55.10it/s]backtest loop:  22%|██▏       | 210/971 [00:04<00:14, 53.40it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:14, 52.46it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:13, 54.29it/s]backtest loop:  23%|██▎       | 228/971 [00:04<00:13, 55.63it/s]backtest loop:  24%|██▍       | 234/971 [00:05<00:12, 56.72it/s]backtest loop:  25%|██▍       | 240/971 [00:05<00:13, 54.28it/s]backtest loop:  25%|██▌       | 247/971 [00:05<00:12, 56.68it/s]backtest loop:  26%|██▌       | 254/971 [00:05<00:12, 55.67it/s]backtest loop:  27%|██▋       | 261/971 [00:05<00:12, 57.56it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:12, 55.18it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:12, 56.38it/s]backtest loop:  29%|██▊       | 279/971 [00:05<00:12, 56.94it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:12, 55.18it/s]backtest loop:  30%|███       | 292/971 [00:06<00:12, 56.40it/s]backtest loop:  31%|███       | 299/971 [00:06<00:11, 58.29it/s]backtest loop:  31%|███▏      | 305/971 [00:06<00:12, 55.32it/s]backtest loop:  32%|███▏      | 311/971 [00:06<00:11, 56.49it/s]backtest loop:  33%|███▎      | 317/971 [00:06<00:11, 57.44it/s]backtest loop:  33%|███▎      | 324/971 [00:06<00:10, 58.84it/s]backtest loop:  34%|███▍      | 330/971 [00:06<00:11, 55.71it/s]backtest loop:  35%|███▍      | 336/971 [00:06<00:11, 56.87it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:11, 55.46it/s]backtest loop:  36%|███▌      | 348/971 [00:07<00:11, 55.32it/s]backtest loop:  36%|███▋      | 354/971 [00:07<00:11, 55.32it/s]backtest loop:  37%|███▋      | 360/971 [00:07<00:11, 51.95it/s]backtest loop:  38%|███▊      | 366/971 [00:07<00:11, 53.14it/s]backtest loop:  38%|███▊      | 372/971 [00:07<00:11, 50.31it/s]backtest loop:  39%|███▉      | 378/971 [00:07<00:12, 48.64it/s]backtest loop:  40%|███▉      | 384/971 [00:07<00:11, 50.28it/s]backtest loop:  40%|████      | 390/971 [00:07<00:11, 51.49it/s]backtest loop:  41%|████      | 396/971 [00:08<00:10, 52.52it/s]backtest loop:  41%|████▏     | 402/971 [00:08<00:10, 53.13it/s]backtest loop:  42%|████▏     | 408/971 [00:08<00:11, 50.10it/s]backtest loop:  43%|████▎     | 414/971 [00:08<00:10, 51.23it/s]backtest loop:  43%|████▎     | 420/971 [00:08<00:10, 52.11it/s]backtest loop:  44%|████▍     | 426/971 [00:08<00:10, 53.08it/s]backtest loop:  44%|████▍     | 432/971 [00:08<00:10, 50.27it/s]backtest loop:  45%|████▌     | 438/971 [00:08<00:10, 51.49it/s]backtest loop:  46%|████▌     | 444/971 [00:08<00:10, 52.37it/s]backtest loop:  46%|████▋     | 450/971 [00:09<00:09, 52.37it/s]backtest loop:  47%|████▋     | 456/971 [00:09<00:09, 52.89it/s]backtest loop:  48%|████▊     | 462/971 [00:09<00:10, 50.16it/s]backtest loop:  48%|████▊     | 468/971 [00:09<00:09, 51.39it/s]backtest loop:  49%|████▉     | 474/971 [00:09<00:09, 52.34it/s]backtest loop:  49%|████▉     | 480/971 [00:09<00:09, 53.10it/s]backtest loop:  50%|█████     | 486/971 [00:09<00:09, 53.43it/s]backtest loop:  51%|█████     | 492/971 [00:09<00:09, 50.51it/s]backtest loop:  51%|█████▏    | 498/971 [00:09<00:09, 51.71it/s]backtest loop:  52%|█████▏    | 504/971 [00:10<00:08, 52.71it/s]backtest loop:  53%|█████▎    | 510/971 [00:10<00:09, 49.84it/s]backtest loop:  53%|█████▎    | 516/971 [00:10<00:08, 51.13it/s]backtest loop:  54%|█████▍    | 522/971 [00:10<00:09, 49.17it/s]backtest loop:  54%|█████▍    | 528/971 [00:10<00:08, 50.69it/s]backtest loop:  55%|█████▍    | 534/971 [00:10<00:08, 52.13it/s]backtest loop:  56%|█████▌    | 540/971 [00:10<00:08, 53.10it/s]backtest loop:  56%|█████▌    | 546/971 [00:10<00:08, 50.32it/s]backtest loop:  57%|█████▋    | 552/971 [00:11<00:08, 51.45it/s]backtest loop:  57%|█████▋    | 558/971 [00:11<00:07, 52.36it/s]backtest loop:  58%|█████▊    | 564/971 [00:11<00:07, 53.27it/s]backtest loop:  59%|█████▊    | 570/971 [00:11<00:07, 53.68it/s]backtest loop:  59%|█████▉    | 576/971 [00:11<00:07, 50.70it/s]backtest loop:  60%|█████▉    | 582/971 [00:11<00:07, 52.03it/s]backtest loop:  61%|██████    | 588/971 [00:11<00:07, 52.88it/s]backtest loop:  61%|██████    | 594/971 [00:11<00:07, 53.39it/s]backtest loop:  62%|██████▏   | 600/971 [00:11<00:07, 50.45it/s]backtest loop:  62%|██████▏   | 606/971 [00:12<00:07, 51.65it/s]backtest loop:  63%|██████▎   | 612/971 [00:12<00:06, 52.50it/s]backtest loop:  64%|██████▎   | 618/971 [00:12<00:06, 53.02it/s]backtest loop:  64%|██████▍   | 624/971 [00:12<00:06, 53.53it/s]backtest loop:  65%|██████▍   | 630/971 [00:12<00:06, 50.74it/s]backtest loop:  65%|██████▌   | 636/971 [00:12<00:06, 51.98it/s]backtest loop:  66%|██████▌   | 642/971 [00:12<00:06, 52.76it/s]backtest loop:  67%|██████▋   | 648/971 [00:12<00:06, 53.35it/s]backtest loop:  67%|██████▋   | 654/971 [00:12<00:05, 53.72it/s]backtest loop:  68%|██████▊   | 660/971 [00:13<00:06, 50.72it/s]backtest loop:  69%|██████▊   | 666/971 [00:13<00:05, 51.85it/s]backtest loop:  69%|██████▉   | 672/971 [00:13<00:05, 52.67it/s]backtest loop:  70%|██████▉   | 678/971 [00:13<00:05, 53.33it/s]backtest loop:  70%|███████   | 684/971 [00:13<00:05, 50.25it/s]backtest loop:  71%|███████   | 690/971 [00:13<00:05, 51.48it/s]backtest loop:  72%|███████▏  | 696/971 [00:13<00:05, 52.40it/s]backtest loop:  72%|███████▏  | 702/971 [00:13<00:05, 53.13it/s]backtest loop:  73%|███████▎  | 708/971 [00:14<00:04, 53.54it/s]backtest loop:  74%|███████▎  | 714/971 [00:14<00:05, 50.63it/s]backtest loop:  74%|███████▍  | 720/971 [00:14<00:04, 51.88it/s]backtest loop:  75%|███████▍  | 726/971 [00:14<00:04, 52.91it/s]backtest loop:  75%|███████▌  | 732/971 [00:14<00:04, 50.27it/s]backtest loop:  76%|███████▌  | 738/971 [00:14<00:04, 48.50it/s]backtest loop:  77%|███████▋  | 744/971 [00:14<00:04, 50.10it/s]backtest loop:  77%|███████▋  | 750/971 [00:14<00:04, 48.36it/s]backtest loop:  78%|███████▊  | 756/971 [00:14<00:04, 50.05it/s]backtest loop:  78%|███████▊  | 762/971 [00:15<00:04, 51.37it/s]backtest loop:  79%|███████▉  | 768/971 [00:15<00:03, 52.27it/s]backtest loop:  80%|███████▉  | 774/971 [00:15<00:03, 52.94it/s]backtest loop:  80%|████████  | 780/971 [00:15<00:03, 50.24it/s]backtest loop:  81%|████████  | 786/971 [00:15<00:03, 51.47it/s]backtest loop:  82%|████████▏ | 792/971 [00:15<00:03, 52.30it/s]backtest loop:  82%|████████▏ | 798/971 [00:15<00:03, 49.78it/s]backtest loop:  83%|████████▎ | 804/971 [00:15<00:03, 51.14it/s]backtest loop:  83%|████████▎ | 810/971 [00:16<00:03, 52.05it/s]backtest loop:  84%|████████▍ | 816/971 [00:16<00:02, 52.79it/s]backtest loop:  85%|████████▍ | 822/971 [00:16<00:02, 53.26it/s]backtest loop:  85%|████████▌ | 828/971 [00:16<00:02, 50.34it/s]backtest loop:  86%|████████▌ | 834/971 [00:16<00:02, 51.51it/s]backtest loop:  87%|████████▋ | 840/971 [00:16<00:02, 52.35it/s]backtest loop:  87%|████████▋ | 846/971 [00:16<00:02, 53.03it/s]backtest loop:  88%|████████▊ | 852/971 [00:16<00:02, 50.28it/s]backtest loop:  88%|████████▊ | 858/971 [00:16<00:02, 51.47it/s]backtest loop:  89%|████████▉ | 864/971 [00:17<00:02, 52.35it/s]backtest loop:  90%|████████▉ | 870/971 [00:17<00:01, 52.96it/s]backtest loop:  90%|█████████ | 876/971 [00:17<00:01, 53.38it/s]backtest loop:  91%|█████████ | 882/971 [00:17<00:01, 50.56it/s]backtest loop:  91%|█████████▏| 888/971 [00:17<00:01, 51.68it/s]backtest loop:  92%|█████████▏| 894/971 [00:17<00:01, 52.52it/s]backtest loop:  93%|█████████▎| 900/971 [00:17<00:01, 53.15it/s]backtest loop:  93%|█████████▎| 906/971 [00:17<00:01, 53.57it/s]backtest loop:  94%|█████████▍| 912/971 [00:17<00:01, 50.66it/s]backtest loop:  95%|█████████▍| 918/971 [00:18<00:01, 51.74it/s]backtest loop:  95%|█████████▌| 924/971 [00:18<00:00, 52.55it/s]backtest loop:  96%|█████████▌| 930/971 [00:18<00:00, 53.49it/s]backtest loop:  96%|█████████▋| 936/971 [00:18<00:00, 50.52it/s]backtest loop:  97%|█████████▋| 942/971 [00:18<00:00, 51.63it/s]backtest loop:  98%|█████████▊| 948/971 [00:18<00:00, 52.57it/s]backtest loop:  98%|█████████▊| 954/971 [00:18<00:00, 53.10it/s]backtest loop:  99%|█████████▉| 960/971 [00:18<00:00, 50.30it/s]backtest loop:  99%|█████████▉| 966/971 [00:19<00:00, 51.47it/s]backtest loop: 100%|██████████| 971/971 [00:19<00:00, 50.81it/s]
[3925260:MainThread](2024-04-26 21:22:29,963) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000458
std                0.005200
annualized_return  0.108911
information_ratio  1.357734
max_drawdown      -0.061580
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000257
std                0.005200
annualized_return  0.061175
information_ratio  0.762542
max_drawdown      -0.073836
[3925260:MainThread](2024-04-26 21:22:29,977) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 21:22:36,882) INFO - qlib.timer - [log.py:127] - Time cost: 0.016s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772,
                                                    0.07388724568850046,
                                                    0.06334240221765423,
                                                    0.05967591966440727,
                                                    0.06951970806773994,
                                                    0.036608956380170296,
                                                    0.03323431426334486,
                                                    0.061175267248932144],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167,
                                                    0.9347375159430679,
                                                    0.8642895289298118,
                                                    0.7525545858988472,
                                                    0.9066095451789402,
                                                    0.4849580835385126,
                                                    0.4322815474654364,
                                                    0.7625417582242598],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557,
                                               -0.09492334235123748,
                                               -0.07955619464075078,
                                               -0.09434548234612129,
                                               -0.07421695280613762,
                                               -0.09728363430060544,
                                               -0.1024171389574715,
                                               -0.07383565991355379],
 'IC': [0.02734841249253904,
        0.022572722047014094,
        0.026684936706207103,
        0.02664763367970717,
        0.026817068213703485,
        0.02397007256994346,
        0.025976119025929705,
        0.02432957604632545,
        0.02133756727805252],
 'ICIR': [0.21236024942574536,
          0.1709789532544127,
          0.19340628575351163,
          0.20007151364249662,
          0.19259407177488486,
          0.17317919939853219,
          0.19772653653050484,
          0.18784734107543133,
          0.14564948068328532],
 'Rank IC': [0.035975396383521215,
             0.032874066222441635,
             0.03798482714314599,
             0.039716791710446786,
             0.038525681522365414,
             0.033958569759792695,
             0.035890706881287766,
             0.03227040856322236,
             0.033161639307825896],
 'Rank ICIR': [0.2768152718838129,
               0.24486868869570597,
               0.2617583327848503,
               0.29471520276399354,
               0.2652645078116241,
               0.24470378820376362,
               0.2707421471174453,
               0.2465444111128172,
               0.22272480347302476],
 'mae': [0.8639875715380355,
         0.8641355173474249,
         0.8637491718650353,
         0.863803688204625,
         0.8637314001679426,
         0.8641202803551714,
         0.864028247883684,
         0.8641853522762293,
         0.8641354879330385],
 'mse': [0.997836837153924,
         0.9970882453499194,
         0.9969328092652393,
         0.9973319905581113,
         0.9968970210618471,
         0.9980745120409013,
         0.9979026326879935,
         0.9981963689283235,
         0.9977746267226862]}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3925260:MainThread](2024-04-26 21:22:43,324) INFO - qlib.TransformerModel - [pytorch_localformer.py:64] - Naive Transformer:
batch_size : 2048
device : cuda:0
[3925260:MainThread](2024-04-26 21:22:46,490) INFO - qlib.workflow - [exp.py:258] - Experiment 127 starts running ...
[3925260:MainThread](2024-04-26 21:22:46,507) INFO - qlib.workflow - [recorder.py:341] - Recorder 9d85f19f493143a9a22a338aa3bdb0b1 starts running under Experiment 127 ...
[3925260:MainThread](2024-04-26 21:22:57,597) INFO - qlib.TransformerModel - [pytorch_localformer.py:184] - training...
[3925260:MainThread](2024-04-26 21:22:57,597) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch0:
[3925260:MainThread](2024-04-26 21:22:57,598) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:23:42,634) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:24:06,857) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.991285, valid -0.997757
[3925260:MainThread](2024-04-26 21:24:06,865) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch1:
[3925260:MainThread](2024-04-26 21:24:06,866) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:24:51,019) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:25:15,449) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990553, valid -0.997596
[3925260:MainThread](2024-04-26 21:25:15,454) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch2:
[3925260:MainThread](2024-04-26 21:25:15,454) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:25:59,737) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:26:24,230) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990564, valid -0.996689
[3925260:MainThread](2024-04-26 21:26:24,234) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch3:
[3925260:MainThread](2024-04-26 21:26:24,235) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:27:08,591) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:27:33,320) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990271, valid -0.998890
[3925260:MainThread](2024-04-26 21:27:33,321) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch4:
[3925260:MainThread](2024-04-26 21:27:33,321) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:28:17,507) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:28:42,494) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990456, valid -0.998426
[3925260:MainThread](2024-04-26 21:28:42,495) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch5:
[3925260:MainThread](2024-04-26 21:28:42,495) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:29:25,742) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:29:38,278) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990232, valid -0.999211
[3925260:MainThread](2024-04-26 21:29:38,279) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch6:
[3925260:MainThread](2024-04-26 21:29:38,279) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:30:00,850) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:30:10,275) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.990556, valid -0.998913
[3925260:MainThread](2024-04-26 21:30:10,276) INFO - qlib.TransformerModel - [pytorch_localformer.py:188] - Epoch7:
[3925260:MainThread](2024-04-26 21:30:10,276) INFO - qlib.TransformerModel - [pytorch_localformer.py:189] - training...
[3925260:MainThread](2024-04-26 21:30:32,673) INFO - qlib.TransformerModel - [pytorch_localformer.py:191] - evaluating...
[3925260:MainThread](2024-04-26 21:30:41,902) INFO - qlib.TransformerModel - [pytorch_localformer.py:194] - train -0.988925, valid -0.997382
[3925260:MainThread](2024-04-26 21:30:41,902) INFO - qlib.TransformerModel - [pytorch_localformer.py:206] - early stop
[3925260:MainThread](2024-04-26 21:30:41,903) INFO - qlib.TransformerModel - [pytorch_localformer.py:209] - best score: -0.996689 @ 2
[3925260:MainThread](2024-04-26 21:30:41,987) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Localformer_crowd_data_csi300_360_rankTrue_52.
[3925260:MainThread](2024-04-26 21:30:42,408) INFO - qlib.workflow - [exp.py:258] - Experiment 118 starts running ...
[3925260:MainThread](2024-04-26 21:30:42,436) INFO - qlib.workflow - [recorder.py:341] - Recorder 5957a31a6e9f4968acdda79a7d88b7dd starts running under Experiment 118 ...
{'IC': 0.024281152011874262,
 'ICIR': 0.1806261273245506,
 'Rank IC': 0.03506864094131861,
 'Rank ICIR': 0.25203502063011096}
[3925260:MainThread](2024-04-26 21:30:53,466) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[3925260:MainThread](2024-04-26 21:31:29,892) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 21:31:29,895) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[3925260:MainThread](2024-04-26 21:31:36,208) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fda16c6ae80>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<03:07,  5.16it/s]backtest loop:   1%|          | 9/971 [00:00<01:00, 15.97it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:35, 27.16it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:29, 31.88it/s]backtest loop:   3%|▎         | 28/971 [00:01<00:23, 40.13it/s]backtest loop:   4%|▎         | 34/971 [00:01<00:21, 42.91it/s]backtest loop:   4%|▍         | 41/971 [00:01<00:19, 48.45it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:17, 52.57it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 51.72it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:16, 54.97it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:16, 53.49it/s]backtest loop:   8%|▊         | 74/971 [00:01<00:15, 56.18it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:15, 58.21it/s]backtest loop:   9%|▉         | 87/971 [00:02<00:15, 55.39it/s]backtest loop:  10%|▉         | 94/971 [00:02<00:15, 57.63it/s]backtest loop:  10%|█         | 101/971 [00:02<00:14, 59.12it/s]backtest loop:  11%|█         | 107/971 [00:02<00:15, 56.28it/s]backtest loop:  12%|█▏        | 114/971 [00:02<00:14, 58.17it/s]backtest loop:  12%|█▏        | 121/971 [00:02<00:14, 59.61it/s]backtest loop:  13%|█▎        | 127/971 [00:03<00:25, 33.22it/s]backtest loop:  14%|█▍        | 134/971 [00:03<00:21, 38.99it/s]backtest loop:  15%|█▍        | 141/971 [00:03<00:19, 42.39it/s]backtest loop:  15%|█▌        | 148/971 [00:03<00:17, 47.19it/s]backtest loop:  16%|█▌        | 155/971 [00:03<00:15, 51.13it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:15, 50.69it/s]backtest loop:  17%|█▋        | 168/971 [00:03<00:14, 53.84it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:14, 56.48it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:14, 54.30it/s]backtest loop:  19%|█▉        | 188/971 [00:04<00:13, 56.73it/s]backtest loop:  20%|██        | 195/971 [00:04<00:14, 55.28it/s]backtest loop:  21%|██        | 202/971 [00:04<00:13, 57.46it/s]backtest loop:  22%|██▏       | 209/971 [00:04<00:12, 59.13it/s]backtest loop:  22%|██▏       | 215/971 [00:04<00:14, 53.67it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:13, 56.35it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:12, 58.07it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:13, 55.25it/s]backtest loop:  25%|██▍       | 241/971 [00:04<00:12, 56.34it/s]backtest loop:  25%|██▌       | 247/971 [00:05<00:12, 57.30it/s]backtest loop:  26%|██▌       | 254/971 [00:05<00:12, 56.35it/s]backtest loop:  27%|██▋       | 260/971 [00:05<00:12, 57.29it/s]backtest loop:  27%|██▋       | 266/971 [00:05<00:12, 54.47it/s]backtest loop:  28%|██▊       | 272/971 [00:05<00:12, 55.78it/s]backtest loop:  29%|██▊       | 278/971 [00:05<00:12, 56.64it/s]backtest loop:  29%|██▉       | 284/971 [00:05<00:11, 57.32it/s]backtest loop:  30%|██▉       | 290/971 [00:05<00:11, 57.93it/s]backtest loop:  30%|███       | 296/971 [00:05<00:12, 55.04it/s]backtest loop:  31%|███       | 303/971 [00:06<00:11, 57.47it/s]backtest loop:  32%|███▏      | 310/971 [00:06<00:11, 55.39it/s]backtest loop:  33%|███▎      | 316/971 [00:06<00:11, 56.42it/s]backtest loop:  33%|███▎      | 323/971 [00:06<00:11, 58.23it/s]backtest loop:  34%|███▍      | 330/971 [00:06<00:11, 56.23it/s]backtest loop:  35%|███▍      | 336/971 [00:06<00:11, 57.14it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:10, 57.87it/s]backtest loop:  36%|███▌      | 349/971 [00:06<00:10, 59.23it/s]backtest loop:  37%|███▋      | 355/971 [00:07<00:11, 55.75it/s]backtest loop:  37%|███▋      | 362/971 [00:07<00:10, 57.92it/s]backtest loop:  38%|███▊      | 368/971 [00:07<00:11, 52.16it/s]backtest loop:  39%|███▊      | 375/971 [00:07<00:10, 54.93it/s]backtest loop:  39%|███▉      | 381/971 [00:07<00:10, 56.14it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:10, 57.02it/s]backtest loop:  40%|████      | 393/971 [00:07<00:10, 54.43it/s]backtest loop:  41%|████      | 400/971 [00:07<00:10, 56.81it/s]backtest loop:  42%|████▏     | 407/971 [00:07<00:09, 59.02it/s]backtest loop:  43%|████▎     | 413/971 [00:08<00:09, 55.85it/s]backtest loop:  43%|████▎     | 419/971 [00:08<00:09, 56.92it/s]backtest loop:  44%|████▍     | 425/971 [00:08<00:09, 57.52it/s]backtest loop:  44%|████▍     | 431/971 [00:08<00:09, 58.16it/s]backtest loop:  45%|████▌     | 437/971 [00:08<00:09, 55.12it/s]backtest loop:  46%|████▌     | 443/971 [00:08<00:09, 56.41it/s]backtest loop:  46%|████▌     | 449/971 [00:08<00:09, 57.25it/s]backtest loop:  47%|████▋     | 456/971 [00:08<00:08, 58.92it/s]backtest loop:  48%|████▊     | 462/971 [00:08<00:09, 55.27it/s]backtest loop:  48%|████▊     | 468/971 [00:09<00:08, 56.46it/s]backtest loop:  49%|████▉     | 474/971 [00:09<00:08, 56.90it/s]backtest loop:  49%|████▉     | 480/971 [00:09<00:08, 57.53it/s]backtest loop:  50%|█████     | 486/971 [00:09<00:08, 57.57it/s]backtest loop:  51%|█████     | 492/971 [00:09<00:08, 54.23it/s]backtest loop:  51%|█████▏    | 498/971 [00:09<00:08, 55.83it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:08, 54.58it/s]backtest loop:  53%|█████▎    | 511/971 [00:09<00:08, 55.44it/s]backtest loop:  53%|█████▎    | 517/971 [00:09<00:08, 51.27it/s]backtest loop:  54%|█████▍    | 523/971 [00:10<00:08, 52.93it/s]backtest loop:  54%|█████▍    | 529/971 [00:10<00:08, 54.58it/s]backtest loop:  55%|█████▌    | 536/971 [00:10<00:08, 54.00it/s]backtest loop:  56%|█████▌    | 542/971 [00:10<00:07, 55.53it/s]backtest loop:  56%|█████▋    | 548/971 [00:10<00:07, 56.66it/s]backtest loop:  57%|█████▋    | 554/971 [00:10<00:07, 57.43it/s]backtest loop:  58%|█████▊    | 560/971 [00:10<00:07, 57.99it/s]backtest loop:  58%|█████▊    | 566/971 [00:10<00:07, 54.34it/s]backtest loop:  59%|█████▉    | 572/971 [00:10<00:07, 55.73it/s]backtest loop:  60%|█████▉    | 579/971 [00:10<00:06, 58.51it/s]backtest loop:  60%|██████    | 586/971 [00:11<00:06, 56.36it/s]backtest loop:  61%|██████    | 592/971 [00:11<00:06, 57.31it/s]backtest loop:  62%|██████▏   | 599/971 [00:11<00:06, 58.76it/s]backtest loop:  62%|██████▏   | 605/971 [00:11<00:06, 55.46it/s]backtest loop:  63%|██████▎   | 611/971 [00:11<00:06, 56.28it/s]backtest loop:  64%|██████▎   | 617/971 [00:11<00:06, 57.07it/s]backtest loop:  64%|██████▍   | 623/971 [00:11<00:06, 57.85it/s]backtest loop:  65%|██████▍   | 630/971 [00:11<00:06, 55.83it/s]backtest loop:  66%|██████▌   | 637/971 [00:12<00:05, 58.08it/s]backtest loop:  66%|██████▋   | 644/971 [00:12<00:05, 59.40it/s]backtest loop:  67%|██████▋   | 650/971 [00:12<00:05, 56.42it/s]backtest loop:  68%|██████▊   | 657/971 [00:12<00:05, 58.25it/s]backtest loop:  68%|██████▊   | 663/971 [00:12<00:05, 58.50it/s]backtest loop:  69%|██████▉   | 670/971 [00:12<00:05, 56.38it/s]backtest loop:  70%|██████▉   | 677/971 [00:12<00:05, 58.30it/s]backtest loop:  70%|███████   | 683/971 [00:12<00:04, 58.65it/s]backtest loop:  71%|███████   | 689/971 [00:12<00:05, 55.80it/s]backtest loop:  72%|███████▏  | 696/971 [00:13<00:04, 57.86it/s]backtest loop:  72%|███████▏  | 703/971 [00:13<00:04, 59.37it/s]backtest loop:  73%|███████▎  | 709/971 [00:13<00:04, 55.80it/s]backtest loop:  74%|███████▎  | 716/971 [00:13<00:04, 57.79it/s]backtest loop:  74%|███████▍  | 723/971 [00:13<00:04, 59.28it/s]backtest loop:  75%|███████▌  | 729/971 [00:13<00:04, 56.43it/s]backtest loop:  76%|███████▌  | 735/971 [00:13<00:04, 54.47it/s]backtest loop:  76%|███████▋  | 742/971 [00:13<00:04, 56.82it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 54.64it/s]backtest loop:  78%|███████▊  | 754/971 [00:14<00:03, 55.29it/s]backtest loop:  78%|███████▊  | 760/971 [00:14<00:03, 53.43it/s]backtest loop:  79%|███████▉  | 767/971 [00:14<00:03, 56.07it/s]backtest loop:  80%|███████▉  | 773/971 [00:14<00:03, 57.13it/s]backtest loop:  80%|████████  | 780/971 [00:14<00:03, 55.47it/s]backtest loop:  81%|████████  | 787/971 [00:14<00:03, 58.08it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 55.39it/s]backtest loop:  82%|████████▏ | 799/971 [00:14<00:03, 56.60it/s]backtest loop:  83%|████████▎ | 806/971 [00:14<00:02, 58.51it/s]backtest loop:  84%|████████▎ | 813/971 [00:15<00:02, 56.35it/s]backtest loop:  84%|████████▍ | 820/971 [00:15<00:02, 58.10it/s]backtest loop:  85%|████████▌ | 827/971 [00:15<00:02, 59.40it/s]backtest loop:  86%|████████▌ | 833/971 [00:15<00:02, 56.40it/s]backtest loop:  87%|████████▋ | 840/971 [00:15<00:02, 58.08it/s]backtest loop:  87%|████████▋ | 847/971 [00:15<00:02, 59.38it/s]backtest loop:  88%|████████▊ | 853/971 [00:15<00:02, 56.22it/s]backtest loop:  89%|████████▊ | 860/971 [00:15<00:01, 58.03it/s]backtest loop:  89%|████████▉ | 867/971 [00:16<00:01, 56.14it/s]backtest loop:  90%|█████████ | 874/971 [00:16<00:01, 58.03it/s]backtest loop:  91%|█████████ | 881/971 [00:16<00:01, 59.33it/s]backtest loop:  91%|█████████▏| 887/971 [00:16<00:01, 56.30it/s]backtest loop:  92%|█████████▏| 894/971 [00:16<00:01, 58.08it/s]backtest loop:  93%|█████████▎| 901/971 [00:16<00:01, 59.40it/s]backtest loop:  93%|█████████▎| 907/971 [00:16<00:01, 56.27it/s]backtest loop:  94%|█████████▍| 914/971 [00:16<00:00, 58.12it/s]backtest loop:  95%|█████████▍| 921/971 [00:16<00:00, 56.15it/s]backtest loop:  96%|█████████▌| 928/971 [00:17<00:00, 57.98it/s]backtest loop:  96%|█████████▋| 935/971 [00:17<00:00, 59.37it/s]backtest loop:  97%|█████████▋| 941/971 [00:17<00:00, 56.29it/s]backtest loop:  98%|█████████▊| 948/971 [00:17<00:00, 58.17it/s]backtest loop:  98%|█████████▊| 954/971 [00:17<00:00, 58.54it/s]backtest loop:  99%|█████████▉| 960/971 [00:17<00:00, 55.20it/s]backtest loop:  99%|█████████▉| 966/971 [00:17<00:00, 56.40it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.38it/s]
[3925260:MainThread](2024-04-26 21:31:54,126) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000328
std                0.004844
annualized_return  0.077978
information_ratio  1.043552
max_drawdown      -0.098166
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000132
std                0.004846
annualized_return  0.031482
information_ratio  0.421089
max_drawdown      -0.130025
[3925260:MainThread](2024-04-26 21:31:54,140) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 118
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LocalformerModel', 'module_path': 'qlib.contrib.model.pytorch_localformer', 'kwargs': {'d_feat': 6, 'seed': None}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
Your evaluation results can be found in the experiment named `Localformer_crowd_data_csi300_360_rankTrue`.
[3925260:MainThread](2024-04-26 21:32:01,121) INFO - qlib.timer - [log.py:127] - Time cost: 0.012s | waiting `async_log` Done
{'1day.excess_return_with_cost.annualized_return': [0.05540546946419471,
                                                    0.03173722454248772,
                                                    0.07388724568850046,
                                                    0.06334240221765423,
                                                    0.05967591966440727,
                                                    0.06951970806773994,
                                                    0.036608956380170296,
                                                    0.03323431426334486,
                                                    0.061175267248932144,
                                                    0.03148203562901194],
 '1day.excess_return_with_cost.information_ratio': [0.7274978943131915,
                                                    0.43156063546417167,
                                                    0.9347375159430679,
                                                    0.8642895289298118,
                                                    0.7525545858988472,
                                                    0.9066095451789402,
                                                    0.4849580835385126,
                                                    0.4322815474654364,
                                                    0.7625417582242598,
                                                    0.4210888655817349],
 '1day.excess_return_with_cost.max_drawdown': [-0.08923121114758757,
                                               -0.10984311387265557,
                                               -0.09492334235123748,
                                               -0.07955619464075078,
                                               -0.09434548234612129,
                                               -0.07421695280613762,
                                               -0.09728363430060544,
                                               -0.1024171389574715,
                                               -0.07383565991355379,
                                               -0.13002491800066762],
 'IC': [0.02734841249253904,
        0.022572722047014094,
        0.026684936706207103,
        0.02664763367970717,
        0.026817068213703485,
        0.02397007256994346,
        0.025976119025929705,
        0.02432957604632545,
        0.02133756727805252,
        0.024281152011874262],
 'ICIR': [0.21236024942574536,
          0.1709789532544127,
          0.19340628575351163,
          0.20007151364249662,
          0.19259407177488486,
          0.17317919939853219,
          0.19772653653050484,
          0.18784734107543133,
          0.14564948068328532,
          0.1806261273245506],
 'Rank IC': [0.035975396383521215,
             0.032874066222441635,
             0.03798482714314599,
             0.039716791710446786,
             0.038525681522365414,
             0.033958569759792695,
             0.035890706881287766,
             0.03227040856322236,
             0.033161639307825896,
             0.03506864094131861],
 'Rank ICIR': [0.2768152718838129,
               0.24486868869570597,
               0.2617583327848503,
               0.29471520276399354,
               0.2652645078116241,
               0.24470378820376362,
               0.2707421471174453,
               0.2465444111128172,
               0.22272480347302476,
               0.25203502063011096],
 'mae': [0.8639875715380355,
         0.8641355173474249,
         0.8637491718650353,
         0.863803688204625,
         0.8637314001679426,
         0.8641202803551714,
         0.864028247883684,
         0.8641853522762293,
         0.8641354879330385,
         0.8640491167664569],
 'mse': [0.997836837153924,
         0.9970882453499194,
         0.9969328092652393,
         0.9973319905581113,
         0.9968970210618471,
         0.9980745120409013,
         0.9979026326879935,
         0.9981963689283235,
         0.9977746267226862,
         0.997042966663123]}
[3925260:MainThread](2024-04-26 21:32:01,408) INFO - qlib.workflow - [exp.py:258] - Experiment 128 starts running ...
[3925260:MainThread](2024-04-26 21:32:01,430) INFO - qlib.workflow - [recorder.py:341] - Recorder b8bafae331dc4fe0b93c58a93ca50d15 starts running under Experiment 128 ...
Time cost: 768.7937678098679
{'1day.excess_return_with_cost.annualized_return': [0.05160685431664436,
                                                    0.015774665630344353],
 '1day.excess_return_with_cost.information_ratio': [0.6718119960537975,
                                                    0.19799785817318652],
 '1day.excess_return_with_cost.max_drawdown': [-0.09456776483367887,
                                               0.016301877911587114],
 'IC': [0.02499652600712963, 0.0019145554879404967],
 'ICIR': [0.18544397588633554, 0.01782157537135867],
 'Rank IC': [0.035542672843536835, 0.0024254213739153276],
 'Rank ICIR': [0.25801721744771483, 0.01921366604331427],
 'mae': [0.8639925834337644, 0.000161851326058661],
 'mse': [0.9975078010432069, 0.00047511207710811435]}
[3925260:MainThread](2024-04-26 21:32:02,477) INFO - qlib.timer - [log.py:127] - Time cost: 0.045s | waiting `async_log` Done
