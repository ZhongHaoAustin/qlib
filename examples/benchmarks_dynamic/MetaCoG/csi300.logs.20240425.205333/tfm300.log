[3431995:MainThread](2024-04-25 20:57:50,471) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[3431995:MainThread](2024-04-25 20:57:50,473) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[3431995:MainThread](2024-04-25 20:57:50,474) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Remove CSRankNorm
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSZScoreNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
[3431995:MainThread](2024-04-25 20:57:57,233) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-02 00:00:00'), Timestamp('2008-01-29 00:00:00')), 'test': (Timestamp('2008-01-31 00:00:00'), Timestamp('2008-03-05 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/147 [00:00<?, ?it/s]creating meta tasks:  26%|██▌       | 38/147 [00:00<00:00, 376.24it/s]creating meta tasks:  53%|█████▎    | 78/147 [00:00<00:00, 389.64it/s]creating meta tasks:  82%|████████▏ | 120/147 [00:00<00:00, 401.66it/s]creating meta tasks: 100%|██████████| 147/147 [00:00<00:00, 400.95it/s]
[3431995:MainThread](2024-04-25 20:57:57,866) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2019-01-02 00:00:00'), Timestamp('2019-01-29 00:00:00')), 'test': (Timestamp('2019-01-31 00:00:00'), Timestamp('2019-03-06 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/63 [00:00<?, ?it/s]creating meta tasks:  68%|██████▊   | 43/63 [00:00<00:00, 425.33it/s]creating meta tasks: 100%|██████████| 63/63 [00:00<00:00, 423.88it/s]
Traceback (most recent call last):
  File "/home/zhonghao/sjtu/qlib/examples/benchmarks_dynamic/incremental/main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
Remove CSRankNorm
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': datetime.date(2008, 1, 1), 'end_time': datetime.date(2020, 8, 1), 'fit_start_time': datetime.date(2008, 1, 1), 'fit_end_time': datetime.date(2014, 12, 31), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSZScoreNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': [datetime.date(2008, 1, 1), datetime.date(2014, 12, 31)], 'valid': [datetime.date(2015, 1, 1), datetime.date(2016, 12, 31)], 'test': [datetime.date(2017, 1, 1), datetime.date(2020, 8, 1)]}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

[3431995:MainThread](2024-04-25 20:57:59,030) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
[3431995:MainThread](2024-04-25 20:58:04,259) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name Transformer_crowd_data_csi300_360_rankFalse_43.
[3431995:MainThread](2024-04-25 20:58:04,386) INFO - qlib.workflow - [exp.py:258] - Experiment 115 starts running ...
[3431995:MainThread](2024-04-25 20:58:05,995) INFO - qlib.workflow - [recorder.py:341] - Recorder 07d1f0e3030346618ccd60f929022408 starts running under Experiment 115 ...
[3431995:MainThread](2024-04-25 20:58:15,673) INFO - qlib.TransformerModel - [pytorch_transformer.py:212] - training...
[3431995:MainThread](2024-04-25 20:58:15,674) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch0:
[3431995:MainThread](2024-04-25 20:58:15,675) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:58:21,916) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:58:22,383) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997004
[3431995:MainThread](2024-04-25 20:58:22,387) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch1:
[3431995:MainThread](2024-04-25 20:58:22,387) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:58:27,017) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:58:27,485) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.996080
[3431995:MainThread](2024-04-25 20:58:27,488) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch2:
[3431995:MainThread](2024-04-25 20:58:27,488) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:58:31,868) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:58:32,335) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.995911
[3431995:MainThread](2024-04-25 20:58:32,338) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch3:
[3431995:MainThread](2024-04-25 20:58:32,339) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:58:36,726) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:58:37,191) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.997020
[3431995:MainThread](2024-04-25 20:58:37,192) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch4:
[3431995:MainThread](2024-04-25 20:58:37,192) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:58:41,604) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:58:42,072) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.996848
[3431995:MainThread](2024-04-25 20:58:42,072) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch5:
[3431995:MainThread](2024-04-25 20:58:42,073) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:58:46,475) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:58:46,941) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.995257
[3431995:MainThread](2024-04-25 20:58:46,944) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch6:
[3431995:MainThread](2024-04-25 20:58:46,945) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:58:51,327) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:58:51,792) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.995800
[3431995:MainThread](2024-04-25 20:58:51,792) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch7:
[3431995:MainThread](2024-04-25 20:58:51,793) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:58:56,202) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:58:56,669) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.996028
[3431995:MainThread](2024-04-25 20:58:56,669) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch8:
[3431995:MainThread](2024-04-25 20:58:56,669) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:59:01,131) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:59:01,597) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.994897
[3431995:MainThread](2024-04-25 20:59:01,601) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch9:
[3431995:MainThread](2024-04-25 20:59:01,601) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:59:06,053) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:59:06,517) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.994593
[3431995:MainThread](2024-04-25 20:59:06,520) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch10:
[3431995:MainThread](2024-04-25 20:59:06,520) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:59:10,931) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:59:11,398) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.993839
[3431995:MainThread](2024-04-25 20:59:11,401) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch11:
[3431995:MainThread](2024-04-25 20:59:11,402) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:59:15,846) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:59:16,311) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.994090
[3431995:MainThread](2024-04-25 20:59:16,312) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch12:
[3431995:MainThread](2024-04-25 20:59:16,312) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:59:20,703) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:59:21,169) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.995458
[3431995:MainThread](2024-04-25 20:59:21,169) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch13:
[3431995:MainThread](2024-04-25 20:59:21,169) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:59:25,560) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:59:26,026) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.995163
[3431995:MainThread](2024-04-25 20:59:26,026) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch14:
[3431995:MainThread](2024-04-25 20:59:26,027) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:59:30,436) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:59:30,903) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.994310
[3431995:MainThread](2024-04-25 20:59:30,903) INFO - qlib.TransformerModel - [pytorch_transformer.py:216] - Epoch15:
[3431995:MainThread](2024-04-25 20:59:30,904) INFO - qlib.TransformerModel - [pytorch_transformer.py:217] - training...
[3431995:MainThread](2024-04-25 20:59:35,308) INFO - qlib.TransformerModel - [pytorch_transformer.py:219] - evaluating...
[3431995:MainThread](2024-04-25 20:59:35,773) INFO - qlib.TransformerModel - [pytorch_transformer.py:222] - valid -0.994231
[3431995:MainThread](2024-04-25 20:59:35,774) INFO - qlib.TransformerModel - [pytorch_transformer.py:234] - early stop
[3431995:MainThread](2024-04-25 20:59:35,774) INFO - qlib.TransformerModel - [pytorch_transformer.py:237] - best score: -0.993839 @ 10
[3431995:MainThread](2024-04-25 20:59:36,008) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
Save pretrained model to Transformer_crowd_data_csi300_360_rankFalse_43.
[3431995:MainThread](2024-04-25 20:59:36,284) ERROR - qlib.workflow - [utils.py:41] - An exception has been raised[AttributeError: 'CML' object has no attribute 'is_rnn'].
  File "main.py", line 62, in <module>
    fire.Fire(CML)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/fire/core.py", line 143, in Fire
    component_trace = _Fire(component, args, parsed_flag_args, context, name)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/fire/core.py", line 477, in _Fire
    component, remaining_args = _CallAndUpdateTrace(
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/fire/core.py", line 693, in _CallAndUpdateTrace
    component = fn(*varargs, **kwargs)
  File "/home/zhonghao/sjtu/qlib/examples/benchmarks_dynamic/incremental/main.py", line 490, in run_all
    mm = self.offline_training(seed=43 + i)
  File "main.py", line 40, in offline_training
    is_rnn=self.is_rnn,
AttributeError: 'CML' object has no attribute 'is_rnn'
