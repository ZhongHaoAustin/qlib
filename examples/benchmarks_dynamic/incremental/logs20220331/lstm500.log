['main.py', 'run_all', '--forecast_model', 'LSTM', '-num_head', '8', '--train_start=2008-01-01', '--train_end=2019-12-31', '--valid_start=2020-01-01', '--valid_end=2022-03-31', '--test_start=2022-04-01', '--test_end=2024-03-31', '--tau', '10', '--lr_da', '0.01', '--market', 'csi500', '--data_dir', 'crowd_data', '--rank_label', 'False', '--begin_valid_epoch', '20']
[2258322:MainThread](2024-04-23 02:20:19,564) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[2258322:MainThread](2024-04-23 02:20:19,567) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[2258322:MainThread](2024-04-23 02:20:19,567) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Remove CSRankNorm
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2019-12-31 00:00:00'), 'instruments': 'csi500', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSZScoreNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2019-12-31 00:00:00')), 'valid': (Timestamp('2020-01-01 00:00:00'), Timestamp('2022-03-31 00:00:00')), 'test': (Timestamp('2022-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
[2258322:MainThread](2024-04-23 02:20:30,308) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-02 00:00:00'), Timestamp('2008-01-29 00:00:00')), 'test': (Timestamp('2008-01-31 00:00:00'), Timestamp('2008-03-05 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/172 [00:00<?, ?it/s]creating meta tasks:  21%|██        | 36/172 [00:00<00:00, 357.48it/s]creating meta tasks:  45%|████▌     | 78/172 [00:00<00:00, 392.59it/s]creating meta tasks:  70%|██████▉   | 120/172 [00:00<00:00, 404.44it/s]creating meta tasks:  95%|█████████▍| 163/172 [00:00<00:00, 411.21it/s]creating meta tasks: 100%|██████████| 172/172 [00:00<00:00, 404.49it/s]
[2258322:MainThread](2024-04-23 02:20:31,207) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2020-01-02 00:00:00'), Timestamp('2020-02-06 00:00:00')), 'test': (Timestamp('2020-02-10 00:00:00'), Timestamp('2020-03-06 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/51 [00:00<?, ?it/s]creating meta tasks:  78%|███████▊  | 40/51 [00:00<00:00, 399.76it/s]creating meta tasks: 100%|██████████| 51/51 [00:00<00:00, 404.90it/s]
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2258322:MainThread](2024-04-23 02:20:32,305) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2258322:MainThread](2024-04-23 02:20:32,515) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:14<23:41, 14.36s/it]epoch:   2%|▏         | 2/100 [00:27<22:06, 13.53s/it]epoch:   3%|▎         | 3/100 [00:40<21:16, 13.16s/it]epoch:   4%|▍         | 4/100 [00:52<20:52, 13.05s/it]epoch:   5%|▌         | 5/100 [01:05<20:34, 13.00s/it]epoch:   6%|▌         | 6/100 [01:18<20:11, 12.89s/it]epoch:   7%|▋         | 7/100 [01:31<19:54, 12.84s/it]epoch:   8%|▊         | 8/100 [01:44<19:40, 12.83s/it]epoch:   9%|▉         | 9/100 [01:56<19:17, 12.72s/it]epoch:  10%|█         | 10/100 [02:09<19:06, 12.74s/it]epoch:  11%|█         | 11/100 [02:21<18:46, 12.66s/it]epoch:  12%|█▏        | 12/100 [02:34<18:36, 12.69s/it]epoch:  13%|█▎        | 13/100 [02:46<18:16, 12.60s/it]epoch:  14%|█▍        | 14/100 [02:59<18:04, 12.61s/it]epoch:  15%|█▌        | 15/100 [03:12<17:49, 12.58s/it]epoch:  16%|█▌        | 16/100 [03:24<17:29, 12.50s/it]epoch:  17%|█▋        | 17/100 [03:37<17:21, 12.54s/it]epoch:  18%|█▊        | 18/100 [03:49<17:10, 12.57s/it]epoch:  19%|█▉        | 19/100 [04:02<16:53, 12.52s/it]epoch:  20%|██        | 20/100 [04:14<16:41, 12.52s/it]0.03143275273611551
best ic: 0.03143275273611551
epoch:  21%|██        | 21/100 [04:30<17:42, 13.45s/it]0.031489910284409936
best ic: 0.031489910284409936
epoch:  22%|██▏       | 22/100 [04:45<18:13, 14.02s/it]0.031214506427749377
epoch:  23%|██▎       | 23/100 [05:00<18:20, 14.30s/it]0.03371500203866794
best ic: 0.03371500203866794
epoch:  24%|██▍       | 24/100 [05:15<18:24, 14.53s/it]0.03168748586821587
epoch:  25%|██▌       | 25/100 [05:30<18:27, 14.77s/it]0.031155328099239016
epoch:  26%|██▌       | 26/100 [05:46<18:27, 14.96s/it]0.03247094031559622
epoch:  27%|██▋       | 27/100 [06:01<18:13, 14.98s/it]0.03133994462846124
epoch:  28%|██▊       | 28/100 [06:16<18:02, 15.03s/it]0.03084372925768331
epoch:  29%|██▉       | 29/100 [06:31<17:51, 15.10s/it]0.03188405341378692
epoch:  30%|███       | 30/100 [06:46<17:38, 15.13s/it]0.03296610487656345
epoch:  31%|███       | 31/100 [07:01<17:21, 15.10s/it]0.030729480733350484
epoch:  31%|███       | 31/100 [07:17<16:12, 14.10s/it]
Test segment: 2022-04-01 00:00:00 2024-03-29 00:00:00
[2258322:MainThread](2024-04-23 02:27:54,351) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-23_02:20:32_online.
[2258322:MainThread](2024-04-23 02:27:54,356) INFO - qlib.workflow - [exp.py:258] - Experiment 6 starts running ...
[2258322:MainThread](2024-04-23 02:27:55,573) INFO - qlib.workflow - [recorder.py:341] - Recorder 3a4f58a7017d4cd8af074dc9e792b6e7 starts running under Experiment 6 ...
online:   0%|          | 0/51 [00:00<?, ?it/s]online:   4%|▍         | 2/51 [00:00<00:04, 11.07it/s]online:   8%|▊         | 4/51 [00:00<00:04, 10.57it/s]online:  12%|█▏        | 6/51 [00:00<00:04, 10.40it/s]online:  16%|█▌        | 8/51 [00:00<00:04, 10.40it/s]online:  20%|█▉        | 10/51 [00:00<00:03, 10.39it/s]online:  24%|██▎       | 12/51 [00:01<00:03, 10.43it/s]online:  27%|██▋       | 14/51 [00:01<00:03, 10.42it/s]online:  31%|███▏      | 16/51 [00:01<00:03, 10.42it/s]online:  35%|███▌      | 18/51 [00:01<00:03, 10.41it/s]online:  39%|███▉      | 20/51 [00:01<00:02, 10.35it/s]online:  43%|████▎     | 22/51 [00:02<00:02, 10.32it/s]online:  47%|████▋     | 24/51 [00:02<00:02, 10.33it/s]online:  51%|█████     | 26/51 [00:02<00:02, 10.33it/s]online:  55%|█████▍    | 28/51 [00:02<00:02, 10.28it/s]online:  59%|█████▉    | 30/51 [00:02<00:02, 10.38it/s]online:  63%|██████▎   | 32/51 [00:03<00:01, 10.33it/s]online:  67%|██████▋   | 34/51 [00:03<00:01, 10.31it/s]online:  71%|███████   | 36/51 [00:03<00:01, 10.42it/s]online:  75%|███████▍  | 38/51 [00:03<00:01, 10.48it/s]online:  78%|███████▊  | 40/51 [00:03<00:01, 10.38it/s]online:  82%|████████▏ | 42/51 [00:04<00:00, 10.38it/s]online:  86%|████████▋ | 44/51 [00:04<00:00, 10.43it/s]online:  90%|█████████ | 46/51 [00:04<00:00, 10.33it/s]online:  94%|█████████▍| 48/51 [00:04<00:00, 10.35it/s]online:  98%|█████████▊| 50/51 [00:04<00:00, 10.32it/s]online: 100%|██████████| 51/51 [00:04<00:00, 10.41it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2258322:MainThread](2024-04-23 02:28:09,988) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99784255 mae 0.68354344
{'IC': 0.01784173241051523,
 'ICIR': 0.15106715081350705,
 'Rank IC': 0.02120073880291459,
 'Rank ICIR': 0.18422340349548189}
[2258322:MainThread](2024-04-23 02:28:10,949) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2258322:MainThread](2024-04-23 02:28:24,432) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:28:24,435) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:28:28,925) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fa28e9b75e0>
backtest loop:   0%|          | 0/485 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 6/485 [00:00<00:08, 58.86it/s]backtest loop:   2%|▏         | 12/485 [00:00<00:07, 59.38it/s]backtest loop:   4%|▍         | 19/485 [00:00<00:08, 56.10it/s]backtest loop:   5%|▌         | 26/485 [00:00<00:08, 54.51it/s]backtest loop:   7%|▋         | 32/485 [00:00<00:08, 56.15it/s]backtest loop:   8%|▊         | 38/485 [00:00<00:07, 57.17it/s]backtest loop:   9%|▉         | 44/485 [00:00<00:07, 57.88it/s]backtest loop:  10%|█         | 50/485 [00:00<00:07, 54.92it/s]backtest loop:  12%|█▏        | 56/485 [00:00<00:07, 56.31it/s]backtest loop:  13%|█▎        | 63/485 [00:01<00:07, 58.23it/s]backtest loop:  14%|█▍        | 70/485 [00:01<00:07, 56.30it/s]backtest loop:  16%|█▌        | 77/485 [00:01<00:07, 58.00it/s]backtest loop:  17%|█▋        | 83/485 [00:01<00:06, 58.28it/s]backtest loop:  18%|█▊        | 89/485 [00:01<00:06, 58.57it/s]backtest loop:  20%|█▉        | 95/485 [00:01<00:07, 55.48it/s]backtest loop:  21%|██        | 101/485 [00:01<00:06, 56.61it/s]backtest loop:  22%|██▏       | 107/485 [00:01<00:06, 57.33it/s]backtest loop:  24%|██▎       | 114/485 [00:02<00:06, 55.56it/s]backtest loop:  25%|██▍       | 121/485 [00:02<00:06, 57.46it/s]backtest loop:  26%|██▌       | 127/485 [00:02<00:06, 58.05it/s]backtest loop:  28%|██▊       | 134/485 [00:02<00:06, 56.11it/s]backtest loop:  29%|██▉       | 141/485 [00:02<00:05, 58.15it/s]backtest loop:  30%|███       | 147/485 [00:02<00:05, 58.58it/s]backtest loop:  32%|███▏      | 153/485 [00:02<00:05, 58.94it/s]backtest loop:  33%|███▎      | 159/485 [00:02<00:05, 55.72it/s]backtest loop:  34%|███▍      | 166/485 [00:02<00:05, 57.83it/s]backtest loop:  35%|███▌      | 172/485 [00:03<00:05, 58.29it/s]backtest loop:  37%|███▋      | 178/485 [00:03<00:05, 58.66it/s]backtest loop:  38%|███▊      | 184/485 [00:03<00:05, 55.56it/s]backtest loop:  39%|███▉      | 190/485 [00:03<00:05, 56.67it/s]backtest loop:  40%|████      | 196/485 [00:03<00:05, 57.35it/s]backtest loop:  42%|████▏     | 202/485 [00:03<00:04, 58.00it/s]backtest loop:  43%|████▎     | 208/485 [00:03<00:05, 55.07it/s]backtest loop:  44%|████▍     | 215/485 [00:03<00:04, 57.22it/s]backtest loop:  46%|████▌     | 221/485 [00:03<00:04, 57.97it/s]backtest loop:  47%|████▋     | 227/485 [00:03<00:04, 58.53it/s]backtest loop:  48%|████▊     | 233/485 [00:04<00:04, 55.61it/s]backtest loop:  49%|████▉     | 240/485 [00:04<00:04, 57.57it/s]backtest loop:  51%|█████     | 246/485 [00:04<00:04, 54.86it/s]backtest loop:  52%|█████▏    | 252/485 [00:04<00:04, 53.11it/s]backtest loop:  53%|█████▎    | 259/485 [00:04<00:04, 55.64it/s]backtest loop:  55%|█████▍    | 265/485 [00:04<00:04, 52.89it/s]backtest loop:  56%|█████▌    | 272/485 [00:04<00:03, 55.79it/s]backtest loop:  57%|█████▋    | 278/485 [00:04<00:03, 56.90it/s]backtest loop:  59%|█████▊    | 284/485 [00:05<00:03, 55.55it/s]backtest loop:  60%|██████    | 291/485 [00:05<00:03, 58.12it/s]backtest loop:  61%|██████    | 297/485 [00:05<00:03, 55.26it/s]backtest loop:  62%|██████▏   | 303/485 [00:05<00:03, 56.21it/s]backtest loop:  64%|██████▎   | 309/485 [00:05<00:03, 57.17it/s]backtest loop:  65%|██████▌   | 316/485 [00:05<00:02, 58.86it/s]backtest loop:  66%|██████▋   | 322/485 [00:05<00:02, 55.87it/s]backtest loop:  68%|██████▊   | 329/485 [00:05<00:02, 57.66it/s]backtest loop:  69%|██████▉   | 335/485 [00:05<00:02, 58.23it/s]backtest loop:  70%|███████   | 341/485 [00:05<00:02, 58.62it/s]backtest loop:  72%|███████▏  | 347/485 [00:06<00:02, 55.53it/s]backtest loop:  73%|███████▎  | 353/485 [00:06<00:02, 56.39it/s]backtest loop:  74%|███████▍  | 359/485 [00:06<00:02, 57.26it/s]backtest loop:  75%|███████▌  | 365/485 [00:06<00:02, 57.72it/s]backtest loop:  76%|███████▋  | 371/485 [00:06<00:02, 54.93it/s]backtest loop:  78%|███████▊  | 378/485 [00:06<00:01, 57.04it/s]backtest loop:  79%|███████▉  | 385/485 [00:06<00:01, 58.58it/s]backtest loop:  81%|████████  | 391/485 [00:06<00:01, 55.64it/s]backtest loop:  82%|████████▏ | 398/485 [00:06<00:01, 57.74it/s]backtest loop:  83%|████████▎ | 404/485 [00:07<00:01, 58.13it/s]backtest loop:  85%|████████▍ | 410/485 [00:07<00:01, 58.34it/s]backtest loop:  86%|████████▌ | 416/485 [00:07<00:01, 55.46it/s]backtest loop:  87%|████████▋ | 423/485 [00:07<00:01, 57.49it/s]backtest loop:  88%|████████▊ | 429/485 [00:07<00:00, 58.05it/s]backtest loop:  90%|████████▉ | 435/485 [00:07<00:00, 55.23it/s]backtest loop:  91%|█████████ | 442/485 [00:07<00:00, 57.34it/s]backtest loop:  93%|█████████▎| 449/485 [00:07<00:00, 58.77it/s]backtest loop:  94%|█████████▍| 455/485 [00:08<00:00, 56.00it/s]backtest loop:  95%|█████████▌| 461/485 [00:08<00:00, 56.64it/s]backtest loop:  96%|█████████▋| 467/485 [00:08<00:00, 57.20it/s]backtest loop:  98%|█████████▊| 473/485 [00:08<00:00, 57.94it/s]backtest loop:  99%|█████████▉| 479/485 [00:08<00:00, 55.08it/s]backtest loop: 100%|██████████| 485/485 [00:08<00:00, 56.29it/s]backtest loop: 100%|██████████| 485/485 [00:08<00:00, 56.85it/s]
[2258322:MainThread](2024-04-23 02:28:37,500) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of benchmark return(1day).'
                       risk
mean              -0.000251
std                0.012236
annualized_return -0.059709
information_ratio -0.316310
max_drawdown      -0.360543
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000391
std                0.004237
annualized_return  0.093152
information_ratio  1.425230
max_drawdown      -0.065495
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000196
std                0.004238
annualized_return  0.046729
information_ratio  0.714795
max_drawdown      -0.083411
[2258322:MainThread](2024-04-23 02:28:37,516) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-23_02:20:32_online`.
("Round 0 finished, all metrics: {'mse': [0.99784255027771], 'mae': "
 "[0.6835434436798096], 'IC': [0.01784173241051523], 'ICIR': "
 "[0.15106715081350705], 'Rank IC': [0.02120073880291459], 'Rank ICIR': "
 "[0.18422340349548189], '1day.excess_return_with_cost.annualized_return': "
 "[0.046728546811842735], '1day.excess_return_with_cost.information_ratio': "
 '[0.7147947586283061]}')
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2258322:MainThread](2024-04-23 02:28:38,260) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2258322:MainThread](2024-04-23 02:28:38,261) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:12<20:58, 12.71s/it]epoch:   2%|▏         | 2/100 [00:24<20:14, 12.39s/it]epoch:   3%|▎         | 3/100 [00:37<20:03, 12.40s/it]epoch:   4%|▍         | 4/100 [00:49<20:00, 12.50s/it]epoch:   5%|▌         | 5/100 [01:02<19:48, 12.51s/it]epoch:   6%|▌         | 6/100 [01:14<19:29, 12.44s/it]epoch:   7%|▋         | 7/100 [01:27<19:12, 12.39s/it]epoch:   8%|▊         | 8/100 [01:39<19:01, 12.41s/it]epoch:   9%|▉         | 9/100 [01:52<18:55, 12.48s/it]epoch:  10%|█         | 10/100 [02:04<18:47, 12.53s/it]epoch:  11%|█         | 11/100 [02:17<18:27, 12.44s/it]epoch:  12%|█▏        | 12/100 [02:29<18:13, 12.42s/it]epoch:  13%|█▎        | 13/100 [02:41<18:02, 12.44s/it]epoch:  14%|█▍        | 14/100 [02:54<17:56, 12.52s/it]epoch:  15%|█▌        | 15/100 [03:07<17:48, 12.57s/it]epoch:  16%|█▌        | 16/100 [03:19<17:30, 12.50s/it]epoch:  17%|█▋        | 17/100 [03:32<17:15, 12.48s/it]epoch:  18%|█▊        | 18/100 [03:44<17:08, 12.54s/it]epoch:  19%|█▉        | 19/100 [03:57<16:59, 12.58s/it]epoch:  20%|██        | 20/100 [04:09<16:46, 12.58s/it]0.034617887353423964
best ic: 0.034617887353423964
epoch:  21%|██        | 21/100 [04:25<17:35, 13.37s/it]0.027909209633227895
epoch:  22%|██▏       | 22/100 [04:40<18:04, 13.90s/it]0.030681964425898958
epoch:  23%|██▎       | 23/100 [04:55<18:24, 14.35s/it]0.0359107697874192
best ic: 0.0359107697874192
epoch:  24%|██▍       | 24/100 [05:11<18:34, 14.67s/it]0.033271938167444864
epoch:  25%|██▌       | 25/100 [05:26<18:25, 14.74s/it]0.03272254577752043
epoch:  26%|██▌       | 26/100 [05:41<18:21, 14.89s/it]0.030044380069098573
epoch:  27%|██▋       | 27/100 [05:56<18:18, 15.05s/it]0.032982495894110696
epoch:  28%|██▊       | 28/100 [06:12<18:13, 15.18s/it]0.02782863407700088
epoch:  29%|██▉       | 29/100 [06:27<17:55, 15.15s/it]0.03359625880203757
epoch:  30%|███       | 30/100 [06:42<17:40, 15.15s/it]0.032646167059946225
epoch:  31%|███       | 31/100 [06:58<17:35, 15.29s/it]0.033657336179264245
epoch:  31%|███       | 31/100 [07:13<16:05, 13.99s/it]
Test segment: 2022-04-01 00:00:00 2024-03-29 00:00:00
[2258322:MainThread](2024-04-23 02:35:51,848) INFO - qlib.workflow - [exp.py:258] - Experiment 6 starts running ...
[2258322:MainThread](2024-04-23 02:35:51,857) INFO - qlib.workflow - [recorder.py:341] - Recorder 645804f74975454aaaae8c10073ebc96 starts running under Experiment 6 ...
online:   0%|          | 0/51 [00:00<?, ?it/s]online:   4%|▍         | 2/51 [00:00<00:04, 10.88it/s]online:   8%|▊         | 4/51 [00:00<00:04, 10.65it/s]online:  12%|█▏        | 6/51 [00:00<00:04, 10.46it/s]online:  16%|█▌        | 8/51 [00:00<00:04, 10.47it/s]online:  20%|█▉        | 10/51 [00:00<00:03, 10.46it/s]online:  24%|██▎       | 12/51 [00:01<00:03, 10.56it/s]online:  27%|██▋       | 14/51 [00:01<00:03, 10.54it/s]online:  31%|███▏      | 16/51 [00:01<00:03, 10.67it/s]online:  35%|███▌      | 18/51 [00:01<00:03, 10.61it/s]online:  39%|███▉      | 20/51 [00:01<00:02, 10.62it/s]online:  43%|████▎     | 22/51 [00:02<00:02, 10.69it/s]online:  47%|████▋     | 24/51 [00:02<00:02, 10.51it/s]online:  51%|█████     | 26/51 [00:02<00:02, 10.58it/s]online:  55%|█████▍    | 28/51 [00:02<00:02, 10.59it/s]online:  59%|█████▉    | 30/51 [00:02<00:01, 10.65it/s]online:  63%|██████▎   | 32/51 [00:03<00:01, 10.61it/s]online:  67%|██████▋   | 34/51 [00:03<00:01, 10.62it/s]online:  71%|███████   | 36/51 [00:03<00:01, 10.63it/s]online:  75%|███████▍  | 38/51 [00:03<00:01, 10.60it/s]online:  78%|███████▊  | 40/51 [00:03<00:01, 10.67it/s]online:  82%|████████▏ | 42/51 [00:03<00:00, 10.54it/s]online:  86%|████████▋ | 44/51 [00:04<00:00, 10.66it/s]online:  90%|█████████ | 46/51 [00:04<00:00, 10.59it/s]online:  94%|█████████▍| 48/51 [00:04<00:00, 10.68it/s]online:  98%|█████████▊| 50/51 [00:04<00:00, 10.67it/s]online: 100%|██████████| 51/51 [00:04<00:00, 10.64it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2258322:MainThread](2024-04-23 02:36:06,508) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9978535 mae 0.68366355
{'IC': 0.02015808623370553,
 'ICIR': 0.1720743710890689,
 'Rank IC': 0.019896714287564066,
 'Rank ICIR': 0.17584010891617827}
[2258322:MainThread](2024-04-23 02:36:07,451) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2258322:MainThread](2024-04-23 02:36:20,151) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:36:20,153) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:36:24,446) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fa40b158fd0>
backtest loop:   0%|          | 0/485 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 3/485 [00:00<00:30, 15.98it/s]backtest loop:   2%|▏         | 8/485 [00:00<00:15, 30.17it/s]backtest loop:   3%|▎         | 14/485 [00:00<00:12, 36.95it/s]backtest loop:   4%|▍         | 20/485 [00:00<00:10, 43.12it/s]backtest loop:   5%|▌         | 26/485 [00:00<00:10, 44.07it/s]backtest loop:   7%|▋         | 32/485 [00:00<00:09, 47.27it/s]backtest loop:   8%|▊         | 38/485 [00:00<00:09, 49.27it/s]backtest loop:   9%|▉         | 44/485 [00:00<00:08, 51.09it/s]backtest loop:  10%|█         | 50/485 [00:01<00:08, 48.73it/s]backtest loop:  12%|█▏        | 56/485 [00:01<00:08, 50.37it/s]backtest loop:  13%|█▎        | 62/485 [00:01<00:08, 51.80it/s]backtest loop:  14%|█▍        | 68/485 [00:01<00:07, 52.58it/s]backtest loop:  15%|█▌        | 74/485 [00:01<00:07, 53.22it/s]backtest loop:  16%|█▋        | 80/485 [00:01<00:08, 50.50it/s]backtest loop:  18%|█▊        | 86/485 [00:01<00:07, 51.75it/s]backtest loop:  19%|█▉        | 92/485 [00:01<00:07, 52.60it/s]backtest loop:  20%|██        | 98/485 [00:02<00:07, 53.18it/s]backtest loop:  21%|██▏       | 104/485 [00:02<00:07, 53.50it/s]backtest loop:  23%|██▎       | 110/485 [00:02<00:11, 33.25it/s]backtest loop:  24%|██▍       | 116/485 [00:02<00:09, 37.53it/s]backtest loop:  25%|██▌       | 122/485 [00:02<00:08, 40.82it/s]backtest loop:  26%|██▋       | 128/485 [00:02<00:08, 44.45it/s]backtest loop:  28%|██▊       | 134/485 [00:02<00:07, 45.68it/s]backtest loop:  29%|██▉       | 141/485 [00:03<00:06, 50.36it/s]backtest loop:  30%|███       | 147/485 [00:03<00:06, 52.65it/s]backtest loop:  32%|███▏      | 154/485 [00:03<00:06, 52.54it/s]backtest loop:  33%|███▎      | 160/485 [00:03<00:05, 54.41it/s]backtest loop:  34%|███▍      | 167/485 [00:03<00:05, 56.95it/s]backtest loop:  36%|███▌      | 173/485 [00:03<00:05, 57.74it/s]backtest loop:  37%|███▋      | 179/485 [00:03<00:05, 55.08it/s]backtest loop:  38%|███▊      | 185/485 [00:03<00:05, 56.19it/s]backtest loop:  40%|███▉      | 192/485 [00:03<00:05, 58.00it/s]backtest loop:  41%|████      | 198/485 [00:04<00:05, 55.43it/s]backtest loop:  42%|████▏     | 205/485 [00:04<00:04, 57.52it/s]backtest loop:  44%|████▎     | 211/485 [00:04<00:04, 58.12it/s]backtest loop:  45%|████▍     | 218/485 [00:04<00:04, 56.10it/s]backtest loop:  46%|████▌     | 224/485 [00:04<00:04, 56.88it/s]backtest loop:  48%|████▊     | 231/485 [00:04<00:04, 58.40it/s]backtest loop:  49%|████▉     | 237/485 [00:04<00:04, 58.71it/s]backtest loop:  50%|█████     | 243/485 [00:04<00:04, 55.96it/s]backtest loop:  51%|█████▏    | 249/485 [00:04<00:04, 53.99it/s]backtest loop:  53%|█████▎    | 255/485 [00:05<00:04, 55.52it/s]backtest loop:  54%|█████▍    | 261/485 [00:05<00:03, 56.71it/s]backtest loop:  55%|█████▌    | 267/485 [00:05<00:03, 54.63it/s]backtest loop:  56%|█████▋    | 274/485 [00:05<00:03, 54.07it/s]backtest loop:  58%|█████▊    | 281/485 [00:05<00:03, 56.58it/s]backtest loop:  59%|█████▉    | 288/485 [00:05<00:03, 59.05it/s]backtest loop:  61%|██████    | 294/485 [00:05<00:03, 56.17it/s]backtest loop:  62%|██████▏   | 300/485 [00:05<00:03, 57.15it/s]backtest loop:  63%|██████▎   | 306/485 [00:05<00:03, 57.76it/s]backtest loop:  64%|██████▍   | 312/485 [00:06<00:03, 55.10it/s]backtest loop:  66%|██████▌   | 318/485 [00:06<00:02, 56.27it/s]backtest loop:  67%|██████▋   | 324/485 [00:06<00:02, 57.28it/s]backtest loop:  68%|██████▊   | 331/485 [00:06<00:02, 58.95it/s]backtest loop:  69%|██████▉   | 337/485 [00:06<00:02, 55.86it/s]backtest loop:  71%|███████   | 343/485 [00:06<00:02, 56.87it/s]backtest loop:  72%|███████▏  | 349/485 [00:06<00:02, 57.66it/s]backtest loop:  73%|███████▎  | 355/485 [00:06<00:02, 58.21it/s]backtest loop:  74%|███████▍  | 361/485 [00:06<00:02, 58.58it/s]backtest loop:  76%|███████▌  | 367/485 [00:07<00:02, 55.43it/s]backtest loop:  77%|███████▋  | 373/485 [00:07<00:01, 56.18it/s]backtest loop:  78%|███████▊  | 380/485 [00:07<00:01, 57.96it/s]backtest loop:  80%|███████▉  | 386/485 [00:07<00:01, 54.75it/s]backtest loop:  81%|████████  | 393/485 [00:07<00:01, 56.95it/s]backtest loop:  82%|████████▏ | 399/485 [00:07<00:01, 57.55it/s]backtest loop:  84%|████████▎ | 405/485 [00:07<00:01, 58.16it/s]backtest loop:  85%|████████▍ | 411/485 [00:07<00:01, 55.03it/s]backtest loop:  86%|████████▌ | 417/485 [00:07<00:01, 56.29it/s]backtest loop:  87%|████████▋ | 424/485 [00:08<00:01, 58.04it/s]backtest loop:  89%|████████▊ | 430/485 [00:08<00:01, 54.98it/s]backtest loop:  90%|████████▉ | 436/485 [00:08<00:00, 56.28it/s]backtest loop:  91%|█████████ | 442/485 [00:08<00:00, 57.18it/s]backtest loop:  93%|█████████▎| 449/485 [00:08<00:00, 58.72it/s]backtest loop:  94%|█████████▍| 455/485 [00:08<00:00, 55.68it/s]backtest loop:  95%|█████████▌| 461/485 [00:08<00:00, 56.70it/s]backtest loop:  96%|█████████▋| 467/485 [00:08<00:00, 57.50it/s]backtest loop:  98%|█████████▊| 473/485 [00:08<00:00, 57.87it/s]backtest loop:  99%|█████████▉| 479/485 [00:09<00:00, 55.13it/s]backtest loop: 100%|██████████| 485/485 [00:09<00:00, 56.09it/s]backtest loop: 100%|██████████| 485/485 [00:09<00:00, 53.25it/s]
[2258322:MainThread](2024-04-23 02:36:33,602) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of benchmark return(1day).'
                       risk
mean              -0.000251
std                0.012236
annualized_return -0.059709
information_ratio -0.316310
max_drawdown      -0.360543
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000262
std                0.003964
annualized_return  0.062250
information_ratio  1.017841
max_drawdown      -0.082673
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000067
std                0.003963
annualized_return  0.016012
information_ratio  0.261863
max_drawdown      -0.099973
[2258322:MainThread](2024-04-23 02:36:33,616) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-23_02:20:32_online`.
("Round 1 finished, all metrics: {'mse': [0.99784255027771, "
 "0.9978535175323486], 'mae': [0.6835434436798096, 0.683663547039032], 'IC': "
 "[0.01784173241051523, 0.02015808623370553], 'ICIR': [0.15106715081350705, "
 "0.1720743710890689], 'Rank IC': [0.02120073880291459, 0.019896714287564066], "
 "'Rank ICIR': [0.18422340349548189, 0.17584010891617827], "
 "'1day.excess_return_with_cost.annualized_return': [0.046728546811842735, "
 "0.016011744083066288], '1day.excess_return_with_cost.information_ratio': "
 '[0.7147947586283061, 0.26186336677355665]}')
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2258322:MainThread](2024-04-23 02:36:34,360) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2258322:MainThread](2024-04-23 02:36:34,361) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:12<21:16, 12.90s/it]epoch:   2%|▏         | 2/100 [00:25<21:00, 12.86s/it]epoch:   3%|▎         | 3/100 [00:38<20:50, 12.89s/it]epoch:   4%|▍         | 4/100 [00:51<20:32, 12.84s/it]epoch:   5%|▌         | 5/100 [01:04<20:25, 12.90s/it]epoch:   6%|▌         | 6/100 [01:17<20:04, 12.81s/it]epoch:   7%|▋         | 7/100 [01:29<19:52, 12.83s/it]epoch:   8%|▊         | 8/100 [01:42<19:29, 12.71s/it]epoch:   9%|▉         | 9/100 [01:55<19:23, 12.79s/it]epoch:  10%|█         | 10/100 [02:07<19:01, 12.68s/it]epoch:  11%|█         | 11/100 [02:20<18:49, 12.69s/it]epoch:  12%|█▏        | 12/100 [02:33<18:33, 12.65s/it]epoch:  13%|█▎        | 13/100 [02:45<18:16, 12.61s/it]epoch:  14%|█▍        | 14/100 [02:58<18:15, 12.74s/it]epoch:  15%|█▌        | 15/100 [03:11<17:57, 12.68s/it]epoch:  16%|█▌        | 16/100 [03:23<17:37, 12.59s/it]epoch:  17%|█▋        | 17/100 [03:36<17:26, 12.61s/it]epoch:  18%|█▊        | 18/100 [03:48<17:14, 12.61s/it]epoch:  19%|█▉        | 19/100 [04:01<16:57, 12.56s/it]epoch:  20%|██        | 20/100 [04:13<16:41, 12.52s/it]0.028848283614713435
best ic: 0.028848283614713435
epoch:  21%|██        | 21/100 [04:29<17:37, 13.39s/it]0.02917281500509961
best ic: 0.02917281500509961
epoch:  22%|██▏       | 22/100 [04:44<18:16, 14.06s/it]0.031886257141966814
best ic: 0.031886257141966814
epoch:  23%|██▎       | 23/100 [04:59<18:27, 14.38s/it]0.030089795350983477
epoch:  24%|██▍       | 24/100 [05:15<18:33, 14.65s/it]0.03135008763588969
epoch:  25%|██▌       | 25/100 [05:30<18:33, 14.84s/it]0.03312035127168401
best ic: 0.03312035127168401
epoch:  26%|██▌       | 26/100 [05:46<18:37, 15.09s/it]0.028467833978646176
epoch:  27%|██▋       | 27/100 [06:01<18:28, 15.18s/it]0.030099251205852006
epoch:  28%|██▊       | 28/100 [06:16<18:12, 15.17s/it]0.02720056650587081
epoch:  29%|██▉       | 29/100 [06:31<17:57, 15.18s/it]0.027893880435749127
epoch:  30%|███       | 30/100 [06:47<17:50, 15.29s/it]0.0286144558892173
epoch:  31%|███       | 31/100 [07:02<17:39, 15.36s/it]0.028284302619470195
epoch:  32%|███▏      | 32/100 [07:18<17:20, 15.30s/it]0.030671332698666443
epoch:  33%|███▎      | 33/100 [07:33<17:03, 15.28s/it]0.0285048497913187
epoch:  33%|███▎      | 33/100 [07:48<15:51, 14.21s/it]
Test segment: 2022-04-01 00:00:00 2024-03-29 00:00:00
[2258322:MainThread](2024-04-23 02:44:23,255) INFO - qlib.workflow - [exp.py:258] - Experiment 6 starts running ...
[2258322:MainThread](2024-04-23 02:44:23,265) INFO - qlib.workflow - [recorder.py:341] - Recorder d1c7e4ebe19d446b820b0c829c19a43e starts running under Experiment 6 ...
online:   0%|          | 0/51 [00:00<?, ?it/s]online:   4%|▍         | 2/51 [00:00<00:04, 10.95it/s]online:   8%|▊         | 4/51 [00:00<00:04, 10.72it/s]online:  12%|█▏        | 6/51 [00:00<00:04, 10.54it/s]online:  16%|█▌        | 8/51 [00:00<00:04, 10.47it/s]online:  20%|█▉        | 10/51 [00:00<00:03, 10.59it/s]online:  24%|██▎       | 12/51 [00:01<00:03, 10.63it/s]online:  27%|██▋       | 14/51 [00:01<00:03, 10.69it/s]online:  31%|███▏      | 16/51 [00:01<00:03, 10.68it/s]online:  35%|███▌      | 18/51 [00:01<00:03, 10.72it/s]online:  39%|███▉      | 20/51 [00:01<00:02, 10.72it/s]online:  43%|████▎     | 22/51 [00:02<00:02, 10.73it/s]online:  47%|████▋     | 24/51 [00:02<00:02, 10.74it/s]online:  51%|█████     | 26/51 [00:02<00:02, 10.70it/s]online:  55%|█████▍    | 28/51 [00:02<00:02, 10.73it/s]online:  59%|█████▉    | 30/51 [00:02<00:01, 10.66it/s]online:  63%|██████▎   | 32/51 [00:03<00:01, 10.62it/s]online:  67%|██████▋   | 34/51 [00:03<00:01, 10.59it/s]online:  71%|███████   | 36/51 [00:03<00:01, 10.63it/s]online:  75%|███████▍  | 38/51 [00:03<00:01, 10.59it/s]online:  78%|███████▊  | 40/51 [00:03<00:01, 10.64it/s]online:  82%|████████▏ | 42/51 [00:03<00:00, 10.67it/s]online:  86%|████████▋ | 44/51 [00:04<00:00, 10.73it/s]online:  90%|█████████ | 46/51 [00:04<00:00, 10.74it/s]online:  94%|█████████▍| 48/51 [00:04<00:00, 10.74it/s]online:  98%|█████████▊| 50/51 [00:04<00:00, 10.77it/s]online: 100%|██████████| 51/51 [00:04<00:00, 10.72it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2258322:MainThread](2024-04-23 02:44:37,990) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9978875 mae 0.68374693
{'IC': 0.017091133068949278,
 'ICIR': 0.14634987603826485,
 'Rank IC': 0.019068803383595855,
 'Rank ICIR': 0.16833290132828618}
[2258322:MainThread](2024-04-23 02:44:38,925) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2258322:MainThread](2024-04-23 02:44:51,974) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:44:51,976) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:44:56,328) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fa0a6ab0c40>
backtest loop:   0%|          | 0/485 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 3/485 [00:00<00:31, 15.15it/s]backtest loop:   2%|▏         | 9/485 [00:00<00:16, 29.60it/s]backtest loop:   3%|▎         | 15/485 [00:00<00:12, 38.71it/s]backtest loop:   4%|▍         | 21/485 [00:00<00:11, 41.63it/s]backtest loop:   6%|▌         | 27/485 [00:00<00:10, 45.74it/s]backtest loop:   7%|▋         | 33/485 [00:00<00:09, 48.45it/s]backtest loop:   8%|▊         | 39/485 [00:00<00:08, 50.35it/s]backtest loop:   9%|▉         | 45/485 [00:01<00:09, 48.43it/s]backtest loop:  11%|█         | 51/485 [00:01<00:08, 50.01it/s]backtest loop:  12%|█▏        | 57/485 [00:01<00:08, 51.24it/s]backtest loop:  13%|█▎        | 63/485 [00:01<00:08, 52.50it/s]backtest loop:  14%|█▍        | 69/485 [00:01<00:07, 52.97it/s]backtest loop:  15%|█▌        | 75/485 [00:01<00:08, 50.36it/s]backtest loop:  17%|█▋        | 81/485 [00:01<00:07, 51.40it/s]backtest loop:  18%|█▊        | 87/485 [00:01<00:07, 52.41it/s]backtest loop:  19%|█▉        | 93/485 [00:01<00:07, 53.10it/s]backtest loop:  20%|██        | 99/485 [00:02<00:07, 53.44it/s]backtest loop:  22%|██▏       | 105/485 [00:02<00:11, 32.85it/s]backtest loop:  23%|██▎       | 111/485 [00:02<00:10, 37.28it/s]backtest loop:  24%|██▍       | 117/485 [00:02<00:08, 40.96it/s]backtest loop:  25%|██▌       | 123/485 [00:02<00:08, 44.19it/s]backtest loop:  27%|██▋       | 129/485 [00:02<00:08, 44.09it/s]backtest loop:  28%|██▊       | 135/485 [00:02<00:07, 46.57it/s]backtest loop:  29%|██▉       | 141/485 [00:03<00:07, 49.14it/s]backtest loop:  30%|███       | 147/485 [00:03<00:06, 50.57it/s]backtest loop:  32%|███▏      | 153/485 [00:03<00:06, 51.80it/s]backtest loop:  33%|███▎      | 159/485 [00:03<00:06, 49.53it/s]backtest loop:  34%|███▍      | 165/485 [00:03<00:06, 51.01it/s]backtest loop:  35%|███▌      | 171/485 [00:03<00:06, 52.20it/s]backtest loop:  36%|███▋      | 177/485 [00:03<00:05, 52.72it/s]backtest loop:  38%|███▊      | 183/485 [00:03<00:05, 53.18it/s]backtest loop:  39%|███▉      | 189/485 [00:04<00:05, 50.51it/s]backtest loop:  40%|████      | 195/485 [00:04<00:05, 51.71it/s]backtest loop:  41%|████▏     | 201/485 [00:04<00:05, 52.50it/s]backtest loop:  43%|████▎     | 207/485 [00:04<00:05, 53.23it/s]backtest loop:  44%|████▍     | 213/485 [00:04<00:05, 50.62it/s]backtest loop:  45%|████▌     | 219/485 [00:04<00:05, 51.69it/s]backtest loop:  46%|████▋     | 225/485 [00:04<00:04, 52.45it/s]backtest loop:  48%|████▊     | 231/485 [00:04<00:04, 52.84it/s]backtest loop:  49%|████▉     | 237/485 [00:04<00:04, 53.40it/s]backtest loop:  50%|█████     | 243/485 [00:05<00:04, 50.66it/s]backtest loop:  51%|█████▏    | 249/485 [00:05<00:04, 48.84it/s]backtest loop:  53%|█████▎    | 255/485 [00:05<00:04, 50.39it/s]backtest loop:  54%|█████▍    | 261/485 [00:05<00:04, 51.54it/s]backtest loop:  55%|█████▌    | 267/485 [00:05<00:04, 49.36it/s]backtest loop:  56%|█████▋    | 273/485 [00:05<00:04, 51.07it/s]backtest loop:  58%|█████▊    | 279/485 [00:05<00:04, 49.09it/s]backtest loop:  59%|█████▉    | 285/485 [00:05<00:03, 50.37it/s]backtest loop:  60%|██████    | 291/485 [00:05<00:03, 51.59it/s]backtest loop:  61%|██████    | 297/485 [00:06<00:03, 49.51it/s]backtest loop:  62%|██████▏   | 303/485 [00:06<00:03, 50.87it/s]backtest loop:  64%|██████▎   | 309/485 [00:06<00:03, 51.83it/s]backtest loop:  65%|██████▍   | 315/485 [00:06<00:03, 52.38it/s]backtest loop:  66%|██████▌   | 321/485 [00:06<00:03, 52.73it/s]backtest loop:  67%|██████▋   | 327/485 [00:06<00:03, 49.77it/s]backtest loop:  69%|██████▊   | 333/485 [00:06<00:02, 51.04it/s]backtest loop:  70%|██████▉   | 339/485 [00:06<00:02, 51.59it/s]backtest loop:  71%|███████   | 345/485 [00:07<00:02, 52.23it/s]backtest loop:  72%|███████▏  | 351/485 [00:07<00:02, 52.58it/s]backtest loop:  74%|███████▎  | 357/485 [00:07<00:02, 50.02it/s]backtest loop:  75%|███████▍  | 363/485 [00:07<00:02, 50.94it/s]backtest loop:  76%|███████▌  | 369/485 [00:07<00:02, 51.87it/s]backtest loop:  77%|███████▋  | 375/485 [00:07<00:02, 52.43it/s]backtest loop:  79%|███████▊  | 381/485 [00:07<00:02, 50.14it/s]backtest loop:  80%|███████▉  | 387/485 [00:07<00:01, 51.23it/s]backtest loop:  81%|████████  | 393/485 [00:07<00:01, 52.17it/s]backtest loop:  82%|████████▏ | 399/485 [00:08<00:01, 52.74it/s]backtest loop:  84%|████████▎ | 405/485 [00:08<00:01, 52.87it/s]backtest loop:  85%|████████▍ | 411/485 [00:08<00:01, 50.11it/s]backtest loop:  86%|████████▌ | 417/485 [00:08<00:01, 51.22it/s]backtest loop:  87%|████████▋ | 423/485 [00:08<00:01, 51.97it/s]backtest loop:  88%|████████▊ | 429/485 [00:08<00:01, 52.67it/s]backtest loop:  90%|████████▉ | 435/485 [00:08<00:01, 49.88it/s]backtest loop:  91%|█████████ | 441/485 [00:08<00:00, 51.18it/s]backtest loop:  92%|█████████▏| 447/485 [00:09<00:00, 52.12it/s]backtest loop:  93%|█████████▎| 453/485 [00:09<00:00, 52.74it/s]backtest loop:  95%|█████████▍| 459/485 [00:09<00:00, 50.08it/s]backtest loop:  96%|█████████▌| 465/485 [00:09<00:00, 51.27it/s]backtest loop:  97%|█████████▋| 471/485 [00:09<00:00, 52.29it/s]backtest loop:  98%|█████████▊| 477/485 [00:09<00:00, 52.76it/s]backtest loop: 100%|█████████▉| 483/485 [00:09<00:00, 53.18it/s]backtest loop: 100%|██████████| 485/485 [00:09<00:00, 49.66it/s]
[2258322:MainThread](2024-04-23 02:45:06,142) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of benchmark return(1day).'
                       risk
mean              -0.000251
std                0.012236
annualized_return -0.059709
information_ratio -0.316310
max_drawdown      -0.360543
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000228
std                0.004160
annualized_return  0.054317
information_ratio  0.846266
max_drawdown      -0.067222
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000033
std                0.004161
annualized_return  0.007832
information_ratio  0.121995
max_drawdown      -0.118413
[2258322:MainThread](2024-04-23 02:45:06,156) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-23_02:20:32_online`.
("Round 2 finished, all metrics: {'mse': [0.99784255027771, "
 "0.9978535175323486, 0.9978874921798706], 'mae': [0.6835434436798096, "
 "0.683663547039032, 0.6837469339370728], 'IC': [0.01784173241051523, "
 "0.02015808623370553, 0.017091133068949278], 'ICIR': [0.15106715081350705, "
 "0.1720743710890689, 0.14634987603826485], 'Rank IC': [0.02120073880291459, "
 "0.019896714287564066, 0.019068803383595855], 'Rank ICIR': "
 '[0.18422340349548189, 0.17584010891617827, 0.16833290132828618], '
 "'1day.excess_return_with_cost.annualized_return': [0.046728546811842735, "
 '0.016011744083066288, 0.00783183872679854], '
 "'1day.excess_return_with_cost.information_ratio': [0.7147947586283061, "
 '0.26186336677355665, 0.12199508356093612]}')
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2258322:MainThread](2024-04-23 02:45:06,907) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2258322:MainThread](2024-04-23 02:45:06,907) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:12<21:19, 12.93s/it]epoch:   2%|▏         | 2/100 [00:25<21:01, 12.87s/it]epoch:   3%|▎         | 3/100 [00:38<20:44, 12.83s/it]epoch:   4%|▍         | 4/100 [00:51<20:34, 12.86s/it]epoch:   5%|▌         | 5/100 [01:04<20:15, 12.80s/it]epoch:   6%|▌         | 6/100 [01:16<20:02, 12.79s/it]epoch:   7%|▋         | 7/100 [01:29<19:40, 12.70s/it]epoch:   8%|▊         | 8/100 [01:42<19:29, 12.71s/it]epoch:   9%|▉         | 9/100 [01:54<19:10, 12.64s/it]epoch:  10%|█         | 10/100 [02:07<19:02, 12.69s/it]epoch:  11%|█         | 11/100 [02:19<18:41, 12.60s/it]epoch:  12%|█▏        | 12/100 [02:32<18:31, 12.63s/it]epoch:  13%|█▎        | 13/100 [02:45<18:22, 12.67s/it]epoch:  14%|█▍        | 14/100 [02:57<18:06, 12.64s/it]epoch:  15%|█▌        | 15/100 [03:10<17:54, 12.64s/it]epoch:  16%|█▌        | 16/100 [03:23<17:44, 12.67s/it]epoch:  17%|█▋        | 17/100 [03:35<17:24, 12.58s/it]epoch:  18%|█▊        | 18/100 [03:48<17:07, 12.53s/it]epoch:  19%|█▉        | 19/100 [04:00<16:59, 12.59s/it]epoch:  20%|██        | 20/100 [04:13<16:49, 12.62s/it]0.03317946549817634
best ic: 0.03317946549817634
epoch:  21%|██        | 21/100 [04:28<17:40, 13.42s/it]0.030110081499156723
epoch:  22%|██▏       | 22/100 [04:43<18:06, 13.93s/it]0.030641627528724697
epoch:  23%|██▎       | 23/100 [04:59<18:28, 14.40s/it]0.031171930396931367
epoch:  24%|██▍       | 24/100 [05:14<18:40, 14.75s/it]0.029848185736995794
epoch:  25%|██▌       | 25/100 [05:30<18:34, 14.87s/it]0.029241925520514862
epoch:  26%|██▌       | 26/100 [05:45<18:22, 14.90s/it]0.03142007981378547
epoch:  27%|██▋       | 27/100 [06:00<18:15, 15.01s/it]0.031055930232824602
epoch:  28%|██▊       | 28/100 [06:15<18:12, 15.18s/it]0.02957926974955369
epoch:  28%|██▊       | 28/100 [06:31<16:45, 13.96s/it]
Test segment: 2022-04-01 00:00:00 2024-03-29 00:00:00
[2258322:MainThread](2024-04-23 02:51:37,922) INFO - qlib.workflow - [exp.py:258] - Experiment 6 starts running ...
[2258322:MainThread](2024-04-23 02:51:37,932) INFO - qlib.workflow - [recorder.py:341] - Recorder f6a319127491478b86c5a7a9687261da starts running under Experiment 6 ...
online:   0%|          | 0/51 [00:00<?, ?it/s]online:   4%|▍         | 2/51 [00:00<00:04, 11.21it/s]online:   8%|▊         | 4/51 [00:00<00:04, 10.82it/s]online:  12%|█▏        | 6/51 [00:00<00:04, 10.72it/s]online:  16%|█▌        | 8/51 [00:00<00:04, 10.68it/s]online:  20%|█▉        | 10/51 [00:00<00:03, 10.74it/s]online:  24%|██▎       | 12/51 [00:01<00:03, 10.71it/s]online:  27%|██▋       | 14/51 [00:01<00:03, 10.70it/s]online:  31%|███▏      | 16/51 [00:01<00:03, 10.73it/s]online:  35%|███▌      | 18/51 [00:01<00:03, 10.64it/s]online:  39%|███▉      | 20/51 [00:01<00:02, 10.64it/s]online:  43%|████▎     | 22/51 [00:02<00:02, 10.61it/s]online:  47%|████▋     | 24/51 [00:02<00:02, 10.77it/s]online:  51%|█████     | 26/51 [00:02<00:02, 10.71it/s]online:  55%|█████▍    | 28/51 [00:02<00:02, 10.74it/s]online:  59%|█████▉    | 30/51 [00:02<00:01, 10.68it/s]online:  63%|██████▎   | 32/51 [00:02<00:01, 10.74it/s]online:  67%|██████▋   | 34/51 [00:03<00:01, 10.72it/s]online:  71%|███████   | 36/51 [00:03<00:01, 10.67it/s]online:  75%|███████▍  | 38/51 [00:03<00:01, 10.70it/s]online:  78%|███████▊  | 40/51 [00:03<00:01, 10.63it/s]online:  82%|████████▏ | 42/51 [00:03<00:00, 10.67it/s]online:  86%|████████▋ | 44/51 [00:04<00:00, 10.70it/s]online:  90%|█████████ | 46/51 [00:04<00:00, 10.69it/s]online:  94%|█████████▍| 48/51 [00:04<00:00, 10.65it/s]online:  98%|█████████▊| 50/51 [00:04<00:00, 10.70it/s]online: 100%|██████████| 51/51 [00:04<00:00, 10.74it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2258322:MainThread](2024-04-23 02:51:53,120) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9978873 mae 0.68352777
{'IC': 0.01801475098528568,
 'ICIR': 0.14684051783526555,
 'Rank IC': 0.02102891742526016,
 'Rank ICIR': 0.17747851179370083}
[2258322:MainThread](2024-04-23 02:51:54,056) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2258322:MainThread](2024-04-23 02:52:07,052) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:52:07,054) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:52:11,303) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fa401171fa0>
backtest loop:   0%|          | 0/485 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 3/485 [00:00<00:30, 15.68it/s]backtest loop:   2%|▏         | 9/485 [00:00<00:14, 31.79it/s]backtest loop:   3%|▎         | 15/485 [00:00<00:11, 41.57it/s]backtest loop:   4%|▍         | 21/485 [00:00<00:10, 44.66it/s]backtest loop:   6%|▌         | 27/485 [00:00<00:09, 48.77it/s]backtest loop:   7%|▋         | 34/485 [00:00<00:08, 53.32it/s]backtest loop:   8%|▊         | 40/485 [00:00<00:08, 51.83it/s]backtest loop:   9%|▉         | 46/485 [00:00<00:08, 53.93it/s]backtest loop:  11%|█         | 53/485 [00:01<00:07, 56.63it/s]backtest loop:  12%|█▏        | 60/485 [00:01<00:07, 55.13it/s]backtest loop:  14%|█▍        | 67/485 [00:01<00:07, 57.15it/s]backtest loop:  15%|█▌        | 73/485 [00:01<00:07, 57.69it/s]backtest loop:  16%|█▋        | 79/485 [00:01<00:06, 58.33it/s]backtest loop:  18%|█▊        | 85/485 [00:01<00:07, 55.21it/s]backtest loop:  19%|█▉        | 91/485 [00:01<00:07, 56.09it/s]backtest loop:  20%|██        | 97/485 [00:02<00:10, 35.31it/s]backtest loop:  21%|██        | 103/485 [00:02<00:09, 40.03it/s]backtest loop:  22%|██▏       | 109/485 [00:02<00:08, 44.35it/s]backtest loop:  24%|██▎       | 115/485 [00:02<00:08, 45.69it/s]backtest loop:  25%|██▌       | 122/485 [00:02<00:07, 50.11it/s]backtest loop:  26%|██▋       | 128/485 [00:02<00:06, 52.51it/s]backtest loop:  28%|██▊       | 134/485 [00:02<00:06, 51.64it/s]backtest loop:  29%|██▉       | 140/485 [00:02<00:06, 53.74it/s]backtest loop:  30%|███       | 146/485 [00:02<00:06, 54.95it/s]backtest loop:  31%|███▏      | 152/485 [00:03<00:05, 56.24it/s]backtest loop:  33%|███▎      | 158/485 [00:03<00:05, 56.58it/s]backtest loop:  34%|███▍      | 164/485 [00:03<00:05, 54.03it/s]backtest loop:  35%|███▌      | 171/485 [00:03<00:05, 56.46it/s]backtest loop:  36%|███▋      | 177/485 [00:03<00:05, 57.33it/s]backtest loop:  38%|███▊      | 183/485 [00:03<00:05, 58.06it/s]backtest loop:  39%|███▉      | 189/485 [00:03<00:05, 55.10it/s]backtest loop:  40%|████      | 195/485 [00:03<00:05, 56.40it/s]backtest loop:  42%|████▏     | 202/485 [00:03<00:04, 58.42it/s]backtest loop:  43%|████▎     | 208/485 [00:04<00:04, 55.42it/s]backtest loop:  44%|████▍     | 215/485 [00:04<00:04, 57.35it/s]backtest loop:  46%|████▌     | 221/485 [00:04<00:04, 58.03it/s]backtest loop:  47%|████▋     | 227/485 [00:04<00:04, 58.41it/s]backtest loop:  48%|████▊     | 233/485 [00:04<00:04, 55.53it/s]backtest loop:  49%|████▉     | 239/485 [00:04<00:04, 56.28it/s]backtest loop:  51%|█████     | 245/485 [00:04<00:04, 54.25it/s]backtest loop:  52%|█████▏    | 252/485 [00:04<00:04, 53.52it/s]backtest loop:  53%|█████▎    | 259/485 [00:04<00:04, 55.90it/s]backtest loop:  55%|█████▍    | 265/485 [00:05<00:04, 53.87it/s]backtest loop:  56%|█████▌    | 272/485 [00:05<00:03, 56.24it/s]backtest loop:  57%|█████▋    | 278/485 [00:05<00:03, 57.15it/s]backtest loop:  59%|█████▊    | 284/485 [00:05<00:03, 55.84it/s]backtest loop:  60%|██████    | 291/485 [00:05<00:03, 58.52it/s]backtest loop:  61%|██████    | 297/485 [00:05<00:03, 55.61it/s]backtest loop:  62%|██████▏   | 303/485 [00:05<00:03, 56.62it/s]backtest loop:  64%|██████▎   | 309/485 [00:05<00:03, 57.11it/s]backtest loop:  65%|██████▌   | 316/485 [00:05<00:02, 58.75it/s]backtest loop:  66%|██████▋   | 322/485 [00:06<00:02, 55.47it/s]backtest loop:  68%|██████▊   | 328/485 [00:06<00:02, 56.62it/s]backtest loop:  69%|██████▉   | 334/485 [00:06<00:02, 57.37it/s]backtest loop:  70%|███████   | 340/485 [00:06<00:02, 57.92it/s]backtest loop:  71%|███████▏  | 346/485 [00:06<00:02, 58.30it/s]backtest loop:  73%|███████▎  | 352/485 [00:06<00:02, 54.86it/s]backtest loop:  74%|███████▍  | 358/485 [00:06<00:02, 56.08it/s]backtest loop:  75%|███████▌  | 364/485 [00:06<00:02, 56.48it/s]backtest loop:  76%|███████▋  | 370/485 [00:06<00:02, 57.36it/s]backtest loop:  78%|███████▊  | 376/485 [00:07<00:02, 53.23it/s]backtest loop:  79%|███████▉  | 382/485 [00:07<00:01, 54.88it/s]backtest loop:  80%|████████  | 388/485 [00:07<00:01, 55.80it/s]backtest loop:  81%|████████  | 394/485 [00:07<00:01, 56.87it/s]backtest loop:  82%|████████▏ | 400/485 [00:07<00:01, 57.52it/s]backtest loop:  84%|████████▎ | 406/485 [00:07<00:01, 54.53it/s]backtest loop:  85%|████████▍ | 412/485 [00:07<00:01, 55.83it/s]backtest loop:  86%|████████▌ | 418/485 [00:07<00:01, 56.73it/s]backtest loop:  87%|████████▋ | 424/485 [00:07<00:01, 57.40it/s]backtest loop:  89%|████████▊ | 430/485 [00:07<00:01, 54.64it/s]backtest loop:  90%|████████▉ | 436/485 [00:08<00:00, 55.68it/s]backtest loop:  91%|█████████ | 442/485 [00:08<00:00, 56.74it/s]backtest loop:  92%|█████████▏| 448/485 [00:08<00:00, 57.14it/s]backtest loop:  94%|█████████▎| 454/485 [00:08<00:00, 54.34it/s]backtest loop:  95%|█████████▍| 460/485 [00:08<00:00, 55.53it/s]backtest loop:  96%|█████████▌| 466/485 [00:08<00:00, 56.59it/s]backtest loop:  97%|█████████▋| 472/485 [00:08<00:00, 57.00it/s]backtest loop:  99%|█████████▊| 478/485 [00:08<00:00, 57.71it/s]backtest loop: 100%|█████████▉| 484/485 [00:08<00:00, 54.37it/s]backtest loop: 100%|██████████| 485/485 [00:08<00:00, 54.08it/s]
[2258322:MainThread](2024-04-23 02:52:20,319) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of benchmark return(1day).'
                       risk
mean              -0.000251
std                0.012236
annualized_return -0.059709
information_ratio -0.316310
max_drawdown      -0.360543
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000400
std                0.004185
annualized_return  0.095117
information_ratio  1.473126
max_drawdown      -0.043190
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000204
std                0.004186
annualized_return  0.048630
information_ratio  0.753028
max_drawdown      -0.061170
[2258322:MainThread](2024-04-23 02:52:20,334) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-23_02:20:32_online`.
("Round 3 finished, all metrics: {'mse': [0.99784255027771, "
 "0.9978535175323486, 0.9978874921798706, 0.9978873133659363], 'mae': "
 '[0.6835434436798096, 0.683663547039032, 0.6837469339370728, '
 "0.6835277676582336], 'IC': [0.01784173241051523, 0.02015808623370553, "
 "0.017091133068949278, 0.01801475098528568], 'ICIR': [0.15106715081350705, "
 "0.1720743710890689, 0.14634987603826485, 0.14684051783526555], 'Rank IC': "
 '[0.02120073880291459, 0.019896714287564066, 0.019068803383595855, '
 "0.02102891742526016], 'Rank ICIR': [0.18422340349548189, "
 '0.17584010891617827, 0.16833290132828618, 0.17747851179370083], '
 "'1day.excess_return_with_cost.annualized_return': [0.046728546811842735, "
 '0.016011744083066288, 0.00783183872679854, 0.048630473637481804], '
 "'1day.excess_return_with_cost.information_ratio': [0.7147947586283061, "
 '0.26186336677355665, 0.12199508356093612, 0.753027871010817]}')
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2258322:MainThread](2024-04-23 02:52:21,085) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2258322:MainThread](2024-04-23 02:52:21,086) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:12<21:20, 12.94s/it]epoch:   2%|▏         | 2/100 [00:25<21:07, 12.93s/it]epoch:   3%|▎         | 3/100 [00:38<20:48, 12.87s/it]epoch:   4%|▍         | 4/100 [00:51<20:32, 12.84s/it]epoch:   5%|▌         | 5/100 [01:04<20:14, 12.78s/it]epoch:   6%|▌         | 6/100 [01:16<20:01, 12.78s/it]epoch:   7%|▋         | 7/100 [01:29<19:43, 12.72s/it]epoch:   8%|▊         | 8/100 [01:42<19:30, 12.73s/it]epoch:   9%|▉         | 9/100 [01:54<19:10, 12.64s/it]epoch:  10%|█         | 10/100 [02:07<18:59, 12.66s/it]epoch:  11%|█         | 11/100 [02:19<18:40, 12.59s/it]epoch:  12%|█▏        | 12/100 [02:32<18:34, 12.67s/it]epoch:  13%|█▎        | 13/100 [02:45<18:19, 12.64s/it]epoch:  14%|█▍        | 14/100 [02:57<18:03, 12.60s/it]epoch:  15%|█▌        | 15/100 [03:10<17:55, 12.65s/it]epoch:  16%|█▌        | 16/100 [03:22<17:35, 12.56s/it]epoch:  17%|█▋        | 17/100 [03:35<17:17, 12.50s/it]epoch:  18%|█▊        | 18/100 [03:47<17:08, 12.54s/it]epoch:  19%|█▉        | 19/100 [04:00<16:59, 12.58s/it]epoch:  20%|██        | 20/100 [04:12<16:41, 12.52s/it]0.03174548193329147
best ic: 0.03174548193329147
epoch:  21%|██        | 21/100 [04:28<17:32, 13.32s/it]0.03145383217606922
epoch:  22%|██▏       | 22/100 [04:43<18:06, 13.93s/it]0.03035060102594925
epoch:  23%|██▎       | 23/100 [04:58<18:27, 14.38s/it]0.027148645447870445
epoch:  24%|██▍       | 24/100 [05:14<18:30, 14.61s/it]0.03006254002520683
epoch:  25%|██▌       | 25/100 [05:29<18:27, 14.76s/it]0.027325735166553438
epoch:  26%|██▌       | 26/100 [05:44<18:27, 14.96s/it]0.029499288204367247
epoch:  27%|██▋       | 27/100 [06:00<18:23, 15.12s/it]0.02934673725714489
epoch:  28%|██▊       | 28/100 [06:15<18:09, 15.13s/it]0.03069430181367063
epoch:  28%|██▊       | 28/100 [06:30<16:43, 13.94s/it]
Test segment: 2022-04-01 00:00:00 2024-03-29 00:00:00
[2258322:MainThread](2024-04-23 02:58:51,489) INFO - qlib.workflow - [exp.py:258] - Experiment 6 starts running ...
[2258322:MainThread](2024-04-23 02:58:51,499) INFO - qlib.workflow - [recorder.py:341] - Recorder 0bc7ae197f1b47409b4071d6fc7a196f starts running under Experiment 6 ...
online:   0%|          | 0/51 [00:00<?, ?it/s]online:   4%|▍         | 2/51 [00:00<00:04, 10.80it/s]online:   8%|▊         | 4/51 [00:00<00:04, 10.55it/s]online:  12%|█▏        | 6/51 [00:00<00:04, 10.76it/s]online:  16%|█▌        | 8/51 [00:00<00:03, 10.76it/s]online:  20%|█▉        | 10/51 [00:00<00:03, 10.75it/s]online:  24%|██▎       | 12/51 [00:01<00:03, 10.62it/s]online:  27%|██▋       | 14/51 [00:01<00:03, 10.68it/s]online:  31%|███▏      | 16/51 [00:01<00:03, 10.76it/s]online:  35%|███▌      | 18/51 [00:01<00:03, 10.78it/s]online:  39%|███▉      | 20/51 [00:01<00:02, 10.78it/s]online:  43%|████▎     | 22/51 [00:02<00:02, 10.78it/s]online:  47%|████▋     | 24/51 [00:02<00:02, 10.80it/s]online:  51%|█████     | 26/51 [00:02<00:02, 10.81it/s]online:  55%|█████▍    | 28/51 [00:02<00:02, 10.74it/s]online:  59%|█████▉    | 30/51 [00:02<00:01, 10.80it/s]online:  63%|██████▎   | 32/51 [00:02<00:01, 10.82it/s]online:  67%|██████▋   | 34/51 [00:03<00:01, 10.82it/s]online:  71%|███████   | 36/51 [00:03<00:01, 10.82it/s]online:  75%|███████▍  | 38/51 [00:03<00:01, 10.79it/s]online:  78%|███████▊  | 40/51 [00:03<00:01, 10.79it/s]online:  82%|████████▏ | 42/51 [00:03<00:00, 10.73it/s]online:  86%|████████▋ | 44/51 [00:04<00:00, 10.82it/s]online:  90%|█████████ | 46/51 [00:04<00:00, 10.80it/s]online:  94%|█████████▍| 48/51 [00:04<00:00, 10.82it/s]online:  98%|█████████▊| 50/51 [00:04<00:00, 10.78it/s]online: 100%|██████████| 51/51 [00:04<00:00, 10.81it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2258322:MainThread](2024-04-23 02:59:06,889) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99753803 mae 0.68342245
{'IC': 0.02190171997800886,
 'ICIR': 0.1829979697523402,
 'Rank IC': 0.026621935658434983,
 'Rank ICIR': 0.2273009991594001}
[2258322:MainThread](2024-04-23 02:59:07,826) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2258322:MainThread](2024-04-23 02:59:20,904) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:59:20,906) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2258322:MainThread](2024-04-23 02:59:25,287) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fa0a5ca6310>
backtest loop:   0%|          | 0/485 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 3/485 [00:00<00:32, 14.80it/s]backtest loop:   2%|▏         | 9/485 [00:00<00:15, 30.32it/s]backtest loop:   3%|▎         | 15/485 [00:00<00:11, 39.88it/s]backtest loop:   4%|▍         | 21/485 [00:00<00:10, 43.45it/s]backtest loop:   6%|▌         | 27/485 [00:00<00:09, 48.27it/s]backtest loop:   7%|▋         | 34/485 [00:00<00:08, 52.97it/s]backtest loop:   8%|▊         | 40/485 [00:00<00:08, 51.62it/s]backtest loop:   9%|▉         | 46/485 [00:00<00:08, 53.88it/s]backtest loop:  11%|█         | 53/485 [00:01<00:07, 56.33it/s]backtest loop:  12%|█▏        | 60/485 [00:01<00:07, 55.03it/s]backtest loop:  14%|█▎        | 66/485 [00:01<00:07, 55.91it/s]backtest loop:  15%|█▍        | 72/485 [00:01<00:07, 56.91it/s]backtest loop:  16%|█▋        | 79/485 [00:01<00:06, 58.20it/s]backtest loop:  18%|█▊        | 85/485 [00:01<00:07, 55.51it/s]backtest loop:  19%|█▉        | 91/485 [00:01<00:06, 56.42it/s]backtest loop:  20%|██        | 97/485 [00:01<00:06, 57.29it/s]backtest loop:  21%|██        | 103/485 [00:01<00:06, 58.05it/s]backtest loop:  22%|██▏       | 109/485 [00:02<00:10, 36.14it/s]backtest loop:  24%|██▎       | 114/485 [00:02<00:09, 38.27it/s]backtest loop:  25%|██▍       | 121/485 [00:02<00:08, 44.14it/s]backtest loop:  26%|██▌       | 127/485 [00:02<00:07, 47.75it/s]backtest loop:  27%|██▋       | 133/485 [00:02<00:06, 50.47it/s]backtest loop:  29%|██▊       | 139/485 [00:02<00:06, 49.83it/s]backtest loop:  30%|███       | 146/485 [00:02<00:06, 53.21it/s]backtest loop:  31%|███▏      | 152/485 [00:03<00:06, 54.95it/s]backtest loop:  33%|███▎      | 158/485 [00:03<00:05, 56.29it/s]backtest loop:  34%|███▍      | 164/485 [00:03<00:05, 54.11it/s]backtest loop:  35%|███▌      | 171/485 [00:03<00:05, 56.60it/s]backtest loop:  37%|███▋      | 178/485 [00:03<00:05, 58.18it/s]backtest loop:  38%|███▊      | 184/485 [00:03<00:05, 55.41it/s]backtest loop:  39%|███▉      | 190/485 [00:03<00:05, 56.36it/s]backtest loop:  41%|████      | 197/485 [00:03<00:04, 58.16it/s]backtest loop:  42%|████▏     | 203/485 [00:03<00:05, 55.71it/s]backtest loop:  43%|████▎     | 209/485 [00:04<00:04, 56.87it/s]backtest loop:  44%|████▍     | 215/485 [00:04<00:04, 57.59it/s]backtest loop:  46%|████▌     | 221/485 [00:04<00:04, 57.87it/s]backtest loop:  47%|████▋     | 227/485 [00:04<00:04, 58.45it/s]backtest loop:  48%|████▊     | 233/485 [00:04<00:04, 55.58it/s]backtest loop:  49%|████▉     | 239/485 [00:04<00:04, 56.74it/s]backtest loop:  51%|█████     | 245/485 [00:04<00:04, 54.45it/s]backtest loop:  52%|█████▏    | 252/485 [00:04<00:04, 53.68it/s]backtest loop:  53%|█████▎    | 259/485 [00:04<00:04, 56.26it/s]backtest loop:  55%|█████▍    | 265/485 [00:05<00:04, 53.88it/s]backtest loop:  56%|█████▌    | 271/485 [00:05<00:03, 55.34it/s]backtest loop:  57%|█████▋    | 278/485 [00:05<00:03, 57.48it/s]backtest loop:  59%|█████▊    | 284/485 [00:05<00:03, 55.84it/s]backtest loop:  60%|██████    | 291/485 [00:05<00:03, 57.07it/s]backtest loop:  61%|██████    | 297/485 [00:05<00:03, 54.25it/s]backtest loop:  62%|██████▏   | 303/485 [00:05<00:03, 55.35it/s]backtest loop:  64%|██████▎   | 309/485 [00:05<00:03, 56.46it/s]backtest loop:  65%|██████▌   | 316/485 [00:05<00:02, 58.20it/s]backtest loop:  66%|██████▋   | 322/485 [00:06<00:02, 55.27it/s]backtest loop:  68%|██████▊   | 329/485 [00:06<00:02, 57.19it/s]backtest loop:  69%|██████▉   | 335/485 [00:06<00:02, 57.77it/s]backtest loop:  71%|███████   | 342/485 [00:06<00:02, 55.65it/s]backtest loop:  72%|███████▏  | 348/485 [00:06<00:02, 56.63it/s]backtest loop:  73%|███████▎  | 354/485 [00:06<00:02, 56.97it/s]backtest loop:  74%|███████▍  | 360/485 [00:06<00:02, 57.65it/s]backtest loop:  75%|███████▌  | 366/485 [00:06<00:02, 54.33it/s]backtest loop:  77%|███████▋  | 372/485 [00:06<00:02, 55.70it/s]backtest loop:  78%|███████▊  | 378/485 [00:07<00:01, 56.56it/s]backtest loop:  79%|███████▉  | 384/485 [00:07<00:01, 57.42it/s]backtest loop:  80%|████████  | 390/485 [00:07<00:01, 57.84it/s]backtest loop:  82%|████████▏ | 396/485 [00:07<00:01, 55.04it/s]backtest loop:  83%|████████▎ | 402/485 [00:07<00:01, 56.14it/s]backtest loop:  84%|████████▍ | 408/485 [00:07<00:01, 57.08it/s]backtest loop:  85%|████████▌ | 414/485 [00:07<00:01, 57.85it/s]backtest loop:  87%|████████▋ | 420/485 [00:07<00:01, 58.40it/s]backtest loop:  88%|████████▊ | 426/485 [00:07<00:01, 55.37it/s]backtest loop:  89%|████████▉ | 432/485 [00:08<00:00, 56.46it/s]backtest loop:  90%|█████████ | 438/485 [00:08<00:00, 57.09it/s]backtest loop:  92%|█████████▏| 445/485 [00:08<00:00, 55.30it/s]backtest loop:  93%|█████████▎| 451/485 [00:08<00:00, 56.19it/s]backtest loop:  94%|█████████▍| 457/485 [00:08<00:00, 57.20it/s]backtest loop:  95%|█████████▌| 463/485 [00:08<00:00, 57.72it/s]backtest loop:  97%|█████████▋| 469/485 [00:08<00:00, 54.88it/s]backtest loop:  98%|█████████▊| 475/485 [00:08<00:00, 56.05it/s]backtest loop:  99%|█████████▉| 481/485 [00:08<00:00, 57.14it/s]backtest loop: 100%|██████████| 485/485 [00:08<00:00, 54.14it/s]
[2258322:MainThread](2024-04-23 02:59:34,293) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of benchmark return(1day).'
                       risk
mean              -0.000251
std                0.012236
annualized_return -0.059709
information_ratio -0.316310
max_drawdown      -0.360543
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000512
std                0.004070
annualized_return  0.121901
information_ratio  1.941219
max_drawdown      -0.039347
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000317
std                0.004070
annualized_return  0.075494
information_ratio  1.202270
max_drawdown      -0.048269
[2258322:MainThread](2024-04-23 02:59:34,307) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 6
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-23_02:20:32_online`.
("Round 4 finished, all metrics: {'mse': [0.99784255027771, "
 '0.9978535175323486, 0.9978874921798706, 0.9978873133659363, '
 "0.9975380301475525], 'mae': [0.6835434436798096, 0.683663547039032, "
 "0.6837469339370728, 0.6835277676582336, 0.6834224462509155], 'IC': "
 '[0.01784173241051523, 0.02015808623370553, 0.017091133068949278, '
 "0.01801475098528568, 0.02190171997800886], 'ICIR': [0.15106715081350705, "
 '0.1720743710890689, 0.14634987603826485, 0.14684051783526555, '
 "0.1829979697523402], 'Rank IC': [0.02120073880291459, 0.019896714287564066, "
 "0.019068803383595855, 0.02102891742526016, 0.026621935658434983], 'Rank "
 "ICIR': [0.18422340349548189, 0.17584010891617827, 0.16833290132828618, "
 '0.17747851179370083, 0.2273009991594001], '
 "'1day.excess_return_with_cost.annualized_return': [0.046728546811842735, "
 '0.016011744083066288, 0.00783183872679854, 0.048630473637481804, '
 "0.07549403872417716], '1day.excess_return_with_cost.information_ratio': "
 '[0.7147947586283061, 0.26186336677355665, 0.12199508356093612, '
 '0.753027871010817, 1.2022699137026038]}')
[2258322:MainThread](2024-04-23 02:59:35,044) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-23_02:20:32_final.
[2258322:MainThread](2024-04-23 02:59:35,050) INFO - qlib.workflow - [exp.py:258] - Experiment 9 starts running ...
[2258322:MainThread](2024-04-23 02:59:35,059) INFO - qlib.workflow - [recorder.py:341] - Recorder 32dc5a8d7aea4754aee144f62771317c starts running under Experiment 9 ...
Time cost: 425.224972820282	43.35787844657898
("Final results: {'mse': [0.9978017807006836, 0.00013309057587091735], 'mae': "
 "[0.6835808277130127, 0.00011289941315728846], 'IC': [0.019001484535292917, "
 "0.0017729751225865652], 'ICIR': [0.1598659771056893, 0.014925822515683538], "
 "'Rank IC': [0.021563421911553932, 0.0026460094978832823], 'Rank ICIR': "
 '[0.18663518493860948, 0.020951740026712535], '
 "'1day.excess_return_with_cost.annualized_return': [0.038939328396673314, "
 "0.02443025625221439], '1day.excess_return_with_cost.information_ratio': "
 '[0.610790198735244, 0.38511488046864056]}')
Your final results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-23_02:20:32_final`.
All Done!
Exception in thread Thread-23:
Traceback (most recent call last):
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 12, in _try_get_item
    return x.item()
ValueError: can only convert an array of size 1 to a Python scalar

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/paral.py", line 91, in run
    data()
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/workflow/recorder.py", line 449, in log_metrics
    self.client.log_metric(self.id, name, data, step=step)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/client.py", line 821, in log_metric
    self._tracking_client.log_metric(run_id, key, value, timestamp, step)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/_tracking_service/client.py", line 305, in log_metric
    metric_value = convert_metric_value_to_float_if_possible(value)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 47, in convert_metric_value_to_float_if_possible
    possible_float = converter_fn(x)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 29, in wrapper
    return func(x)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 62, in convert_metric_value_to_float_if_ndarray
    return float(_try_get_item(x))
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 14, in _try_get_item
    raise MlflowException(
mlflow.exceptions.MlflowException: Failed to convert metric value to float: can only convert an array of size 1 to a Python scalar
[2258322:MainThread](2024-04-23 02:59:36,056) INFO - qlib.timer - [log.py:127] - Time cost: 0.002s | waiting `async_log` Done
