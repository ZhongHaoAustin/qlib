['main.py', 'run_all', '--forecast_model', 'LSTM', '-num_head', '8', '--tau', '10', '--lr_da', '0.01', '--market', 'csi500', '--data_dir', 'crowd_data', '--rank_label', 'False', '--begin_valid_epoch', '20']
[2165750:MainThread](2024-04-22 15:50:29,546) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[2165750:MainThread](2024-04-22 15:50:29,549) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[2165750:MainThread](2024-04-22 15:50:29,549) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Remove CSRankNorm
{'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': datetime.date(2008, 1, 1), 'end_time': datetime.date(2020, 8, 1), 'fit_start_time': datetime.date(2008, 1, 1), 'fit_end_time': datetime.date(2014, 12, 31), 'instruments': 'csi500', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSZScoreNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
{'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': [datetime.date(2008, 1, 1), datetime.date(2014, 12, 31)], 'valid': [datetime.date(2015, 1, 1), datetime.date(2016, 12, 31)], 'test': [datetime.date(2017, 1, 1), datetime.date(2020, 8, 1)]}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
[2165750:MainThread](2024-04-22 15:50:37,911) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-02 00:00:00'), Timestamp('2008-01-29 00:00:00')), 'test': (Timestamp('2008-01-31 00:00:00'), Timestamp('2008-03-05 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/108 [00:00<?, ?it/s]creating meta tasks:  32%|███▏      | 35/108 [00:00<00:00, 347.98it/s]creating meta tasks:  69%|██████▉   | 75/108 [00:00<00:00, 375.06it/s]creating meta tasks: 100%|██████████| 108/108 [00:00<00:00, 378.25it/s]
[2165750:MainThread](2024-04-22 15:50:38,490) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2015-01-05 00:00:00'), Timestamp('2015-01-30 00:00:00')), 'test': (Timestamp('2015-02-03 00:00:00'), Timestamp('2015-03-09 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/67 [00:00<?, ?it/s]creating meta tasks:  60%|█████▉    | 40/67 [00:00<00:00, 399.78it/s]creating meta tasks: 100%|██████████| 67/67 [00:00<00:00, 379.89it/s]
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2165750:MainThread](2024-04-22 15:50:39,524) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2165750:MainThread](2024-04-22 15:50:39,597) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:10<17:44, 10.76s/it]epoch:   2%|▏         | 2/100 [00:20<16:54, 10.35s/it]epoch:   3%|▎         | 3/100 [00:31<16:36, 10.27s/it]epoch:   4%|▍         | 4/100 [00:40<16:11, 10.12s/it]epoch:   5%|▌         | 5/100 [00:50<15:56, 10.06s/it]epoch:   6%|▌         | 6/100 [01:00<15:41, 10.01s/it]epoch:   7%|▋         | 7/100 [01:10<15:34, 10.05s/it]epoch:   8%|▊         | 8/100 [01:20<15:14,  9.94s/it]epoch:   9%|▉         | 9/100 [01:30<15:08,  9.98s/it]epoch:  10%|█         | 10/100 [01:40<14:47,  9.86s/it]epoch:  11%|█         | 11/100 [01:50<14:36,  9.85s/it]epoch:  12%|█▏        | 12/100 [01:59<14:26,  9.84s/it]epoch:  13%|█▎        | 13/100 [02:09<14:11,  9.78s/it]epoch:  14%|█▍        | 14/100 [02:19<14:03,  9.81s/it]epoch:  15%|█▌        | 15/100 [02:29<13:53,  9.81s/it]epoch:  16%|█▌        | 16/100 [02:39<13:46,  9.84s/it]epoch:  17%|█▋        | 17/100 [02:48<13:32,  9.79s/it]epoch:  18%|█▊        | 18/100 [02:58<13:22,  9.79s/it]epoch:  19%|█▉        | 19/100 [03:08<13:15,  9.82s/it]epoch:  20%|██        | 20/100 [03:18<13:05,  9.82s/it]0.09601457374038505
best ic: 0.09601457374038505
epoch:  21%|██        | 21/100 [03:31<14:08, 10.74s/it]0.09433548304052003
epoch:  22%|██▏       | 22/100 [03:43<14:44, 11.34s/it]0.09675359918262243
best ic: 0.09675359918262243
epoch:  23%|██▎       | 23/100 [03:57<15:13, 11.87s/it]0.09818716755360292
best ic: 0.09818716755360292
epoch:  24%|██▍       | 24/100 [04:10<15:27, 12.20s/it]0.0973573119578938
epoch:  25%|██▌       | 25/100 [04:22<15:27, 12.37s/it]0.09734340260407241
epoch:  26%|██▌       | 26/100 [04:35<15:16, 12.38s/it]0.09929245098320762
best ic: 0.09929245098320762
epoch:  27%|██▋       | 27/100 [04:48<15:14, 12.53s/it]0.10217791897306679
best ic: 0.10217791897306679
epoch:  28%|██▊       | 28/100 [05:00<15:06, 12.58s/it]0.1004027178069338
epoch:  29%|██▉       | 29/100 [05:13<14:54, 12.60s/it]0.10118202687129406
epoch:  30%|███       | 30/100 [05:26<14:48, 12.69s/it]0.10092101559891613
epoch:  31%|███       | 31/100 [05:39<14:40, 12.76s/it]0.10335593308299905
best ic: 0.10335593308299905
epoch:  32%|███▏      | 32/100 [05:52<14:31, 12.82s/it]0.10147865475468475
epoch:  33%|███▎      | 33/100 [06:04<14:16, 12.79s/it]0.0983973321493869
epoch:  34%|███▍      | 34/100 [06:17<14:08, 12.86s/it]0.10235492536856364
epoch:  35%|███▌      | 35/100 [06:30<13:55, 12.86s/it]0.10118409964179165
epoch:  36%|███▌      | 36/100 [06:43<13:38, 12.79s/it]0.09879595797715722
epoch:  37%|███▋      | 37/100 [06:56<13:27, 12.83s/it]0.1014254937544813
epoch:  38%|███▊      | 38/100 [07:09<13:16, 12.85s/it]0.10120731921328427
epoch:  39%|███▉      | 39/100 [07:22<13:05, 12.87s/it]0.1034421996107407
best ic: 0.1034421996107407
epoch:  40%|████      | 40/100 [07:34<12:49, 12.82s/it]0.10369186510328147
best ic: 0.10369186510328147
epoch:  41%|████      | 41/100 [07:47<12:36, 12.82s/it]0.10126214653410776
epoch:  42%|████▏     | 42/100 [08:00<12:29, 12.92s/it]0.10403296476367138
best ic: 0.10403296476367138
epoch:  43%|████▎     | 43/100 [08:13<12:13, 12.86s/it]0.09887428543851179
epoch:  44%|████▍     | 44/100 [08:26<12:03, 12.92s/it]0.10240622604243788
epoch:  45%|████▌     | 45/100 [08:39<11:51, 12.94s/it]0.09937368482832536
epoch:  46%|████▌     | 46/100 [08:52<11:37, 12.91s/it]0.1029673295667043
epoch:  47%|████▋     | 47/100 [09:05<11:22, 12.88s/it]0.1015286350280673
epoch:  48%|████▊     | 48/100 [09:17<11:07, 12.83s/it]0.09995141228967928
epoch:  49%|████▉     | 49/100 [09:30<10:57, 12.88s/it]0.09629456797069008
epoch:  50%|█████     | 50/100 [09:43<10:41, 12.83s/it]0.09860425112742438
epoch:  50%|█████     | 50/100 [09:56<09:56, 11.93s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2165750:MainThread](2024-04-22 16:00:38,985) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-22_15:50:39_online.
[2165750:MainThread](2024-04-22 16:00:38,992) INFO - qlib.workflow - [exp.py:258] - Experiment 11 starts running ...
[2165750:MainThread](2024-04-22 16:00:40,003) INFO - qlib.workflow - [recorder.py:341] - Recorder 700e3d648b9d4372ba8a1f6f09a71d1f starts running under Experiment 11 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   1%|▏         | 1/67 [00:00<00:07,  9.04it/s]online:   3%|▎         | 2/67 [00:00<00:10,  6.34it/s]online:   4%|▍         | 3/67 [00:00<00:10,  5.94it/s]online:   7%|▋         | 5/67 [00:00<00:07,  8.06it/s]online:   9%|▉         | 6/67 [00:00<00:07,  8.08it/s]online:  12%|█▏        | 8/67 [00:00<00:06,  9.44it/s]online:  15%|█▍        | 10/67 [00:01<00:05,  9.59it/s]online:  16%|█▋        | 11/67 [00:01<00:06,  8.27it/s]online:  18%|█▊        | 12/67 [00:01<00:07,  7.36it/s]online:  19%|█▉        | 13/67 [00:01<00:08,  6.71it/s]online:  21%|██        | 14/67 [00:01<00:08,  6.32it/s]online:  22%|██▏       | 15/67 [00:02<00:08,  6.39it/s]online:  25%|██▌       | 17/67 [00:02<00:06,  7.71it/s]online:  28%|██▊       | 19/67 [00:02<00:05,  8.56it/s]online:  30%|██▉       | 20/67 [00:02<00:05,  8.19it/s]online:  31%|███▏      | 21/67 [00:02<00:05,  8.15it/s]online:  34%|███▍      | 23/67 [00:02<00:04,  8.93it/s]online:  37%|███▋      | 25/67 [00:03<00:04,  9.50it/s]online:  40%|████      | 27/67 [00:03<00:04,  9.88it/s]online:  43%|████▎     | 29/67 [00:03<00:04,  8.65it/s]online:  45%|████▍     | 30/67 [00:03<00:04,  7.70it/s]online:  46%|████▋     | 31/67 [00:03<00:04,  7.83it/s]online:  49%|████▉     | 33/67 [00:04<00:04,  8.14it/s]online:  52%|█████▏    | 35/67 [00:04<00:03,  8.79it/s]online:  55%|█████▌    | 37/67 [00:04<00:03,  8.82it/s]online:  57%|█████▋    | 38/67 [00:04<00:03,  7.86it/s]online:  58%|█████▊    | 39/67 [00:04<00:03,  7.18it/s]online:  60%|█████▉    | 40/67 [00:05<00:03,  6.85it/s]online:  63%|██████▎   | 42/67 [00:05<00:03,  8.04it/s]online:  66%|██████▌   | 44/67 [00:05<00:02,  8.14it/s]online:  69%|██████▊   | 46/67 [00:05<00:02,  8.76it/s]online:  70%|███████   | 47/67 [00:05<00:02,  8.86it/s]online:  73%|███████▎  | 49/67 [00:06<00:03,  5.88it/s]online:  76%|███████▌  | 51/67 [00:06<00:02,  6.61it/s]online:  78%|███████▊  | 52/67 [00:06<00:02,  6.94it/s]online:  81%|████████  | 54/67 [00:06<00:01,  7.81it/s]online:  82%|████████▏ | 55/67 [00:06<00:01,  8.10it/s]online:  84%|████████▎ | 56/67 [00:07<00:01,  7.62it/s]online:  85%|████████▌ | 57/67 [00:07<00:01,  6.74it/s]online:  87%|████████▋ | 58/67 [00:07<00:01,  6.97it/s]online:  88%|████████▊ | 59/67 [00:07<00:01,  7.58it/s]online:  90%|████████▉ | 60/67 [00:07<00:00,  7.64it/s]online:  91%|█████████ | 61/67 [00:07<00:00,  8.18it/s]online:  93%|█████████▎| 62/67 [00:07<00:00,  8.57it/s]online:  94%|█████████▍| 63/67 [00:08<00:00,  7.21it/s]online:  96%|█████████▌| 64/67 [00:08<00:00,  6.44it/s]online:  97%|█████████▋| 65/67 [00:08<00:00,  6.58it/s]online:  99%|█████████▊| 66/67 [00:08<00:00,  7.31it/s]online: 100%|██████████| 67/67 [00:08<00:00,  7.60it/s]online: 100%|██████████| 67/67 [00:08<00:00,  7.76it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2165750:MainThread](2024-04-22 16:00:56,647) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9952144 mae 0.68434465
{'IC': 0.062365012060450746,
 'ICIR': 0.6013576218619284,
 'Rank IC': 0.05935208231460742,
 'Rank ICIR': 0.6095345356103196}
[2165750:MainThread](2024-04-22 16:00:58,307) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2165750:MainThread](2024-04-22 16:01:08,700) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:01:08,705) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:01:13,043) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fee74c30e50>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 5/872 [00:00<00:18, 48.00it/s]backtest loop:   1%|▏         | 11/872 [00:00<00:16, 51.32it/s]backtest loop:   2%|▏         | 17/872 [00:00<00:16, 52.46it/s]backtest loop:   3%|▎         | 23/872 [00:00<00:17, 49.15it/s]backtest loop:   3%|▎         | 29/872 [00:00<00:17, 47.52it/s]backtest loop:   4%|▍         | 35/872 [00:00<00:16, 49.76it/s]backtest loop:   5%|▍         | 41/872 [00:00<00:16, 51.27it/s]backtest loop:   5%|▌         | 47/872 [00:00<00:15, 52.23it/s]backtest loop:   6%|▌         | 53/872 [00:01<00:15, 53.07it/s]backtest loop:   7%|▋         | 59/872 [00:01<00:16, 50.30it/s]backtest loop:   7%|▋         | 65/872 [00:01<00:15, 51.71it/s]backtest loop:   8%|▊         | 71/872 [00:01<00:15, 52.70it/s]backtest loop:   9%|▉         | 77/872 [00:01<00:15, 50.22it/s]backtest loop:  10%|▉         | 83/872 [00:01<00:15, 51.40it/s]backtest loop:  10%|█         | 89/872 [00:01<00:15, 51.98it/s]backtest loop:  11%|█         | 95/872 [00:01<00:14, 52.01it/s]backtest loop:  12%|█▏        | 101/872 [00:01<00:15, 51.31it/s]backtest loop:  12%|█▏        | 108/872 [00:02<00:14, 54.46it/s]backtest loop:  13%|█▎        | 114/872 [00:02<00:14, 52.09it/s]backtest loop:  14%|█▍        | 120/872 [00:02<00:13, 53.85it/s]backtest loop:  14%|█▍        | 126/872 [00:02<00:13, 55.35it/s]backtest loop:  15%|█▌        | 132/872 [00:02<00:13, 56.52it/s]backtest loop:  16%|█▌        | 138/872 [00:02<00:12, 57.34it/s]backtest loop:  17%|█▋        | 144/872 [00:02<00:13, 54.53it/s]backtest loop:  17%|█▋        | 150/872 [00:02<00:12, 55.82it/s]backtest loop:  18%|█▊        | 156/872 [00:02<00:12, 56.96it/s]backtest loop:  19%|█▊        | 162/872 [00:03<00:12, 57.83it/s]backtest loop:  19%|█▉        | 168/872 [00:03<00:12, 58.41it/s]backtest loop:  20%|█▉        | 174/872 [00:03<00:12, 55.09it/s]backtest loop:  21%|██        | 181/872 [00:03<00:12, 57.28it/s]backtest loop:  22%|██▏       | 188/872 [00:03<00:11, 59.03it/s]backtest loop:  22%|██▏       | 194/872 [00:03<00:12, 56.45it/s]backtest loop:  23%|██▎       | 201/872 [00:03<00:11, 58.78it/s]backtest loop:  24%|██▎       | 207/872 [00:03<00:11, 58.40it/s]backtest loop:  24%|██▍       | 213/872 [00:03<00:11, 58.81it/s]backtest loop:  25%|██▌       | 219/872 [00:04<00:11, 55.33it/s]backtest loop:  26%|██▌       | 225/872 [00:04<00:11, 55.16it/s]backtest loop:  26%|██▋       | 231/872 [00:04<00:11, 56.36it/s]backtest loop:  27%|██▋       | 237/872 [00:04<00:11, 56.74it/s]backtest loop:  28%|██▊       | 243/872 [00:04<00:10, 57.67it/s]backtest loop:  29%|██▊       | 249/872 [00:04<00:11, 54.43it/s]backtest loop:  29%|██▉       | 255/872 [00:04<00:11, 55.96it/s]backtest loop:  30%|██▉       | 261/872 [00:04<00:10, 56.56it/s]backtest loop:  31%|███       | 267/872 [00:04<00:10, 57.52it/s]backtest loop:  31%|███▏      | 273/872 [00:05<00:10, 54.89it/s]backtest loop:  32%|███▏      | 279/872 [00:05<00:11, 52.74it/s]backtest loop:  33%|███▎      | 285/872 [00:05<00:10, 54.57it/s]backtest loop:  33%|███▎      | 292/872 [00:05<00:10, 56.84it/s]backtest loop:  34%|███▍      | 298/872 [00:05<00:10, 54.22it/s]backtest loop:  35%|███▍      | 304/872 [00:05<00:10, 55.57it/s]backtest loop:  36%|███▌      | 310/872 [00:05<00:09, 56.62it/s]backtest loop:  36%|███▌      | 316/872 [00:05<00:10, 54.05it/s]backtest loop:  37%|███▋      | 322/872 [00:05<00:09, 55.40it/s]backtest loop:  38%|███▊      | 328/872 [00:06<00:09, 56.56it/s]backtest loop:  38%|███▊      | 334/872 [00:06<00:10, 53.77it/s]backtest loop:  39%|███▉      | 340/872 [00:06<00:09, 55.25it/s]backtest loop:  40%|███▉      | 346/872 [00:06<00:09, 56.26it/s]backtest loop:  40%|████      | 353/872 [00:06<00:08, 58.11it/s]backtest loop:  41%|████      | 359/872 [00:06<00:09, 55.29it/s]backtest loop:  42%|████▏     | 365/872 [00:06<00:08, 56.55it/s]backtest loop:  43%|████▎     | 371/872 [00:06<00:08, 56.97it/s]backtest loop:  43%|████▎     | 377/872 [00:06<00:08, 57.54it/s]backtest loop:  44%|████▍     | 383/872 [00:06<00:09, 54.30it/s]backtest loop:  45%|████▍     | 389/872 [00:07<00:08, 55.66it/s]backtest loop:  45%|████▌     | 395/872 [00:07<00:08, 56.45it/s]backtest loop:  46%|████▌     | 401/872 [00:07<00:08, 57.30it/s]backtest loop:  47%|████▋     | 407/872 [00:07<00:08, 57.94it/s]backtest loop:  47%|████▋     | 413/872 [00:07<00:08, 55.03it/s]backtest loop:  48%|████▊     | 419/872 [00:07<00:08, 56.40it/s]backtest loop:  49%|████▊     | 425/872 [00:07<00:07, 57.21it/s]backtest loop:  50%|████▉     | 432/872 [00:07<00:07, 55.61it/s]backtest loop:  50%|█████     | 439/872 [00:07<00:07, 57.94it/s]backtest loop:  51%|█████     | 446/872 [00:08<00:07, 59.41it/s]backtest loop:  52%|█████▏    | 452/872 [00:08<00:07, 56.08it/s]backtest loop:  53%|█████▎    | 458/872 [00:08<00:07, 57.08it/s]backtest loop:  53%|█████▎    | 464/872 [00:08<00:07, 57.39it/s]backtest loop:  54%|█████▍    | 470/872 [00:08<00:06, 58.10it/s]backtest loop:  55%|█████▍    | 477/872 [00:08<00:07, 55.90it/s]backtest loop:  55%|█████▌    | 483/872 [00:08<00:06, 56.02it/s]backtest loop:  56%|█████▌    | 489/872 [00:08<00:06, 56.79it/s]backtest loop:  57%|█████▋    | 495/872 [00:08<00:06, 54.05it/s]backtest loop:  58%|█████▊    | 502/872 [00:09<00:06, 56.64it/s]backtest loop:  58%|█████▊    | 509/872 [00:09<00:06, 58.11it/s]backtest loop:  59%|█████▉    | 515/872 [00:09<00:06, 55.49it/s]backtest loop:  60%|█████▉    | 522/872 [00:09<00:06, 57.60it/s]backtest loop:  61%|██████    | 529/872 [00:09<00:05, 59.22it/s]backtest loop:  61%|██████▏   | 535/872 [00:09<00:05, 56.35it/s]backtest loop:  62%|██████▏   | 541/872 [00:09<00:05, 57.30it/s]backtest loop:  63%|██████▎   | 548/872 [00:09<00:05, 58.89it/s]backtest loop:  64%|██████▎   | 554/872 [00:09<00:05, 55.55it/s]backtest loop:  64%|██████▍   | 560/872 [00:10<00:05, 56.64it/s]backtest loop:  65%|██████▍   | 566/872 [00:10<00:05, 54.44it/s]backtest loop:  66%|██████▌   | 572/872 [00:10<00:05, 55.58it/s]backtest loop:  66%|██████▋   | 579/872 [00:10<00:05, 57.52it/s]backtest loop:  67%|██████▋   | 586/872 [00:10<00:05, 55.73it/s]backtest loop:  68%|██████▊   | 593/872 [00:10<00:04, 57.79it/s]backtest loop:  69%|██████▉   | 600/872 [00:10<00:04, 56.18it/s]backtest loop:  70%|██████▉   | 607/872 [00:10<00:04, 57.98it/s]backtest loop:  70%|███████   | 614/872 [00:11<00:04, 59.30it/s]backtest loop:  71%|███████   | 620/872 [00:11<00:04, 56.31it/s]backtest loop:  72%|███████▏  | 626/872 [00:11<00:04, 57.22it/s]backtest loop:  72%|███████▏  | 632/872 [00:11<00:04, 57.98it/s]backtest loop:  73%|███████▎  | 639/872 [00:11<00:03, 59.48it/s]backtest loop:  74%|███████▍  | 645/872 [00:11<00:04, 56.16it/s]backtest loop:  75%|███████▍  | 652/872 [00:11<00:03, 58.36it/s]backtest loop:  76%|███████▌  | 659/872 [00:11<00:03, 56.24it/s]backtest loop:  76%|███████▋  | 665/872 [00:11<00:03, 57.15it/s]backtest loop:  77%|███████▋  | 671/872 [00:12<00:03, 54.69it/s]backtest loop:  78%|███████▊  | 677/872 [00:12<00:03, 55.98it/s]backtest loop:  78%|███████▊  | 683/872 [00:12<00:03, 56.71it/s]backtest loop:  79%|███████▉  | 689/872 [00:12<00:03, 54.53it/s]backtest loop:  80%|███████▉  | 695/872 [00:12<00:03, 55.79it/s]backtest loop:  80%|████████  | 701/872 [00:12<00:03, 56.89it/s]backtest loop:  81%|████████  | 708/872 [00:12<00:02, 58.64it/s]backtest loop:  82%|████████▏ | 714/872 [00:12<00:02, 55.43it/s]backtest loop:  83%|████████▎ | 720/872 [00:12<00:02, 56.62it/s]backtest loop:  83%|████████▎ | 727/872 [00:13<00:02, 58.33it/s]backtest loop:  84%|████████▍ | 733/872 [00:13<00:02, 52.40it/s]backtest loop:  85%|████████▍ | 740/872 [00:13<00:02, 55.33it/s]backtest loop:  86%|████████▌ | 746/872 [00:13<00:02, 56.26it/s]backtest loop:  86%|████████▌ | 752/872 [00:13<00:02, 54.07it/s]backtest loop:  87%|████████▋ | 759/872 [00:13<00:01, 56.91it/s]backtest loop:  88%|████████▊ | 765/872 [00:13<00:01, 57.32it/s]backtest loop:  89%|████████▊ | 772/872 [00:13<00:01, 56.05it/s]backtest loop:  89%|████████▉ | 778/872 [00:13<00:01, 57.06it/s]backtest loop:  90%|████████▉ | 784/872 [00:14<00:01, 57.46it/s]backtest loop:  91%|█████████ | 791/872 [00:14<00:01, 59.09it/s]backtest loop:  91%|█████████▏| 797/872 [00:14<00:01, 56.27it/s]backtest loop:  92%|█████████▏| 804/872 [00:14<00:01, 58.04it/s]backtest loop:  93%|█████████▎| 810/872 [00:14<00:01, 55.35it/s]backtest loop:  94%|█████████▎| 816/872 [00:14<00:00, 56.55it/s]backtest loop:  94%|█████████▍| 822/872 [00:14<00:00, 57.43it/s]backtest loop:  95%|█████████▍| 828/872 [00:14<00:00, 54.72it/s]backtest loop:  96%|█████████▌| 835/872 [00:14<00:00, 57.21it/s]backtest loop:  96%|█████████▋| 841/872 [00:15<00:00, 57.95it/s]backtest loop:  97%|█████████▋| 847/872 [00:15<00:00, 55.18it/s]backtest loop:  98%|█████████▊| 854/872 [00:15<00:00, 58.09it/s]backtest loop:  99%|█████████▊| 861/872 [00:15<00:00, 56.58it/s]backtest loop: 100%|█████████▉| 868/872 [00:15<00:00, 58.80it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 55.92it/s]
[2165750:MainThread](2024-04-22 16:01:28,705) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000188
std                0.014399
annualized_return  0.044836
information_ratio  0.201841
max_drawdown      -0.487617
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000747
std                0.004449
annualized_return  0.177888
information_ratio  2.591935
max_drawdown      -0.068478
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000553
std                0.004448
annualized_return  0.131726
information_ratio  1.919585
max_drawdown      -0.110324
[2165750:MainThread](2024-04-22 16:01:28,720) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-22_15:50:39_online`.
{'1day.excess_return_with_cost.annualized_return': [0.13172647803265194],
 '1day.excess_return_with_cost.information_ratio': [1.919585005035602],
 'IC': [0.062365012060450746],
 'ICIR': [0.6013576218619284],
 'Rank IC': [0.05935208231460742],
 'Rank ICIR': [0.6095345356103196],
 'mae': [0.6843446493148804],
 'mse': [0.9952144026756287]}
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2165750:MainThread](2024-04-22 16:01:29,834) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2165750:MainThread](2024-04-22 16:01:29,835) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:09<16:29,  9.99s/it]epoch:   2%|▏         | 2/100 [00:20<16:20, 10.01s/it]epoch:   3%|▎         | 3/100 [00:29<16:04,  9.95s/it]epoch:   4%|▍         | 4/100 [00:39<15:56,  9.97s/it]epoch:   5%|▌         | 5/100 [00:49<15:45,  9.95s/it]epoch:   6%|▌         | 6/100 [00:59<15:33,  9.93s/it]epoch:   7%|▋         | 7/100 [01:09<15:24,  9.94s/it]epoch:   8%|▊         | 8/100 [01:19<15:12,  9.91s/it]epoch:   9%|▉         | 9/100 [01:29<15:04,  9.94s/it]epoch:  10%|█         | 10/100 [01:39<14:55,  9.95s/it]epoch:  11%|█         | 11/100 [01:49<14:42,  9.91s/it]epoch:  12%|█▏        | 12/100 [01:59<14:31,  9.90s/it]epoch:  13%|█▎        | 13/100 [02:08<14:16,  9.85s/it]epoch:  14%|█▍        | 14/100 [02:18<14:12,  9.91s/it]epoch:  15%|█▌        | 15/100 [02:28<13:56,  9.84s/it]epoch:  16%|█▌        | 16/100 [02:38<13:47,  9.85s/it]epoch:  17%|█▋        | 17/100 [02:48<13:38,  9.86s/it]epoch:  18%|█▊        | 18/100 [02:58<13:26,  9.84s/it]epoch:  19%|█▉        | 19/100 [03:07<13:15,  9.82s/it]epoch:  20%|██        | 20/100 [03:17<13:04,  9.81s/it]0.09525893555947335
best ic: 0.09525893555947335
epoch:  21%|██        | 21/100 [03:30<14:07, 10.73s/it]0.0940225051076443
epoch:  22%|██▏       | 22/100 [03:43<14:51, 11.43s/it]0.09517944614053828
epoch:  23%|██▎       | 23/100 [03:56<15:06, 11.78s/it]0.09883391706617858
best ic: 0.09883391706617858
epoch:  24%|██▍       | 24/100 [04:08<15:13, 12.02s/it]0.10108868167336678
best ic: 0.10108868167336678
epoch:  25%|██▌       | 25/100 [04:21<15:17, 12.23s/it]0.09889692041404446
epoch:  26%|██▌       | 26/100 [04:34<15:23, 12.48s/it]0.09813581213877738
epoch:  27%|██▋       | 27/100 [04:47<15:15, 12.55s/it]0.10232745372706598
best ic: 0.10232745372706598
epoch:  28%|██▊       | 28/100 [05:00<15:14, 12.69s/it]0.10298323773307837
best ic: 0.10298323773307837
epoch:  29%|██▉       | 29/100 [05:13<15:07, 12.78s/it]0.09754700048185513
epoch:  30%|███       | 30/100 [05:26<14:51, 12.74s/it]0.09956220290273335
epoch:  31%|███       | 31/100 [05:38<14:37, 12.72s/it]0.10115315565507577
epoch:  32%|███▏      | 32/100 [05:51<14:28, 12.77s/it]0.10152983826619996
epoch:  33%|███▎      | 33/100 [06:04<14:19, 12.82s/it]0.10141737240150976
epoch:  34%|███▍      | 34/100 [06:17<14:04, 12.80s/it]0.10342486277653329
best ic: 0.10342486277653329
epoch:  35%|███▌      | 35/100 [06:30<13:53, 12.82s/it]0.10392571261397304
best ic: 0.10392571261397304
epoch:  36%|███▌      | 36/100 [06:43<13:41, 12.84s/it]0.10095708919880138
epoch:  37%|███▋      | 37/100 [06:55<13:28, 12.83s/it]0.10433598830429196
best ic: 0.10433598830429196
epoch:  38%|███▊      | 38/100 [07:08<13:14, 12.82s/it]0.0999615674746568
epoch:  39%|███▉      | 39/100 [07:21<13:00, 12.80s/it]0.10358719485819681
epoch:  40%|████      | 40/100 [07:34<12:53, 12.90s/it]0.10226537573437729
epoch:  41%|████      | 41/100 [07:47<12:36, 12.83s/it]0.10039594566795158
epoch:  42%|████▏     | 42/100 [07:59<12:21, 12.79s/it]0.10592486027237852
best ic: 0.10592486027237852
epoch:  43%|████▎     | 43/100 [08:12<12:10, 12.81s/it]0.10133905195369554
epoch:  44%|████▍     | 44/100 [08:25<11:59, 12.84s/it]0.09916017093987937
epoch:  45%|████▌     | 45/100 [08:38<11:44, 12.80s/it]0.10109827652667462
epoch:  46%|████▌     | 46/100 [08:51<11:34, 12.85s/it]0.10117767686641219
epoch:  47%|████▋     | 47/100 [09:04<11:22, 12.87s/it]0.10250007057567162
epoch:  48%|████▊     | 48/100 [09:17<11:10, 12.90s/it]0.10138069048705477
epoch:  49%|████▉     | 49/100 [09:30<10:57, 12.89s/it]0.10101955050677577
epoch:  50%|█████     | 50/100 [09:42<10:43, 12.87s/it]0.0980564032368189
epoch:  50%|█████     | 50/100 [09:55<09:55, 11.92s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2165750:MainThread](2024-04-22 16:11:25,804) INFO - qlib.workflow - [exp.py:258] - Experiment 11 starts running ...
[2165750:MainThread](2024-04-22 16:11:25,814) INFO - qlib.workflow - [recorder.py:341] - Recorder e88e9b50d3bf4fb98ee915513d93a89e starts running under Experiment 11 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   1%|▏         | 1/67 [00:00<00:08,  7.73it/s]online:   3%|▎         | 2/67 [00:00<00:10,  6.27it/s]online:   4%|▍         | 3/67 [00:00<00:10,  5.99it/s]online:   6%|▌         | 4/67 [00:00<00:10,  5.86it/s]online:   9%|▉         | 6/67 [00:00<00:07,  8.02it/s]online:  12%|█▏        | 8/67 [00:01<00:06,  8.90it/s]online:  13%|█▎        | 9/67 [00:01<00:06,  8.97it/s]online:  16%|█▋        | 11/67 [00:01<00:05,  9.93it/s]online:  19%|█▉        | 13/67 [00:01<00:05, 10.41it/s]online:  22%|██▏       | 15/67 [00:01<00:05,  8.76it/s]online:  24%|██▍       | 16/67 [00:01<00:06,  7.85it/s]online:  25%|██▌       | 17/67 [00:02<00:06,  7.17it/s]online:  27%|██▋       | 18/67 [00:02<00:06,  7.67it/s]online:  30%|██▉       | 20/67 [00:02<00:05,  8.73it/s]online:  31%|███▏      | 21/67 [00:02<00:05,  8.29it/s]online:  34%|███▍      | 23/67 [00:02<00:04,  9.10it/s]online:  37%|███▋      | 25/67 [00:02<00:04,  9.79it/s]online:  40%|████      | 27/67 [00:03<00:04,  9.21it/s]online:  42%|████▏     | 28/67 [00:03<00:04,  8.15it/s]online:  43%|████▎     | 29/67 [00:03<00:05,  7.37it/s]online:  45%|████▍     | 30/67 [00:03<00:04,  7.67it/s]online:  48%|████▊     | 32/67 [00:03<00:03,  8.79it/s]online:  49%|████▉     | 33/67 [00:03<00:04,  8.34it/s]online:  52%|█████▏    | 35/67 [00:04<00:03,  9.24it/s]online:  55%|█████▌    | 37/67 [00:04<00:03,  9.90it/s]online:  57%|█████▋    | 38/67 [00:04<00:03,  9.60it/s]online:  58%|█████▊    | 39/67 [00:04<00:03,  8.27it/s]online:  60%|█████▉    | 40/67 [00:04<00:03,  7.36it/s]online:  61%|██████    | 41/67 [00:04<00:03,  7.46it/s]online:  64%|██████▍   | 43/67 [00:05<00:02,  8.72it/s]online:  66%|██████▌   | 44/67 [00:05<00:02,  8.39it/s]online:  69%|██████▊   | 46/67 [00:05<00:02,  9.27it/s]online:  72%|███████▏  | 48/67 [00:05<00:01,  9.59it/s]online:  73%|███████▎  | 49/67 [00:05<00:02,  8.20it/s]online:  75%|███████▍  | 50/67 [00:05<00:02,  7.25it/s]online:  76%|███████▌  | 51/67 [00:06<00:02,  6.60it/s]online:  78%|███████▊  | 52/67 [00:06<00:02,  7.08it/s]online:  81%|████████  | 54/67 [00:06<00:01,  8.23it/s]online:  82%|████████▏ | 55/67 [00:06<00:01,  7.76it/s]online:  85%|████████▌ | 57/67 [00:06<00:01,  8.68it/s]online:  88%|████████▊ | 59/67 [00:07<00:00,  9.25it/s]online:  90%|████████▉ | 60/67 [00:07<00:00,  9.07it/s]online:  91%|█████████ | 61/67 [00:07<00:00,  7.81it/s]online:  93%|█████████▎| 62/67 [00:07<00:00,  6.98it/s]online:  94%|█████████▍| 63/67 [00:07<00:00,  6.44it/s]online:  96%|█████████▌| 64/67 [00:07<00:00,  6.35it/s]online:  99%|█████████▊| 66/67 [00:08<00:00,  7.71it/s]online: 100%|██████████| 67/67 [00:08<00:00,  8.22it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2165750:MainThread](2024-04-22 16:11:42,049) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99505067 mae 0.6841682
{'IC': 0.059679414417870974,
 'ICIR': 0.5854024397861095,
 'Rank IC': 0.05506732288935573,
 'Rank ICIR': 0.5499679511526695}
[2165750:MainThread](2024-04-22 16:11:43,716) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2165750:MainThread](2024-04-22 16:11:54,138) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:11:54,140) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:11:58,380) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fee839cdf70>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/872 [00:00<01:04, 13.42it/s]backtest loop:   1%|          | 9/872 [00:00<00:31, 27.63it/s]backtest loop:   2%|▏         | 15/872 [00:00<00:23, 37.05it/s]backtest loop:   2%|▏         | 20/872 [00:00<00:21, 38.83it/s]backtest loop:   3%|▎         | 26/872 [00:00<00:19, 43.92it/s]backtest loop:   4%|▎         | 32/872 [00:00<00:17, 47.26it/s]backtest loop:   4%|▍         | 38/872 [00:00<00:16, 49.59it/s]backtest loop:   5%|▌         | 44/872 [00:01<00:17, 48.03it/s]backtest loop:   6%|▌         | 50/872 [00:01<00:16, 50.08it/s]backtest loop:   6%|▋         | 56/872 [00:01<00:15, 51.27it/s]backtest loop:   7%|▋         | 62/872 [00:01<00:16, 49.26it/s]backtest loop:   8%|▊         | 68/872 [00:01<00:15, 50.90it/s]backtest loop:   8%|▊         | 74/872 [00:01<00:15, 51.84it/s]backtest loop:   9%|▉         | 80/872 [00:01<00:15, 52.56it/s]backtest loop:  10%|▉         | 86/872 [00:01<00:15, 49.72it/s]backtest loop:  11%|█         | 92/872 [00:01<00:15, 51.23it/s]backtest loop:  11%|█         | 98/872 [00:02<00:14, 52.45it/s]backtest loop:  12%|█▏        | 104/872 [00:02<00:15, 49.88it/s]backtest loop:  13%|█▎        | 110/872 [00:02<00:14, 51.21it/s]backtest loop:  13%|█▎        | 116/872 [00:02<00:14, 51.97it/s]backtest loop:  14%|█▍        | 122/872 [00:02<00:14, 52.75it/s]backtest loop:  15%|█▍        | 128/872 [00:02<00:14, 53.00it/s]backtest loop:  15%|█▌        | 134/872 [00:02<00:14, 51.04it/s]backtest loop:  16%|█▌        | 140/872 [00:02<00:13, 52.80it/s]backtest loop:  17%|█▋        | 146/872 [00:02<00:13, 54.16it/s]backtest loop:  17%|█▋        | 152/872 [00:03<00:12, 55.56it/s]backtest loop:  18%|█▊        | 158/872 [00:03<00:12, 56.18it/s]backtest loop:  19%|█▉        | 164/872 [00:03<00:13, 53.45it/s]backtest loop:  19%|█▉        | 170/872 [00:03<00:12, 54.85it/s]backtest loop:  20%|██        | 176/872 [00:03<00:12, 55.69it/s]backtest loop:  21%|██        | 182/872 [00:03<00:12, 56.40it/s]backtest loop:  22%|██▏       | 188/872 [00:03<00:12, 56.76it/s]backtest loop:  22%|██▏       | 194/872 [00:03<00:12, 53.67it/s]backtest loop:  23%|██▎       | 201/872 [00:03<00:11, 57.14it/s]backtest loop:  24%|██▍       | 208/872 [00:04<00:11, 59.58it/s]backtest loop:  25%|██▍       | 214/872 [00:04<00:11, 57.32it/s]backtest loop:  25%|██▌       | 221/872 [00:04<00:10, 59.79it/s]backtest loop:  26%|██▌       | 228/872 [00:04<00:10, 61.60it/s]backtest loop:  27%|██▋       | 235/872 [00:04<00:10, 58.99it/s]backtest loop:  28%|██▊       | 242/872 [00:04<00:10, 60.63it/s]backtest loop:  29%|██▊       | 249/872 [00:04<00:10, 58.46it/s]backtest loop:  29%|██▉       | 256/872 [00:04<00:10, 60.37it/s]backtest loop:  30%|███       | 263/872 [00:05<00:10, 57.68it/s]backtest loop:  31%|███       | 270/872 [00:05<00:10, 59.18it/s]backtest loop:  32%|███▏      | 276/872 [00:05<00:10, 55.77it/s]backtest loop:  32%|███▏      | 282/872 [00:05<00:10, 56.31it/s]backtest loop:  33%|███▎      | 288/872 [00:05<00:10, 54.11it/s]backtest loop:  34%|███▎      | 294/872 [00:05<00:10, 55.45it/s]backtest loop:  34%|███▍      | 300/872 [00:05<00:10, 56.65it/s]backtest loop:  35%|███▌      | 306/872 [00:05<00:10, 54.17it/s]backtest loop:  36%|███▌      | 312/872 [00:05<00:10, 55.63it/s]backtest loop:  36%|███▋      | 318/872 [00:06<00:09, 56.72it/s]backtest loop:  37%|███▋      | 324/872 [00:06<00:10, 54.56it/s]backtest loop:  38%|███▊      | 330/872 [00:06<00:09, 56.02it/s]backtest loop:  39%|███▊      | 336/872 [00:06<00:09, 57.12it/s]backtest loop:  39%|███▉      | 342/872 [00:06<00:09, 57.86it/s]backtest loop:  40%|████      | 349/872 [00:06<00:09, 55.91it/s]backtest loop:  41%|████      | 356/872 [00:06<00:08, 57.74it/s]backtest loop:  42%|████▏     | 363/872 [00:06<00:09, 55.96it/s]backtest loop:  42%|████▏     | 369/872 [00:06<00:08, 56.98it/s]backtest loop:  43%|████▎     | 375/872 [00:07<00:08, 57.74it/s]backtest loop:  44%|████▎     | 381/872 [00:07<00:08, 58.17it/s]backtest loop:  44%|████▍     | 388/872 [00:07<00:08, 56.36it/s]backtest loop:  45%|████▌     | 394/872 [00:07<00:08, 57.12it/s]backtest loop:  46%|████▌     | 400/872 [00:07<00:08, 57.64it/s]backtest loop:  47%|████▋     | 406/872 [00:07<00:08, 58.08it/s]backtest loop:  47%|████▋     | 412/872 [00:07<00:07, 58.49it/s]backtest loop:  48%|████▊     | 418/872 [00:07<00:08, 54.97it/s]backtest loop:  49%|████▊     | 425/872 [00:07<00:07, 57.08it/s]backtest loop:  49%|████▉     | 431/872 [00:07<00:07, 57.87it/s]backtest loop:  50%|█████     | 437/872 [00:08<00:07, 55.87it/s]backtest loop:  51%|█████     | 443/872 [00:08<00:07, 56.88it/s]backtest loop:  52%|█████▏    | 450/872 [00:08<00:07, 58.55it/s]backtest loop:  52%|█████▏    | 456/872 [00:08<00:07, 58.56it/s]backtest loop:  53%|█████▎    | 462/872 [00:08<00:07, 55.66it/s]backtest loop:  54%|█████▎    | 468/872 [00:08<00:07, 56.50it/s]backtest loop:  54%|█████▍    | 475/872 [00:08<00:06, 58.22it/s]backtest loop:  55%|█████▌    | 481/872 [00:08<00:06, 58.23it/s]backtest loop:  56%|█████▌    | 487/872 [00:08<00:06, 55.30it/s]backtest loop:  57%|█████▋    | 493/872 [00:09<00:06, 56.46it/s]backtest loop:  57%|█████▋    | 500/872 [00:09<00:06, 54.95it/s]backtest loop:  58%|█████▊    | 506/872 [00:09<00:06, 56.22it/s]backtest loop:  59%|█████▉    | 513/872 [00:09<00:06, 58.05it/s]backtest loop:  60%|█████▉    | 520/872 [00:09<00:06, 56.08it/s]backtest loop:  60%|██████    | 527/872 [00:09<00:05, 58.74it/s]backtest loop:  61%|██████    | 534/872 [00:09<00:05, 60.10it/s]backtest loop:  62%|██████▏   | 541/872 [00:09<00:05, 57.50it/s]backtest loop:  63%|██████▎   | 548/872 [00:10<00:05, 59.07it/s]backtest loop:  64%|██████▎   | 554/872 [00:10<00:05, 56.33it/s]backtest loop:  64%|██████▍   | 561/872 [00:10<00:05, 57.99it/s]backtest loop:  65%|██████▌   | 567/872 [00:10<00:05, 55.52it/s]backtest loop:  66%|██████▌   | 573/872 [00:10<00:05, 56.63it/s]backtest loop:  67%|██████▋   | 580/872 [00:10<00:05, 58.32it/s]backtest loop:  67%|██████▋   | 586/872 [00:10<00:05, 55.37it/s]backtest loop:  68%|██████▊   | 593/872 [00:10<00:04, 57.50it/s]backtest loop:  69%|██████▉   | 600/872 [00:10<00:04, 55.89it/s]backtest loop:  70%|██████▉   | 607/872 [00:11<00:04, 57.72it/s]backtest loop:  70%|███████   | 613/872 [00:11<00:04, 58.16it/s]backtest loop:  71%|███████   | 620/872 [00:11<00:04, 56.20it/s]backtest loop:  72%|███████▏  | 626/872 [00:11<00:04, 57.03it/s]backtest loop:  72%|███████▏  | 632/872 [00:11<00:04, 57.61it/s]backtest loop:  73%|███████▎  | 638/872 [00:11<00:04, 58.18it/s]backtest loop:  74%|███████▍  | 644/872 [00:11<00:03, 58.27it/s]backtest loop:  75%|███████▍  | 650/872 [00:11<00:04, 55.28it/s]backtest loop:  75%|███████▌  | 657/872 [00:11<00:03, 57.10it/s]backtest loop:  76%|███████▌  | 664/872 [00:12<00:03, 55.49it/s]backtest loop:  77%|███████▋  | 670/872 [00:12<00:03, 53.42it/s]backtest loop:  78%|███████▊  | 677/872 [00:12<00:03, 56.11it/s]backtest loop:  78%|███████▊  | 683/872 [00:12<00:03, 56.93it/s]backtest loop:  79%|███████▉  | 689/872 [00:12<00:03, 54.54it/s]backtest loop:  80%|███████▉  | 695/872 [00:12<00:03, 55.85it/s]backtest loop:  80%|████████  | 701/872 [00:12<00:03, 56.55it/s]backtest loop:  81%|████████  | 708/872 [00:12<00:02, 58.34it/s]backtest loop:  82%|████████▏ | 714/872 [00:12<00:02, 55.48it/s]backtest loop:  83%|████████▎ | 720/872 [00:13<00:02, 56.14it/s]backtest loop:  83%|████████▎ | 727/872 [00:13<00:02, 58.12it/s]backtest loop:  84%|████████▍ | 733/872 [00:13<00:02, 52.41it/s]backtest loop:  85%|████████▍ | 740/872 [00:13<00:02, 55.22it/s]backtest loop:  86%|████████▌ | 747/872 [00:13<00:02, 54.19it/s]backtest loop:  86%|████████▋ | 754/872 [00:13<00:02, 57.19it/s]backtest loop:  87%|████████▋ | 761/872 [00:13<00:01, 58.76it/s]backtest loop:  88%|████████▊ | 767/872 [00:13<00:01, 56.25it/s]backtest loop:  89%|████████▉ | 774/872 [00:14<00:01, 58.19it/s]backtest loop:  90%|████████▉ | 781/872 [00:14<00:01, 59.54it/s]backtest loop:  90%|█████████ | 787/872 [00:14<00:01, 56.61it/s]backtest loop:  91%|█████████ | 794/872 [00:14<00:01, 58.30it/s]backtest loop:  92%|█████████▏| 801/872 [00:14<00:01, 56.33it/s]backtest loop:  93%|█████████▎| 808/872 [00:14<00:01, 58.10it/s]backtest loop:  93%|█████████▎| 814/872 [00:14<00:01, 55.54it/s]backtest loop:  94%|█████████▍| 821/872 [00:14<00:00, 57.44it/s]backtest loop:  95%|█████████▍| 828/872 [00:14<00:00, 55.60it/s]backtest loop:  96%|█████████▌| 835/872 [00:15<00:00, 57.77it/s]backtest loop:  96%|█████████▋| 841/872 [00:15<00:00, 58.15it/s]backtest loop:  97%|█████████▋| 847/872 [00:15<00:00, 55.38it/s]backtest loop:  98%|█████████▊| 854/872 [00:15<00:00, 58.14it/s]backtest loop:  99%|█████████▊| 860/872 [00:15<00:00, 58.52it/s]backtest loop:  99%|█████████▉| 866/872 [00:15<00:00, 55.67it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 55.38it/s]
[2165750:MainThread](2024-04-22 16:12:14,190) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000188
std                0.014399
annualized_return  0.044836
information_ratio  0.201841
max_drawdown      -0.487617
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000735
std                0.004318
annualized_return  0.174865
information_ratio  2.624841
max_drawdown      -0.065855
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000547
std                0.004318
annualized_return  0.130228
information_ratio  1.954955
max_drawdown      -0.075718
[2165750:MainThread](2024-04-22 16:12:14,205) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-22_15:50:39_online`.
{'1day.excess_return_with_cost.annualized_return': [0.13172647803265194,
                                                    0.130227841650523],
 '1day.excess_return_with_cost.information_ratio': [1.919585005035602,
                                                    1.9549551721921175],
 'IC': [0.062365012060450746, 0.059679414417870974],
 'ICIR': [0.6013576218619284, 0.5854024397861095],
 'Rank IC': [0.05935208231460742, 0.05506732288935573],
 'Rank ICIR': [0.6095345356103196, 0.5499679511526695],
 'mae': [0.6843446493148804, 0.6841682195663452],
 'mse': [0.9952144026756287, 0.9950506687164307]}
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2165750:MainThread](2024-04-22 16:12:15,308) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2165750:MainThread](2024-04-22 16:12:15,308) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:09<16:23,  9.93s/it]epoch:   2%|▏         | 2/100 [00:20<16:23, 10.04s/it]epoch:   3%|▎         | 3/100 [00:30<16:15, 10.05s/it]epoch:   4%|▍         | 4/100 [00:39<15:55,  9.96s/it]epoch:   5%|▌         | 5/100 [00:49<15:40,  9.90s/it]epoch:   6%|▌         | 6/100 [00:59<15:31,  9.91s/it]epoch:   7%|▋         | 7/100 [01:09<15:21,  9.90s/it]epoch:   8%|▊         | 8/100 [01:19<15:05,  9.84s/it]epoch:   9%|▉         | 9/100 [01:29<14:58,  9.87s/it]epoch:  10%|█         | 10/100 [01:38<14:46,  9.85s/it]epoch:  11%|█         | 11/100 [01:48<14:33,  9.82s/it]epoch:  12%|█▏        | 12/100 [01:58<14:29,  9.88s/it]epoch:  13%|█▎        | 13/100 [02:08<14:14,  9.83s/it]epoch:  14%|█▍        | 14/100 [02:18<14:08,  9.86s/it]epoch:  15%|█▌        | 15/100 [02:27<13:47,  9.73s/it]epoch:  16%|█▌        | 16/100 [02:37<13:42,  9.79s/it]epoch:  17%|█▋        | 17/100 [02:47<13:29,  9.75s/it]epoch:  18%|█▊        | 18/100 [02:57<13:18,  9.73s/it]epoch:  19%|█▉        | 19/100 [03:07<13:15,  9.82s/it]epoch:  20%|██        | 20/100 [03:16<13:03,  9.79s/it]0.09762845572744985
best ic: 0.09762845572744985
epoch:  21%|██        | 21/100 [03:29<14:07, 10.72s/it]0.09631058945270927
epoch:  22%|██▏       | 22/100 [03:42<14:41, 11.30s/it]0.10042713879070411
best ic: 0.10042713879070411
epoch:  23%|██▎       | 23/100 [03:55<15:06, 11.77s/it]0.10188364173265871
best ic: 0.10188364173265871
epoch:  24%|██▍       | 24/100 [04:08<15:21, 12.12s/it]0.10090918039068657
epoch:  25%|██▌       | 25/100 [04:20<15:23, 12.31s/it]0.1001997603561374
epoch:  26%|██▌       | 26/100 [04:33<15:18, 12.42s/it]0.10054558917044079
epoch:  27%|██▋       | 27/100 [04:46<15:13, 12.52s/it]0.10060494944912851
epoch:  28%|██▊       | 28/100 [04:59<15:08, 12.62s/it]0.09904757909430183
epoch:  29%|██▉       | 29/100 [05:11<14:58, 12.66s/it]0.09938033700313488
epoch:  30%|███       | 30/100 [05:24<14:48, 12.69s/it]0.10371519632719037
best ic: 0.10371519632719037
epoch:  31%|███       | 31/100 [05:37<14:35, 12.69s/it]0.10375998406102965
best ic: 0.10375998406102965
epoch:  32%|███▏      | 32/100 [05:50<14:28, 12.78s/it]0.10452040584689962
best ic: 0.10452040584689962
epoch:  33%|███▎      | 33/100 [06:03<14:12, 12.72s/it]0.10049327695892392
epoch:  34%|███▍      | 34/100 [06:15<14:00, 12.74s/it]0.10662999016266773
best ic: 0.10662999016266773
epoch:  35%|███▌      | 35/100 [06:28<13:49, 12.77s/it]0.10297577294865962
epoch:  36%|███▌      | 36/100 [06:41<13:42, 12.85s/it]0.10652652948268583
epoch:  37%|███▋      | 37/100 [06:54<13:30, 12.86s/it]0.10727300537585173
best ic: 0.10727300537585173
epoch:  38%|███▊      | 38/100 [07:07<13:14, 12.81s/it]0.1054757768926937
epoch:  39%|███▉      | 39/100 [07:20<13:03, 12.85s/it]0.10398076679615012
epoch:  40%|████      | 40/100 [07:33<12:52, 12.87s/it]0.10562640238153218
epoch:  41%|████      | 41/100 [07:45<12:32, 12.75s/it]0.10312511397871978
epoch:  42%|████▏     | 42/100 [07:58<12:23, 12.82s/it]0.10353006403615343
epoch:  43%|████▎     | 43/100 [08:11<12:10, 12.82s/it]0.10835296052359807
best ic: 0.10835296052359807
epoch:  44%|████▍     | 44/100 [08:24<11:58, 12.83s/it]0.1059086224557966
epoch:  45%|████▌     | 45/100 [08:36<11:40, 12.73s/it]0.10567285238283122
epoch:  46%|████▌     | 46/100 [08:49<11:28, 12.75s/it]0.10259758232005022
epoch:  47%|████▋     | 47/100 [09:02<11:20, 12.84s/it]0.10198747783890603
epoch:  48%|████▊     | 48/100 [09:15<11:10, 12.89s/it]0.10197611432626869
epoch:  49%|████▉     | 49/100 [09:28<10:54, 12.83s/it]0.10187035785420834
epoch:  50%|█████     | 50/100 [09:41<10:41, 12.83s/it]0.10789401170895137
epoch:  51%|█████     | 51/100 [09:54<10:30, 12.87s/it]0.10355762950772025
epoch:  51%|█████     | 51/100 [10:06<09:43, 11.90s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2165750:MainThread](2024-04-22 16:22:22,265) INFO - qlib.workflow - [exp.py:258] - Experiment 11 starts running ...
[2165750:MainThread](2024-04-22 16:22:22,276) INFO - qlib.workflow - [recorder.py:341] - Recorder b5e220cf967141a5a0366c615135b9b9 starts running under Experiment 11 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   3%|▎         | 2/67 [00:00<00:05, 11.02it/s]online:   6%|▌         | 4/67 [00:00<00:06,  9.72it/s]online:   7%|▋         | 5/67 [00:00<00:07,  8.04it/s]online:   9%|▉         | 6/67 [00:00<00:07,  8.33it/s]online:  12%|█▏        | 8/67 [00:00<00:06,  9.26it/s]online:  15%|█▍        | 10/67 [00:01<00:05, 10.22it/s]online:  18%|█▊        | 12/67 [00:01<00:06,  8.30it/s]online:  19%|█▉        | 13/67 [00:01<00:07,  7.53it/s]online:  21%|██        | 14/67 [00:01<00:06,  7.71it/s]online:  24%|██▍       | 16/67 [00:01<00:05,  8.86it/s]online:  25%|██▌       | 17/67 [00:01<00:05,  8.46it/s]online:  28%|██▊       | 19/67 [00:02<00:05,  9.29it/s]online:  31%|███▏      | 21/67 [00:02<00:04,  9.79it/s]online:  33%|███▎      | 22/67 [00:02<00:04,  9.38it/s]online:  34%|███▍      | 23/67 [00:02<00:05,  8.07it/s]online:  36%|███▌      | 24/67 [00:02<00:05,  7.25it/s]online:  37%|███▋      | 25/67 [00:03<00:06,  6.70it/s]online:  39%|███▉      | 26/67 [00:03<00:06,  6.71it/s]online:  42%|████▏     | 28/67 [00:03<00:04,  8.17it/s]online:  45%|████▍     | 30/67 [00:03<00:04,  8.67it/s]online:  46%|████▋     | 31/67 [00:03<00:04,  8.47it/s]online:  49%|████▉     | 33/67 [00:03<00:03,  9.24it/s]online:  52%|█████▏    | 35/67 [00:04<00:03,  9.83it/s]online:  55%|█████▌    | 37/67 [00:04<00:03,  9.83it/s]online:  57%|█████▋    | 38/67 [00:04<00:03,  8.56it/s]online:  58%|█████▊    | 39/67 [00:04<00:03,  7.67it/s]online:  60%|█████▉    | 40/67 [00:04<00:03,  7.38it/s]online:  63%|██████▎   | 42/67 [00:04<00:02,  8.57it/s]online:  64%|██████▍   | 43/67 [00:05<00:02,  8.34it/s]online:  66%|██████▌   | 44/67 [00:05<00:02,  8.67it/s]online:  69%|██████▊   | 46/67 [00:05<00:02,  9.30it/s]online:  72%|███████▏  | 48/67 [00:05<00:02,  9.26it/s]online:  73%|███████▎  | 49/67 [00:05<00:02,  7.97it/s]online:  75%|███████▍  | 50/67 [00:05<00:02,  7.94it/s]online:  78%|███████▊  | 52/67 [00:06<00:01,  8.35it/s]online:  81%|████████  | 54/67 [00:06<00:01,  8.89it/s]online:  82%|████████▏ | 55/67 [00:06<00:01,  7.84it/s]online:  84%|████████▎ | 56/67 [00:06<00:01,  7.54it/s]online:  87%|████████▋ | 58/67 [00:06<00:01,  8.13it/s]online:  90%|████████▉ | 60/67 [00:07<00:00,  8.88it/s]online:  91%|█████████ | 61/67 [00:07<00:00,  7.83it/s]online:  93%|█████████▎| 62/67 [00:07<00:00,  7.03it/s]online:  94%|█████████▍| 63/67 [00:07<00:00,  6.69it/s]online:  97%|█████████▋| 65/67 [00:07<00:00,  7.86it/s]online:  99%|█████████▊| 66/67 [00:07<00:00,  7.72it/s]online: 100%|██████████| 67/67 [00:08<00:00,  8.35it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2165750:MainThread](2024-04-22 16:22:38,826) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99469936 mae 0.6846561
{'IC': 0.06899313314440517,
 'ICIR': 0.6587728046246801,
 'Rank IC': 0.057888066212032616,
 'Rank ICIR': 0.5928677086634494}
[2165750:MainThread](2024-04-22 16:22:40,513) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2165750:MainThread](2024-04-22 16:22:51,476) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:22:51,478) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:22:55,723) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fee8d591f40>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/872 [00:00<01:05, 13.28it/s]backtest loop:   1%|          | 9/872 [00:00<00:31, 27.70it/s]backtest loop:   2%|▏         | 15/872 [00:00<00:23, 36.87it/s]backtest loop:   2%|▏         | 20/872 [00:00<00:22, 38.55it/s]backtest loop:   3%|▎         | 26/872 [00:00<00:19, 43.57it/s]backtest loop:   4%|▎         | 32/872 [00:00<00:17, 46.81it/s]backtest loop:   4%|▍         | 38/872 [00:00<00:16, 49.34it/s]backtest loop:   5%|▌         | 44/872 [00:01<00:17, 47.71it/s]backtest loop:   6%|▌         | 50/872 [00:01<00:16, 49.59it/s]backtest loop:   6%|▋         | 56/872 [00:01<00:16, 50.98it/s]backtest loop:   7%|▋         | 62/872 [00:01<00:16, 49.10it/s]backtest loop:   8%|▊         | 68/872 [00:01<00:16, 50.17it/s]backtest loop:   8%|▊         | 74/872 [00:01<00:15, 51.50it/s]backtest loop:   9%|▉         | 80/872 [00:01<00:15, 52.00it/s]backtest loop:  10%|▉         | 86/872 [00:01<00:15, 49.62it/s]backtest loop:  11%|█         | 92/872 [00:01<00:15, 51.10it/s]backtest loop:  11%|█         | 98/872 [00:02<00:14, 52.24it/s]backtest loop:  12%|█▏        | 104/872 [00:02<00:15, 49.96it/s]backtest loop:  13%|█▎        | 110/872 [00:02<00:14, 51.50it/s]backtest loop:  13%|█▎        | 116/872 [00:02<00:14, 52.59it/s]backtest loop:  14%|█▍        | 122/872 [00:02<00:14, 53.13it/s]backtest loop:  15%|█▍        | 128/872 [00:02<00:13, 53.70it/s]backtest loop:  15%|█▌        | 134/872 [00:02<00:14, 51.41it/s]backtest loop:  16%|█▌        | 140/872 [00:02<00:13, 53.22it/s]backtest loop:  17%|█▋        | 146/872 [00:03<00:13, 54.59it/s]backtest loop:  17%|█▋        | 152/872 [00:03<00:12, 55.76it/s]backtest loop:  18%|█▊        | 158/872 [00:03<00:12, 56.29it/s]backtest loop:  19%|█▉        | 164/872 [00:03<00:13, 53.49it/s]backtest loop:  19%|█▉        | 170/872 [00:03<00:12, 54.81it/s]backtest loop:  20%|██        | 176/872 [00:03<00:12, 55.67it/s]backtest loop:  21%|██        | 182/872 [00:03<00:12, 56.18it/s]backtest loop:  22%|██▏       | 188/872 [00:03<00:12, 56.60it/s]backtest loop:  22%|██▏       | 194/872 [00:03<00:13, 51.79it/s]backtest loop:  23%|██▎       | 200/872 [00:03<00:12, 53.43it/s]backtest loop:  24%|██▎       | 206/872 [00:04<00:12, 54.64it/s]backtest loop:  24%|██▍       | 212/872 [00:04<00:11, 55.37it/s]backtest loop:  25%|██▌       | 218/872 [00:04<00:11, 55.71it/s]backtest loop:  26%|██▌       | 224/872 [00:04<00:12, 52.83it/s]backtest loop:  26%|██▋       | 230/872 [00:04<00:11, 54.13it/s]backtest loop:  27%|██▋       | 236/872 [00:04<00:11, 54.74it/s]backtest loop:  28%|██▊       | 242/872 [00:04<00:11, 55.13it/s]backtest loop:  28%|██▊       | 248/872 [00:04<00:11, 52.41it/s]backtest loop:  29%|██▉       | 254/872 [00:04<00:11, 53.89it/s]backtest loop:  30%|██▉       | 260/872 [00:05<00:11, 54.36it/s]backtest loop:  31%|███       | 266/872 [00:05<00:11, 54.63it/s]backtest loop:  31%|███       | 272/872 [00:05<00:10, 55.02it/s]backtest loop:  32%|███▏      | 278/872 [00:05<00:12, 48.66it/s]backtest loop:  33%|███▎      | 284/872 [00:05<00:11, 50.36it/s]backtest loop:  33%|███▎      | 290/872 [00:05<00:11, 51.51it/s]backtest loop:  34%|███▍      | 296/872 [00:05<00:10, 52.37it/s]backtest loop:  35%|███▍      | 302/872 [00:05<00:10, 53.12it/s]backtest loop:  35%|███▌      | 308/872 [00:06<00:11, 50.19it/s]backtest loop:  36%|███▌      | 314/872 [00:06<00:10, 51.07it/s]backtest loop:  37%|███▋      | 320/872 [00:06<00:10, 52.18it/s]backtest loop:  37%|███▋      | 326/872 [00:06<00:10, 49.72it/s]backtest loop:  38%|███▊      | 332/872 [00:06<00:10, 50.77it/s]backtest loop:  39%|███▉      | 338/872 [00:06<00:10, 51.62it/s]backtest loop:  39%|███▉      | 344/872 [00:06<00:10, 49.38it/s]backtest loop:  40%|████      | 350/872 [00:06<00:10, 50.88it/s]backtest loop:  41%|████      | 356/872 [00:06<00:09, 51.96it/s]backtest loop:  42%|████▏     | 362/872 [00:07<00:09, 52.76it/s]backtest loop:  42%|████▏     | 368/872 [00:07<00:09, 50.43it/s]backtest loop:  43%|████▎     | 374/872 [00:07<00:09, 51.46it/s]backtest loop:  44%|████▎     | 380/872 [00:07<00:09, 52.43it/s]backtest loop:  44%|████▍     | 386/872 [00:07<00:09, 53.59it/s]backtest loop:  45%|████▍     | 392/872 [00:07<00:08, 54.00it/s]backtest loop:  46%|████▌     | 398/872 [00:07<00:09, 50.92it/s]backtest loop:  46%|████▋     | 404/872 [00:07<00:09, 51.92it/s]backtest loop:  47%|████▋     | 410/872 [00:08<00:08, 52.57it/s]backtest loop:  48%|████▊     | 416/872 [00:08<00:08, 52.82it/s]backtest loop:  48%|████▊     | 422/872 [00:08<00:08, 53.15it/s]backtest loop:  49%|████▉     | 428/872 [00:08<00:08, 50.11it/s]backtest loop:  50%|████▉     | 434/872 [00:08<00:08, 51.83it/s]backtest loop:  50%|█████     | 440/872 [00:08<00:08, 52.91it/s]backtest loop:  51%|█████     | 446/872 [00:08<00:07, 53.51it/s]backtest loop:  52%|█████▏    | 452/872 [00:08<00:08, 50.54it/s]backtest loop:  53%|█████▎    | 458/872 [00:08<00:07, 51.75it/s]backtest loop:  53%|█████▎    | 464/872 [00:09<00:07, 52.41it/s]backtest loop:  54%|█████▍    | 470/872 [00:09<00:07, 52.99it/s]backtest loop:  55%|█████▍    | 476/872 [00:09<00:07, 53.49it/s]backtest loop:  55%|█████▌    | 482/872 [00:09<00:07, 50.48it/s]backtest loop:  56%|█████▌    | 488/872 [00:09<00:07, 51.48it/s]backtest loop:  57%|█████▋    | 494/872 [00:09<00:07, 52.18it/s]backtest loop:  57%|█████▋    | 500/872 [00:09<00:07, 49.70it/s]backtest loop:  58%|█████▊    | 506/872 [00:09<00:07, 50.59it/s]backtest loop:  59%|█████▊    | 512/872 [00:09<00:07, 51.42it/s]backtest loop:  59%|█████▉    | 518/872 [00:10<00:06, 52.59it/s]backtest loop:  60%|██████    | 524/872 [00:10<00:06, 53.58it/s]backtest loop:  61%|██████    | 530/872 [00:10<00:06, 50.76it/s]backtest loop:  61%|██████▏   | 536/872 [00:10<00:06, 51.97it/s]backtest loop:  62%|██████▏   | 542/872 [00:10<00:06, 52.70it/s]backtest loop:  63%|██████▎   | 548/872 [00:10<00:06, 53.42it/s]backtest loop:  64%|██████▎   | 554/872 [00:10<00:06, 50.62it/s]backtest loop:  64%|██████▍   | 560/872 [00:10<00:06, 51.83it/s]backtest loop:  65%|██████▍   | 566/872 [00:11<00:06, 50.17it/s]backtest loop:  66%|██████▌   | 572/872 [00:11<00:05, 51.20it/s]backtest loop:  66%|██████▋   | 578/872 [00:11<00:05, 52.14it/s]backtest loop:  67%|██████▋   | 584/872 [00:11<00:05, 52.81it/s]backtest loop:  68%|██████▊   | 590/872 [00:11<00:05, 50.32it/s]backtest loop:  68%|██████▊   | 596/872 [00:11<00:05, 52.09it/s]backtest loop:  69%|██████▉   | 602/872 [00:11<00:05, 52.55it/s]backtest loop:  70%|██████▉   | 608/872 [00:11<00:04, 52.88it/s]backtest loop:  70%|███████   | 614/872 [00:11<00:04, 53.41it/s]backtest loop:  71%|███████   | 620/872 [00:12<00:04, 50.62it/s]backtest loop:  72%|███████▏  | 626/872 [00:12<00:04, 51.80it/s]backtest loop:  72%|███████▏  | 632/872 [00:12<00:04, 52.55it/s]backtest loop:  73%|███████▎  | 638/872 [00:12<00:04, 53.40it/s]backtest loop:  74%|███████▍  | 644/872 [00:12<00:04, 53.85it/s]backtest loop:  75%|███████▍  | 650/872 [00:12<00:04, 50.81it/s]backtest loop:  75%|███████▌  | 656/872 [00:12<00:04, 51.95it/s]backtest loop:  76%|███████▌  | 662/872 [00:12<00:03, 52.80it/s]backtest loop:  77%|███████▋  | 668/872 [00:12<00:03, 53.41it/s]backtest loop:  77%|███████▋  | 674/872 [00:13<00:04, 47.78it/s]backtest loop:  78%|███████▊  | 680/872 [00:13<00:03, 49.96it/s]backtest loop:  79%|███████▊  | 686/872 [00:13<00:03, 51.08it/s]backtest loop:  79%|███████▉  | 692/872 [00:13<00:03, 51.89it/s]backtest loop:  80%|████████  | 698/872 [00:13<00:03, 52.72it/s]backtest loop:  81%|████████  | 704/872 [00:13<00:03, 50.02it/s]backtest loop:  81%|████████▏ | 710/872 [00:13<00:03, 50.94it/s]backtest loop:  82%|████████▏ | 716/872 [00:13<00:03, 51.77it/s]backtest loop:  83%|████████▎ | 722/872 [00:14<00:02, 51.85it/s]backtest loop:  83%|████████▎ | 728/872 [00:14<00:02, 52.56it/s]backtest loop:  84%|████████▍ | 734/872 [00:14<00:02, 47.50it/s]backtest loop:  85%|████████▍ | 740/872 [00:14<00:02, 49.42it/s]backtest loop:  86%|████████▌ | 746/872 [00:14<00:02, 50.90it/s]backtest loop:  86%|████████▌ | 752/872 [00:14<00:02, 49.27it/s]backtest loop:  87%|████████▋ | 758/872 [00:14<00:02, 50.90it/s]backtest loop:  88%|████████▊ | 764/872 [00:14<00:02, 52.10it/s]backtest loop:  88%|████████▊ | 770/872 [00:14<00:01, 52.57it/s]backtest loop:  89%|████████▉ | 776/872 [00:15<00:01, 53.27it/s]backtest loop:  90%|████████▉ | 782/872 [00:15<00:01, 50.80it/s]backtest loop:  90%|█████████ | 788/872 [00:15<00:01, 51.89it/s]backtest loop:  91%|█████████ | 794/872 [00:15<00:01, 52.54it/s]backtest loop:  92%|█████████▏| 800/872 [00:15<00:01, 53.57it/s]backtest loop:  92%|█████████▏| 806/872 [00:15<00:01, 50.63it/s]backtest loop:  93%|█████████▎| 812/872 [00:15<00:01, 51.67it/s]backtest loop:  94%|█████████▍| 818/872 [00:15<00:01, 49.59it/s]backtest loop:  94%|█████████▍| 824/872 [00:16<00:00, 50.79it/s]backtest loop:  95%|█████████▌| 830/872 [00:16<00:00, 51.94it/s]backtest loop:  96%|█████████▌| 836/872 [00:16<00:00, 52.53it/s]backtest loop:  97%|█████████▋| 842/872 [00:16<00:00, 52.85it/s]backtest loop:  97%|█████████▋| 848/872 [00:16<00:00, 50.37it/s]backtest loop:  98%|█████████▊| 854/872 [00:16<00:00, 51.74it/s]backtest loop:  99%|█████████▊| 860/872 [00:16<00:00, 53.04it/s]backtest loop:  99%|█████████▉| 866/872 [00:16<00:00, 50.63it/s]backtest loop: 100%|██████████| 872/872 [00:16<00:00, 52.11it/s]backtest loop: 100%|██████████| 872/872 [00:16<00:00, 51.45it/s]
[2165750:MainThread](2024-04-22 16:23:12,737) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000188
std                0.014399
annualized_return  0.044836
information_ratio  0.201841
max_drawdown      -0.487617
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000904
std                0.004321
annualized_return  0.215089
information_ratio  3.226253
max_drawdown      -0.059410
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000715
std                0.004323
annualized_return  0.170270
information_ratio  2.553336
max_drawdown      -0.063434
[2165750:MainThread](2024-04-22 16:23:12,751) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-22_15:50:39_online`.
{'1day.excess_return_with_cost.annualized_return': [0.13172647803265194,
                                                    0.130227841650523,
                                                    0.1702703270580714],
 '1day.excess_return_with_cost.information_ratio': [1.919585005035602,
                                                    1.9549551721921175,
                                                    2.553336488171685],
 'IC': [0.062365012060450746, 0.059679414417870974, 0.06899313314440517],
 'ICIR': [0.6013576218619284, 0.5854024397861095, 0.6587728046246801],
 'Rank IC': [0.05935208231460742, 0.05506732288935573, 0.057888066212032616],
 'Rank ICIR': [0.6095345356103196, 0.5499679511526695, 0.5928677086634494],
 'mae': [0.6843446493148804, 0.6841682195663452, 0.6846560835838318],
 'mse': [0.9952144026756287, 0.9950506687164307, 0.9946993589401245]}
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2165750:MainThread](2024-04-22 16:23:13,857) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2165750:MainThread](2024-04-22 16:23:13,857) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:10<16:37, 10.08s/it]epoch:   2%|▏         | 2/100 [00:20<16:33, 10.14s/it]epoch:   3%|▎         | 3/100 [00:30<16:13, 10.04s/it]epoch:   4%|▍         | 4/100 [00:40<16:02, 10.02s/it]epoch:   5%|▌         | 5/100 [00:50<15:55, 10.05s/it]epoch:   6%|▌         | 6/100 [01:00<15:43, 10.03s/it]epoch:   7%|▋         | 7/100 [01:10<15:37, 10.08s/it]epoch:   8%|▊         | 8/100 [01:20<15:19,  9.99s/it]epoch:   9%|▉         | 9/100 [01:30<15:07,  9.98s/it]epoch:  10%|█         | 10/100 [01:40<14:54,  9.94s/it]epoch:  11%|█         | 11/100 [01:50<14:47,  9.97s/it]epoch:  12%|█▏        | 12/100 [01:59<14:28,  9.87s/it]epoch:  13%|█▎        | 13/100 [02:09<14:24,  9.93s/it]epoch:  14%|█▍        | 14/100 [02:19<14:15,  9.95s/it]epoch:  15%|█▌        | 15/100 [02:29<13:56,  9.84s/it]epoch:  16%|█▌        | 16/100 [02:39<13:47,  9.85s/it]epoch:  17%|█▋        | 17/100 [02:48<13:33,  9.80s/it]epoch:  18%|█▊        | 18/100 [02:58<13:23,  9.80s/it]epoch:  19%|█▉        | 19/100 [03:08<13:13,  9.79s/it]epoch:  20%|██        | 20/100 [03:18<13:07,  9.84s/it]0.09623162518120038
best ic: 0.09623162518120038
epoch:  21%|██        | 21/100 [03:31<14:12, 10.79s/it]0.09592502286453163
epoch:  22%|██▏       | 22/100 [03:44<14:46, 11.36s/it]0.09444586201585863
epoch:  23%|██▎       | 23/100 [03:56<15:01, 11.71s/it]0.09639800077956238
best ic: 0.09639800077956238
epoch:  24%|██▍       | 24/100 [04:09<15:16, 12.05s/it]0.0954595465393275
epoch:  25%|██▌       | 25/100 [04:22<15:14, 12.19s/it]0.09328767221585502
epoch:  26%|██▌       | 26/100 [04:34<15:15, 12.37s/it]0.09790155380355674
best ic: 0.09790155380355674
epoch:  27%|██▋       | 27/100 [04:47<15:15, 12.53s/it]0.10020550228844825
best ic: 0.10020550228844825
epoch:  28%|██▊       | 28/100 [05:00<15:10, 12.65s/it]0.09795947027702248
epoch:  29%|██▉       | 29/100 [05:13<14:59, 12.67s/it]0.10199800413117614
best ic: 0.10199800413117614
epoch:  30%|███       | 30/100 [05:26<14:46, 12.66s/it]0.09765336821435583
epoch:  31%|███       | 31/100 [05:38<14:37, 12.71s/it]0.10065174913155932
epoch:  32%|███▏      | 32/100 [05:51<14:29, 12.78s/it]0.10241709324793476
best ic: 0.10241709324793476
epoch:  33%|███▎      | 33/100 [06:04<14:15, 12.77s/it]0.10125111785267059
epoch:  34%|███▍      | 34/100 [06:17<13:59, 12.72s/it]0.09836838314164455
epoch:  35%|███▌      | 35/100 [06:30<13:50, 12.78s/it]0.0958721647036357
epoch:  36%|███▌      | 36/100 [06:42<13:38, 12.79s/it]0.10002877331113208
epoch:  37%|███▋      | 37/100 [06:55<13:21, 12.71s/it]0.09944778592366389
epoch:  38%|███▊      | 38/100 [07:08<13:12, 12.79s/it]0.10285817215841837
best ic: 0.10285817215841837
epoch:  39%|███▉      | 39/100 [07:21<12:59, 12.78s/it]0.10103173568158592
epoch:  40%|████      | 40/100 [07:34<12:47, 12.79s/it]0.09953568919544047
epoch:  41%|████      | 41/100 [07:46<12:31, 12.74s/it]0.10168322749548135
epoch:  42%|████▏     | 42/100 [07:59<12:17, 12.72s/it]0.0974573552473874
epoch:  43%|████▎     | 43/100 [08:12<12:12, 12.84s/it]0.10055116172794816
epoch:  44%|████▍     | 44/100 [08:25<11:56, 12.79s/it]0.09845862255596334
epoch:  45%|████▌     | 45/100 [08:38<11:46, 12.85s/it]0.09860112587392536
epoch:  46%|████▌     | 46/100 [08:50<11:33, 12.85s/it]0.10042662361309676
epoch:  46%|████▌     | 46/100 [09:03<10:38, 11.82s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2165750:MainThread](2024-04-22 16:32:17,796) INFO - qlib.workflow - [exp.py:258] - Experiment 11 starts running ...
[2165750:MainThread](2024-04-22 16:32:17,806) INFO - qlib.workflow - [recorder.py:341] - Recorder e01f2eb2980e45a2a7809ebb7ff07178 starts running under Experiment 11 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   3%|▎         | 2/67 [00:00<00:05, 12.06it/s]online:   6%|▌         | 4/67 [00:00<00:05, 11.66it/s]online:   9%|▉         | 6/67 [00:00<00:05, 11.95it/s]online:  12%|█▏        | 8/67 [00:00<00:05, 11.17it/s]online:  15%|█▍        | 10/67 [00:01<00:06,  8.38it/s]online:  16%|█▋        | 11/67 [00:01<00:07,  7.60it/s]online:  19%|█▉        | 13/67 [00:01<00:06,  8.54it/s]online:  22%|██▏       | 15/67 [00:01<00:05,  8.95it/s]online:  24%|██▍       | 16/67 [00:01<00:05,  8.95it/s]online:  27%|██▋       | 18/67 [00:01<00:05,  9.60it/s]online:  30%|██▉       | 20/67 [00:02<00:04, 10.07it/s]online:  33%|███▎      | 22/67 [00:02<00:05,  8.56it/s]online:  34%|███▍      | 23/67 [00:02<00:05,  8.54it/s]online:  37%|███▋      | 25/67 [00:02<00:04,  8.95it/s]online:  40%|████      | 27/67 [00:02<00:04,  9.63it/s]online:  42%|████▏     | 28/67 [00:03<00:04,  8.80it/s]online:  43%|████▎     | 29/67 [00:03<00:04,  7.76it/s]online:  45%|████▍     | 30/67 [00:03<00:05,  7.10it/s]online:  46%|████▋     | 31/67 [00:03<00:05,  6.60it/s]online:  49%|████▉     | 33/67 [00:03<00:04,  7.96it/s]online:  52%|█████▏    | 35/67 [00:03<00:03,  8.55it/s]online:  54%|█████▎    | 36/67 [00:04<00:03,  8.50it/s]online:  57%|█████▋    | 38/67 [00:04<00:03,  9.33it/s]online:  60%|█████▉    | 40/67 [00:04<00:02, 10.03it/s]online:  63%|██████▎   | 42/67 [00:04<00:02,  9.35it/s]online:  64%|██████▍   | 43/67 [00:04<00:02,  8.24it/s]online:  66%|██████▌   | 44/67 [00:05<00:02,  7.89it/s]online:  69%|██████▊   | 46/67 [00:05<00:02,  8.73it/s]online:  70%|███████   | 47/67 [00:05<00:02,  8.61it/s]online:  73%|███████▎  | 49/67 [00:05<00:01,  9.23it/s]online:  75%|███████▍  | 50/67 [00:05<00:01,  8.93it/s]online:  76%|███████▌  | 51/67 [00:05<00:02,  7.64it/s]online:  78%|███████▊  | 52/67 [00:06<00:02,  6.83it/s]online:  79%|███████▉  | 53/67 [00:06<00:02,  6.94it/s]online:  82%|████████▏ | 55/67 [00:06<00:01,  8.17it/s]online:  84%|████████▎ | 56/67 [00:06<00:01,  7.89it/s]online:  87%|████████▋ | 58/67 [00:06<00:01,  8.80it/s]online:  90%|████████▉ | 60/67 [00:06<00:00,  9.38it/s]online:  91%|█████████ | 61/67 [00:07<00:00,  8.55it/s]online:  93%|█████████▎| 62/67 [00:07<00:00,  7.48it/s]online:  94%|█████████▍| 63/67 [00:07<00:00,  6.73it/s]online:  96%|█████████▌| 64/67 [00:07<00:00,  6.82it/s]online:  99%|█████████▊| 66/67 [00:07<00:00,  8.04it/s]online: 100%|██████████| 67/67 [00:07<00:00,  8.27it/s]online: 100%|██████████| 67/67 [00:07<00:00,  8.53it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2165750:MainThread](2024-04-22 16:32:34,242) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99531746 mae 0.68448746
{'IC': 0.06127828000172926,
 'ICIR': 0.5894708352209375,
 'Rank IC': 0.05664376616630612,
 'Rank ICIR': 0.5675996310137258}
[2165750:MainThread](2024-04-22 16:32:35,887) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2165750:MainThread](2024-04-22 16:32:46,771) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:32:46,773) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:32:51,061) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fee92e40700>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/872 [00:00<01:04, 13.40it/s]backtest loop:   1%|          | 9/872 [00:00<00:30, 27.88it/s]backtest loop:   2%|▏         | 15/872 [00:00<00:23, 36.92it/s]backtest loop:   2%|▏         | 20/872 [00:00<00:22, 38.28it/s]backtest loop:   3%|▎         | 26/872 [00:00<00:19, 43.43it/s]backtest loop:   4%|▎         | 32/872 [00:00<00:17, 46.95it/s]backtest loop:   4%|▍         | 38/872 [00:00<00:16, 49.21it/s]backtest loop:   5%|▌         | 44/872 [00:01<00:17, 47.80it/s]backtest loop:   6%|▌         | 50/872 [00:01<00:16, 49.88it/s]backtest loop:   6%|▋         | 56/872 [00:01<00:15, 51.27it/s]backtest loop:   7%|▋         | 62/872 [00:01<00:16, 49.43it/s]backtest loop:   8%|▊         | 68/872 [00:01<00:15, 50.96it/s]backtest loop:   8%|▊         | 74/872 [00:01<00:15, 52.06it/s]backtest loop:   9%|▉         | 80/872 [00:01<00:14, 53.08it/s]backtest loop:  10%|▉         | 86/872 [00:01<00:15, 50.21it/s]backtest loop:  11%|█         | 92/872 [00:01<00:15, 51.24it/s]backtest loop:  11%|█         | 98/872 [00:02<00:14, 51.99it/s]backtest loop:  12%|█▏        | 104/872 [00:02<00:15, 49.53it/s]backtest loop:  13%|█▎        | 110/872 [00:02<00:14, 51.68it/s]backtest loop:  13%|█▎        | 116/872 [00:02<00:14, 52.55it/s]backtest loop:  14%|█▍        | 122/872 [00:02<00:14, 52.96it/s]backtest loop:  15%|█▍        | 128/872 [00:02<00:13, 53.64it/s]backtest loop:  15%|█▌        | 134/872 [00:02<00:14, 51.91it/s]backtest loop:  16%|█▌        | 140/872 [00:02<00:13, 54.07it/s]backtest loop:  17%|█▋        | 146/872 [00:02<00:13, 55.64it/s]backtest loop:  18%|█▊        | 153/872 [00:03<00:12, 58.25it/s]backtest loop:  18%|█▊        | 159/872 [00:03<00:12, 55.31it/s]backtest loop:  19%|█▉        | 166/872 [00:03<00:12, 57.56it/s]backtest loop:  20%|█▉        | 173/872 [00:03<00:11, 59.45it/s]backtest loop:  21%|██        | 179/872 [00:03<00:12, 56.41it/s]backtest loop:  21%|██▏       | 186/872 [00:03<00:11, 58.93it/s]backtest loop:  22%|██▏       | 193/872 [00:03<00:11, 61.31it/s]backtest loop:  23%|██▎       | 200/872 [00:03<00:11, 59.79it/s]backtest loop:  24%|██▎       | 207/872 [00:04<00:10, 60.94it/s]backtest loop:  25%|██▍       | 214/872 [00:04<00:11, 58.20it/s]backtest loop:  25%|██▌       | 221/872 [00:04<00:10, 59.52it/s]backtest loop:  26%|██▌       | 228/872 [00:04<00:10, 60.76it/s]backtest loop:  27%|██▋       | 235/872 [00:04<00:10, 58.14it/s]backtest loop:  28%|██▊       | 242/872 [00:04<00:10, 59.62it/s]backtest loop:  29%|██▊       | 249/872 [00:04<00:10, 57.41it/s]backtest loop:  29%|██▉       | 256/872 [00:04<00:10, 59.00it/s]backtest loop:  30%|███       | 262/872 [00:04<00:10, 58.09it/s]backtest loop:  31%|███       | 268/872 [00:05<00:11, 54.13it/s]backtest loop:  31%|███▏      | 274/872 [00:05<00:11, 54.33it/s]backtest loop:  32%|███▏      | 280/872 [00:05<00:11, 50.76it/s]backtest loop:  33%|███▎      | 286/872 [00:05<00:11, 51.84it/s]backtest loop:  33%|███▎      | 292/872 [00:05<00:11, 52.14it/s]backtest loop:  34%|███▍      | 298/872 [00:05<00:11, 49.15it/s]backtest loop:  35%|███▍      | 304/872 [00:05<00:10, 51.82it/s]backtest loop:  36%|███▌      | 310/872 [00:05<00:10, 54.00it/s]backtest loop:  36%|███▌      | 316/872 [00:06<00:10, 52.18it/s]backtest loop:  37%|███▋      | 323/872 [00:06<00:09, 55.17it/s]backtest loop:  38%|███▊      | 329/872 [00:06<00:10, 53.26it/s]backtest loop:  38%|███▊      | 335/872 [00:06<00:09, 55.07it/s]backtest loop:  39%|███▉      | 342/872 [00:06<00:09, 57.05it/s]backtest loop:  40%|███▉      | 348/872 [00:06<00:09, 57.85it/s]backtest loop:  41%|████      | 354/872 [00:06<00:09, 55.04it/s]backtest loop:  41%|████▏     | 361/872 [00:06<00:08, 57.61it/s]backtest loop:  42%|████▏     | 367/872 [00:06<00:08, 58.26it/s]backtest loop:  43%|████▎     | 373/872 [00:07<00:09, 55.13it/s]backtest loop:  43%|████▎     | 379/872 [00:07<00:08, 56.47it/s]backtest loop:  44%|████▍     | 386/872 [00:07<00:08, 58.81it/s]backtest loop:  45%|████▍     | 392/872 [00:07<00:08, 58.95it/s]backtest loop:  46%|████▌     | 398/872 [00:07<00:08, 55.55it/s]backtest loop:  46%|████▋     | 404/872 [00:07<00:08, 56.42it/s]backtest loop:  47%|████▋     | 410/872 [00:07<00:08, 57.34it/s]backtest loop:  48%|████▊     | 416/872 [00:07<00:07, 57.73it/s]backtest loop:  49%|████▊     | 423/872 [00:07<00:08, 55.53it/s]backtest loop:  49%|████▉     | 429/872 [00:07<00:07, 56.70it/s]backtest loop:  50%|█████     | 436/872 [00:08<00:07, 58.54it/s]backtest loop:  51%|█████     | 442/872 [00:08<00:07, 55.52it/s]backtest loop:  51%|█████▏    | 449/872 [00:08<00:07, 57.38it/s]backtest loop:  52%|█████▏    | 455/872 [00:08<00:07, 57.57it/s]backtest loop:  53%|█████▎    | 462/872 [00:08<00:07, 55.49it/s]backtest loop:  54%|█████▎    | 468/872 [00:08<00:07, 56.40it/s]backtest loop:  54%|█████▍    | 475/872 [00:08<00:06, 58.07it/s]backtest loop:  55%|█████▌    | 481/872 [00:08<00:06, 58.48it/s]backtest loop:  56%|█████▌    | 487/872 [00:09<00:06, 55.50it/s]backtest loop:  57%|█████▋    | 493/872 [00:09<00:06, 56.70it/s]backtest loop:  57%|█████▋    | 499/872 [00:09<00:06, 57.57it/s]backtest loop:  58%|█████▊    | 505/872 [00:09<00:06, 54.77it/s]backtest loop:  59%|█████▊    | 511/872 [00:09<00:06, 56.10it/s]backtest loop:  59%|█████▉    | 517/872 [00:09<00:06, 57.15it/s]backtest loop:  60%|██████    | 524/872 [00:09<00:05, 59.08it/s]backtest loop:  61%|██████    | 530/872 [00:09<00:06, 56.26it/s]backtest loop:  61%|██████▏   | 536/872 [00:09<00:05, 57.21it/s]backtest loop:  62%|██████▏   | 543/872 [00:09<00:05, 58.92it/s]backtest loop:  63%|██████▎   | 549/872 [00:10<00:05, 55.91it/s]backtest loop:  64%|██████▍   | 556/872 [00:10<00:05, 58.00it/s]backtest loop:  64%|██████▍   | 562/872 [00:10<00:05, 58.53it/s]backtest loop:  65%|██████▌   | 568/872 [00:10<00:05, 55.87it/s]backtest loop:  66%|██████▌   | 574/872 [00:10<00:05, 56.91it/s]backtest loop:  67%|██████▋   | 580/872 [00:10<00:05, 57.71it/s]backtest loop:  67%|██████▋   | 586/872 [00:10<00:05, 55.11it/s]backtest loop:  68%|██████▊   | 593/872 [00:10<00:04, 57.79it/s]backtest loop:  69%|██████▊   | 599/872 [00:10<00:04, 58.39it/s]backtest loop:  69%|██████▉   | 605/872 [00:11<00:04, 55.42it/s]backtest loop:  70%|███████   | 611/872 [00:11<00:04, 56.59it/s]backtest loop:  71%|███████   | 617/872 [00:11<00:04, 57.42it/s]backtest loop:  71%|███████▏  | 623/872 [00:11<00:04, 58.01it/s]backtest loop:  72%|███████▏  | 629/872 [00:11<00:04, 58.17it/s]backtest loop:  73%|███████▎  | 635/872 [00:11<00:04, 55.07it/s]backtest loop:  74%|███████▎  | 641/872 [00:11<00:04, 55.96it/s]backtest loop:  74%|███████▍  | 647/872 [00:11<00:03, 56.97it/s]backtest loop:  75%|███████▌  | 654/872 [00:11<00:03, 59.00it/s]backtest loop:  76%|███████▌  | 660/872 [00:12<00:03, 55.68it/s]backtest loop:  76%|███████▋  | 666/872 [00:12<00:03, 56.80it/s]backtest loop:  77%|███████▋  | 672/872 [00:12<00:03, 54.22it/s]backtest loop:  78%|███████▊  | 679/872 [00:12<00:03, 53.62it/s]backtest loop:  79%|███████▊  | 685/872 [00:12<00:03, 54.79it/s]backtest loop:  79%|███████▉  | 692/872 [00:12<00:03, 57.11it/s]backtest loop:  80%|████████  | 698/872 [00:12<00:03, 57.46it/s]backtest loop:  81%|████████  | 704/872 [00:12<00:03, 54.64it/s]backtest loop:  82%|████████▏ | 711/872 [00:12<00:02, 56.86it/s]backtest loop:  82%|████████▏ | 717/872 [00:13<00:02, 57.58it/s]backtest loop:  83%|████████▎ | 723/872 [00:13<00:02, 58.07it/s]backtest loop:  84%|████████▎ | 729/872 [00:13<00:02, 55.37it/s]backtest loop:  84%|████████▍ | 735/872 [00:13<00:02, 53.66it/s]backtest loop:  85%|████████▌ | 742/872 [00:13<00:02, 56.10it/s]backtest loop:  86%|████████▌ | 748/872 [00:13<00:02, 54.53it/s]backtest loop:  86%|████████▋ | 754/872 [00:13<00:02, 55.95it/s]backtest loop:  87%|████████▋ | 761/872 [00:13<00:01, 57.89it/s]backtest loop:  88%|████████▊ | 767/872 [00:13<00:01, 55.45it/s]backtest loop:  89%|████████▉ | 774/872 [00:14<00:01, 57.48it/s]backtest loop:  90%|████████▉ | 781/872 [00:14<00:01, 59.31it/s]backtest loop:  90%|█████████ | 787/872 [00:14<00:01, 56.41it/s]backtest loop:  91%|█████████ | 794/872 [00:14<00:01, 58.31it/s]backtest loop:  92%|█████████▏| 801/872 [00:14<00:01, 56.38it/s]backtest loop:  93%|█████████▎| 808/872 [00:14<00:01, 58.24it/s]backtest loop:  93%|█████████▎| 814/872 [00:14<00:01, 55.46it/s]backtest loop:  94%|█████████▍| 820/872 [00:14<00:00, 56.65it/s]backtest loop:  95%|█████████▍| 826/872 [00:14<00:00, 57.42it/s]backtest loop:  96%|█████████▌| 833/872 [00:15<00:00, 55.68it/s]backtest loop:  96%|█████████▌| 839/872 [00:15<00:00, 56.47it/s]backtest loop:  97%|█████████▋| 845/872 [00:15<00:00, 57.31it/s]backtest loop:  98%|█████████▊| 851/872 [00:15<00:00, 54.87it/s]backtest loop:  98%|█████████▊| 857/872 [00:15<00:00, 56.22it/s]backtest loop:  99%|█████████▉| 864/872 [00:15<00:00, 58.23it/s]backtest loop: 100%|█████████▉| 871/872 [00:15<00:00, 56.29it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 55.19it/s]
[2165750:MainThread](2024-04-22 16:33:06,928) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000188
std                0.014399
annualized_return  0.044836
information_ratio  0.201841
max_drawdown      -0.487617
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000749
std                0.004458
annualized_return  0.178298
information_ratio  2.592702
max_drawdown      -0.066597
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000567
std                0.004457
annualized_return  0.134979
information_ratio  1.962971
max_drawdown      -0.101940
[2165750:MainThread](2024-04-22 16:33:06,943) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-22_15:50:39_online`.
{'1day.excess_return_with_cost.annualized_return': [0.13172647803265194,
                                                    0.130227841650523,
                                                    0.1702703270580714,
                                                    0.13497939965458583],
 '1day.excess_return_with_cost.information_ratio': [1.919585005035602,
                                                    1.9549551721921175,
                                                    2.553336488171685,
                                                    1.9629714128079128],
 'IC': [0.062365012060450746,
        0.059679414417870974,
        0.06899313314440517,
        0.06127828000172926],
 'ICIR': [0.6013576218619284,
          0.5854024397861095,
          0.6587728046246801,
          0.5894708352209375],
 'Rank IC': [0.05935208231460742,
             0.05506732288935573,
             0.057888066212032616,
             0.05664376616630612],
 'Rank ICIR': [0.6095345356103196,
               0.5499679511526695,
               0.5928677086634494,
               0.5675996310137258],
 'mae': [0.6843446493148804,
         0.6841682195663452,
         0.6846560835838318,
         0.6844874620437622],
 'mse': [0.9952144026756287,
         0.9950506687164307,
         0.9946993589401245,
         0.9953174591064453]}
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2165750:MainThread](2024-04-22 16:33:08,028) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2165750:MainThread](2024-04-22 16:33:08,029) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:10<16:47, 10.18s/it]epoch:   2%|▏         | 2/100 [00:19<16:11,  9.92s/it]epoch:   3%|▎         | 3/100 [00:30<16:09, 10.00s/it]epoch:   4%|▍         | 4/100 [00:39<15:53,  9.93s/it]epoch:   5%|▌         | 5/100 [00:49<15:41,  9.91s/it]epoch:   6%|▌         | 6/100 [00:59<15:34,  9.94s/it]epoch:   7%|▋         | 7/100 [01:09<15:22,  9.92s/it]epoch:   8%|▊         | 8/100 [01:19<15:15,  9.95s/it]epoch:   9%|▉         | 9/100 [01:29<15:00,  9.90s/it]epoch:  10%|█         | 10/100 [01:39<14:52,  9.91s/it]epoch:  11%|█         | 11/100 [01:49<14:38,  9.87s/it]epoch:  12%|█▏        | 12/100 [01:58<14:27,  9.86s/it]epoch:  13%|█▎        | 13/100 [02:08<14:20,  9.89s/it]epoch:  14%|█▍        | 14/100 [02:18<14:12,  9.91s/it]epoch:  15%|█▌        | 15/100 [02:28<13:55,  9.83s/it]epoch:  16%|█▌        | 16/100 [02:38<13:47,  9.86s/it]epoch:  17%|█▋        | 17/100 [02:48<13:44,  9.93s/it]epoch:  18%|█▊        | 18/100 [02:58<13:29,  9.88s/it]epoch:  19%|█▉        | 19/100 [03:08<13:18,  9.86s/it]epoch:  20%|██        | 20/100 [03:17<13:06,  9.83s/it]0.10194502509159406
best ic: 0.10194502509159406
epoch:  21%|██        | 21/100 [03:30<14:13, 10.81s/it]0.09916412994608154
epoch:  22%|██▏       | 22/100 [03:43<14:52, 11.45s/it]0.09808169399573297
epoch:  23%|██▎       | 23/100 [03:56<15:11, 11.84s/it]0.10371461167024677
best ic: 0.10371461167024677
epoch:  24%|██▍       | 24/100 [04:09<15:17, 12.08s/it]0.10196247827294884
epoch:  25%|██▌       | 25/100 [04:22<15:22, 12.30s/it]0.10239582414119455
epoch:  26%|██▌       | 26/100 [04:34<15:16, 12.39s/it]0.10297038711043238
epoch:  27%|██▋       | 27/100 [04:47<15:13, 12.51s/it]0.10100309792815014
epoch:  28%|██▊       | 28/100 [05:00<15:07, 12.61s/it]0.10321133265705126
epoch:  29%|██▉       | 29/100 [05:13<15:03, 12.73s/it]0.10455996566103626
best ic: 0.10455996566103626
epoch:  30%|███       | 30/100 [05:25<14:46, 12.67s/it]0.10387660281662567
epoch:  31%|███       | 31/100 [05:38<14:31, 12.63s/it]0.10309136763075552
epoch:  32%|███▏      | 32/100 [05:51<14:24, 12.71s/it]0.1060686641369045
best ic: 0.1060686641369045
epoch:  33%|███▎      | 33/100 [06:04<14:11, 12.71s/it]0.10382728516773815
epoch:  34%|███▍      | 34/100 [06:16<13:55, 12.66s/it]0.10328321485349816
epoch:  35%|███▌      | 35/100 [06:29<13:41, 12.63s/it]0.10487951151051471
epoch:  36%|███▌      | 36/100 [06:42<13:35, 12.74s/it]0.10533129261886529
epoch:  37%|███▋      | 37/100 [06:54<13:22, 12.74s/it]0.10788381675237031
best ic: 0.10788381675237031
epoch:  38%|███▊      | 38/100 [07:07<13:06, 12.69s/it]0.10578881045204873
epoch:  39%|███▉      | 39/100 [07:20<12:56, 12.73s/it]0.1049138682326424
epoch:  40%|████      | 40/100 [07:33<12:49, 12.82s/it]0.10534813003836738
epoch:  41%|████      | 41/100 [07:45<12:30, 12.71s/it]0.10694099531688443
epoch:  42%|████▏     | 42/100 [07:58<12:16, 12.70s/it]0.1056474898319185
epoch:  43%|████▎     | 43/100 [08:11<12:06, 12.75s/it]0.10544170943651889
epoch:  44%|████▍     | 44/100 [08:23<11:53, 12.74s/it]0.10299818522804896
epoch:  45%|████▌     | 45/100 [08:36<11:37, 12.68s/it]0.10518169401669612
epoch:  45%|████▌     | 45/100 [08:49<10:47, 11.77s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2165750:MainThread](2024-04-22 16:41:57,608) INFO - qlib.workflow - [exp.py:258] - Experiment 11 starts running ...
[2165750:MainThread](2024-04-22 16:41:57,618) INFO - qlib.workflow - [recorder.py:341] - Recorder 3372ad14385145348e8a109955a063ba starts running under Experiment 11 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   3%|▎         | 2/67 [00:00<00:07,  8.92it/s]online:   6%|▌         | 4/67 [00:00<00:06, 10.34it/s]online:   9%|▉         | 6/67 [00:00<00:05, 11.06it/s]online:  12%|█▏        | 8/67 [00:00<00:06,  9.04it/s]online:  13%|█▎        | 9/67 [00:01<00:07,  7.98it/s]online:  15%|█▍        | 10/67 [00:01<00:07,  7.32it/s]online:  16%|█▋        | 11/67 [00:01<00:08,  6.79it/s]online:  18%|█▊        | 12/67 [00:01<00:08,  6.50it/s]online:  19%|█▉        | 13/67 [00:01<00:08,  6.17it/s]online:  21%|██        | 14/67 [00:01<00:08,  5.94it/s]online:  22%|██▏       | 15/67 [00:02<00:08,  5.78it/s]online:  24%|██▍       | 16/67 [00:02<00:08,  6.33it/s]online:  27%|██▋       | 18/67 [00:02<00:06,  7.87it/s]online:  30%|██▉       | 20/67 [00:02<00:05,  8.97it/s]online:  33%|███▎      | 22/67 [00:02<00:04,  9.61it/s]online:  36%|███▌      | 24/67 [00:02<00:04, 10.09it/s]online:  39%|███▉      | 26/67 [00:03<00:04,  8.49it/s]online:  42%|████▏     | 28/67 [00:03<00:04,  9.23it/s]online:  45%|████▍     | 30/67 [00:03<00:03,  9.74it/s]online:  48%|████▊     | 32/67 [00:03<00:03, 10.11it/s]online:  51%|█████     | 34/67 [00:03<00:03, 10.36it/s]online:  54%|█████▎    | 36/67 [00:04<00:02, 10.61it/s]online:  57%|█████▋    | 38/67 [00:04<00:02, 10.80it/s]online:  60%|█████▉    | 40/67 [00:04<00:02,  9.34it/s]online:  61%|██████    | 41/67 [00:04<00:03,  8.32it/s]online:  63%|██████▎   | 42/67 [00:04<00:03,  7.72it/s]online:  66%|██████▌   | 44/67 [00:05<00:02,  8.75it/s]online:  67%|██████▋   | 45/67 [00:05<00:02,  8.82it/s]online:  69%|██████▊   | 46/67 [00:05<00:02,  8.66it/s]online:  72%|███████▏  | 48/67 [00:05<00:02,  9.35it/s]online:  75%|███████▍  | 50/67 [00:05<00:01,  9.65it/s]online:  76%|███████▌  | 51/67 [00:05<00:01,  8.18it/s]online:  78%|███████▊  | 52/67 [00:06<00:02,  7.27it/s]online:  79%|███████▉  | 53/67 [00:06<00:01,  7.62it/s]online:  82%|████████▏ | 55/67 [00:06<00:01,  8.10it/s]online:  85%|████████▌ | 57/67 [00:06<00:01,  8.88it/s]online:  88%|████████▊ | 59/67 [00:06<00:00,  8.29it/s]online:  90%|████████▉ | 60/67 [00:07<00:00,  7.42it/s]online:  91%|█████████ | 61/67 [00:07<00:00,  6.88it/s]online:  93%|█████████▎| 62/67 [00:07<00:00,  6.98it/s]online:  96%|█████████▌| 64/67 [00:07<00:00,  8.10it/s]online:  97%|█████████▋| 65/67 [00:07<00:00,  8.06it/s]online:  99%|█████████▊| 66/67 [00:07<00:00,  8.18it/s]online: 100%|██████████| 67/67 [00:07<00:00,  8.41it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2165750:MainThread](2024-04-22 16:42:14,386) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9943541 mae 0.68411225
{'IC': 0.0655038632812737,
 'ICIR': 0.6467995140863154,
 'Rank IC': 0.06136211580814169,
 'Rank ICIR': 0.6387468115817954}
[2165750:MainThread](2024-04-22 16:42:16,040) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2165750:MainThread](2024-04-22 16:42:27,443) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:42:27,445) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2165750:MainThread](2024-04-22 16:42:31,649) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fee92aa2ca0>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/872 [00:00<01:01, 14.16it/s]backtest loop:   1%|          | 9/872 [00:00<00:29, 29.70it/s]backtest loop:   2%|▏         | 15/872 [00:00<00:21, 40.08it/s]backtest loop:   2%|▏         | 20/872 [00:00<00:20, 41.91it/s]backtest loop:   3%|▎         | 26/872 [00:00<00:17, 47.53it/s]backtest loop:   4%|▎         | 32/872 [00:00<00:16, 51.37it/s]backtest loop:   4%|▍         | 39/872 [00:00<00:16, 51.66it/s]backtest loop:   5%|▌         | 46/872 [00:00<00:15, 54.86it/s]backtest loop:   6%|▌         | 53/872 [00:01<00:14, 57.11it/s]backtest loop:   7%|▋         | 59/872 [00:01<00:14, 54.67it/s]backtest loop:   8%|▊         | 66/872 [00:01<00:14, 57.05it/s]backtest loop:   8%|▊         | 72/872 [00:01<00:14, 54.00it/s]backtest loop:   9%|▉         | 78/872 [00:01<00:14, 55.52it/s]backtest loop:  10%|▉         | 84/872 [00:01<00:13, 56.45it/s]backtest loop:  10%|█         | 90/872 [00:01<00:13, 57.21it/s]backtest loop:  11%|█         | 96/872 [00:01<00:14, 54.79it/s]backtest loop:  12%|█▏        | 102/872 [00:01<00:13, 56.08it/s]backtest loop:  12%|█▎        | 109/872 [00:02<00:13, 54.97it/s]backtest loop:  13%|█▎        | 115/872 [00:02<00:13, 55.94it/s]backtest loop:  14%|█▍        | 121/872 [00:02<00:13, 57.04it/s]backtest loop:  15%|█▍        | 127/872 [00:02<00:12, 57.60it/s]backtest loop:  15%|█▌        | 134/872 [00:02<00:13, 56.45it/s]backtest loop:  16%|█▌        | 141/872 [00:02<00:12, 59.82it/s]backtest loop:  17%|█▋        | 148/872 [00:02<00:11, 62.25it/s]backtest loop:  18%|█▊        | 155/872 [00:02<00:11, 60.68it/s]backtest loop:  19%|█▊        | 163/872 [00:02<00:11, 64.05it/s]backtest loop:  19%|█▉        | 170/872 [00:03<00:11, 62.19it/s]backtest loop:  20%|██        | 177/872 [00:03<00:10, 63.86it/s]backtest loop:  21%|██        | 184/872 [00:03<00:11, 62.29it/s]backtest loop:  22%|██▏       | 192/872 [00:03<00:10, 66.18it/s]backtest loop:  23%|██▎       | 199/872 [00:03<00:10, 64.91it/s]backtest loop:  24%|██▎       | 207/872 [00:03<00:09, 67.20it/s]backtest loop:  25%|██▍       | 214/872 [00:03<00:10, 64.27it/s]backtest loop:  25%|██▌       | 222/872 [00:03<00:09, 66.65it/s]backtest loop:  26%|██▋       | 229/872 [00:04<00:10, 63.90it/s]backtest loop:  27%|██▋       | 236/872 [00:04<00:09, 65.21it/s]backtest loop:  28%|██▊       | 243/872 [00:04<00:09, 66.41it/s]backtest loop:  29%|██▊       | 250/872 [00:04<00:09, 63.31it/s]backtest loop:  29%|██▉       | 257/872 [00:04<00:09, 64.99it/s]backtest loop:  30%|███       | 264/872 [00:04<00:09, 60.84it/s]backtest loop:  31%|███       | 271/872 [00:04<00:09, 61.32it/s]backtest loop:  32%|███▏      | 278/872 [00:04<00:10, 55.21it/s]backtest loop:  33%|███▎      | 284/872 [00:04<00:10, 56.40it/s]backtest loop:  33%|███▎      | 290/872 [00:05<00:10, 57.11it/s]backtest loop:  34%|███▍      | 297/872 [00:05<00:09, 58.60it/s]backtest loop:  35%|███▍      | 303/872 [00:05<00:10, 55.56it/s]backtest loop:  35%|███▌      | 309/872 [00:05<00:09, 56.72it/s]backtest loop:  36%|███▌      | 315/872 [00:05<00:09, 57.29it/s]backtest loop:  37%|███▋      | 321/872 [00:05<00:10, 54.25it/s]backtest loop:  38%|███▊      | 327/872 [00:05<00:09, 55.75it/s]backtest loop:  38%|███▊      | 333/872 [00:05<00:09, 56.38it/s]backtest loop:  39%|███▉      | 339/872 [00:05<00:09, 53.84it/s]backtest loop:  40%|███▉      | 345/872 [00:06<00:09, 55.26it/s]backtest loop:  40%|████      | 352/872 [00:06<00:09, 57.50it/s]backtest loop:  41%|████      | 358/872 [00:06<00:09, 54.97it/s]backtest loop:  42%|████▏     | 365/872 [00:06<00:08, 57.29it/s]backtest loop:  43%|████▎     | 371/872 [00:06<00:08, 57.92it/s]backtest loop:  43%|████▎     | 378/872 [00:06<00:08, 55.91it/s]backtest loop:  44%|████▍     | 385/872 [00:06<00:08, 58.07it/s]backtest loop:  45%|████▍     | 392/872 [00:06<00:08, 59.52it/s]backtest loop:  46%|████▌     | 398/872 [00:06<00:08, 56.07it/s]backtest loop:  46%|████▋     | 405/872 [00:07<00:08, 57.72it/s]backtest loop:  47%|████▋     | 411/872 [00:07<00:07, 58.21it/s]backtest loop:  48%|████▊     | 417/872 [00:07<00:07, 58.46it/s]backtest loop:  49%|████▊     | 423/872 [00:07<00:08, 55.30it/s]backtest loop:  49%|████▉     | 430/872 [00:07<00:07, 57.41it/s]backtest loop:  50%|█████     | 437/872 [00:07<00:07, 56.47it/s]backtest loop:  51%|█████     | 443/872 [00:07<00:07, 57.34it/s]backtest loop:  52%|█████▏    | 450/872 [00:07<00:07, 58.97it/s]backtest loop:  52%|█████▏    | 456/872 [00:07<00:07, 58.87it/s]backtest loop:  53%|█████▎    | 462/872 [00:08<00:07, 55.90it/s]backtest loop:  54%|█████▎    | 468/872 [00:08<00:07, 56.59it/s]backtest loop:  54%|█████▍    | 475/872 [00:08<00:06, 58.38it/s]backtest loop:  55%|█████▌    | 481/872 [00:08<00:06, 58.57it/s]backtest loop:  56%|█████▌    | 487/872 [00:08<00:06, 55.52it/s]backtest loop:  57%|█████▋    | 493/872 [00:08<00:06, 56.48it/s]backtest loop:  57%|█████▋    | 500/872 [00:08<00:06, 54.93it/s]backtest loop:  58%|█████▊    | 506/872 [00:08<00:06, 55.65it/s]backtest loop:  59%|█████▉    | 513/872 [00:08<00:06, 57.65it/s]backtest loop:  60%|█████▉    | 520/872 [00:09<00:06, 55.55it/s]backtest loop:  60%|██████    | 527/872 [00:09<00:05, 58.07it/s]backtest loop:  61%|██████    | 534/872 [00:09<00:05, 59.73it/s]backtest loop:  62%|██████▏   | 541/872 [00:09<00:05, 57.33it/s]backtest loop:  63%|██████▎   | 548/872 [00:09<00:05, 58.73it/s]backtest loop:  64%|██████▎   | 554/872 [00:09<00:05, 56.21it/s]backtest loop:  64%|██████▍   | 560/872 [00:09<00:05, 57.21it/s]backtest loop:  65%|██████▍   | 566/872 [00:09<00:05, 55.01it/s]backtest loop:  66%|██████▌   | 573/872 [00:10<00:05, 57.13it/s]backtest loop:  66%|██████▋   | 579/872 [00:10<00:05, 57.87it/s]backtest loop:  67%|██████▋   | 586/872 [00:10<00:05, 56.14it/s]backtest loop:  68%|██████▊   | 593/872 [00:10<00:04, 58.32it/s]backtest loop:  69%|██████▉   | 600/872 [00:10<00:04, 56.29it/s]backtest loop:  69%|██████▉   | 606/872 [00:10<00:04, 57.20it/s]backtest loop:  70%|███████   | 612/872 [00:10<00:04, 57.96it/s]backtest loop:  71%|███████   | 619/872 [00:10<00:04, 59.23it/s]backtest loop:  72%|███████▏  | 625/872 [00:10<00:04, 56.04it/s]backtest loop:  72%|███████▏  | 631/872 [00:11<00:04, 56.90it/s]backtest loop:  73%|███████▎  | 638/872 [00:11<00:03, 58.56it/s]backtest loop:  74%|███████▍  | 645/872 [00:11<00:04, 56.28it/s]backtest loop:  75%|███████▍  | 651/872 [00:11<00:03, 57.17it/s]backtest loop:  75%|███████▌  | 658/872 [00:11<00:03, 58.57it/s]backtest loop:  76%|███████▌  | 664/872 [00:11<00:03, 55.73it/s]backtest loop:  77%|███████▋  | 670/872 [00:11<00:03, 53.55it/s]backtest loop:  78%|███████▊  | 677/872 [00:11<00:03, 56.09it/s]backtest loop:  78%|███████▊  | 683/872 [00:11<00:03, 56.65it/s]backtest loop:  79%|███████▉  | 689/872 [00:12<00:03, 54.74it/s]backtest loop:  80%|███████▉  | 695/872 [00:12<00:03, 56.07it/s]backtest loop:  80%|████████  | 701/872 [00:12<00:03, 56.64it/s]backtest loop:  81%|████████  | 708/872 [00:12<00:02, 58.43it/s]backtest loop:  82%|████████▏ | 714/872 [00:12<00:02, 55.14it/s]backtest loop:  83%|████████▎ | 720/872 [00:12<00:02, 56.46it/s]backtest loop:  83%|████████▎ | 727/872 [00:12<00:02, 58.15it/s]backtest loop:  84%|████████▍ | 733/872 [00:12<00:02, 51.93it/s]backtest loop:  85%|████████▍ | 740/872 [00:12<00:02, 54.84it/s]backtest loop:  86%|████████▌ | 747/872 [00:13<00:02, 53.86it/s]backtest loop:  86%|████████▋ | 754/872 [00:13<00:02, 56.51it/s]backtest loop:  87%|████████▋ | 761/872 [00:13<00:01, 58.32it/s]backtest loop:  88%|████████▊ | 767/872 [00:13<00:01, 55.59it/s]backtest loop:  89%|████████▉ | 774/872 [00:13<00:01, 57.44it/s]backtest loop:  90%|████████▉ | 781/872 [00:13<00:01, 58.93it/s]backtest loop:  90%|█████████ | 787/872 [00:13<00:01, 55.94it/s]backtest loop:  91%|█████████ | 793/872 [00:13<00:01, 56.96it/s]backtest loop:  92%|█████████▏| 799/872 [00:14<00:01, 57.75it/s]backtest loop:  92%|█████████▏| 805/872 [00:14<00:01, 58.38it/s]backtest loop:  93%|█████████▎| 811/872 [00:14<00:01, 55.45it/s]backtest loop:  94%|█████████▍| 818/872 [00:14<00:00, 54.26it/s]backtest loop:  94%|█████████▍| 824/872 [00:14<00:00, 55.78it/s]backtest loop:  95%|█████████▌| 830/872 [00:14<00:00, 56.92it/s]backtest loop:  96%|█████████▌| 837/872 [00:14<00:00, 58.55it/s]backtest loop:  97%|█████████▋| 843/872 [00:14<00:00, 55.35it/s]backtest loop:  97%|█████████▋| 849/872 [00:14<00:00, 56.59it/s]backtest loop:  98%|█████████▊| 856/872 [00:15<00:00, 55.83it/s]backtest loop:  99%|█████████▉| 863/872 [00:15<00:00, 57.89it/s]backtest loop: 100%|█████████▉| 869/872 [00:15<00:00, 58.24it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 56.98it/s]
[2165750:MainThread](2024-04-22 16:42:47,016) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000188
std                0.014399
annualized_return  0.044836
information_ratio  0.201841
max_drawdown      -0.487617
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000771
std                0.004291
annualized_return  0.183612
information_ratio  2.773794
max_drawdown      -0.067339
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000589
std                0.004290
annualized_return  0.140213
information_ratio  2.118361
max_drawdown      -0.085721
[2165750:MainThread](2024-04-22 16:42:47,031) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 11
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-22_15:50:39_online`.
{'1day.excess_return_with_cost.annualized_return': [0.13172647803265194,
                                                    0.130227841650523,
                                                    0.1702703270580714,
                                                    0.13497939965458583,
                                                    0.14021289604800108],
 '1day.excess_return_with_cost.information_ratio': [1.919585005035602,
                                                    1.9549551721921175,
                                                    2.553336488171685,
                                                    1.9629714128079128,
                                                    2.118361303966107],
 'IC': [0.062365012060450746,
        0.059679414417870974,
        0.06899313314440517,
        0.06127828000172926,
        0.0655038632812737],
 'ICIR': [0.6013576218619284,
          0.5854024397861095,
          0.6587728046246801,
          0.5894708352209375,
          0.6467995140863154],
 'Rank IC': [0.05935208231460742,
             0.05506732288935573,
             0.057888066212032616,
             0.05664376616630612,
             0.06136211580814169],
 'Rank ICIR': [0.6095345356103196,
               0.5499679511526695,
               0.5928677086634494,
               0.5675996310137258,
               0.6387468115817954],
 'mae': [0.6843446493148804,
         0.6841682195663452,
         0.6846560835838318,
         0.6844874620437622,
         0.6841122508049011],
 'mse': [0.9952144026756287,
         0.9950506687164307,
         0.9946993589401245,
         0.9953174591064453,
         0.9943541288375854]}
[2165750:MainThread](2024-04-22 16:42:48,118) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-22_15:50:39_final.
[2165750:MainThread](2024-04-22 16:42:48,127) INFO - qlib.workflow - [exp.py:258] - Experiment 12 starts running ...
[2165750:MainThread](2024-04-22 16:42:48,137) INFO - qlib.workflow - [recorder.py:341] - Recorder 566574b143cf46e78df918f508ea8928 starts running under Experiment 12 ...
Time cost: 575.2294253826142	50.53787317276001
{'1day.excess_return_with_cost.annualized_return': [0.14148338848876665,
                                                    0.014795191720735856],
 '1day.excess_return_with_cost.information_ratio': [2.1018418764346847,
                                                    0.235880712495469],
 'IC': [0.06356394058114596, 0.0033163428461672577],
 'ICIR': [0.6163606431159941, 0.03043642251837168],
 'Rank IC': [0.05806267067808872, 0.002170935542258749],
 'Rank ICIR': [0.591743327604392, 0.031161575646412493],
 'mae': [0.6843537330627442, 0.00020105259542740062],
 'mse': [0.9949272036552429, 0.00035506455094203314]}
Exception in thread Thread-23:
Traceback (most recent call last):
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 12, in _try_get_item
    return x.item()
ValueError: can only convert an array of size 1 to a Python scalar

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/paral.py", line 91, in run
    data()
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/workflow/recorder.py", line 449, in log_metrics
    self.client.log_metric(self.id, name, data, step=step)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/client.py", line 821, in log_metric
    self._tracking_client.log_metric(run_id, key, value, timestamp, step)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/_tracking_service/client.py", line 305, in log_metric
    metric_value = convert_metric_value_to_float_if_possible(value)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 47, in convert_metric_value_to_float_if_possible
    possible_float = converter_fn(x)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 29, in wrapper
    return func(x)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 62, in convert_metric_value_to_float_if_ndarray
    return float(_try_get_item(x))
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 14, in _try_get_item
    raise MlflowException(
mlflow.exceptions.MlflowException: Failed to convert metric value to float: can only convert an array of size 1 to a Python scalar
[2165750:MainThread](2024-04-22 16:42:49,254) INFO - qlib.timer - [log.py:127] - Time cost: 0.005s | waiting `async_log` Done
