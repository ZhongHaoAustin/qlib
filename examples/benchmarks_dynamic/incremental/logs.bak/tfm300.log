['main.py', 'run_all', '--forecast_model', 'Transformer', '-num_head', '8', '--tau', '10', '--lr_da', '0.01', '--market', 'csi300', '--data_dir', 'crowd_data', '--rank_label', 'False', '--begin_valid_epoch', '30']
[2160528:MainThread](2024-04-22 13:59:38,309) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[2160528:MainThread](2024-04-22 13:59:38,312) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[2160528:MainThread](2024-04-22 13:59:38,312) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Remove CSRankNorm
{'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': datetime.date(2008, 1, 1), 'end_time': datetime.date(2020, 8, 1), 'fit_start_time': datetime.date(2008, 1, 1), 'fit_end_time': datetime.date(2014, 12, 31), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSZScoreNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
{'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': [datetime.date(2008, 1, 1), datetime.date(2014, 12, 31)], 'valid': [datetime.date(2015, 1, 1), datetime.date(2016, 12, 31)], 'test': [datetime.date(2017, 1, 1), datetime.date(2020, 8, 1)]}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
[2160528:MainThread](2024-04-22 13:59:43,593) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-02 00:00:00'), Timestamp('2008-01-29 00:00:00')), 'test': (Timestamp('2008-01-31 00:00:00'), Timestamp('2008-03-05 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/108 [00:00<?, ?it/s]creating meta tasks:  35%|███▌      | 38/108 [00:00<00:00, 374.52it/s]creating meta tasks:  72%|███████▏  | 78/108 [00:00<00:00, 384.91it/s]creating meta tasks: 100%|██████████| 108/108 [00:00<00:00, 390.74it/s]
[2160528:MainThread](2024-04-22 13:59:44,094) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2015-01-05 00:00:00'), Timestamp('2015-01-30 00:00:00')), 'test': (Timestamp('2015-02-03 00:00:00'), Timestamp('2015-03-09 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/67 [00:00<?, ?it/s]creating meta tasks:  48%|████▊     | 32/67 [00:00<00:00, 317.29it/s]creating meta tasks: 100%|██████████| 67/67 [00:00<00:00, 334.46it/s]creating meta tasks: 100%|██████████| 67/67 [00:00<00:00, 331.62it/s]
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2160528:MainThread](2024-04-22 13:59:45,092) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:16<27:20, 16.57s/it]epoch:   2%|▏         | 2/100 [00:31<25:47, 15.79s/it]epoch:   3%|▎         | 3/100 [00:46<24:58, 15.45s/it]epoch:   4%|▍         | 4/100 [01:01<24:23, 15.25s/it]epoch:   5%|▌         | 5/100 [01:17<24:09, 15.26s/it]epoch:   6%|▌         | 6/100 [01:32<23:52, 15.24s/it]epoch:   7%|▋         | 7/100 [01:47<23:29, 15.15s/it]epoch:   8%|▊         | 8/100 [02:02<23:14, 15.16s/it]epoch:   9%|▉         | 9/100 [02:17<22:53, 15.10s/it]epoch:  10%|█         | 10/100 [02:32<22:41, 15.13s/it]epoch:  11%|█         | 11/100 [02:47<22:26, 15.12s/it]epoch:  12%|█▏        | 12/100 [03:02<22:07, 15.09s/it]epoch:  13%|█▎        | 13/100 [03:17<21:57, 15.15s/it]epoch:  14%|█▍        | 14/100 [03:32<21:37, 15.09s/it]epoch:  15%|█▌        | 15/100 [03:47<21:21, 15.08s/it]epoch:  16%|█▌        | 16/100 [04:02<21:00, 15.00s/it]epoch:  17%|█▋        | 17/100 [04:18<20:51, 15.07s/it]epoch:  18%|█▊        | 18/100 [04:33<20:39, 15.11s/it]epoch:  19%|█▉        | 19/100 [04:47<20:13, 14.98s/it]epoch:  20%|██        | 20/100 [05:03<20:02, 15.03s/it]epoch:  21%|██        | 21/100 [05:18<19:51, 15.09s/it]epoch:  22%|██▏       | 22/100 [05:33<19:34, 15.06s/it]epoch:  23%|██▎       | 23/100 [05:48<19:21, 15.09s/it]epoch:  24%|██▍       | 24/100 [06:03<19:01, 15.02s/it]epoch:  25%|██▌       | 25/100 [06:18<18:49, 15.07s/it]epoch:  26%|██▌       | 26/100 [06:33<18:36, 15.08s/it]epoch:  27%|██▋       | 27/100 [06:48<18:17, 15.03s/it]epoch:  28%|██▊       | 28/100 [07:03<18:03, 15.05s/it]epoch:  29%|██▉       | 29/100 [07:18<17:52, 15.11s/it]epoch:  30%|███       | 30/100 [07:33<17:32, 15.04s/it]0.06378287359447463
best ic: 0.06378287359447463
epoch:  31%|███       | 31/100 [07:53<18:54, 16.44s/it]0.05884084334594452
epoch:  32%|███▏      | 32/100 [08:12<19:40, 17.35s/it]0.06458282176271021
best ic: 0.06458282176271021
epoch:  33%|███▎      | 33/100 [08:32<20:07, 18.02s/it]0.059709398640775214
epoch:  34%|███▍      | 34/100 [08:51<20:16, 18.44s/it]0.061186272926261526
epoch:  35%|███▌      | 35/100 [09:11<20:16, 18.72s/it]0.06209529443295182
epoch:  36%|███▌      | 36/100 [09:30<20:14, 18.98s/it]0.06215856190759183
epoch:  37%|███▋      | 37/100 [09:50<20:02, 19.08s/it]0.05936146737805948
epoch:  38%|███▊      | 38/100 [10:09<19:50, 19.19s/it]0.06045826964307599
epoch:  39%|███▉      | 39/100 [10:29<19:36, 19.28s/it]0.06167303877516962
epoch:  40%|████      | 40/100 [10:48<19:19, 19.33s/it]0.05899832727156989
epoch:  40%|████      | 40/100 [11:08<16:42, 16.71s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2160528:MainThread](2024-04-22 14:10:54,947) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-22_13:59:44_online.
[2160528:MainThread](2024-04-22 14:10:54,952) INFO - qlib.workflow - [exp.py:258] - Experiment 7 starts running ...
[2160528:MainThread](2024-04-22 14:10:55,633) INFO - qlib.workflow - [recorder.py:341] - Recorder 8d5279de1fc04077a18c84f8e56baca6 starts running under Experiment 7 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   1%|▏         | 1/67 [00:00<00:07,  8.56it/s]online:   3%|▎         | 2/67 [00:00<00:08,  7.90it/s]online:   4%|▍         | 3/67 [00:00<00:10,  6.19it/s]online:   6%|▌         | 4/67 [00:00<00:09,  6.46it/s]online:   7%|▋         | 5/67 [00:00<00:09,  6.85it/s]online:   9%|▉         | 6/67 [00:00<00:08,  7.17it/s]online:  10%|█         | 7/67 [00:00<00:07,  7.52it/s]online:  12%|█▏        | 8/67 [00:01<00:07,  7.73it/s]online:  13%|█▎        | 9/67 [00:01<00:09,  6.25it/s]online:  15%|█▍        | 10/67 [00:01<00:11,  5.11it/s]online:  16%|█▋        | 11/67 [00:01<00:10,  5.55it/s]online:  18%|█▊        | 12/67 [00:01<00:09,  5.92it/s]online:  19%|█▉        | 13/67 [00:02<00:09,  5.89it/s]online:  21%|██        | 14/67 [00:02<00:08,  6.33it/s]online:  22%|██▏       | 15/67 [00:02<00:07,  6.64it/s]online:  24%|██▍       | 16/67 [00:02<00:09,  5.64it/s]online:  25%|██▌       | 17/67 [00:02<00:10,  4.82it/s]online:  27%|██▋       | 18/67 [00:03<00:11,  4.37it/s]online:  28%|██▊       | 19/67 [00:03<00:09,  4.98it/s]online:  30%|██▉       | 20/67 [00:03<00:08,  5.53it/s]online:  31%|███▏      | 21/67 [00:03<00:08,  5.58it/s]online:  33%|███▎      | 22/67 [00:03<00:07,  5.74it/s]online:  34%|███▍      | 23/67 [00:03<00:07,  6.17it/s]online:  36%|███▌      | 24/67 [00:03<00:06,  6.54it/s]online:  37%|███▋      | 25/67 [00:04<00:06,  6.80it/s]online:  39%|███▉      | 26/67 [00:04<00:05,  6.84it/s]online:  40%|████      | 27/67 [00:04<00:07,  5.35it/s]online:  42%|████▏     | 28/67 [00:04<00:08,  4.67it/s]online:  43%|████▎     | 29/67 [00:04<00:07,  5.03it/s]online:  45%|████▍     | 30/67 [00:05<00:06,  5.60it/s]online:  46%|████▋     | 31/67 [00:05<00:06,  5.49it/s]online:  48%|████▊     | 32/67 [00:05<00:05,  5.96it/s]online:  49%|████▉     | 33/67 [00:05<00:05,  6.38it/s]online:  51%|█████     | 34/67 [00:05<00:04,  6.69it/s]online:  52%|█████▏    | 35/67 [00:05<00:04,  6.43it/s]online:  54%|█████▎    | 36/67 [00:06<00:05,  5.18it/s]online:  55%|█████▌    | 37/67 [00:06<00:06,  4.58it/s]online:  57%|█████▋    | 38/67 [00:06<00:05,  5.15it/s]online:  58%|█████▊    | 39/67 [00:06<00:04,  5.72it/s]online:  60%|█████▉    | 40/67 [00:06<00:04,  5.54it/s]online:  61%|██████    | 41/67 [00:07<00:04,  6.02it/s]online:  63%|██████▎   | 42/67 [00:07<00:03,  6.39it/s]online:  64%|██████▍   | 43/67 [00:07<00:03,  6.69it/s]online:  66%|██████▌   | 44/67 [00:07<00:03,  6.30it/s]online:  67%|██████▋   | 45/67 [00:07<00:04,  5.13it/s]online:  69%|██████▊   | 46/67 [00:07<00:03,  5.54it/s]online:  70%|███████   | 47/67 [00:08<00:03,  5.62it/s]online:  72%|███████▏  | 48/67 [00:08<00:03,  6.01it/s]online:  73%|███████▎  | 49/67 [00:08<00:03,  5.82it/s]online:  75%|███████▍  | 50/67 [00:08<00:03,  4.80it/s]online:  76%|███████▌  | 51/67 [00:08<00:03,  5.33it/s]online:  78%|███████▊  | 52/67 [00:09<00:02,  5.49it/s]online:  79%|███████▉  | 53/67 [00:09<00:02,  5.93it/s]online:  81%|████████  | 54/67 [00:09<00:02,  5.61it/s]online:  82%|████████▏ | 55/67 [00:09<00:02,  4.73it/s]online:  84%|████████▎ | 56/67 [00:09<00:02,  4.73it/s]online:  85%|████████▌ | 57/67 [00:09<00:01,  5.31it/s]online:  87%|████████▋ | 58/67 [00:10<00:01,  5.23it/s]online:  88%|████████▊ | 59/67 [00:10<00:01,  5.72it/s]online:  90%|████████▉ | 60/67 [00:10<00:01,  6.09it/s]online:  91%|█████████ | 61/67 [00:10<00:00,  6.43it/s]online:  93%|█████████▎| 62/67 [00:10<00:00,  5.31it/s]online:  94%|█████████▍| 63/67 [00:11<00:00,  4.53it/s]online:  96%|█████████▌| 64/67 [00:11<00:00,  5.09it/s]online:  97%|█████████▋| 65/67 [00:11<00:00,  5.49it/s]online:  99%|█████████▊| 66/67 [00:11<00:00,  5.47it/s]online: 100%|██████████| 67/67 [00:11<00:00,  5.98it/s]online: 100%|██████████| 67/67 [00:11<00:00,  5.70it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2160528:MainThread](2024-04-22 14:11:13,554) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99462324 mae 0.6975067
{'IC': 0.047794093817928186,
 'ICIR': 0.33518060416752843,
 'Rank IC': 0.04635870119592828,
 'Rank ICIR': 0.3297524956240849}
[2160528:MainThread](2024-04-22 14:11:15,107) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2160528:MainThread](2024-04-22 14:11:22,865) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:11:22,867) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:11:27,145) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f2ad99262e0>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 6/872 [00:00<00:15, 57.04it/s]backtest loop:   1%|▏         | 12/872 [00:00<00:14, 58.25it/s]backtest loop:   2%|▏         | 18/872 [00:00<00:16, 53.36it/s]backtest loop:   3%|▎         | 24/872 [00:00<00:16, 51.31it/s]backtest loop:   3%|▎         | 30/872 [00:00<00:15, 53.84it/s]backtest loop:   4%|▍         | 36/872 [00:00<00:15, 55.47it/s]backtest loop:   5%|▍         | 42/872 [00:00<00:14, 56.73it/s]backtest loop:   6%|▌         | 48/872 [00:00<00:14, 57.32it/s]backtest loop:   6%|▌         | 54/872 [00:00<00:15, 54.00it/s]backtest loop:   7%|▋         | 60/872 [00:01<00:14, 55.22it/s]backtest loop:   8%|▊         | 66/872 [00:01<00:14, 56.56it/s]backtest loop:   8%|▊         | 72/872 [00:01<00:14, 53.35it/s]backtest loop:   9%|▉         | 78/872 [00:01<00:14, 54.49it/s]backtest loop:  10%|▉         | 85/872 [00:01<00:13, 56.97it/s]backtest loop:  10%|█         | 91/872 [00:01<00:13, 55.81it/s]backtest loop:  11%|█         | 98/872 [00:01<00:13, 58.70it/s]backtest loop:  12%|█▏        | 104/872 [00:01<00:13, 56.44it/s]backtest loop:  13%|█▎        | 111/872 [00:01<00:12, 59.07it/s]backtest loop:  14%|█▎        | 118/872 [00:02<00:12, 60.78it/s]backtest loop:  14%|█▍        | 125/872 [00:02<00:12, 58.63it/s]backtest loop:  15%|█▌        | 132/872 [00:02<00:12, 60.37it/s]backtest loop:  16%|█▌        | 139/872 [00:02<00:12, 58.47it/s]backtest loop:  17%|█▋        | 146/872 [00:02<00:12, 60.45it/s]backtest loop:  18%|█▊        | 153/872 [00:02<00:11, 61.86it/s]backtest loop:  18%|█▊        | 160/872 [00:02<00:12, 59.28it/s]backtest loop:  19%|█▉        | 167/872 [00:02<00:11, 60.64it/s]backtest loop:  20%|█▉        | 174/872 [00:03<00:12, 58.09it/s]backtest loop:  21%|██        | 181/872 [00:03<00:11, 60.01it/s]backtest loop:  22%|██▏       | 188/872 [00:03<00:11, 61.00it/s]backtest loop:  22%|██▏       | 195/872 [00:03<00:11, 58.48it/s]backtest loop:  23%|██▎       | 202/872 [00:03<00:11, 60.28it/s]backtest loop:  24%|██▍       | 209/872 [00:03<00:11, 58.34it/s]backtest loop:  25%|██▍       | 216/872 [00:03<00:10, 60.21it/s]backtest loop:  26%|██▌       | 223/872 [00:03<00:10, 61.75it/s]backtest loop:  26%|██▋       | 230/872 [00:03<00:10, 58.38it/s]backtest loop:  27%|██▋       | 236/872 [00:04<00:10, 58.64it/s]backtest loop:  28%|██▊       | 242/872 [00:04<00:16, 38.42it/s]backtest loop:  28%|██▊       | 248/872 [00:04<00:15, 40.81it/s]backtest loop:  29%|██▉       | 254/872 [00:04<00:13, 44.83it/s]backtest loop:  30%|██▉       | 260/872 [00:04<00:12, 48.22it/s]backtest loop:  31%|███       | 266/872 [00:04<00:11, 50.99it/s]backtest loop:  31%|███▏      | 273/872 [00:04<00:11, 51.66it/s]backtest loop:  32%|███▏      | 279/872 [00:05<00:11, 50.85it/s]backtest loop:  33%|███▎      | 285/872 [00:05<00:11, 53.00it/s]backtest loop:  33%|███▎      | 291/872 [00:05<00:10, 54.73it/s]backtest loop:  34%|███▍      | 297/872 [00:05<00:10, 55.76it/s]backtest loop:  35%|███▍      | 303/872 [00:05<00:10, 53.39it/s]backtest loop:  35%|███▌      | 309/872 [00:05<00:10, 54.79it/s]backtest loop:  36%|███▌      | 315/872 [00:05<00:09, 56.21it/s]backtest loop:  37%|███▋      | 321/872 [00:05<00:10, 53.14it/s]backtest loop:  38%|███▊      | 327/872 [00:05<00:09, 55.00it/s]backtest loop:  38%|███▊      | 333/872 [00:06<00:09, 55.74it/s]backtest loop:  39%|███▉      | 339/872 [00:06<00:09, 53.41it/s]backtest loop:  40%|███▉      | 345/872 [00:06<00:09, 55.16it/s]backtest loop:  40%|████      | 351/872 [00:06<00:09, 56.27it/s]backtest loop:  41%|████      | 357/872 [00:06<00:08, 57.25it/s]backtest loop:  42%|████▏     | 363/872 [00:06<00:09, 54.37it/s]backtest loop:  42%|████▏     | 369/872 [00:06<00:09, 55.71it/s]backtest loop:  43%|████▎     | 375/872 [00:06<00:08, 56.71it/s]backtest loop:  44%|████▎     | 381/872 [00:06<00:08, 57.60it/s]backtest loop:  44%|████▍     | 387/872 [00:06<00:08, 58.27it/s]backtest loop:  45%|████▌     | 393/872 [00:07<00:08, 54.98it/s]backtest loop:  46%|████▌     | 399/872 [00:07<00:08, 56.29it/s]backtest loop:  46%|████▋     | 405/872 [00:07<00:08, 56.89it/s]backtest loop:  47%|████▋     | 411/872 [00:07<00:08, 57.60it/s]backtest loop:  48%|████▊     | 417/872 [00:07<00:07, 58.03it/s]backtest loop:  49%|████▊     | 423/872 [00:07<00:08, 54.70it/s]backtest loop:  49%|████▉     | 429/872 [00:07<00:07, 56.03it/s]backtest loop:  50%|████▉     | 435/872 [00:07<00:07, 57.16it/s]backtest loop:  51%|█████     | 441/872 [00:07<00:07, 57.82it/s]backtest loop:  51%|█████▏    | 447/872 [00:08<00:07, 55.01it/s]backtest loop:  52%|█████▏    | 453/872 [00:08<00:07, 56.07it/s]backtest loop:  53%|█████▎    | 459/872 [00:08<00:07, 57.11it/s]backtest loop:  53%|█████▎    | 465/872 [00:08<00:07, 57.82it/s]backtest loop:  54%|█████▍    | 471/872 [00:08<00:06, 58.19it/s]backtest loop:  55%|█████▍    | 477/872 [00:08<00:07, 55.21it/s]backtest loop:  55%|█████▌    | 483/872 [00:08<00:06, 56.48it/s]backtest loop:  56%|█████▌    | 489/872 [00:08<00:06, 56.90it/s]backtest loop:  57%|█████▋    | 495/872 [00:08<00:06, 54.03it/s]backtest loop:  57%|█████▋    | 501/872 [00:08<00:06, 55.63it/s]backtest loop:  58%|█████▊    | 507/872 [00:09<00:06, 56.38it/s]backtest loop:  59%|█████▉    | 513/872 [00:09<00:06, 57.31it/s]backtest loop:  60%|█████▉    | 520/872 [00:09<00:06, 55.73it/s]backtest loop:  60%|██████    | 527/872 [00:09<00:05, 58.74it/s]backtest loop:  61%|██████    | 534/872 [00:09<00:05, 60.35it/s]backtest loop:  62%|██████▏   | 541/872 [00:09<00:05, 57.43it/s]backtest loop:  63%|██████▎   | 547/872 [00:09<00:05, 58.08it/s]backtest loop:  63%|██████▎   | 553/872 [00:09<00:05, 58.60it/s]backtest loop:  64%|██████▍   | 559/872 [00:10<00:05, 55.47it/s]backtest loop:  65%|██████▍   | 565/872 [00:10<00:05, 56.66it/s]backtest loop:  65%|██████▌   | 571/872 [00:10<00:05, 54.18it/s]backtest loop:  66%|██████▋   | 578/872 [00:10<00:05, 56.54it/s]backtest loop:  67%|██████▋   | 585/872 [00:10<00:04, 58.18it/s]backtest loop:  68%|██████▊   | 591/872 [00:10<00:05, 55.13it/s]backtest loop:  69%|██████▊   | 598/872 [00:10<00:04, 57.24it/s]backtest loop:  69%|██████▉   | 605/872 [00:10<00:04, 55.57it/s]backtest loop:  70%|███████   | 611/872 [00:10<00:04, 56.66it/s]backtest loop:  71%|███████   | 617/872 [00:11<00:04, 57.42it/s]backtest loop:  71%|███████▏  | 623/872 [00:11<00:04, 58.05it/s]backtest loop:  72%|███████▏  | 629/872 [00:11<00:04, 58.39it/s]backtest loop:  73%|███████▎  | 635/872 [00:11<00:04, 55.06it/s]backtest loop:  74%|███████▎  | 641/872 [00:11<00:04, 56.28it/s]backtest loop:  74%|███████▍  | 647/872 [00:11<00:03, 57.23it/s]backtest loop:  75%|███████▍  | 653/872 [00:11<00:03, 57.82it/s]backtest loop:  76%|███████▌  | 659/872 [00:11<00:03, 54.82it/s]backtest loop:  76%|███████▋  | 665/872 [00:11<00:03, 56.19it/s]backtest loop:  77%|███████▋  | 671/872 [00:12<00:03, 53.53it/s]backtest loop:  78%|███████▊  | 678/872 [00:12<00:03, 56.15it/s]backtest loop:  78%|███████▊  | 684/872 [00:12<00:03, 53.60it/s]backtest loop:  79%|███████▉  | 690/872 [00:12<00:03, 54.83it/s]backtest loop:  80%|███████▉  | 696/872 [00:12<00:03, 55.72it/s]backtest loop:  81%|████████  | 702/872 [00:12<00:03, 56.31it/s]backtest loop:  81%|████████  | 708/872 [00:12<00:02, 57.12it/s]backtest loop:  82%|████████▏ | 714/872 [00:12<00:02, 53.94it/s]backtest loop:  83%|████████▎ | 720/872 [00:12<00:02, 55.43it/s]backtest loop:  83%|████████▎ | 726/872 [00:12<00:02, 56.69it/s]backtest loop:  84%|████████▍ | 732/872 [00:13<00:02, 54.11it/s]backtest loop:  85%|████████▍ | 738/872 [00:13<00:02, 52.25it/s]backtest loop:  85%|████████▌ | 744/872 [00:13<00:02, 54.31it/s]backtest loop:  86%|████████▌ | 751/872 [00:13<00:02, 57.01it/s]backtest loop:  87%|████████▋ | 757/872 [00:13<00:02, 54.44it/s]backtest loop:  88%|████████▊ | 763/872 [00:13<00:01, 55.82it/s]backtest loop:  88%|████████▊ | 769/872 [00:13<00:01, 56.91it/s]backtest loop:  89%|████████▉ | 775/872 [00:13<00:01, 57.69it/s]backtest loop:  90%|████████▉ | 782/872 [00:13<00:01, 55.54it/s]backtest loop:  90%|█████████ | 788/872 [00:14<00:01, 56.63it/s]backtest loop:  91%|█████████ | 794/872 [00:14<00:01, 57.46it/s]backtest loop:  92%|█████████▏| 800/872 [00:14<00:01, 58.12it/s]backtest loop:  92%|█████████▏| 806/872 [00:14<00:01, 55.09it/s]backtest loop:  93%|█████████▎| 812/872 [00:14<00:01, 56.35it/s]backtest loop:  94%|█████████▍| 818/872 [00:14<00:01, 53.94it/s]backtest loop:  95%|█████████▍| 825/872 [00:14<00:00, 56.39it/s]backtest loop:  95%|█████████▌| 832/872 [00:14<00:00, 58.13it/s]backtest loop:  96%|█████████▌| 838/872 [00:14<00:00, 55.32it/s]backtest loop:  97%|█████████▋| 844/872 [00:15<00:00, 56.41it/s]backtest loop:  97%|█████████▋| 850/872 [00:15<00:00, 57.38it/s]backtest loop:  98%|█████████▊| 856/872 [00:15<00:00, 54.64it/s]backtest loop:  99%|█████████▉| 863/872 [00:15<00:00, 57.17it/s]backtest loop: 100%|█████████▉| 870/872 [00:15<00:00, 58.68it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 55.94it/s]
[2160528:MainThread](2024-04-22 14:11:42,798) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000495
std                0.012300
annualized_return  0.117864
information_ratio  0.621155
max_drawdown      -0.370479
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000659
std                0.007158
annualized_return  0.156946
information_ratio  1.421275
max_drawdown      -0.122760
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000467
std                0.007157
annualized_return  0.111226
information_ratio  1.007340
max_drawdown      -0.128166
[2160528:MainThread](2024-04-22 14:11:42,814) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-22_13:59:44_online`.
{'1day.excess_return_with_cost.annualized_return': [0.11122624285193974],
 '1day.excess_return_with_cost.information_ratio': [1.0073404313106729],
 'IC': [0.047794093817928186],
 'ICIR': [0.33518060416752843],
 'Rank IC': [0.04635870119592828],
 'Rank ICIR': [0.3297524956240849],
 'mae': [0.6975067257881165],
 'mse': [0.9946232438087463]}
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2160528:MainThread](2024-04-22 14:11:43,783) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:15<25:03, 15.19s/it]epoch:   2%|▏         | 2/100 [00:30<24:43, 15.14s/it]epoch:   3%|▎         | 3/100 [00:45<24:32, 15.18s/it]epoch:   4%|▍         | 4/100 [01:00<24:11, 15.12s/it]epoch:   5%|▌         | 5/100 [01:15<23:54, 15.10s/it]epoch:   6%|▌         | 6/100 [01:30<23:44, 15.16s/it]epoch:   7%|▋         | 7/100 [01:45<23:24, 15.10s/it]epoch:   8%|▊         | 8/100 [02:01<23:14, 15.16s/it]epoch:   9%|▉         | 9/100 [02:16<22:52, 15.08s/it]epoch:  10%|█         | 10/100 [02:31<22:43, 15.15s/it]epoch:  11%|█         | 11/100 [02:46<22:31, 15.19s/it]epoch:  12%|█▏        | 12/100 [03:01<22:12, 15.14s/it]epoch:  13%|█▎        | 13/100 [03:16<21:55, 15.13s/it]epoch:  14%|█▍        | 14/100 [03:31<21:35, 15.06s/it]epoch:  15%|█▌        | 15/100 [03:46<21:22, 15.09s/it]epoch:  16%|█▌        | 16/100 [04:02<21:10, 15.13s/it]epoch:  17%|█▋        | 17/100 [04:17<20:51, 15.08s/it]epoch:  18%|█▊        | 18/100 [04:32<20:38, 15.10s/it]epoch:  19%|█▉        | 19/100 [04:47<20:25, 15.13s/it]epoch:  20%|██        | 20/100 [05:02<20:06, 15.08s/it]epoch:  21%|██        | 21/100 [05:17<19:50, 15.07s/it]epoch:  22%|██▏       | 22/100 [05:32<19:40, 15.13s/it]epoch:  23%|██▎       | 23/100 [05:47<19:24, 15.13s/it]epoch:  24%|██▍       | 24/100 [06:02<19:07, 15.10s/it]epoch:  25%|██▌       | 25/100 [06:17<18:47, 15.03s/it]epoch:  26%|██▌       | 26/100 [06:32<18:31, 15.02s/it]epoch:  27%|██▋       | 27/100 [06:48<18:26, 15.16s/it]epoch:  28%|██▊       | 28/100 [07:03<18:08, 15.12s/it]epoch:  29%|██▉       | 29/100 [07:18<17:52, 15.11s/it]epoch:  30%|███       | 30/100 [07:33<17:40, 15.14s/it]0.06626325732664172
best ic: 0.06626325732664172
epoch:  31%|███       | 31/100 [07:52<18:52, 16.42s/it]0.060230020949630335
epoch:  32%|███▏      | 32/100 [08:12<19:48, 17.48s/it]0.06232839694381316
epoch:  33%|███▎      | 33/100 [08:32<20:06, 18.00s/it]0.06343751322124404
epoch:  34%|███▍      | 34/100 [08:51<20:17, 18.44s/it]0.05967681604992645
epoch:  35%|███▌      | 35/100 [09:10<20:16, 18.72s/it]0.05998050091115561
epoch:  36%|███▌      | 36/100 [09:30<20:14, 18.98s/it]0.06485242945753306
epoch:  37%|███▋      | 37/100 [09:50<20:10, 19.22s/it]0.06190712750345805
epoch:  38%|███▊      | 38/100 [10:09<19:56, 19.30s/it]0.057790303137072785
epoch:  38%|███▊      | 38/100 [10:29<17:06, 16.56s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2160528:MainThread](2024-04-22 14:22:12,994) INFO - qlib.workflow - [exp.py:258] - Experiment 7 starts running ...
[2160528:MainThread](2024-04-22 14:22:13,003) INFO - qlib.workflow - [recorder.py:341] - Recorder 7f24dd5407134a1396ad0953b9b812ce starts running under Experiment 7 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   1%|▏         | 1/67 [00:00<00:08,  7.42it/s]online:   3%|▎         | 2/67 [00:00<00:08,  7.43it/s]online:   4%|▍         | 3/67 [00:00<00:08,  7.52it/s]online:   6%|▌         | 4/67 [00:00<00:08,  7.53it/s]online:   7%|▋         | 5/67 [00:00<00:10,  5.92it/s]online:   9%|▉         | 6/67 [00:01<00:12,  4.89it/s]online:  10%|█         | 7/67 [00:01<00:10,  5.51it/s]online:  12%|█▏        | 8/67 [00:01<00:09,  6.13it/s]online:  13%|█▎        | 9/67 [00:01<00:09,  5.99it/s]online:  15%|█▍        | 10/67 [00:01<00:08,  6.39it/s]online:  16%|█▋        | 11/67 [00:01<00:08,  6.72it/s]online:  18%|█▊        | 12/67 [00:01<00:09,  5.73it/s]online:  19%|█▉        | 13/67 [00:02<00:11,  4.86it/s]online:  21%|██        | 14/67 [00:02<00:10,  5.05it/s]online:  22%|██▏       | 15/67 [00:02<00:09,  5.61it/s]online:  24%|██▍       | 16/67 [00:02<00:09,  5.62it/s]online:  25%|██▌       | 17/67 [00:02<00:08,  6.06it/s]online:  27%|██▋       | 18/67 [00:03<00:07,  6.41it/s]online:  28%|██▊       | 19/67 [00:03<00:07,  6.76it/s]online:  30%|██▉       | 20/67 [00:03<00:08,  5.27it/s]online:  31%|███▏      | 21/67 [00:03<00:10,  4.59it/s]online:  33%|███▎      | 22/67 [00:03<00:10,  4.45it/s]online:  34%|███▍      | 23/67 [00:04<00:08,  5.09it/s]online:  36%|███▌      | 24/67 [00:04<00:07,  5.61it/s]online:  37%|███▋      | 25/67 [00:04<00:07,  5.32it/s]online:  39%|███▉      | 26/67 [00:04<00:07,  5.83it/s]online:  40%|████      | 27/67 [00:04<00:06,  6.23it/s]online:  42%|████▏     | 28/67 [00:04<00:05,  6.65it/s]online:  43%|████▎     | 29/67 [00:04<00:05,  6.97it/s]online:  45%|████▍     | 30/67 [00:05<00:06,  5.86it/s]online:  46%|████▋     | 31/67 [00:05<00:06,  5.31it/s]online:  48%|████▊     | 32/67 [00:05<00:05,  5.85it/s]online:  49%|████▉     | 33/67 [00:05<00:05,  5.92it/s]online:  51%|█████     | 34/67 [00:05<00:05,  6.30it/s]online:  52%|█████▏    | 35/67 [00:06<00:05,  6.13it/s]online:  54%|█████▎    | 36/67 [00:06<00:06,  4.99it/s]online:  55%|█████▌    | 37/67 [00:06<00:06,  4.93it/s]online:  57%|█████▋    | 38/67 [00:06<00:05,  5.56it/s]online:  58%|█████▊    | 39/67 [00:06<00:05,  5.48it/s]online:  60%|█████▉    | 40/67 [00:06<00:04,  5.96it/s]online:  61%|██████    | 41/67 [00:07<00:04,  6.37it/s]online:  63%|██████▎   | 42/67 [00:07<00:04,  6.19it/s]online:  64%|██████▍   | 43/67 [00:07<00:04,  5.05it/s]online:  66%|██████▌   | 44/67 [00:07<00:04,  4.94it/s]online:  67%|██████▋   | 45/67 [00:07<00:04,  5.44it/s]online:  69%|██████▊   | 46/67 [00:08<00:03,  5.43it/s]online:  70%|███████   | 47/67 [00:08<00:03,  5.91it/s]online:  72%|███████▏  | 48/67 [00:08<00:03,  6.28it/s]online:  73%|███████▎  | 49/67 [00:08<00:02,  6.27it/s]online:  75%|███████▍  | 50/67 [00:08<00:03,  5.08it/s]online:  76%|███████▌  | 51/67 [00:08<00:02,  5.58it/s]online:  78%|███████▊  | 52/67 [00:09<00:02,  5.66it/s]online:  79%|███████▉  | 53/67 [00:09<00:02,  5.96it/s]online:  81%|████████  | 54/67 [00:09<00:02,  4.87it/s]online:  82%|████████▏ | 55/67 [00:09<00:02,  4.46it/s]online:  84%|████████▎ | 56/67 [00:09<00:02,  5.09it/s]online:  85%|████████▌ | 57/67 [00:10<00:01,  5.28it/s]online:  87%|████████▋ | 58/67 [00:10<00:01,  5.51it/s]online:  88%|████████▊ | 59/67 [00:10<00:01,  5.87it/s]online:  90%|████████▉ | 60/67 [00:10<00:01,  6.27it/s]online:  91%|█████████ | 61/67 [00:10<00:01,  5.37it/s]online:  93%|█████████▎| 62/67 [00:11<00:01,  4.60it/s]online:  94%|█████████▍| 63/67 [00:11<00:00,  5.16it/s]online:  96%|█████████▌| 64/67 [00:11<00:00,  5.20it/s]online:  97%|█████████▋| 65/67 [00:11<00:00,  5.64it/s]online:  99%|█████████▊| 66/67 [00:11<00:00,  6.10it/s]online: 100%|██████████| 67/67 [00:12<00:00,  4.27it/s]online: 100%|██████████| 67/67 [00:12<00:00,  5.54it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2160528:MainThread](2024-04-22 14:22:31,423) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9945686 mae 0.6975472
{'IC': 0.04850299629052687,
 'ICIR': 0.3494834093909675,
 'Rank IC': 0.048894470472441824,
 'Rank ICIR': 0.3541161837832041}
[2160528:MainThread](2024-04-22 14:22:32,970) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2160528:MainThread](2024-04-22 14:22:40,922) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:22:40,924) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:22:45,095) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f2ae31c2fa0>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/872 [00:00<01:00, 14.27it/s]backtest loop:   1%|          | 9/872 [00:00<00:28, 29.79it/s]backtest loop:   2%|▏         | 15/872 [00:00<00:21, 39.90it/s]backtest loop:   2%|▏         | 20/872 [00:00<00:20, 41.44it/s]backtest loop:   3%|▎         | 26/872 [00:00<00:18, 46.92it/s]backtest loop:   4%|▎         | 32/872 [00:00<00:16, 50.81it/s]backtest loop:   4%|▍         | 38/872 [00:00<00:15, 53.22it/s]backtest loop:   5%|▌         | 44/872 [00:00<00:16, 51.05it/s]backtest loop:   6%|▌         | 51/872 [00:01<00:15, 54.51it/s]backtest loop:   7%|▋         | 57/872 [00:01<00:14, 55.65it/s]backtest loop:   7%|▋         | 63/872 [00:01<00:15, 53.35it/s]backtest loop:   8%|▊         | 69/872 [00:01<00:14, 55.04it/s]backtest loop:   9%|▊         | 75/872 [00:01<00:14, 56.34it/s]backtest loop:   9%|▉         | 81/872 [00:01<00:14, 53.84it/s]backtest loop:  10%|█         | 88/872 [00:01<00:13, 56.96it/s]backtest loop:  11%|█         | 95/872 [00:01<00:12, 59.89it/s]backtest loop:  12%|█▏        | 102/872 [00:01<00:13, 57.96it/s]backtest loop:  12%|█▎        | 109/872 [00:02<00:13, 56.71it/s]backtest loop:  13%|█▎        | 116/872 [00:02<00:12, 58.90it/s]backtest loop:  14%|█▍        | 123/872 [00:02<00:12, 60.69it/s]backtest loop:  15%|█▍        | 130/872 [00:02<00:12, 58.39it/s]backtest loop:  16%|█▌        | 137/872 [00:02<00:12, 60.27it/s]backtest loop:  17%|█▋        | 144/872 [00:02<00:12, 58.29it/s]backtest loop:  17%|█▋        | 151/872 [00:02<00:12, 60.06it/s]backtest loop:  18%|█▊        | 158/872 [00:02<00:11, 60.82it/s]backtest loop:  19%|█▉        | 165/872 [00:03<00:12, 57.23it/s]backtest loop:  20%|█▉        | 172/872 [00:03<00:11, 59.02it/s]backtest loop:  21%|██        | 179/872 [00:03<00:12, 57.57it/s]backtest loop:  21%|██        | 185/872 [00:03<00:11, 58.17it/s]backtest loop:  22%|██▏       | 192/872 [00:03<00:11, 60.11it/s]backtest loop:  23%|██▎       | 199/872 [00:03<00:11, 58.11it/s]backtest loop:  24%|██▎       | 206/872 [00:03<00:11, 60.08it/s]backtest loop:  24%|██▍       | 213/872 [00:03<00:10, 61.49it/s]backtest loop:  25%|██▌       | 220/872 [00:03<00:11, 59.22it/s]backtest loop:  26%|██▌       | 227/872 [00:04<00:10, 60.46it/s]backtest loop:  27%|██▋       | 234/872 [00:04<00:11, 57.42it/s]backtest loop:  28%|██▊       | 240/872 [00:04<00:10, 58.06it/s]backtest loop:  28%|██▊       | 246/872 [00:04<00:10, 58.29it/s]backtest loop:  29%|██▉       | 252/872 [00:04<00:10, 58.67it/s]backtest loop:  30%|██▉       | 258/872 [00:04<00:11, 55.36it/s]backtest loop:  30%|███       | 264/872 [00:04<00:10, 56.45it/s]backtest loop:  31%|███       | 271/872 [00:04<00:10, 58.32it/s]backtest loop:  32%|███▏      | 277/872 [00:04<00:10, 56.13it/s]backtest loop:  32%|███▏      | 283/872 [00:05<00:10, 53.69it/s]backtest loop:  33%|███▎      | 289/872 [00:05<00:10, 55.34it/s]backtest loop:  34%|███▍      | 295/872 [00:05<00:10, 56.40it/s]backtest loop:  35%|███▍      | 301/872 [00:05<00:09, 57.41it/s]backtest loop:  35%|███▌      | 307/872 [00:05<00:10, 54.25it/s]backtest loop:  36%|███▌      | 313/872 [00:05<00:10, 55.66it/s]backtest loop:  37%|███▋      | 319/872 [00:05<00:09, 56.52it/s]backtest loop:  37%|███▋      | 325/872 [00:05<00:10, 54.27it/s]backtest loop:  38%|███▊      | 331/872 [00:05<00:09, 55.44it/s]backtest loop:  39%|███▊      | 337/872 [00:06<00:09, 56.65it/s]backtest loop:  39%|███▉      | 343/872 [00:06<00:09, 56.92it/s]backtest loop:  40%|████      | 349/872 [00:06<00:09, 54.19it/s]backtest loop:  41%|████      | 356/872 [00:06<00:09, 56.71it/s]backtest loop:  42%|████▏     | 362/872 [00:06<00:08, 57.42it/s]backtest loop:  42%|████▏     | 368/872 [00:06<00:09, 54.64it/s]backtest loop:  43%|████▎     | 374/872 [00:06<00:08, 55.91it/s]backtest loop:  44%|████▎     | 380/872 [00:06<00:08, 56.88it/s]backtest loop:  44%|████▍     | 387/872 [00:06<00:08, 58.51it/s]backtest loop:  45%|████▌     | 393/872 [00:07<00:08, 55.30it/s]backtest loop:  46%|████▌     | 399/872 [00:07<00:08, 56.52it/s]backtest loop:  46%|████▋     | 405/872 [00:07<00:08, 57.43it/s]backtest loop:  47%|████▋     | 412/872 [00:07<00:07, 58.88it/s]backtest loop:  48%|████▊     | 418/872 [00:07<00:08, 55.43it/s]backtest loop:  49%|████▊     | 424/872 [00:07<00:07, 56.64it/s]backtest loop:  49%|████▉     | 430/872 [00:07<00:07, 57.49it/s]backtest loop:  50%|█████     | 437/872 [00:07<00:07, 55.51it/s]backtest loop:  51%|█████     | 443/872 [00:07<00:07, 56.72it/s]backtest loop:  51%|█████▏    | 449/872 [00:08<00:07, 57.43it/s]backtest loop:  52%|█████▏    | 455/872 [00:08<00:07, 57.33it/s]backtest loop:  53%|█████▎    | 461/872 [00:08<00:07, 57.77it/s]backtest loop:  54%|█████▎    | 467/872 [00:08<00:07, 54.62it/s]backtest loop:  54%|█████▍    | 473/872 [00:08<00:07, 55.98it/s]backtest loop:  55%|█████▍    | 479/872 [00:08<00:06, 56.59it/s]backtest loop:  56%|█████▌    | 485/872 [00:08<00:06, 57.34it/s]backtest loop:  56%|█████▋    | 491/872 [00:08<00:07, 54.14it/s]backtest loop:  57%|█████▋    | 497/872 [00:08<00:06, 55.51it/s]backtest loop:  58%|█████▊    | 503/872 [00:09<00:06, 56.59it/s]backtest loop:  58%|█████▊    | 509/872 [00:09<00:06, 57.09it/s]backtest loop:  59%|█████▉    | 515/872 [00:09<00:10, 33.05it/s]backtest loop:  60%|█████▉    | 522/872 [00:09<00:08, 39.55it/s]backtest loop:  61%|██████    | 529/872 [00:09<00:07, 45.18it/s]backtest loop:  61%|██████▏   | 535/872 [00:09<00:07, 46.11it/s]backtest loop:  62%|██████▏   | 542/872 [00:09<00:06, 50.25it/s]backtest loop:  63%|██████▎   | 549/872 [00:10<00:06, 50.87it/s]backtest loop:  64%|██████▎   | 555/872 [00:10<00:05, 53.06it/s]backtest loop:  64%|██████▍   | 561/872 [00:10<00:05, 54.79it/s]backtest loop:  65%|██████▌   | 567/872 [00:10<00:05, 53.49it/s]backtest loop:  66%|██████▌   | 573/872 [00:10<00:05, 55.06it/s]backtest loop:  66%|██████▋   | 579/872 [00:10<00:05, 56.19it/s]backtest loop:  67%|██████▋   | 586/872 [00:10<00:05, 54.56it/s]backtest loop:  68%|██████▊   | 592/872 [00:10<00:05, 55.91it/s]backtest loop:  69%|██████▊   | 598/872 [00:10<00:04, 57.00it/s]backtest loop:  69%|██████▉   | 605/872 [00:11<00:04, 55.33it/s]backtest loop:  70%|███████   | 611/872 [00:11<00:04, 56.48it/s]backtest loop:  71%|███████   | 617/872 [00:11<00:04, 57.31it/s]backtest loop:  71%|███████▏  | 623/872 [00:11<00:04, 57.91it/s]backtest loop:  72%|███████▏  | 629/872 [00:11<00:04, 58.49it/s]backtest loop:  73%|███████▎  | 635/872 [00:11<00:04, 55.03it/s]backtest loop:  74%|███████▎  | 641/872 [00:11<00:04, 56.23it/s]backtest loop:  74%|███████▍  | 647/872 [00:11<00:03, 57.06it/s]backtest loop:  75%|███████▍  | 653/872 [00:11<00:03, 57.58it/s]backtest loop:  76%|███████▌  | 659/872 [00:11<00:03, 54.46it/s]backtest loop:  76%|███████▋  | 665/872 [00:12<00:03, 55.72it/s]backtest loop:  77%|███████▋  | 671/872 [00:12<00:03, 53.38it/s]backtest loop:  78%|███████▊  | 677/872 [00:12<00:03, 55.08it/s]backtest loop:  78%|███████▊  | 683/872 [00:12<00:03, 55.83it/s]backtest loop:  79%|███████▉  | 689/872 [00:12<00:03, 53.57it/s]backtest loop:  80%|███████▉  | 695/872 [00:12<00:03, 55.19it/s]backtest loop:  80%|████████  | 701/872 [00:12<00:03, 56.16it/s]backtest loop:  81%|████████  | 707/872 [00:12<00:02, 57.17it/s]backtest loop:  82%|████████▏ | 713/872 [00:12<00:02, 57.93it/s]backtest loop:  82%|████████▏ | 719/872 [00:13<00:02, 54.56it/s]backtest loop:  83%|████████▎ | 725/872 [00:13<00:02, 55.72it/s]backtest loop:  84%|████████▍ | 731/872 [00:13<00:02, 52.49it/s]backtest loop:  85%|████████▍ | 737/872 [00:13<00:02, 53.55it/s]backtest loop:  85%|████████▌ | 743/872 [00:13<00:02, 51.96it/s]backtest loop:  86%|████████▌ | 750/872 [00:13<00:02, 54.95it/s]backtest loop:  87%|████████▋ | 756/872 [00:13<00:02, 56.14it/s]backtest loop:  87%|████████▋ | 762/872 [00:13<00:02, 53.61it/s]backtest loop:  88%|████████▊ | 768/872 [00:13<00:01, 55.21it/s]backtest loop:  89%|████████▉ | 774/872 [00:14<00:01, 56.26it/s]backtest loop:  89%|████████▉ | 780/872 [00:14<00:01, 57.26it/s]backtest loop:  90%|█████████ | 786/872 [00:14<00:01, 57.96it/s]backtest loop:  91%|█████████ | 792/872 [00:14<00:01, 54.81it/s]backtest loop:  92%|█████████▏| 798/872 [00:14<00:01, 56.09it/s]backtest loop:  92%|█████████▏| 804/872 [00:14<00:01, 57.07it/s]backtest loop:  93%|█████████▎| 810/872 [00:14<00:01, 54.22it/s]backtest loop:  94%|█████████▎| 817/872 [00:14<00:00, 56.62it/s]backtest loop:  94%|█████████▍| 823/872 [00:14<00:00, 54.10it/s]backtest loop:  95%|█████████▌| 829/872 [00:15<00:00, 55.56it/s]backtest loop:  96%|█████████▌| 836/872 [00:15<00:00, 57.56it/s]backtest loop:  97%|█████████▋| 842/872 [00:15<00:00, 58.12it/s]backtest loop:  97%|█████████▋| 848/872 [00:15<00:00, 55.39it/s]backtest loop:  98%|█████████▊| 855/872 [00:15<00:00, 57.52it/s]backtest loop:  99%|█████████▊| 861/872 [00:15<00:00, 54.90it/s]backtest loop: 100%|█████████▉| 868/872 [00:15<00:00, 57.43it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 55.11it/s]
[2160528:MainThread](2024-04-22 14:23:00,982) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000495
std                0.012300
annualized_return  0.117864
information_ratio  0.621155
max_drawdown      -0.370479
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000684
std                0.006448
annualized_return  0.162806
information_ratio  1.636597
max_drawdown      -0.104823
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000493
std                0.006447
annualized_return  0.117243
information_ratio  1.178726
max_drawdown      -0.113907
[2160528:MainThread](2024-04-22 14:23:00,996) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-22_13:59:44_online`.
{'1day.excess_return_with_cost.annualized_return': [0.11122624285193974,
                                                    0.1172430590821991],
 '1day.excess_return_with_cost.information_ratio': [1.0073404313106729,
                                                    1.1787257560325017],
 'IC': [0.047794093817928186, 0.04850299629052687],
 'ICIR': [0.33518060416752843, 0.3494834093909675],
 'Rank IC': [0.04635870119592828, 0.048894470472441824],
 'Rank ICIR': [0.3297524956240849, 0.3541161837832041],
 'mae': [0.6975067257881165, 0.697547197341919],
 'mse': [0.9946232438087463, 0.9945685863494873]}
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2160528:MainThread](2024-04-22 14:23:01,968) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:15<24:46, 15.01s/it]epoch:   2%|▏         | 2/100 [00:30<24:38, 15.08s/it]epoch:   3%|▎         | 3/100 [00:45<24:21, 15.07s/it]epoch:   4%|▍         | 4/100 [01:00<24:14, 15.15s/it]epoch:   5%|▌         | 5/100 [01:15<23:54, 15.10s/it]epoch:   6%|▌         | 6/100 [01:30<23:43, 15.14s/it]epoch:   7%|▋         | 7/100 [01:45<23:29, 15.15s/it]epoch:   8%|▊         | 8/100 [02:00<23:09, 15.10s/it]epoch:   9%|▉         | 9/100 [02:15<22:54, 15.11s/it]epoch:  10%|█         | 10/100 [02:31<22:39, 15.10s/it]epoch:  11%|█         | 11/100 [02:46<22:25, 15.12s/it]epoch:  12%|█▏        | 12/100 [03:01<22:11, 15.13s/it]epoch:  13%|█▎        | 13/100 [03:16<21:51, 15.07s/it]epoch:  14%|█▍        | 14/100 [03:31<21:37, 15.09s/it]epoch:  15%|█▌        | 15/100 [03:46<21:21, 15.08s/it]epoch:  16%|█▌        | 16/100 [04:01<21:07, 15.08s/it]epoch:  17%|█▋        | 17/100 [04:16<20:52, 15.09s/it]epoch:  18%|█▊        | 18/100 [04:31<20:34, 15.05s/it]epoch:  19%|█▉        | 19/100 [04:47<20:28, 15.17s/it]epoch:  20%|██        | 20/100 [05:01<20:06, 15.08s/it]epoch:  21%|██        | 21/100 [05:17<19:52, 15.10s/it]epoch:  22%|██▏       | 22/100 [05:32<19:37, 15.10s/it]epoch:  23%|██▎       | 23/100 [05:47<19:20, 15.07s/it]epoch:  24%|██▍       | 24/100 [06:02<19:16, 15.21s/it]epoch:  25%|██▌       | 25/100 [06:17<18:52, 15.10s/it]epoch:  26%|██▌       | 26/100 [06:32<18:30, 15.00s/it]epoch:  27%|██▋       | 27/100 [06:47<18:16, 15.02s/it]epoch:  28%|██▊       | 28/100 [07:02<17:59, 14.99s/it]epoch:  29%|██▉       | 29/100 [07:17<17:51, 15.10s/it]epoch:  30%|███       | 30/100 [07:32<17:38, 15.11s/it]0.06276704482469486
best ic: 0.06276704482469486
epoch:  31%|███       | 31/100 [07:52<18:54, 16.45s/it]0.06768956784005407
best ic: 0.06768956784005407
epoch:  32%|███▏      | 32/100 [08:12<19:43, 17.40s/it]0.06519476185572766
epoch:  33%|███▎      | 33/100 [08:31<20:12, 18.09s/it]0.06516254371849708
epoch:  34%|███▍      | 34/100 [08:51<20:26, 18.59s/it]0.06177736484310889
epoch:  35%|███▌      | 35/100 [09:10<20:21, 18.79s/it]0.06518280098263904
epoch:  36%|███▌      | 36/100 [09:30<20:16, 19.01s/it]0.06292852564260988
epoch:  37%|███▋      | 37/100 [09:50<20:11, 19.23s/it]0.06504803460009312
epoch:  38%|███▊      | 38/100 [10:09<19:56, 19.30s/it]0.06485599517593701
epoch:  39%|███▉      | 39/100 [10:29<19:45, 19.44s/it]0.06082679583730699
epoch:  39%|███▉      | 39/100 [10:48<16:54, 16.63s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2160528:MainThread](2024-04-22 14:33:50,833) INFO - qlib.workflow - [exp.py:258] - Experiment 7 starts running ...
[2160528:MainThread](2024-04-22 14:33:50,843) INFO - qlib.workflow - [recorder.py:341] - Recorder fb543876e43a44b7865401cc83a218f4 starts running under Experiment 7 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   1%|▏         | 1/67 [00:00<00:08,  7.87it/s]online:   3%|▎         | 2/67 [00:00<00:08,  7.77it/s]online:   4%|▍         | 3/67 [00:00<00:08,  7.65it/s]online:   6%|▌         | 4/67 [00:00<00:08,  7.63it/s]online:   7%|▋         | 5/67 [00:00<00:08,  7.68it/s]online:   9%|▉         | 6/67 [00:00<00:07,  7.72it/s]online:  10%|█         | 7/67 [00:00<00:09,  6.38it/s]online:  12%|█▏        | 8/67 [00:01<00:09,  5.92it/s]online:  13%|█▎        | 9/67 [00:01<00:09,  6.10it/s]online:  15%|█▍        | 10/67 [00:01<00:08,  6.50it/s]online:  16%|█▋        | 11/67 [00:01<00:08,  6.63it/s]online:  18%|█▊        | 12/67 [00:01<00:10,  5.24it/s]online:  19%|█▉        | 13/67 [00:02<00:10,  5.20it/s]online:  21%|██        | 14/67 [00:02<00:09,  5.75it/s]online:  22%|██▏       | 15/67 [00:02<00:08,  5.82it/s]online:  24%|██▍       | 16/67 [00:02<00:08,  6.17it/s]online:  25%|██▌       | 17/67 [00:02<00:08,  6.14it/s]online:  27%|██▋       | 18/67 [00:02<00:09,  5.00it/s]online:  28%|██▊       | 19/67 [00:03<00:09,  4.91it/s]online:  30%|██▉       | 20/67 [00:03<00:08,  5.48it/s]online:  31%|███▏      | 21/67 [00:03<00:08,  5.48it/s]online:  33%|███▎      | 22/67 [00:03<00:07,  5.96it/s]online:  34%|███▍      | 23/67 [00:03<00:06,  6.43it/s]online:  36%|███▌      | 24/67 [00:03<00:07,  5.80it/s]online:  37%|███▋      | 25/67 [00:04<00:08,  5.00it/s]online:  39%|███▉      | 26/67 [00:04<00:07,  5.57it/s]online:  40%|████      | 27/67 [00:04<00:06,  5.75it/s]online:  42%|████▏     | 28/67 [00:04<00:06,  6.14it/s]online:  43%|████▎     | 29/67 [00:04<00:06,  6.04it/s]online:  45%|████▍     | 30/67 [00:05<00:07,  5.05it/s]online:  46%|████▋     | 31/67 [00:05<00:07,  4.50it/s]online:  48%|████▊     | 32/67 [00:05<00:07,  4.80it/s]online:  49%|████▉     | 33/67 [00:05<00:06,  5.40it/s]online:  51%|█████     | 34/67 [00:05<00:05,  5.59it/s]online:  52%|█████▏    | 35/67 [00:06<00:05,  5.66it/s]online:  54%|█████▎    | 36/67 [00:06<00:05,  6.12it/s]online:  55%|█████▌    | 37/67 [00:06<00:04,  6.50it/s]online:  57%|█████▋    | 38/67 [00:06<00:04,  6.78it/s]online:  58%|█████▊    | 39/67 [00:06<00:04,  5.80it/s]online:  60%|█████▉    | 40/67 [00:06<00:05,  4.83it/s]online:  61%|██████    | 41/67 [00:07<00:04,  5.27it/s]online:  63%|██████▎   | 42/67 [00:07<00:04,  5.68it/s]online:  64%|██████▍   | 43/67 [00:07<00:04,  5.71it/s]online:  66%|██████▌   | 44/67 [00:07<00:03,  6.16it/s]online:  67%|██████▋   | 45/67 [00:07<00:03,  6.48it/s]online:  69%|██████▊   | 46/67 [00:07<00:04,  5.15it/s]online:  70%|███████   | 47/67 [00:08<00:04,  4.68it/s]online:  72%|███████▏  | 48/67 [00:08<00:03,  5.25it/s]online:  73%|███████▎  | 49/67 [00:08<00:03,  5.26it/s]online:  75%|███████▍  | 50/67 [00:08<00:02,  5.72it/s]online:  76%|███████▌  | 51/67 [00:08<00:02,  6.12it/s]online:  78%|███████▊  | 52/67 [00:08<00:02,  6.26it/s]online:  79%|███████▉  | 53/67 [00:09<00:02,  4.96it/s]online:  81%|████████  | 54/67 [00:09<00:02,  4.35it/s]online:  82%|████████▏ | 55/67 [00:09<00:02,  4.63it/s]online:  84%|████████▎ | 56/67 [00:09<00:02,  5.19it/s]online:  85%|████████▌ | 57/67 [00:10<00:01,  5.28it/s]online:  87%|████████▋ | 58/67 [00:10<00:01,  5.57it/s]online:  88%|████████▊ | 59/67 [00:10<00:01,  5.92it/s]online:  90%|████████▉ | 60/67 [00:10<00:01,  6.29it/s]online:  91%|█████████ | 61/67 [00:10<00:00,  6.59it/s]online:  93%|█████████▎| 62/67 [00:10<00:00,  5.32it/s]online:  94%|█████████▍| 63/67 [00:11<00:00,  4.53it/s]online:  96%|█████████▌| 64/67 [00:11<00:00,  4.54it/s]online:  97%|█████████▋| 65/67 [00:11<00:00,  5.12it/s]online:  99%|█████████▊| 66/67 [00:11<00:00,  5.61it/s]online: 100%|██████████| 67/67 [00:11<00:00,  5.45it/s]online: 100%|██████████| 67/67 [00:11<00:00,  5.62it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2160528:MainThread](2024-04-22 14:34:09,334) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9944507 mae 0.697615
{'IC': 0.049824131514057186,
 'ICIR': 0.36494642230010954,
 'Rank IC': 0.047156937600123204,
 'Rank ICIR': 0.3534710503831135}
[2160528:MainThread](2024-04-22 14:34:10,870) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2160528:MainThread](2024-04-22 14:34:19,426) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:34:19,428) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:34:23,662) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f2aeaa25940>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/872 [00:00<01:01, 14.08it/s]backtest loop:   1%|          | 9/872 [00:00<00:29, 29.58it/s]backtest loop:   2%|▏         | 15/872 [00:00<00:21, 39.93it/s]backtest loop:   2%|▏         | 20/872 [00:00<00:20, 41.75it/s]backtest loop:   3%|▎         | 26/872 [00:00<00:17, 47.32it/s]backtest loop:   4%|▎         | 32/872 [00:00<00:16, 51.07it/s]backtest loop:   4%|▍         | 38/872 [00:00<00:15, 53.75it/s]backtest loop:   5%|▌         | 44/872 [00:00<00:15, 51.82it/s]backtest loop:   6%|▌         | 51/872 [00:01<00:14, 54.92it/s]backtest loop:   7%|▋         | 57/872 [00:01<00:14, 56.18it/s]backtest loop:   7%|▋         | 63/872 [00:01<00:15, 53.56it/s]backtest loop:   8%|▊         | 69/872 [00:01<00:14, 55.22it/s]backtest loop:   9%|▊         | 75/872 [00:01<00:14, 56.26it/s]backtest loop:   9%|▉         | 81/872 [00:01<00:14, 53.63it/s]backtest loop:  10%|█         | 88/872 [00:01<00:13, 56.88it/s]backtest loop:  11%|█         | 95/872 [00:01<00:13, 59.43it/s]backtest loop:  12%|█▏        | 101/872 [00:01<00:13, 56.95it/s]backtest loop:  12%|█▏        | 108/872 [00:02<00:12, 59.18it/s]backtest loop:  13%|█▎        | 114/872 [00:02<00:13, 56.35it/s]backtest loop:  14%|█▍        | 121/872 [00:02<00:12, 58.91it/s]backtest loop:  15%|█▍        | 128/872 [00:02<00:12, 60.08it/s]backtest loop:  15%|█▌        | 135/872 [00:02<00:12, 58.12it/s]backtest loop:  16%|█▋        | 142/872 [00:02<00:12, 60.01it/s]backtest loop:  17%|█▋        | 149/872 [00:02<00:12, 58.11it/s]backtest loop:  18%|█▊        | 156/872 [00:02<00:11, 60.06it/s]backtest loop:  19%|█▊        | 163/872 [00:03<00:11, 61.55it/s]backtest loop:  19%|█▉        | 170/872 [00:03<00:11, 59.23it/s]backtest loop:  20%|██        | 177/872 [00:03<00:11, 60.79it/s]backtest loop:  21%|██        | 184/872 [00:03<00:11, 58.74it/s]backtest loop:  22%|██▏       | 191/872 [00:03<00:11, 60.52it/s]backtest loop:  23%|██▎       | 198/872 [00:03<00:10, 61.89it/s]backtest loop:  24%|██▎       | 205/872 [00:03<00:11, 59.41it/s]backtest loop:  24%|██▍       | 212/872 [00:03<00:10, 61.07it/s]backtest loop:  25%|██▌       | 219/872 [00:03<00:11, 58.74it/s]backtest loop:  26%|██▌       | 226/872 [00:04<00:10, 60.30it/s]backtest loop:  27%|██▋       | 233/872 [00:04<00:10, 60.56it/s]backtest loop:  28%|██▊       | 240/872 [00:04<00:10, 57.53it/s]backtest loop:  28%|██▊       | 246/872 [00:04<00:10, 57.89it/s]backtest loop:  29%|██▉       | 252/872 [00:04<00:10, 58.36it/s]backtest loop:  30%|██▉       | 258/872 [00:04<00:11, 55.01it/s]backtest loop:  30%|███       | 264/872 [00:04<00:10, 56.21it/s]backtest loop:  31%|███       | 270/872 [00:04<00:10, 57.10it/s]backtest loop:  32%|███▏      | 276/872 [00:04<00:10, 55.31it/s]backtest loop:  32%|███▏      | 282/872 [00:05<00:10, 56.04it/s]backtest loop:  33%|███▎      | 288/872 [00:05<00:10, 53.63it/s]backtest loop:  34%|███▎      | 294/872 [00:05<00:10, 54.75it/s]backtest loop:  34%|███▍      | 300/872 [00:05<00:10, 56.10it/s]backtest loop:  35%|███▌      | 306/872 [00:05<00:10, 53.52it/s]backtest loop:  36%|███▌      | 312/872 [00:05<00:10, 55.16it/s]backtest loop:  36%|███▋      | 318/872 [00:05<00:09, 56.36it/s]backtest loop:  37%|███▋      | 324/872 [00:05<00:10, 53.97it/s]backtest loop:  38%|███▊      | 330/872 [00:05<00:09, 55.53it/s]backtest loop:  39%|███▊      | 336/872 [00:06<00:09, 56.48it/s]backtest loop:  39%|███▉      | 342/872 [00:06<00:09, 57.10it/s]backtest loop:  40%|███▉      | 348/872 [00:06<00:09, 57.72it/s]backtest loop:  41%|████      | 354/872 [00:06<00:09, 54.72it/s]backtest loop:  41%|████▏     | 360/872 [00:06<00:09, 56.20it/s]backtest loop:  42%|████▏     | 366/872 [00:06<00:08, 57.09it/s]backtest loop:  43%|████▎     | 372/872 [00:06<00:08, 57.79it/s]backtest loop:  43%|████▎     | 378/872 [00:06<00:09, 54.71it/s]backtest loop:  44%|████▍     | 384/872 [00:06<00:08, 56.00it/s]backtest loop:  45%|████▍     | 390/872 [00:06<00:08, 56.98it/s]backtest loop:  45%|████▌     | 396/872 [00:07<00:08, 57.61it/s]backtest loop:  46%|████▌     | 402/872 [00:07<00:08, 58.17it/s]backtest loop:  47%|████▋     | 408/872 [00:07<00:08, 54.90it/s]backtest loop:  47%|████▋     | 414/872 [00:07<00:08, 56.23it/s]backtest loop:  48%|████▊     | 420/872 [00:07<00:07, 57.16it/s]backtest loop:  49%|████▉     | 426/872 [00:07<00:07, 57.63it/s]backtest loop:  50%|████▉     | 432/872 [00:07<00:08, 54.75it/s]backtest loop:  50%|█████     | 438/872 [00:07<00:07, 56.04it/s]backtest loop:  51%|█████     | 444/872 [00:07<00:07, 57.01it/s]backtest loop:  52%|█████▏    | 451/872 [00:08<00:07, 58.20it/s]backtest loop:  52%|█████▏    | 457/872 [00:08<00:07, 55.15it/s]backtest loop:  53%|█████▎    | 463/872 [00:08<00:07, 56.32it/s]backtest loop:  54%|█████▍    | 469/872 [00:08<00:07, 56.65it/s]backtest loop:  54%|█████▍    | 475/872 [00:08<00:06, 57.52it/s]backtest loop:  55%|█████▌    | 482/872 [00:08<00:07, 55.38it/s]backtest loop:  56%|█████▌    | 488/872 [00:08<00:06, 56.50it/s]backtest loop:  57%|█████▋    | 494/872 [00:08<00:06, 57.41it/s]backtest loop:  57%|█████▋    | 500/872 [00:08<00:06, 54.61it/s]backtest loop:  58%|█████▊    | 506/872 [00:09<00:06, 55.93it/s]backtest loop:  59%|█████▊    | 512/872 [00:09<00:10, 35.20it/s]backtest loop:  59%|█████▉    | 518/872 [00:09<00:08, 40.08it/s]backtest loop:  60%|██████    | 525/872 [00:09<00:07, 43.44it/s]backtest loop:  61%|██████    | 532/872 [00:09<00:07, 48.10it/s]backtest loop:  62%|██████▏   | 538/872 [00:09<00:06, 50.95it/s]backtest loop:  62%|██████▎   | 545/872 [00:09<00:06, 51.24it/s]backtest loop:  63%|██████▎   | 552/872 [00:10<00:05, 54.24it/s]backtest loop:  64%|██████▍   | 558/872 [00:10<00:05, 55.59it/s]backtest loop:  65%|██████▍   | 564/872 [00:10<00:05, 53.49it/s]backtest loop:  65%|██████▌   | 571/872 [00:10<00:05, 53.57it/s]backtest loop:  66%|██████▌   | 577/872 [00:10<00:05, 54.82it/s]backtest loop:  67%|██████▋   | 583/872 [00:10<00:05, 56.11it/s]backtest loop:  68%|██████▊   | 589/872 [00:10<00:04, 57.08it/s]backtest loop:  68%|██████▊   | 595/872 [00:10<00:05, 54.31it/s]backtest loop:  69%|██████▉   | 602/872 [00:10<00:04, 56.87it/s]backtest loop:  70%|██████▉   | 609/872 [00:11<00:04, 58.51it/s]backtest loop:  71%|███████   | 615/872 [00:11<00:04, 54.86it/s]backtest loop:  71%|███████   | 621/872 [00:11<00:04, 55.87it/s]backtest loop:  72%|███████▏  | 627/872 [00:11<00:04, 56.88it/s]backtest loop:  73%|███████▎  | 633/872 [00:11<00:04, 57.31it/s]backtest loop:  73%|███████▎  | 639/872 [00:11<00:04, 58.03it/s]backtest loop:  74%|███████▍  | 645/872 [00:11<00:04, 54.95it/s]backtest loop:  75%|███████▍  | 651/872 [00:11<00:03, 55.93it/s]backtest loop:  75%|███████▌  | 657/872 [00:11<00:03, 57.03it/s]backtest loop:  76%|███████▌  | 663/872 [00:12<00:03, 57.72it/s]backtest loop:  77%|███████▋  | 669/872 [00:12<00:03, 54.04it/s]backtest loop:  77%|███████▋  | 675/872 [00:12<00:03, 52.28it/s]backtest loop:  78%|███████▊  | 681/872 [00:12<00:03, 53.58it/s]backtest loop:  79%|███████▉  | 687/872 [00:12<00:03, 54.97it/s]backtest loop:  80%|███████▉  | 694/872 [00:12<00:03, 53.81it/s]backtest loop:  80%|████████  | 700/872 [00:12<00:03, 55.36it/s]backtest loop:  81%|████████  | 706/872 [00:12<00:02, 56.33it/s]backtest loop:  82%|████████▏ | 712/872 [00:12<00:02, 57.30it/s]backtest loop:  82%|████████▏ | 718/872 [00:13<00:02, 57.93it/s]backtest loop:  83%|████████▎ | 724/872 [00:13<00:02, 54.75it/s]backtest loop:  84%|████████▎ | 730/872 [00:13<00:02, 56.01it/s]backtest loop:  84%|████████▍ | 736/872 [00:13<00:02, 53.75it/s]backtest loop:  85%|████████▌ | 743/872 [00:13<00:02, 53.36it/s]backtest loop:  86%|████████▌ | 750/872 [00:13<00:02, 56.57it/s]backtest loop:  87%|████████▋ | 756/872 [00:13<00:02, 57.40it/s]backtest loop:  87%|████████▋ | 762/872 [00:13<00:02, 54.73it/s]backtest loop:  88%|████████▊ | 769/872 [00:13<00:01, 56.97it/s]backtest loop:  89%|████████▉ | 775/872 [00:14<00:01, 57.67it/s]backtest loop:  90%|████████▉ | 782/872 [00:14<00:01, 55.61it/s]backtest loop:  90%|█████████ | 788/872 [00:14<00:01, 56.62it/s]backtest loop:  91%|█████████ | 795/872 [00:14<00:01, 58.21it/s]backtest loop:  92%|█████████▏| 801/872 [00:14<00:01, 55.08it/s]backtest loop:  93%|█████████▎| 807/872 [00:14<00:01, 56.20it/s]backtest loop:  93%|█████████▎| 813/872 [00:14<00:01, 53.63it/s]backtest loop:  94%|█████████▍| 820/872 [00:14<00:00, 56.11it/s]backtest loop:  95%|█████████▍| 826/872 [00:14<00:00, 56.96it/s]backtest loop:  95%|█████████▌| 832/872 [00:15<00:00, 57.63it/s]backtest loop:  96%|█████████▌| 838/872 [00:15<00:00, 54.59it/s]backtest loop:  97%|█████████▋| 844/872 [00:15<00:00, 55.92it/s]backtest loop:  97%|█████████▋| 850/872 [00:15<00:00, 56.87it/s]backtest loop:  98%|█████████▊| 856/872 [00:15<00:00, 54.55it/s]backtest loop:  99%|█████████▉| 863/872 [00:15<00:00, 56.91it/s]backtest loop: 100%|█████████▉| 870/872 [00:15<00:00, 58.23it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 55.23it/s]
[2160528:MainThread](2024-04-22 14:34:39,512) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000495
std                0.012300
annualized_return  0.117864
information_ratio  0.621155
max_drawdown      -0.370479
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000688
std                0.006053
annualized_return  0.163661
information_ratio  1.752645
max_drawdown      -0.099086
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000496
std                0.006051
annualized_return  0.118145
information_ratio  1.265651
max_drawdown      -0.109705
[2160528:MainThread](2024-04-22 14:34:39,526) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-22_13:59:44_online`.
{'1day.excess_return_with_cost.annualized_return': [0.11122624285193974,
                                                    0.1172430590821991,
                                                    0.1181450950678585],
 '1day.excess_return_with_cost.information_ratio': [1.0073404313106729,
                                                    1.1787257560325017,
                                                    1.2656507239020849],
 'IC': [0.047794093817928186, 0.04850299629052687, 0.049824131514057186],
 'ICIR': [0.33518060416752843, 0.3494834093909675, 0.36494642230010954],
 'Rank IC': [0.04635870119592828, 0.048894470472441824, 0.047156937600123204],
 'Rank ICIR': [0.3297524956240849, 0.3541161837832041, 0.3534710503831135],
 'mae': [0.6975067257881165, 0.697547197341919, 0.6976150274276733],
 'mse': [0.9946232438087463, 0.9945685863494873, 0.9944506883621216]}
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2160528:MainThread](2024-04-22 14:34:40,521) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:15<24:46, 15.02s/it]epoch:   2%|▏         | 2/100 [00:30<24:52, 15.22s/it]epoch:   3%|▎         | 3/100 [00:45<24:34, 15.20s/it]epoch:   4%|▍         | 4/100 [01:00<24:25, 15.27s/it]epoch:   5%|▌         | 5/100 [01:15<24:02, 15.18s/it]epoch:   6%|▌         | 6/100 [01:31<23:49, 15.21s/it]epoch:   7%|▋         | 7/100 [01:46<23:30, 15.17s/it]epoch:   8%|▊         | 8/100 [02:01<23:16, 15.18s/it]epoch:   9%|▉         | 9/100 [02:16<22:59, 15.16s/it]epoch:  10%|█         | 10/100 [02:31<22:45, 15.17s/it]epoch:  11%|█         | 11/100 [02:46<22:24, 15.11s/it]epoch:  12%|█▏        | 12/100 [03:02<22:16, 15.19s/it]epoch:  13%|█▎        | 13/100 [03:17<21:54, 15.11s/it]epoch:  14%|█▍        | 14/100 [03:32<21:39, 15.11s/it]epoch:  15%|█▌        | 15/100 [03:47<21:28, 15.16s/it]epoch:  16%|█▌        | 16/100 [04:02<21:09, 15.11s/it]epoch:  17%|█▋        | 17/100 [04:17<20:52, 15.09s/it]epoch:  18%|█▊        | 18/100 [04:32<20:39, 15.12s/it]epoch:  19%|█▉        | 19/100 [04:48<20:29, 15.18s/it]epoch:  20%|██        | 20/100 [05:03<20:13, 15.17s/it]epoch:  21%|██        | 21/100 [05:18<20:01, 15.21s/it]epoch:  22%|██▏       | 22/100 [05:33<19:48, 15.24s/it]epoch:  23%|██▎       | 23/100 [05:48<19:15, 15.01s/it]epoch:  24%|██▍       | 24/100 [06:03<19:08, 15.12s/it]epoch:  25%|██▌       | 25/100 [06:18<18:50, 15.07s/it]epoch:  26%|██▌       | 26/100 [06:33<18:35, 15.08s/it]epoch:  27%|██▋       | 27/100 [06:48<18:23, 15.12s/it]epoch:  28%|██▊       | 28/100 [07:03<18:04, 15.06s/it]epoch:  29%|██▉       | 29/100 [07:19<17:53, 15.12s/it]epoch:  30%|███       | 30/100 [07:34<17:37, 15.10s/it]0.06739317330421653
best ic: 0.06739317330421653
epoch:  31%|███       | 31/100 [07:53<18:55, 16.45s/it]0.06224723889755815
epoch:  32%|███▏      | 32/100 [08:13<19:43, 17.40s/it]0.06711507329514067
epoch:  33%|███▎      | 33/100 [08:32<20:07, 18.03s/it]0.0664051482727911
epoch:  34%|███▍      | 34/100 [08:52<20:23, 18.53s/it]0.0636168218518118
epoch:  35%|███▌      | 35/100 [09:12<20:23, 18.83s/it]0.06372286952019698
epoch:  36%|███▌      | 36/100 [09:31<20:15, 19.00s/it]0.060818057666437
epoch:  37%|███▋      | 37/100 [09:50<20:06, 19.15s/it]0.0643725238292094
epoch:  38%|███▊      | 38/100 [10:10<19:53, 19.25s/it]0.06333724213189082
epoch:  38%|███▊      | 38/100 [10:29<17:07, 16.58s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2160528:MainThread](2024-04-22 14:45:10,450) INFO - qlib.workflow - [exp.py:258] - Experiment 7 starts running ...
[2160528:MainThread](2024-04-22 14:45:10,459) INFO - qlib.workflow - [recorder.py:341] - Recorder c49b607d6cd946f28f1dc6535abb7260 starts running under Experiment 7 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   1%|▏         | 1/67 [00:00<00:15,  4.27it/s]online:   3%|▎         | 2/67 [00:00<00:12,  5.07it/s]online:   4%|▍         | 3/67 [00:00<00:10,  5.98it/s]online:   6%|▌         | 4/67 [00:00<00:11,  5.63it/s]online:   7%|▋         | 5/67 [00:00<00:09,  6.23it/s]online:   9%|▉         | 6/67 [00:00<00:09,  6.73it/s]online:  10%|█         | 7/67 [00:01<00:08,  7.19it/s]online:  12%|█▏        | 8/67 [00:01<00:08,  6.82it/s]online:  13%|█▎        | 9/67 [00:01<00:10,  5.37it/s]online:  15%|█▍        | 10/67 [00:01<00:10,  5.46it/s]online:  16%|█▋        | 11/67 [00:01<00:09,  5.98it/s]online:  18%|█▊        | 12/67 [00:02<00:09,  5.95it/s]online:  19%|█▉        | 13/67 [00:02<00:08,  6.30it/s]online:  21%|██        | 14/67 [00:02<00:08,  6.27it/s]online:  22%|██▏       | 15/67 [00:02<00:10,  5.10it/s]online:  24%|██▍       | 16/67 [00:02<00:11,  4.55it/s]online:  25%|██▌       | 17/67 [00:03<00:10,  4.79it/s]online:  27%|██▋       | 18/67 [00:03<00:09,  5.38it/s]online:  28%|██▊       | 19/67 [00:03<00:08,  5.59it/s]online:  30%|██▉       | 20/67 [00:03<00:08,  5.60it/s]online:  31%|███▏      | 21/67 [00:03<00:07,  6.04it/s]online:  33%|███▎      | 22/67 [00:03<00:07,  6.43it/s]online:  34%|███▍      | 23/67 [00:03<00:06,  6.72it/s]online:  36%|███▌      | 24/67 [00:04<00:07,  5.76it/s]online:  37%|███▋      | 25/67 [00:04<00:08,  4.81it/s]online:  39%|███▉      | 26/67 [00:04<00:08,  5.09it/s]online:  40%|████      | 27/67 [00:04<00:07,  5.59it/s]online:  42%|████▏     | 28/67 [00:04<00:07,  5.57it/s]online:  43%|████▎     | 29/67 [00:05<00:06,  6.07it/s]online:  45%|████▍     | 30/67 [00:05<00:05,  6.49it/s]online:  46%|████▋     | 31/67 [00:05<00:05,  6.83it/s]online:  48%|████▊     | 32/67 [00:05<00:06,  5.65it/s]online:  49%|████▉     | 33/67 [00:05<00:06,  5.34it/s]online:  51%|█████     | 34/67 [00:05<00:05,  5.74it/s]online:  52%|█████▏    | 35/67 [00:06<00:05,  5.89it/s]online:  54%|█████▎    | 36/67 [00:06<00:04,  6.30it/s]online:  55%|█████▌    | 37/67 [00:06<00:05,  5.53it/s]online:  57%|█████▋    | 38/67 [00:06<00:06,  4.77it/s]online:  58%|█████▊    | 39/67 [00:06<00:05,  5.12it/s]online:  60%|█████▉    | 40/67 [00:07<00:04,  5.73it/s]online:  61%|██████    | 41/67 [00:07<00:04,  5.62it/s]online:  63%|██████▎   | 42/67 [00:07<00:04,  6.12it/s]online:  64%|██████▍   | 43/67 [00:07<00:03,  6.50it/s]online:  66%|██████▌   | 44/67 [00:07<00:04,  5.74it/s]online:  67%|██████▋   | 45/67 [00:07<00:04,  4.82it/s]online:  69%|██████▊   | 46/67 [00:08<00:04,  5.08it/s]online:  70%|███████   | 47/67 [00:08<00:03,  5.62it/s]online:  72%|███████▏  | 48/67 [00:08<00:03,  5.56it/s]online:  73%|███████▎  | 49/67 [00:08<00:03,  5.98it/s]online:  75%|███████▍  | 50/67 [00:08<00:02,  6.37it/s]online:  76%|███████▌  | 51/67 [00:08<00:03,  5.28it/s]online:  78%|███████▊  | 52/67 [00:09<00:03,  4.52it/s]online:  79%|███████▉  | 53/67 [00:09<00:03,  4.51it/s]online:  81%|████████  | 54/67 [00:09<00:02,  5.13it/s]online:  82%|████████▏ | 55/67 [00:09<00:02,  5.64it/s]online:  84%|████████▎ | 56/67 [00:09<00:02,  5.36it/s]online:  85%|████████▌ | 57/67 [00:10<00:01,  5.83it/s]online:  87%|████████▋ | 58/67 [00:10<00:01,  6.19it/s]online:  88%|████████▊ | 59/67 [00:10<00:01,  6.56it/s]online:  90%|████████▉ | 60/67 [00:10<00:01,  5.52it/s]online:  91%|█████████ | 61/67 [00:10<00:01,  5.50it/s]online:  93%|█████████▎| 62/67 [00:11<00:00,  5.57it/s]online:  94%|█████████▍| 63/67 [00:11<00:00,  6.00it/s]online:  96%|█████████▌| 64/67 [00:11<00:00,  5.25it/s]online:  97%|█████████▋| 65/67 [00:11<00:00,  4.55it/s]online:  99%|█████████▊| 66/67 [00:11<00:00,  4.20it/s]online: 100%|██████████| 67/67 [00:12<00:00,  4.82it/s]online: 100%|██████████| 67/67 [00:12<00:00,  5.54it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2160528:MainThread](2024-04-22 14:45:29,000) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9929551 mae 0.6973891
{'IC': 0.057254122888773996,
 'ICIR': 0.4108924468736018,
 'Rank IC': 0.04851908601406945,
 'Rank ICIR': 0.36447096370483983}
[2160528:MainThread](2024-04-22 14:45:30,560) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2160528:MainThread](2024-04-22 14:45:39,006) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:45:39,009) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:45:43,235) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f2ae60894c0>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/872 [00:00<01:04, 13.45it/s]backtest loop:   1%|          | 9/872 [00:00<00:30, 28.58it/s]backtest loop:   2%|▏         | 15/872 [00:00<00:22, 38.83it/s]backtest loop:   2%|▏         | 20/872 [00:00<00:20, 40.89it/s]backtest loop:   3%|▎         | 26/872 [00:00<00:18, 46.61it/s]backtest loop:   4%|▎         | 32/872 [00:00<00:16, 50.35it/s]backtest loop:   4%|▍         | 38/872 [00:00<00:15, 53.19it/s]backtest loop:   5%|▌         | 44/872 [00:00<00:16, 51.55it/s]backtest loop:   6%|▌         | 50/872 [00:01<00:15, 53.85it/s]backtest loop:   6%|▋         | 56/872 [00:01<00:14, 55.37it/s]backtest loop:   7%|▋         | 62/872 [00:01<00:15, 53.27it/s]backtest loop:   8%|▊         | 68/872 [00:01<00:14, 54.94it/s]backtest loop:   8%|▊         | 74/872 [00:01<00:14, 56.04it/s]backtest loop:   9%|▉         | 80/872 [00:01<00:13, 57.05it/s]backtest loop:  10%|▉         | 86/872 [00:01<00:14, 54.41it/s]backtest loop:  11%|█         | 93/872 [00:01<00:13, 57.99it/s]backtest loop:  11%|█▏        | 99/872 [00:01<00:13, 55.88it/s]backtest loop:  12%|█▏        | 106/872 [00:02<00:13, 58.37it/s]backtest loop:  13%|█▎        | 113/872 [00:02<00:12, 60.39it/s]backtest loop:  14%|█▍        | 120/872 [00:02<00:12, 58.32it/s]backtest loop:  15%|█▍        | 127/872 [00:02<00:12, 59.95it/s]backtest loop:  15%|█▌        | 134/872 [00:02<00:12, 57.93it/s]backtest loop:  16%|█▌        | 141/872 [00:02<00:12, 60.87it/s]backtest loop:  17%|█▋        | 148/872 [00:02<00:11, 62.35it/s]backtest loop:  18%|█▊        | 155/872 [00:02<00:11, 60.75it/s]backtest loop:  19%|█▊        | 162/872 [00:02<00:11, 62.98it/s]backtest loop:  19%|█▉        | 169/872 [00:03<00:11, 61.25it/s]backtest loop:  20%|██        | 176/872 [00:03<00:10, 63.28it/s]backtest loop:  21%|██        | 183/872 [00:03<00:10, 65.12it/s]backtest loop:  22%|██▏       | 190/872 [00:03<00:10, 62.76it/s]backtest loop:  23%|██▎       | 197/872 [00:03<00:10, 64.58it/s]backtest loop:  23%|██▎       | 204/872 [00:03<00:10, 62.29it/s]backtest loop:  24%|██▍       | 211/872 [00:03<00:10, 63.96it/s]backtest loop:  25%|██▌       | 218/872 [00:03<00:10, 65.38it/s]backtest loop:  26%|██▌       | 225/872 [00:03<00:10, 62.71it/s]backtest loop:  27%|██▋       | 232/872 [00:04<00:10, 63.29it/s]backtest loop:  27%|██▋       | 239/872 [00:04<00:10, 60.33it/s]backtest loop:  28%|██▊       | 246/872 [00:04<00:10, 61.05it/s]backtest loop:  29%|██▉       | 253/872 [00:04<00:10, 57.79it/s]backtest loop:  30%|██▉       | 259/872 [00:04<00:10, 58.10it/s]backtest loop:  30%|███       | 265/872 [00:04<00:10, 58.40it/s]backtest loop:  31%|███       | 272/872 [00:04<00:10, 59.77it/s]backtest loop:  32%|███▏      | 279/872 [00:04<00:10, 54.19it/s]backtest loop:  33%|███▎      | 285/872 [00:05<00:10, 55.53it/s]backtest loop:  33%|███▎      | 291/872 [00:05<00:10, 56.64it/s]backtest loop:  34%|███▍      | 297/872 [00:05<00:10, 57.47it/s]backtest loop:  35%|███▍      | 303/872 [00:05<00:10, 54.48it/s]backtest loop:  35%|███▌      | 309/872 [00:05<00:10, 55.84it/s]backtest loop:  36%|███▌      | 315/872 [00:05<00:09, 56.78it/s]backtest loop:  37%|███▋      | 321/872 [00:05<00:10, 53.80it/s]backtest loop:  38%|███▊      | 327/872 [00:05<00:09, 55.12it/s]backtest loop:  38%|███▊      | 333/872 [00:05<00:09, 56.04it/s]backtest loop:  39%|███▉      | 339/872 [00:06<00:09, 53.72it/s]backtest loop:  40%|███▉      | 345/872 [00:06<00:09, 55.36it/s]backtest loop:  40%|████      | 352/872 [00:06<00:08, 58.34it/s]backtest loop:  41%|████      | 358/872 [00:06<00:09, 55.70it/s]backtest loop:  42%|████▏     | 364/872 [00:06<00:08, 56.88it/s]backtest loop:  42%|████▏     | 370/872 [00:06<00:08, 57.54it/s]backtest loop:  43%|████▎     | 377/872 [00:06<00:08, 58.93it/s]backtest loop:  44%|████▍     | 383/872 [00:06<00:08, 55.48it/s]backtest loop:  45%|████▍     | 389/872 [00:06<00:08, 56.63it/s]backtest loop:  45%|████▌     | 396/872 [00:06<00:08, 58.20it/s]backtest loop:  46%|████▌     | 402/872 [00:07<00:08, 58.65it/s]backtest loop:  47%|████▋     | 408/872 [00:07<00:08, 55.60it/s]backtest loop:  47%|████▋     | 414/872 [00:07<00:08, 56.62it/s]backtest loop:  48%|████▊     | 420/872 [00:07<00:07, 57.44it/s]backtest loop:  49%|████▉     | 426/872 [00:07<00:07, 57.93it/s]backtest loop:  50%|████▉     | 432/872 [00:07<00:07, 55.08it/s]backtest loop:  50%|█████     | 438/872 [00:07<00:07, 56.20it/s]backtest loop:  51%|█████     | 445/872 [00:07<00:07, 58.12it/s]backtest loop:  52%|█████▏    | 451/872 [00:07<00:07, 58.26it/s]backtest loop:  52%|█████▏    | 457/872 [00:08<00:07, 54.54it/s]backtest loop:  53%|█████▎    | 463/872 [00:08<00:07, 55.80it/s]backtest loop:  54%|█████▍    | 469/872 [00:08<00:07, 56.79it/s]backtest loop:  54%|█████▍    | 475/872 [00:08<00:06, 57.63it/s]backtest loop:  55%|█████▌    | 481/872 [00:08<00:06, 57.95it/s]backtest loop:  56%|█████▌    | 487/872 [00:08<00:07, 54.97it/s]backtest loop:  57%|█████▋    | 493/872 [00:08<00:06, 55.91it/s]backtest loop:  57%|█████▋    | 499/872 [00:08<00:06, 56.89it/s]backtest loop:  58%|█████▊    | 505/872 [00:08<00:06, 53.56it/s]backtest loop:  59%|█████▊    | 511/872 [00:09<00:06, 55.07it/s]backtest loop:  59%|█████▉    | 517/872 [00:09<00:10, 34.42it/s]backtest loop:  60%|██████    | 524/872 [00:09<00:08, 40.71it/s]backtest loop:  61%|██████    | 530/872 [00:09<00:07, 42.93it/s]backtest loop:  61%|██████▏   | 536/872 [00:09<00:07, 46.76it/s]backtest loop:  62%|██████▏   | 542/872 [00:09<00:06, 50.00it/s]backtest loop:  63%|██████▎   | 548/872 [00:09<00:06, 52.52it/s]backtest loop:  64%|██████▎   | 554/872 [00:10<00:06, 51.37it/s]backtest loop:  64%|██████▍   | 560/872 [00:10<00:05, 53.65it/s]backtest loop:  65%|██████▍   | 566/872 [00:10<00:05, 52.07it/s]backtest loop:  66%|██████▌   | 573/872 [00:10<00:05, 55.08it/s]backtest loop:  66%|██████▋   | 579/872 [00:10<00:05, 56.29it/s]backtest loop:  67%|██████▋   | 585/872 [00:10<00:05, 57.15it/s]backtest loop:  68%|██████▊   | 591/872 [00:10<00:05, 54.22it/s]backtest loop:  68%|██████▊   | 597/872 [00:10<00:04, 55.67it/s]backtest loop:  69%|██████▉   | 604/872 [00:10<00:04, 57.92it/s]backtest loop:  70%|██████▉   | 610/872 [00:11<00:04, 54.80it/s]backtest loop:  71%|███████   | 616/872 [00:11<00:04, 56.11it/s]backtest loop:  71%|███████▏  | 622/872 [00:11<00:04, 57.07it/s]backtest loop:  72%|███████▏  | 628/872 [00:11<00:04, 57.54it/s]backtest loop:  73%|███████▎  | 634/872 [00:11<00:04, 58.09it/s]backtest loop:  73%|███████▎  | 640/872 [00:11<00:04, 54.66it/s]backtest loop:  74%|███████▍  | 646/872 [00:11<00:04, 55.96it/s]backtest loop:  75%|███████▍  | 653/872 [00:11<00:03, 57.85it/s]backtest loop:  76%|███████▌  | 659/872 [00:11<00:03, 54.65it/s]backtest loop:  76%|███████▋  | 665/872 [00:11<00:03, 55.99it/s]backtest loop:  77%|███████▋  | 671/872 [00:12<00:03, 53.46it/s]backtest loop:  78%|███████▊  | 677/872 [00:12<00:03, 55.23it/s]backtest loop:  78%|███████▊  | 683/872 [00:12<00:03, 56.27it/s]backtest loop:  79%|███████▉  | 689/872 [00:12<00:03, 53.25it/s]backtest loop:  80%|███████▉  | 695/872 [00:12<00:03, 54.89it/s]backtest loop:  80%|████████  | 701/872 [00:12<00:03, 55.98it/s]backtest loop:  81%|████████  | 707/872 [00:12<00:02, 56.97it/s]backtest loop:  82%|████████▏ | 714/872 [00:12<00:02, 55.11it/s]backtest loop:  83%|████████▎ | 720/872 [00:12<00:02, 55.97it/s]backtest loop:  83%|████████▎ | 726/872 [00:13<00:02, 56.89it/s]backtest loop:  84%|████████▍ | 732/872 [00:13<00:02, 54.06it/s]backtest loop:  85%|████████▍ | 738/872 [00:13<00:02, 52.23it/s]backtest loop:  85%|████████▌ | 744/872 [00:13<00:02, 54.13it/s]backtest loop:  86%|████████▌ | 751/872 [00:13<00:02, 56.80it/s]backtest loop:  87%|████████▋ | 757/872 [00:13<00:02, 54.45it/s]backtest loop:  88%|████████▊ | 763/872 [00:13<00:01, 55.85it/s]backtest loop:  88%|████████▊ | 769/872 [00:13<00:01, 56.85it/s]backtest loop:  89%|████████▉ | 775/872 [00:13<00:01, 57.53it/s]backtest loop:  90%|████████▉ | 781/872 [00:14<00:01, 58.17it/s]backtest loop:  90%|█████████ | 787/872 [00:14<00:01, 54.97it/s]backtest loop:  91%|█████████ | 793/872 [00:14<00:01, 56.34it/s]backtest loop:  92%|█████████▏| 799/872 [00:14<00:01, 57.19it/s]backtest loop:  92%|█████████▏| 805/872 [00:14<00:01, 57.68it/s]backtest loop:  93%|█████████▎| 811/872 [00:14<00:01, 54.55it/s]backtest loop:  94%|█████████▎| 817/872 [00:14<00:00, 55.94it/s]backtest loop:  94%|█████████▍| 823/872 [00:14<00:00, 53.46it/s]backtest loop:  95%|█████████▌| 829/872 [00:14<00:00, 55.05it/s]backtest loop:  96%|█████████▌| 835/872 [00:15<00:00, 56.36it/s]backtest loop:  96%|█████████▋| 841/872 [00:15<00:00, 56.86it/s]backtest loop:  97%|█████████▋| 847/872 [00:15<00:00, 54.23it/s]backtest loop:  98%|█████████▊| 854/872 [00:15<00:00, 56.49it/s]backtest loop:  99%|█████████▊| 860/872 [00:15<00:00, 57.43it/s]backtest loop:  99%|█████████▉| 866/872 [00:15<00:00, 55.16it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 56.47it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 55.50it/s]
[2160528:MainThread](2024-04-22 14:45:59,012) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000495
std                0.012300
annualized_return  0.117864
information_ratio  0.621155
max_drawdown      -0.370479
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000511
std                0.006276
annualized_return  0.121616
information_ratio  1.256067
max_drawdown      -0.101887
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000326
std                0.006274
annualized_return  0.077578
information_ratio  0.801562
max_drawdown      -0.115318
[2160528:MainThread](2024-04-22 14:45:59,026) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-22_13:59:44_online`.
{'1day.excess_return_with_cost.annualized_return': [0.11122624285193974,
                                                    0.1172430590821991,
                                                    0.1181450950678585,
                                                    0.07757783438018157],
 '1day.excess_return_with_cost.information_ratio': [1.0073404313106729,
                                                    1.1787257560325017,
                                                    1.2656507239020849,
                                                    0.8015620482821639],
 'IC': [0.047794093817928186,
        0.04850299629052687,
        0.049824131514057186,
        0.057254122888773996],
 'ICIR': [0.33518060416752843,
          0.3494834093909675,
          0.36494642230010954,
          0.4108924468736018],
 'Rank IC': [0.04635870119592828,
             0.048894470472441824,
             0.047156937600123204,
             0.04851908601406945],
 'Rank ICIR': [0.3297524956240849,
               0.3541161837832041,
               0.3534710503831135,
               0.36447096370483983],
 'mae': [0.6975067257881165,
         0.697547197341919,
         0.6976150274276733,
         0.6973891258239746],
 'mse': [0.9946232438087463,
         0.9945685863494873,
         0.9944506883621216,
         0.9929550886154175]}
Traceback (most recent call last):
  File "main.py", line 471, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2160528:MainThread](2024-04-22 14:45:59,998) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:14<24:43, 14.98s/it]epoch:   2%|▏         | 2/100 [00:30<24:43, 15.14s/it]epoch:   3%|▎         | 3/100 [00:45<24:29, 15.15s/it]epoch:   4%|▍         | 4/100 [01:00<24:17, 15.18s/it]epoch:   5%|▌         | 5/100 [01:15<23:59, 15.16s/it]epoch:   6%|▌         | 6/100 [01:30<23:41, 15.12s/it]epoch:   7%|▋         | 7/100 [01:45<23:19, 15.05s/it]epoch:   8%|▊         | 8/100 [02:01<23:12, 15.14s/it]epoch:   9%|▉         | 9/100 [02:16<22:53, 15.09s/it]epoch:  10%|█         | 10/100 [02:31<22:35, 15.06s/it]epoch:  11%|█         | 11/100 [02:45<22:17, 15.02s/it]epoch:  12%|█▏        | 12/100 [03:01<22:07, 15.09s/it]epoch:  13%|█▎        | 13/100 [03:16<21:49, 15.05s/it]epoch:  14%|█▍        | 14/100 [03:31<21:37, 15.09s/it]epoch:  15%|█▌        | 15/100 [03:46<21:21, 15.08s/it]epoch:  16%|█▌        | 16/100 [04:01<21:03, 15.04s/it]epoch:  17%|█▋        | 17/100 [04:16<20:53, 15.10s/it]epoch:  18%|█▊        | 18/100 [04:31<20:41, 15.14s/it]epoch:  19%|█▉        | 19/100 [04:46<20:19, 15.05s/it]epoch:  20%|██        | 20/100 [05:01<20:05, 15.06s/it]epoch:  21%|██        | 21/100 [05:16<19:45, 15.01s/it]epoch:  22%|██▏       | 22/100 [05:31<19:31, 15.02s/it]epoch:  23%|██▎       | 23/100 [05:46<19:22, 15.10s/it]epoch:  24%|██▍       | 24/100 [06:02<19:07, 15.10s/it]epoch:  25%|██▌       | 25/100 [06:17<18:50, 15.07s/it]epoch:  26%|██▌       | 26/100 [06:32<18:40, 15.14s/it]epoch:  27%|██▋       | 27/100 [06:47<18:24, 15.13s/it]epoch:  28%|██▊       | 28/100 [07:02<18:07, 15.10s/it]epoch:  29%|██▉       | 29/100 [07:18<18:02, 15.24s/it]epoch:  30%|███       | 30/100 [07:33<17:41, 15.17s/it]0.05886858767954476
best ic: 0.05886858767954476
epoch:  31%|███       | 31/100 [07:52<18:55, 16.46s/it]0.061674054171363034
best ic: 0.061674054171363034
epoch:  32%|███▏      | 32/100 [08:12<19:44, 17.41s/it]0.06265607672054224
best ic: 0.06265607672054224
epoch:  33%|███▎      | 33/100 [08:31<20:11, 18.08s/it]0.06262788038914756
epoch:  34%|███▍      | 34/100 [08:51<20:26, 18.58s/it]0.06148972191035469
epoch:  35%|███▌      | 35/100 [09:11<20:27, 18.89s/it]0.0642910808431986
best ic: 0.0642910808431986
epoch:  36%|███▌      | 36/100 [09:30<20:20, 19.06s/it]0.06103536819196352
epoch:  37%|███▋      | 37/100 [09:50<20:10, 19.21s/it]0.06463504879508888
best ic: 0.06463504879508888
epoch:  38%|███▊      | 38/100 [10:09<19:59, 19.35s/it]0.06401216299975485
epoch:  39%|███▉      | 39/100 [10:29<19:43, 19.40s/it]0.06495155727171084
best ic: 0.06495155727171084
epoch:  40%|████      | 40/100 [10:48<19:26, 19.44s/it]0.06112439975468262
epoch:  41%|████      | 41/100 [11:08<19:11, 19.52s/it]0.06212334670563976
epoch:  42%|████▏     | 42/100 [11:28<18:55, 19.58s/it]0.06455417707070898
epoch:  43%|████▎     | 43/100 [11:47<18:27, 19.43s/it]0.06442487153541965
epoch:  44%|████▍     | 44/100 [12:07<18:11, 19.50s/it]0.05786572262465009
epoch:  45%|████▌     | 45/100 [12:26<17:54, 19.53s/it]0.06271922624658578
epoch:  46%|████▌     | 46/100 [12:46<17:33, 19.52s/it]0.05848087470522028
epoch:  47%|████▋     | 47/100 [13:05<17:08, 19.40s/it]0.062338998150313546
epoch:  47%|████▋     | 47/100 [13:24<15:07, 17.12s/it]
Test segment: 2017-01-03 00:00:00 2020-07-31 00:00:00
[2160528:MainThread](2024-04-22 14:59:24,791) INFO - qlib.workflow - [exp.py:258] - Experiment 7 starts running ...
[2160528:MainThread](2024-04-22 14:59:24,801) INFO - qlib.workflow - [recorder.py:341] - Recorder 40a21a45b1a64d9abe2a311f6f5ac933 starts running under Experiment 7 ...
online:   0%|          | 0/67 [00:00<?, ?it/s]online:   1%|▏         | 1/67 [00:00<00:08,  8.05it/s]online:   3%|▎         | 2/67 [00:00<00:09,  7.08it/s]online:   4%|▍         | 3/67 [00:00<00:13,  4.84it/s]online:   6%|▌         | 4/67 [00:00<00:11,  5.36it/s]online:   7%|▋         | 5/67 [00:00<00:11,  5.51it/s]online:   9%|▉         | 6/67 [00:01<00:09,  6.16it/s]online:  10%|█         | 7/67 [00:01<00:08,  6.69it/s]online:  12%|█▏        | 8/67 [00:01<00:10,  5.73it/s]online:  13%|█▎        | 9/67 [00:01<00:11,  5.02it/s]online:  15%|█▍        | 10/67 [00:01<00:10,  5.64it/s]online:  16%|█▋        | 11/67 [00:01<00:09,  5.67it/s]online:  18%|█▊        | 12/67 [00:02<00:08,  6.16it/s]online:  19%|█▉        | 13/67 [00:02<00:08,  6.60it/s]online:  21%|██        | 14/67 [00:02<00:09,  5.54it/s]online:  22%|██▏       | 15/67 [00:02<00:09,  5.22it/s]online:  24%|██▍       | 16/67 [00:02<00:08,  5.75it/s]online:  25%|██▌       | 17/67 [00:02<00:08,  5.83it/s]online:  27%|██▋       | 18/67 [00:03<00:07,  6.25it/s]online:  28%|██▊       | 19/67 [00:03<00:08,  5.55it/s]online:  30%|██▉       | 20/67 [00:03<00:10,  4.69it/s]online:  31%|███▏      | 21/67 [00:03<00:08,  5.28it/s]online:  33%|███▎      | 22/67 [00:03<00:08,  5.43it/s]online:  34%|███▍      | 23/67 [00:04<00:07,  5.88it/s]online:  36%|███▌      | 24/67 [00:04<00:06,  6.23it/s]online:  37%|███▋      | 25/67 [00:04<00:07,  5.85it/s]online:  39%|███▉      | 26/67 [00:04<00:08,  4.91it/s]online:  40%|████      | 27/67 [00:04<00:07,  5.23it/s]online:  42%|████▏     | 28/67 [00:04<00:07,  5.50it/s]online:  43%|████▎     | 29/67 [00:05<00:06,  5.90it/s]online:  45%|████▍     | 30/67 [00:05<00:05,  6.33it/s]online:  46%|████▋     | 31/67 [00:05<00:06,  5.97it/s]online:  48%|████▊     | 32/67 [00:05<00:06,  5.31it/s]online:  49%|████▉     | 33/67 [00:05<00:05,  5.68it/s]online:  51%|█████     | 34/67 [00:05<00:05,  5.91it/s]online:  52%|█████▏    | 35/67 [00:06<00:05,  6.32it/s]online:  54%|█████▎    | 36/67 [00:06<00:06,  5.14it/s]online:  55%|█████▌    | 37/67 [00:06<00:06,  4.52it/s]online:  57%|█████▋    | 38/67 [00:06<00:05,  5.14it/s]online:  58%|█████▊    | 39/67 [00:06<00:04,  5.68it/s]online:  60%|█████▉    | 40/67 [00:07<00:04,  5.64it/s]online:  61%|██████    | 41/67 [00:07<00:04,  6.14it/s]online:  63%|██████▎   | 42/67 [00:07<00:03,  6.47it/s]online:  64%|██████▍   | 43/67 [00:07<00:03,  6.05it/s]online:  66%|██████▌   | 44/67 [00:07<00:04,  4.97it/s]online:  67%|██████▋   | 45/67 [00:08<00:04,  5.23it/s]online:  69%|██████▊   | 46/67 [00:08<00:03,  5.40it/s]online:  70%|███████   | 47/67 [00:08<00:03,  5.84it/s]online:  72%|███████▏  | 48/67 [00:08<00:03,  6.15it/s]online:  73%|███████▎  | 49/67 [00:08<00:03,  5.54it/s]online:  75%|███████▍  | 50/67 [00:08<00:03,  4.92it/s]online:  76%|███████▌  | 51/67 [00:09<00:02,  5.46it/s]online:  78%|███████▊  | 52/67 [00:09<00:02,  5.59it/s]online:  79%|███████▉  | 53/67 [00:09<00:02,  5.99it/s]online:  81%|████████  | 54/67 [00:09<00:02,  5.35it/s]online:  82%|████████▏ | 55/67 [00:09<00:02,  4.59it/s]online:  84%|████████▎ | 56/67 [00:10<00:02,  4.92it/s]online:  85%|████████▌ | 57/67 [00:10<00:01,  5.41it/s]online:  87%|████████▋ | 58/67 [00:10<00:01,  5.43it/s]online:  88%|████████▊ | 59/67 [00:10<00:01,  5.86it/s]online:  90%|████████▉ | 60/67 [00:10<00:01,  6.24it/s]online:  91%|█████████ | 61/67 [00:10<00:01,  5.22it/s]online:  93%|█████████▎| 62/67 [00:11<00:01,  4.82it/s]online:  94%|█████████▍| 63/67 [00:11<00:00,  5.31it/s]online:  96%|█████████▌| 64/67 [00:11<00:00,  5.46it/s]online:  97%|█████████▋| 65/67 [00:11<00:00,  5.88it/s]online:  99%|█████████▊| 66/67 [00:11<00:00,  6.11it/s]online: 100%|██████████| 67/67 [00:12<00:00,  4.99it/s]online: 100%|██████████| 67/67 [00:12<00:00,  5.54it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2160528:MainThread](2024-04-22 14:59:43,056) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99434847 mae 0.6974679
{'IC': 0.050301190933503416,
 'ICIR': 0.35189824190317864,
 'Rank IC': 0.047542331784755164,
 'Rank ICIR': 0.32478724474021015}
[2160528:MainThread](2024-04-22 14:59:44,612) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2160528:MainThread](2024-04-22 14:59:53,134) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:59:53,137) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2160528:MainThread](2024-04-22 14:59:57,367) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f2aeb5d06d0>
backtest loop:   0%|          | 0/872 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/872 [00:00<01:03, 13.72it/s]backtest loop:   1%|          | 9/872 [00:00<00:29, 29.11it/s]backtest loop:   2%|▏         | 15/872 [00:00<00:21, 39.50it/s]backtest loop:   2%|▏         | 20/872 [00:00<00:20, 41.42it/s]backtest loop:   3%|▎         | 26/872 [00:00<00:17, 47.03it/s]backtest loop:   4%|▎         | 32/872 [00:00<00:16, 50.74it/s]backtest loop:   4%|▍         | 38/872 [00:00<00:15, 53.33it/s]backtest loop:   5%|▌         | 44/872 [00:00<00:16, 51.55it/s]backtest loop:   6%|▌         | 50/872 [00:01<00:15, 53.67it/s]backtest loop:   6%|▋         | 56/872 [00:01<00:14, 55.29it/s]backtest loop:   7%|▋         | 62/872 [00:01<00:15, 52.74it/s]backtest loop:   8%|▊         | 68/872 [00:01<00:14, 54.64it/s]backtest loop:   8%|▊         | 74/872 [00:01<00:14, 55.97it/s]backtest loop:   9%|▉         | 80/872 [00:01<00:13, 56.68it/s]backtest loop:  10%|▉         | 86/872 [00:01<00:14, 54.35it/s]backtest loop:  11%|█         | 93/872 [00:01<00:13, 57.98it/s]backtest loop:  11%|█▏        | 99/872 [00:01<00:13, 55.66it/s]backtest loop:  12%|█▏        | 106/872 [00:02<00:13, 58.43it/s]backtest loop:  13%|█▎        | 113/872 [00:02<00:12, 59.83it/s]backtest loop:  14%|█▍        | 120/872 [00:02<00:13, 57.53it/s]backtest loop:  15%|█▍        | 127/872 [00:02<00:12, 59.36it/s]backtest loop:  15%|█▌        | 134/872 [00:02<00:12, 57.50it/s]backtest loop:  16%|█▌        | 141/872 [00:02<00:12, 60.49it/s]backtest loop:  17%|█▋        | 148/872 [00:02<00:11, 62.82it/s]backtest loop:  18%|█▊        | 155/872 [00:02<00:11, 61.17it/s]backtest loop:  19%|█▊        | 162/872 [00:02<00:11, 63.39it/s]backtest loop:  19%|█▉        | 169/872 [00:03<00:11, 61.46it/s]backtest loop:  20%|██        | 176/872 [00:03<00:10, 63.45it/s]backtest loop:  21%|██        | 183/872 [00:03<00:10, 65.12it/s]backtest loop:  22%|██▏       | 190/872 [00:03<00:10, 62.52it/s]backtest loop:  23%|██▎       | 197/872 [00:03<00:10, 64.37it/s]backtest loop:  23%|██▎       | 204/872 [00:03<00:10, 62.09it/s]backtest loop:  24%|██▍       | 211/872 [00:03<00:10, 64.00it/s]backtest loop:  25%|██▌       | 218/872 [00:03<00:10, 65.32it/s]backtest loop:  26%|██▌       | 225/872 [00:03<00:10, 62.61it/s]backtest loop:  27%|██▋       | 232/872 [00:04<00:10, 63.71it/s]backtest loop:  27%|██▋       | 239/872 [00:04<00:10, 60.86it/s]backtest loop:  28%|██▊       | 246/872 [00:04<00:10, 61.36it/s]backtest loop:  29%|██▉       | 253/872 [00:04<00:10, 57.93it/s]backtest loop:  30%|██▉       | 259/872 [00:04<00:10, 58.07it/s]backtest loop:  30%|███       | 265/872 [00:04<00:10, 58.38it/s]backtest loop:  31%|███       | 272/872 [00:04<00:10, 59.73it/s]backtest loop:  32%|███▏      | 278/872 [00:04<00:11, 53.56it/s]backtest loop:  33%|███▎      | 284/872 [00:05<00:10, 54.97it/s]backtest loop:  33%|███▎      | 290/872 [00:05<00:10, 56.22it/s]backtest loop:  34%|███▍      | 296/872 [00:05<00:10, 56.59it/s]backtest loop:  35%|███▍      | 302/872 [00:05<00:09, 57.45it/s]backtest loop:  35%|███▌      | 308/872 [00:05<00:10, 53.98it/s]backtest loop:  36%|███▌      | 314/872 [00:05<00:10, 55.36it/s]backtest loop:  37%|███▋      | 320/872 [00:05<00:09, 56.37it/s]backtest loop:  37%|███▋      | 326/872 [00:05<00:10, 53.80it/s]backtest loop:  38%|███▊      | 332/872 [00:05<00:09, 55.39it/s]backtest loop:  39%|███▉      | 339/872 [00:06<00:09, 54.39it/s]backtest loop:  40%|███▉      | 346/872 [00:06<00:09, 57.27it/s]backtest loop:  40%|████      | 353/872 [00:06<00:08, 59.62it/s]backtest loop:  41%|████▏     | 360/872 [00:06<00:08, 57.73it/s]backtest loop:  42%|████▏     | 367/872 [00:06<00:08, 59.88it/s]backtest loop:  43%|████▎     | 374/872 [00:06<00:08, 57.83it/s]backtest loop:  44%|████▎     | 381/872 [00:06<00:08, 59.73it/s]backtest loop:  44%|████▍     | 388/872 [00:06<00:08, 57.75it/s]backtest loop:  45%|████▌     | 395/872 [00:06<00:07, 59.70it/s]backtest loop:  46%|████▌     | 402/872 [00:07<00:07, 61.08it/s]backtest loop:  47%|████▋     | 409/872 [00:07<00:07, 58.76it/s]backtest loop:  48%|████▊     | 416/872 [00:07<00:07, 60.36it/s]backtest loop:  49%|████▊     | 423/872 [00:07<00:07, 58.32it/s]backtest loop:  49%|████▉     | 430/872 [00:07<00:07, 59.89it/s]backtest loop:  50%|█████     | 437/872 [00:07<00:07, 58.30it/s]backtest loop:  51%|█████     | 444/872 [00:07<00:07, 60.14it/s]backtest loop:  52%|█████▏    | 451/872 [00:07<00:06, 61.69it/s]backtest loop:  53%|█████▎    | 458/872 [00:08<00:07, 58.26it/s]backtest loop:  53%|█████▎    | 464/872 [00:08<00:06, 58.56it/s]backtest loop:  54%|█████▍    | 470/872 [00:08<00:06, 58.82it/s]backtest loop:  55%|█████▍    | 476/872 [00:08<00:06, 58.46it/s]backtest loop:  55%|█████▌    | 482/872 [00:08<00:07, 55.21it/s]backtest loop:  56%|█████▌    | 488/872 [00:08<00:06, 55.81it/s]backtest loop:  57%|█████▋    | 494/872 [00:08<00:06, 56.85it/s]backtest loop:  57%|█████▋    | 500/872 [00:08<00:06, 53.96it/s]backtest loop:  58%|█████▊    | 506/872 [00:08<00:06, 55.40it/s]backtest loop:  59%|█████▊    | 512/872 [00:09<00:10, 35.00it/s]backtest loop:  59%|█████▉    | 518/872 [00:09<00:08, 39.87it/s]backtest loop:  60%|██████    | 525/872 [00:09<00:07, 43.73it/s]backtest loop:  61%|██████    | 532/872 [00:09<00:06, 48.63it/s]backtest loop:  62%|██████▏   | 538/872 [00:09<00:06, 51.34it/s]backtest loop:  62%|██████▎   | 545/872 [00:09<00:06, 52.38it/s]backtest loop:  63%|██████▎   | 552/872 [00:09<00:05, 55.61it/s]backtest loop:  64%|██████▍   | 558/872 [00:09<00:05, 56.76it/s]backtest loop:  65%|██████▍   | 564/872 [00:10<00:05, 54.21it/s]backtest loop:  65%|██████▌   | 571/872 [00:10<00:05, 54.87it/s]backtest loop:  66%|██████▌   | 577/872 [00:10<00:05, 56.05it/s]backtest loop:  67%|██████▋   | 583/872 [00:10<00:05, 56.89it/s]backtest loop:  68%|██████▊   | 589/872 [00:10<00:04, 57.61it/s]backtest loop:  68%|██████▊   | 595/872 [00:10<00:05, 54.67it/s]backtest loop:  69%|██████▉   | 602/872 [00:10<00:04, 57.09it/s]backtest loop:  70%|██████▉   | 608/872 [00:10<00:04, 57.63it/s]backtest loop:  70%|███████   | 614/872 [00:10<00:04, 58.16it/s]backtest loop:  71%|███████   | 620/872 [00:11<00:04, 53.94it/s]backtest loop:  72%|███████▏  | 626/872 [00:11<00:04, 55.25it/s]backtest loop:  72%|███████▏  | 632/872 [00:11<00:04, 56.44it/s]backtest loop:  73%|███████▎  | 638/872 [00:11<00:04, 57.27it/s]backtest loop:  74%|███████▍  | 644/872 [00:11<00:03, 58.03it/s]backtest loop:  75%|███████▍  | 650/872 [00:11<00:04, 54.77it/s]backtest loop:  75%|███████▌  | 656/872 [00:11<00:03, 55.92it/s]backtest loop:  76%|███████▌  | 662/872 [00:11<00:03, 56.51it/s]backtest loop:  77%|███████▋  | 668/872 [00:11<00:03, 56.71it/s]backtest loop:  77%|███████▋  | 674/872 [00:12<00:03, 50.86it/s]backtest loop:  78%|███████▊  | 680/872 [00:12<00:03, 52.48it/s]backtest loop:  79%|███████▊  | 686/872 [00:12<00:03, 54.16it/s]backtest loop:  79%|███████▉  | 693/872 [00:12<00:03, 56.58it/s]backtest loop:  80%|████████  | 699/872 [00:12<00:03, 53.74it/s]backtest loop:  81%|████████  | 705/872 [00:12<00:03, 55.31it/s]backtest loop:  82%|████████▏ | 712/872 [00:12<00:02, 57.31it/s]backtest loop:  82%|████████▏ | 718/872 [00:12<00:02, 57.79it/s]backtest loop:  83%|████████▎ | 724/872 [00:12<00:02, 54.91it/s]backtest loop:  84%|████████▎ | 730/872 [00:13<00:02, 56.17it/s]backtest loop:  84%|████████▍ | 736/872 [00:13<00:02, 53.64it/s]backtest loop:  85%|████████▌ | 742/872 [00:13<00:02, 55.21it/s]backtest loop:  86%|████████▌ | 748/872 [00:13<00:02, 53.46it/s]backtest loop:  86%|████████▋ | 754/872 [00:13<00:02, 55.15it/s]backtest loop:  87%|████████▋ | 760/872 [00:13<00:01, 56.39it/s]backtest loop:  88%|████████▊ | 766/872 [00:13<00:01, 57.11it/s]backtest loop:  89%|████████▊ | 772/872 [00:13<00:01, 54.16it/s]backtest loop:  89%|████████▉ | 779/872 [00:13<00:01, 56.64it/s]backtest loop:  90%|█████████ | 785/872 [00:14<00:01, 57.42it/s]backtest loop:  91%|█████████ | 791/872 [00:14<00:01, 57.77it/s]backtest loop:  91%|█████████▏| 797/872 [00:14<00:01, 54.73it/s]backtest loop:  92%|█████████▏| 803/872 [00:14<00:01, 55.97it/s]backtest loop:  93%|█████████▎| 809/872 [00:14<00:01, 56.97it/s]backtest loop:  93%|█████████▎| 815/872 [00:14<00:01, 54.24it/s]backtest loop:  94%|█████████▍| 821/872 [00:14<00:00, 55.81it/s]backtest loop:  95%|█████████▍| 827/872 [00:14<00:00, 56.83it/s]backtest loop:  96%|█████████▌| 833/872 [00:14<00:00, 53.96it/s]backtest loop:  96%|█████████▌| 839/872 [00:15<00:00, 55.20it/s]backtest loop:  97%|█████████▋| 845/872 [00:15<00:00, 56.48it/s]backtest loop:  98%|█████████▊| 851/872 [00:15<00:00, 53.87it/s]backtest loop:  98%|█████████▊| 858/872 [00:15<00:00, 56.51it/s]backtest loop:  99%|█████████▉| 864/872 [00:15<00:00, 57.30it/s]backtest loop: 100%|█████████▉| 871/872 [00:15<00:00, 55.65it/s]backtest loop: 100%|██████████| 872/872 [00:15<00:00, 55.90it/s]
[2160528:MainThread](2024-04-22 15:00:13,032) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000495
std                0.012300
annualized_return  0.117864
information_ratio  0.621155
max_drawdown      -0.370479
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000497
std                0.006745
annualized_return  0.118289
information_ratio  1.136763
max_drawdown      -0.148297
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000318
std                0.006743
annualized_return  0.075691
information_ratio  0.727614
max_drawdown      -0.171405
[2160528:MainThread](2024-04-22 15:00:13,046) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 7
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-22_13:59:44_online`.
{'1day.excess_return_with_cost.annualized_return': [0.11122624285193974,
                                                    0.1172430590821991,
                                                    0.1181450950678585,
                                                    0.07757783438018157,
                                                    0.07569128139848112],
 '1day.excess_return_with_cost.information_ratio': [1.0073404313106729,
                                                    1.1787257560325017,
                                                    1.2656507239020849,
                                                    0.8015620482821639,
                                                    0.7276143435033504],
 'IC': [0.047794093817928186,
        0.04850299629052687,
        0.049824131514057186,
        0.057254122888773996,
        0.050301190933503416],
 'ICIR': [0.33518060416752843,
          0.3494834093909675,
          0.36494642230010954,
          0.4108924468736018,
          0.35189824190317864],
 'Rank IC': [0.04635870119592828,
             0.048894470472441824,
             0.047156937600123204,
             0.04851908601406945,
             0.047542331784755164],
 'Rank ICIR': [0.3297524956240849,
               0.3541161837832041,
               0.3534710503831135,
               0.36447096370483983,
               0.32478724474021015],
 'mae': [0.6975067257881165,
         0.697547197341919,
         0.6976150274276733,
         0.6973891258239746,
         0.6974679231643677],
 'mse': [0.9946232438087463,
         0.9945685863494873,
         0.9944506883621216,
         0.9929550886154175,
         0.9943484663963318]}
[2160528:MainThread](2024-04-22 15:00:14,017) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-22_13:59:44_final.
[2160528:MainThread](2024-04-22 15:00:14,023) INFO - qlib.workflow - [exp.py:258] - Experiment 8 starts running ...
[2160528:MainThread](2024-04-22 15:00:14,032) INFO - qlib.workflow - [recorder.py:341] - Recorder ec6370c0894d4be8bc7525e9b88a0532 starts running under Experiment 8 ...
Time cost: 676.5916981697083	49.25350947380066
{'1day.excess_return_with_cost.annualized_return': [0.09997670255613202,
                                                    0.01921593446793834],
 '1day.excess_return_with_cost.information_ratio': [0.9961786606061548,
                                                    0.20787767474367422],
 'IC': [0.050735307088957925, 0.0033807574359343583],
 'ICIR': [0.3624802249270772, 0.025984573252971606],
 'Rank IC': [0.04769430541346359, 0.0009182982069527443],
 'Rank ICIR': [0.3453195876470905, 0.015326533283965032],
 'mae': [0.6975051999092102, 7.575083556194912e-05],
 'mse': [0.9941892147064209, 0.0006243558099495289]}
Exception in thread Thread-23:
Traceback (most recent call last):
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 12, in _try_get_item
    return x.item()
ValueError: can only convert an array of size 1 to a Python scalar

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/paral.py", line 91, in run
    data()
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/workflow/recorder.py", line 449, in log_metrics
    self.client.log_metric(self.id, name, data, step=step)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/client.py", line 821, in log_metric
    self._tracking_client.log_metric(run_id, key, value, timestamp, step)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/_tracking_service/client.py", line 305, in log_metric
    metric_value = convert_metric_value_to_float_if_possible(value)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 47, in convert_metric_value_to_float_if_possible
    possible_float = converter_fn(x)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 29, in wrapper
    return func(x)
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 62, in convert_metric_value_to_float_if_ndarray
    return float(_try_get_item(x))
  File "/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/mlflow/tracking/metric_value_conversion_utils.py", line 14, in _try_get_item
    raise MlflowException(
mlflow.exceptions.MlflowException: Failed to convert metric value to float: can only convert an array of size 1 to a Python scalar
[2160528:MainThread](2024-04-22 15:00:14,677) INFO - qlib.timer - [log.py:127] - Time cost: 0.023s | waiting `async_log` Done
