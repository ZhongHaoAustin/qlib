['main.py', 'run_all', '--forecast_model', 'LSTM', '-num_head', '8', '--train_start=2008-01-01', '--train_end=2018-12-31', '--valid_start=2019-01-01', '--valid_end=2020-03-31', '--test_start=2020-04-01', '--test_end=2024-03-31', '--tau', '10', '--lr_da', '0.01', '--market', 'csi500', '--data_dir', 'crowd_data', '--rank_label', 'False', '--begin_valid_epoch', '20']
[2955773:MainThread](2024-04-24 23:48:14,728) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[2955773:MainThread](2024-04-24 23:48:14,730) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[2955773:MainThread](2024-04-24 23:48:14,731) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Remove CSRankNorm
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi500', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSZScoreNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
[2955773:MainThread](2024-04-24 23:48:32,130) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-02 00:00:00'), Timestamp('2008-01-29 00:00:00')), 'test': (Timestamp('2008-01-31 00:00:00'), Timestamp('2008-03-05 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/147 [00:00<?, ?it/s]creating meta tasks:  24%|██▍       | 36/147 [00:00<00:00, 357.80it/s]creating meta tasks:  53%|█████▎    | 78/147 [00:00<00:00, 390.27it/s]creating meta tasks:  82%|████████▏ | 120/147 [00:00<00:00, 400.44it/s]creating meta tasks: 100%|██████████| 147/147 [00:00<00:00, 399.44it/s]
[2955773:MainThread](2024-04-24 23:48:33,101) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi500_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2019-01-02 00:00:00'), Timestamp('2019-01-29 00:00:00')), 'test': (Timestamp('2019-01-31 00:00:00'), Timestamp('2019-03-06 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/63 [00:00<?, ?it/s]creating meta tasks:  49%|████▉     | 31/63 [00:00<00:00, 308.66it/s]creating meta tasks: 100%|██████████| 63/63 [00:00<00:00, 324.61it/s]
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-24 23:48:34,750) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-24 23:48:34,849) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:13<22:49, 13.83s/it]epoch:   2%|▏         | 2/100 [00:25<20:33, 12.58s/it]epoch:   3%|▎         | 3/100 [00:36<19:24, 12.00s/it]epoch:   4%|▍         | 4/100 [00:48<18:48, 11.76s/it]epoch:   5%|▌         | 5/100 [00:59<18:09, 11.47s/it]epoch:   6%|▌         | 6/100 [01:10<17:48, 11.37s/it]epoch:   7%|▋         | 7/100 [01:21<17:32, 11.32s/it]epoch:   8%|▊         | 8/100 [01:32<17:12, 11.22s/it]epoch:   9%|▉         | 9/100 [01:43<16:49, 11.09s/it]epoch:  10%|█         | 10/100 [01:54<16:33, 11.04s/it]epoch:  11%|█         | 11/100 [02:05<16:26, 11.08s/it]epoch:  12%|█▏        | 12/100 [02:16<16:18, 11.12s/it]epoch:  13%|█▎        | 13/100 [02:27<16:06, 11.10s/it]epoch:  14%|█▍        | 14/100 [02:38<15:47, 11.02s/it]epoch:  15%|█▌        | 15/100 [02:49<15:33, 10.98s/it]epoch:  16%|█▌        | 16/100 [03:00<15:26, 11.03s/it]epoch:  17%|█▋        | 17/100 [03:11<15:22, 11.12s/it]epoch:  18%|█▊        | 18/100 [03:23<15:12, 11.13s/it]epoch:  19%|█▉        | 19/100 [03:33<14:54, 11.04s/it]epoch:  20%|██        | 20/100 [03:44<14:38, 10.98s/it]0.05244877995450833
best ic: 0.05244877995450833
epoch:  21%|██        | 21/100 [03:58<15:24, 11.70s/it]0.051912962650443144
epoch:  22%|██▏       | 22/100 [04:10<15:36, 12.01s/it]0.05073596966804115
epoch:  23%|██▎       | 23/100 [04:23<15:41, 12.22s/it]0.05213330457766555
epoch:  24%|██▍       | 24/100 [04:35<15:32, 12.26s/it]0.05569940033297794
best ic: 0.05569940033297794
epoch:  25%|██▌       | 25/100 [04:48<15:20, 12.28s/it]0.05412507386715946
epoch:  26%|██▌       | 26/100 [05:00<15:14, 12.36s/it]0.05138684619690164
epoch:  27%|██▋       | 27/100 [05:13<15:11, 12.48s/it]0.0523931184497309
epoch:  28%|██▊       | 28/100 [05:26<15:04, 12.57s/it]0.0523403909564379
epoch:  29%|██▉       | 29/100 [05:38<14:47, 12.50s/it]0.05408255403899915
epoch:  30%|███       | 30/100 [05:51<14:40, 12.58s/it]0.055053597917458626
epoch:  31%|███       | 31/100 [06:04<14:29, 12.60s/it]0.05418954376944768
epoch:  32%|███▏      | 32/100 [06:16<14:19, 12.64s/it]0.052768494773517416
epoch:  32%|███▏      | 32/100 [06:29<13:47, 12.18s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-24 23:55:09,347) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online.
[2955773:MainThread](2024-04-24 23:55:09,380) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-24 23:55:10,845) INFO - qlib.workflow - [recorder.py:341] - Recorder 18561b7048b6458e9415063e92dbdcdf starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:06,  9.15it/s]online:   3%|▎         | 2/63 [00:00<00:06,  9.22it/s]online:   5%|▍         | 3/63 [00:00<00:06,  9.52it/s]online:   6%|▋         | 4/63 [00:00<00:06,  9.49it/s]online:   8%|▊         | 5/63 [00:00<00:06,  9.33it/s]online:  10%|▉         | 6/63 [00:00<00:06,  9.30it/s]online:  11%|█         | 7/63 [00:00<00:05,  9.41it/s]online:  13%|█▎        | 8/63 [00:00<00:05,  9.58it/s]online:  14%|█▍        | 9/63 [00:00<00:05,  9.60it/s]online:  17%|█▋        | 11/63 [00:01<00:05,  9.78it/s]online:  19%|█▉        | 12/63 [00:01<00:05,  9.83it/s]online:  21%|██        | 13/63 [00:01<00:05,  9.84it/s]online:  22%|██▏       | 14/63 [00:01<00:04,  9.82it/s]online:  25%|██▌       | 16/63 [00:01<00:04,  9.82it/s]online:  27%|██▋       | 17/63 [00:01<00:04,  9.85it/s]online:  29%|██▊       | 18/63 [00:01<00:04,  9.79it/s]online:  32%|███▏      | 20/63 [00:02<00:04, 10.09it/s]online:  35%|███▍      | 22/63 [00:02<00:04, 10.03it/s]online:  37%|███▋      | 23/63 [00:02<00:04,  9.94it/s]online:  40%|███▉      | 25/63 [00:02<00:03, 10.03it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.03it/s]online:  43%|████▎     | 27/63 [00:02<00:03, 10.02it/s]online:  46%|████▌     | 29/63 [00:02<00:03, 10.18it/s]online:  49%|████▉     | 31/63 [00:03<00:03,  9.95it/s]online:  52%|█████▏    | 33/63 [00:03<00:02, 10.15it/s]online:  56%|█████▌    | 35/63 [00:03<00:02, 10.06it/s]online:  59%|█████▊    | 37/63 [00:03<00:02, 10.08it/s]online:  62%|██████▏   | 39/63 [00:03<00:02, 10.10it/s]online:  65%|██████▌   | 41/63 [00:04<00:02, 10.04it/s]online:  68%|██████▊   | 43/63 [00:04<00:01, 10.06it/s]online:  71%|███████▏  | 45/63 [00:04<00:01, 10.03it/s]online:  75%|███████▍  | 47/63 [00:04<00:01,  9.98it/s]online:  78%|███████▊  | 49/63 [00:04<00:01, 10.13it/s]online:  81%|████████  | 51/63 [00:05<00:01, 10.18it/s]online:  84%|████████▍ | 53/63 [00:05<00:01,  9.90it/s]online:  86%|████████▌ | 54/63 [00:05<00:00,  9.88it/s]online:  87%|████████▋ | 55/63 [00:05<00:00,  9.89it/s]online:  90%|█████████ | 57/63 [00:05<00:00, 10.12it/s]online:  94%|█████████▎| 59/63 [00:05<00:00, 10.20it/s]online:  97%|█████████▋| 61/63 [00:06<00:00, 10.00it/s]online: 100%|██████████| 63/63 [00:06<00:00, 10.29it/s]online: 100%|██████████| 63/63 [00:06<00:00,  9.97it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-24 23:55:27,915) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9973626 mae 0.6861303
{'IC': 0.027428014568116936,
 'ICIR': 0.2387005207618663,
 'Rank IC': 0.017899936121617426,
 'Rank ICIR': 0.15498014880934224}
[2955773:MainThread](2024-04-24 23:55:29,961) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-24 23:55:44,764) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-24 23:55:44,767) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-24 23:55:50,899) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0f8afb3e80>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 6/971 [00:00<00:16, 56.81it/s]backtest loop:   1%|          | 12/971 [00:00<00:18, 51.86it/s]backtest loop:   2%|▏         | 19/971 [00:00<00:16, 56.84it/s]backtest loop:   3%|▎         | 25/971 [00:00<00:17, 53.76it/s]backtest loop:   3%|▎         | 32/971 [00:00<00:16, 56.66it/s]backtest loop:   4%|▍         | 39/971 [00:00<00:16, 55.08it/s]backtest loop:   5%|▍         | 46/971 [00:00<00:16, 57.68it/s]backtest loop:   5%|▌         | 53/971 [00:00<00:15, 59.27it/s]backtest loop:   6%|▌         | 59/971 [00:01<00:16, 56.09it/s]backtest loop:   7%|▋         | 66/971 [00:01<00:15, 57.95it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 55.57it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:15, 57.70it/s]backtest loop:   9%|▉         | 86/971 [00:01<00:14, 59.17it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 56.92it/s]backtest loop:  10%|█         | 99/971 [00:01<00:14, 58.62it/s]backtest loop:  11%|█         | 106/971 [00:01<00:14, 59.86it/s]backtest loop:  12%|█▏        | 112/971 [00:01<00:15, 56.74it/s]backtest loop:  12%|█▏        | 119/971 [00:02<00:14, 58.50it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:15, 55.92it/s]backtest loop:  13%|█▎        | 131/971 [00:02<00:15, 54.07it/s]backtest loop:  14%|█▍        | 137/971 [00:02<00:15, 55.59it/s]backtest loop:  15%|█▍        | 144/971 [00:02<00:14, 57.65it/s]backtest loop:  16%|█▌        | 151/971 [00:02<00:14, 55.73it/s]backtest loop:  16%|█▋        | 158/971 [00:02<00:14, 57.27it/s]backtest loop:  17%|█▋        | 165/971 [00:02<00:13, 58.92it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:14, 55.96it/s]backtest loop:  18%|█▊        | 178/971 [00:03<00:13, 57.72it/s]backtest loop:  19%|█▉        | 184/971 [00:03<00:13, 57.85it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:14, 55.40it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 57.54it/s]backtest loop:  21%|██        | 204/971 [00:03<00:12, 59.25it/s]backtest loop:  22%|██▏       | 210/971 [00:03<00:13, 56.13it/s]backtest loop:  22%|██▏       | 216/971 [00:03<00:13, 54.19it/s]backtest loop:  23%|██▎       | 223/971 [00:03<00:13, 56.72it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:12, 57.54it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:13, 54.99it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:12, 57.23it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:12, 55.96it/s]backtest loop:  26%|██▋       | 256/971 [00:04<00:12, 57.82it/s]backtest loop:  27%|██▋       | 263/971 [00:04<00:11, 59.25it/s]backtest loop:  28%|██▊       | 269/971 [00:04<00:12, 56.33it/s]backtest loop:  28%|██▊       | 276/971 [00:04<00:12, 54.87it/s]backtest loop:  29%|██▉       | 283/971 [00:04<00:12, 57.06it/s]backtest loop:  30%|██▉       | 290/971 [00:05<00:11, 58.65it/s]backtest loop:  30%|███       | 296/971 [00:05<00:12, 56.05it/s]backtest loop:  31%|███       | 302/971 [00:05<00:11, 56.97it/s]backtest loop:  32%|███▏      | 309/971 [00:05<00:11, 58.83it/s]backtest loop:  32%|███▏      | 315/971 [00:05<00:11, 56.51it/s]backtest loop:  33%|███▎      | 322/971 [00:05<00:11, 58.49it/s]backtest loop:  34%|███▍      | 329/971 [00:05<00:10, 59.71it/s]backtest loop:  35%|███▍      | 335/971 [00:05<00:11, 56.45it/s]backtest loop:  35%|███▌      | 342/971 [00:05<00:10, 58.15it/s]backtest loop:  36%|███▌      | 349/971 [00:06<00:10, 59.97it/s]backtest loop:  37%|███▋      | 356/971 [00:06<00:10, 57.52it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 56.42it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 54.43it/s]backtest loop:  39%|███▊      | 376/971 [00:06<00:10, 56.93it/s]backtest loop:  39%|███▉      | 383/971 [00:06<00:10, 55.54it/s]backtest loop:  40%|████      | 390/971 [00:06<00:10, 57.46it/s]backtest loop:  41%|████      | 396/971 [00:06<00:09, 57.72it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 56.02it/s]backtest loop:  42%|████▏     | 409/971 [00:07<00:09, 56.98it/s]backtest loop:  43%|████▎     | 416/971 [00:07<00:09, 58.83it/s]backtest loop:  44%|████▎     | 423/971 [00:07<00:09, 56.68it/s]backtest loop:  44%|████▍     | 430/971 [00:07<00:09, 58.49it/s]backtest loop:  45%|████▌     | 437/971 [00:07<00:09, 56.20it/s]backtest loop:  46%|████▌     | 444/971 [00:07<00:09, 57.90it/s]backtest loop:  46%|████▋     | 451/971 [00:07<00:08, 59.25it/s]backtest loop:  47%|████▋     | 457/971 [00:08<00:09, 55.99it/s]backtest loop:  48%|████▊     | 463/971 [00:08<00:08, 57.05it/s]backtest loop:  48%|████▊     | 470/971 [00:08<00:08, 58.64it/s]backtest loop:  49%|████▉     | 476/971 [00:08<00:08, 58.53it/s]backtest loop:  50%|████▉     | 482/971 [00:08<00:08, 55.88it/s]backtest loop:  50%|█████     | 489/971 [00:08<00:08, 58.44it/s]backtest loop:  51%|█████     | 495/971 [00:08<00:08, 55.70it/s]backtest loop:  52%|█████▏    | 502/971 [00:08<00:08, 57.99it/s]backtest loop:  52%|█████▏    | 508/971 [00:08<00:08, 55.56it/s]backtest loop:  53%|█████▎    | 515/971 [00:09<00:07, 57.65it/s]backtest loop:  54%|█████▍    | 522/971 [00:09<00:08, 55.84it/s]backtest loop:  54%|█████▍    | 528/971 [00:09<00:07, 56.50it/s]backtest loop:  55%|█████▌    | 535/971 [00:09<00:07, 58.22it/s]backtest loop:  56%|█████▌    | 541/971 [00:09<00:07, 55.71it/s]backtest loop:  56%|█████▋    | 548/971 [00:09<00:07, 57.84it/s]backtest loop:  57%|█████▋    | 555/971 [00:09<00:07, 59.23it/s]backtest loop:  58%|█████▊    | 561/971 [00:09<00:07, 56.11it/s]backtest loop:  58%|█████▊    | 568/971 [00:09<00:06, 58.00it/s]backtest loop:  59%|█████▉    | 575/971 [00:10<00:06, 59.53it/s]backtest loop:  60%|█████▉    | 581/971 [00:10<00:07, 55.59it/s]backtest loop:  61%|██████    | 588/971 [00:10<00:06, 57.55it/s]backtest loop:  61%|██████▏   | 595/971 [00:10<00:06, 59.00it/s]backtest loop:  62%|██████▏   | 601/971 [00:10<00:06, 56.05it/s]backtest loop:  63%|██████▎   | 608/971 [00:10<00:06, 58.03it/s]backtest loop:  63%|██████▎   | 614/971 [00:10<00:06, 58.38it/s]backtest loop:  64%|██████▍   | 620/971 [00:10<00:06, 55.73it/s]backtest loop:  65%|██████▍   | 627/971 [00:10<00:05, 58.14it/s]backtest loop:  65%|██████▌   | 634/971 [00:11<00:05, 59.51it/s]backtest loop:  66%|██████▌   | 640/971 [00:11<00:05, 56.46it/s]backtest loop:  67%|██████▋   | 647/971 [00:11<00:05, 58.17it/s]backtest loop:  67%|██████▋   | 654/971 [00:11<00:05, 59.67it/s]backtest loop:  68%|██████▊   | 660/971 [00:11<00:05, 56.57it/s]backtest loop:  69%|██████▊   | 666/971 [00:11<00:05, 57.50it/s]backtest loop:  69%|██████▉   | 672/971 [00:11<00:05, 57.96it/s]backtest loop:  70%|██████▉   | 679/971 [00:11<00:05, 56.12it/s]backtest loop:  71%|███████   | 686/971 [00:11<00:04, 57.88it/s]backtest loop:  71%|███████▏  | 693/971 [00:12<00:04, 59.17it/s]backtest loop:  72%|███████▏  | 699/971 [00:12<00:04, 56.23it/s]backtest loop:  73%|███████▎  | 706/971 [00:12<00:04, 58.06it/s]backtest loop:  73%|███████▎  | 713/971 [00:12<00:04, 59.32it/s]backtest loop:  74%|███████▍  | 719/971 [00:12<00:04, 56.10it/s]backtest loop:  75%|███████▍  | 725/971 [00:12<00:04, 56.93it/s]backtest loop:  75%|███████▌  | 731/971 [00:12<00:04, 55.13it/s]backtest loop:  76%|███████▌  | 738/971 [00:12<00:04, 54.44it/s]backtest loop:  77%|███████▋  | 745/971 [00:13<00:03, 56.85it/s]backtest loop:  77%|███████▋  | 751/971 [00:13<00:04, 54.96it/s]backtest loop:  78%|███████▊  | 758/971 [00:13<00:03, 57.47it/s]backtest loop:  79%|███████▉  | 765/971 [00:13<00:03, 56.21it/s]backtest loop:  80%|███████▉  | 772/971 [00:13<00:03, 58.75it/s]backtest loop:  80%|████████  | 779/971 [00:13<00:03, 60.33it/s]backtest loop:  81%|████████  | 786/971 [00:13<00:03, 57.69it/s]backtest loop:  82%|████████▏ | 793/971 [00:13<00:03, 55.91it/s]backtest loop:  82%|████████▏ | 800/971 [00:13<00:02, 58.12it/s]backtest loop:  83%|████████▎ | 807/971 [00:14<00:02, 59.39it/s]backtest loop:  84%|████████▎ | 813/971 [00:14<00:02, 56.59it/s]backtest loop:  84%|████████▍ | 820/971 [00:14<00:02, 58.29it/s]backtest loop:  85%|████████▌ | 826/971 [00:14<00:02, 58.70it/s]backtest loop:  86%|████████▌ | 833/971 [00:14<00:02, 56.56it/s]backtest loop:  87%|████████▋ | 840/971 [00:14<00:02, 58.22it/s]backtest loop:  87%|████████▋ | 847/971 [00:14<00:02, 59.48it/s]backtest loop:  88%|████████▊ | 853/971 [00:14<00:02, 56.45it/s]backtest loop:  89%|████████▊ | 860/971 [00:15<00:01, 58.14it/s]backtest loop:  89%|████████▉ | 867/971 [00:15<00:01, 56.55it/s]backtest loop:  90%|████████▉ | 873/971 [00:15<00:01, 57.28it/s]backtest loop:  91%|█████████ | 880/971 [00:15<00:01, 58.95it/s]backtest loop:  91%|█████████▏| 887/971 [00:15<00:01, 56.82it/s]backtest loop:  92%|█████████▏| 894/971 [00:15<00:01, 58.47it/s]backtest loop:  93%|█████████▎| 901/971 [00:15<00:01, 59.70it/s]backtest loop:  93%|█████████▎| 907/971 [00:15<00:01, 56.52it/s]backtest loop:  94%|█████████▍| 914/971 [00:15<00:00, 58.19it/s]backtest loop:  95%|█████████▍| 921/971 [00:16<00:00, 56.29it/s]backtest loop:  95%|█████████▌| 927/971 [00:16<00:00, 57.24it/s]backtest loop:  96%|█████████▌| 934/971 [00:16<00:00, 58.85it/s]backtest loop:  97%|█████████▋| 940/971 [00:16<00:00, 56.30it/s]backtest loop:  98%|█████████▊| 947/971 [00:16<00:00, 58.09it/s]backtest loop:  98%|█████████▊| 953/971 [00:16<00:00, 58.50it/s]backtest loop:  99%|█████████▉| 960/971 [00:16<00:00, 56.48it/s]backtest loop: 100%|█████████▉| 967/971 [00:16<00:00, 58.22it/s]backtest loop: 100%|██████████| 971/971 [00:16<00:00, 57.28it/s]
[2955773:MainThread](2024-04-24 23:56:07,927) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000531
std                0.004647
annualized_return  0.126489
information_ratio  1.764418
max_drawdown      -0.054839
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000336
std                0.004648
annualized_return  0.079956
information_ratio  1.114965
max_drawdown      -0.067968
[2955773:MainThread](2024-04-24 23:56:07,964) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 1 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074],
 'IC': [0.027428014568116936],
 'ICIR': [0.2387005207618663],
 'Rank IC': [0.017899936121617426],
 'Rank ICIR': [0.15498014880934224],
 'mae': [0.6861302852630615],
 'mse': [0.9973626136779785]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-24 23:56:09,244) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-24 23:56:09,245) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:23, 11.75s/it]epoch:   2%|▏         | 2/100 [00:22<18:38, 11.42s/it]epoch:   3%|▎         | 3/100 [00:34<18:17, 11.32s/it]epoch:   4%|▍         | 4/100 [00:45<17:57, 11.22s/it]epoch:   5%|▌         | 5/100 [00:56<17:32, 11.08s/it]epoch:   6%|▌         | 6/100 [01:06<17:14, 11.00s/it]epoch:   7%|▋         | 7/100 [01:17<17:03, 11.00s/it]epoch:   8%|▊         | 8/100 [01:29<17:00, 11.10s/it]epoch:   9%|▉         | 9/100 [01:40<16:53, 11.13s/it]epoch:  10%|█         | 10/100 [01:51<16:38, 11.10s/it]epoch:  11%|█         | 11/100 [02:02<16:24, 11.06s/it]epoch:  12%|█▏        | 12/100 [02:13<16:11, 11.04s/it]epoch:  13%|█▎        | 13/100 [02:24<16:05, 11.09s/it]epoch:  14%|█▍        | 14/100 [02:35<16:01, 11.18s/it]epoch:  15%|█▌        | 15/100 [02:46<15:44, 11.11s/it]epoch:  16%|█▌        | 16/100 [02:57<15:24, 11.01s/it]epoch:  17%|█▋        | 17/100 [03:08<15:10, 10.97s/it]epoch:  18%|█▊        | 18/100 [03:19<15:05, 11.04s/it]epoch:  19%|█▉        | 19/100 [03:31<15:00, 11.12s/it]epoch:  20%|██        | 20/100 [03:42<14:48, 11.11s/it]0.05113317026912024
best ic: 0.05113317026912024
epoch:  21%|██        | 21/100 [03:54<15:09, 11.51s/it]0.05011184886229526
epoch:  22%|██▏       | 22/100 [04:07<15:18, 11.77s/it]0.05421703664718907
best ic: 0.05421703664718907
epoch:  23%|██▎       | 23/100 [04:19<15:29, 12.07s/it]0.05552713991947141
best ic: 0.05552713991947141
epoch:  24%|██▍       | 24/100 [04:32<15:37, 12.34s/it]0.05437006268152192
epoch:  25%|██▌       | 25/100 [04:45<15:27, 12.37s/it]0.054820860631626334
epoch:  26%|██▌       | 26/100 [04:57<15:14, 12.36s/it]0.053995227191143205
epoch:  27%|██▋       | 27/100 [05:09<15:03, 12.37s/it]0.05569013371611059
best ic: 0.05569013371611059
epoch:  28%|██▊       | 28/100 [05:22<15:01, 12.52s/it]0.054141022714872235
epoch:  29%|██▉       | 29/100 [05:35<15:01, 12.70s/it]0.055229345598204395
epoch:  30%|███       | 30/100 [05:48<14:43, 12.63s/it]0.05335508198776035
epoch:  31%|███       | 31/100 [06:00<14:28, 12.59s/it]0.0553425211626363
epoch:  32%|███▏      | 32/100 [06:13<14:14, 12.57s/it]0.055674739898041316
epoch:  33%|███▎      | 33/100 [06:26<14:10, 12.70s/it]0.049827013620829905
epoch:  34%|███▍      | 34/100 [06:39<14:04, 12.79s/it]0.05466735552342821
epoch:  35%|███▌      | 35/100 [06:51<13:45, 12.69s/it]0.055597546944149485
epoch:  35%|███▌      | 35/100 [07:04<13:07, 12.12s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 00:03:13,573) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 00:03:13,589) INFO - qlib.workflow - [recorder.py:341] - Recorder 4be23d3ac21c4a928178c0de850d6484 starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 10.82it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.43it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.62it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.64it/s]online:  16%|█▌        | 10/63 [00:00<00:05, 10.48it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.53it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.52it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.54it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.56it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.60it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.59it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.57it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.50it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.47it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.54it/s]online:  51%|█████     | 32/63 [00:03<00:02, 10.54it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.51it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.43it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.50it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.62it/s]online:  67%|██████▋   | 42/63 [00:03<00:01, 10.57it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.59it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.64it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.60it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.71it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.61it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.60it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.60it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.68it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.73it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.64it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.61it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 00:03:29,611) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9971275 mae 0.6859832
{'IC': 0.02918433457730239,
 'ICIR': 0.26166720227076895,
 'Rank IC': 0.023050650417454972,
 'Rank ICIR': 0.2092031518636296}
[2955773:MainThread](2024-04-25 00:03:31,467) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 00:03:45,563) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:03:45,566) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:03:51,656) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0f9f12ca90>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:40,  9.67it/s]backtest loop:   1%|          | 9/971 [00:00<00:38, 24.77it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:27, 34.55it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:24, 38.46it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:21, 43.45it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:19, 46.96it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:20, 46.53it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:19, 48.49it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 50.29it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 49.74it/s]backtest loop:   7%|▋         | 64/971 [00:01<00:16, 53.74it/s]backtest loop:   7%|▋         | 71/971 [00:01<00:15, 56.55it/s]backtest loop:   8%|▊         | 77/971 [00:01<00:16, 54.25it/s]backtest loop:   9%|▊         | 84/971 [00:01<00:15, 56.92it/s]backtest loop:   9%|▉         | 90/971 [00:01<00:15, 57.73it/s]backtest loop:  10%|▉         | 97/971 [00:02<00:15, 56.26it/s]backtest loop:  11%|█         | 103/971 [00:02<00:15, 57.02it/s]backtest loop:  11%|█▏        | 110/971 [00:02<00:14, 58.88it/s]backtest loop:  12%|█▏        | 116/971 [00:02<00:14, 59.09it/s]backtest loop:  13%|█▎        | 122/971 [00:02<00:15, 56.13it/s]backtest loop:  13%|█▎        | 128/971 [00:02<00:15, 54.17it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:14, 56.83it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:15, 54.58it/s]backtest loop:  15%|█▌        | 148/971 [00:02<00:14, 56.93it/s]backtest loop:  16%|█▌        | 154/971 [00:03<00:14, 57.12it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:14, 55.52it/s]backtest loop:  17%|█▋        | 168/971 [00:03<00:13, 57.91it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:13, 59.24it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:13, 56.48it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:13, 58.40it/s]backtest loop:  20%|██        | 195/971 [00:03<00:13, 56.00it/s]backtest loop:  21%|██        | 201/971 [00:03<00:13, 56.97it/s]backtest loop:  21%|██▏       | 207/971 [00:03<00:13, 57.28it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:13, 55.10it/s]backtest loop:  23%|██▎       | 220/971 [00:04<00:13, 54.32it/s]backtest loop:  23%|██▎       | 227/971 [00:04<00:13, 56.62it/s]backtest loop:  24%|██▍       | 233/971 [00:04<00:12, 57.33it/s]backtest loop:  25%|██▍       | 240/971 [00:04<00:13, 55.83it/s]backtest loop:  25%|██▌       | 247/971 [00:04<00:12, 57.78it/s]backtest loop:  26%|██▌       | 253/971 [00:04<00:12, 57.97it/s]backtest loop:  27%|██▋       | 259/971 [00:04<00:12, 55.37it/s]backtest loop:  27%|██▋       | 265/971 [00:05<00:12, 56.44it/s]backtest loop:  28%|██▊       | 271/971 [00:05<00:13, 52.64it/s]backtest loop:  29%|██▊       | 278/971 [00:05<00:12, 55.51it/s]backtest loop:  29%|██▉       | 284/971 [00:05<00:12, 56.28it/s]backtest loop:  30%|██▉       | 290/971 [00:05<00:12, 56.43it/s]backtest loop:  30%|███       | 296/971 [00:05<00:12, 53.27it/s]backtest loop:  31%|███       | 302/971 [00:05<00:12, 55.02it/s]backtest loop:  32%|███▏      | 308/971 [00:05<00:11, 56.40it/s]backtest loop:  32%|███▏      | 315/971 [00:05<00:11, 54.96it/s]backtest loop:  33%|███▎      | 322/971 [00:06<00:11, 57.18it/s]backtest loop:  34%|███▍      | 329/971 [00:06<00:10, 58.69it/s]backtest loop:  35%|███▍      | 335/971 [00:06<00:11, 55.83it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:10, 57.70it/s]backtest loop:  36%|███▌      | 349/971 [00:06<00:10, 59.65it/s]backtest loop:  37%|███▋      | 355/971 [00:06<00:10, 56.50it/s]backtest loop:  37%|███▋      | 362/971 [00:06<00:10, 58.34it/s]backtest loop:  38%|███▊      | 368/971 [00:06<00:11, 53.04it/s]backtest loop:  39%|███▊      | 375/971 [00:06<00:10, 55.90it/s]backtest loop:  39%|███▉      | 382/971 [00:07<00:10, 58.05it/s]backtest loop:  40%|███▉      | 388/971 [00:07<00:10, 55.60it/s]backtest loop:  41%|████      | 394/971 [00:07<00:10, 56.61it/s]backtest loop:  41%|████▏     | 401/971 [00:07<00:09, 58.67it/s]backtest loop:  42%|████▏     | 408/971 [00:07<00:09, 56.51it/s]backtest loop:  43%|████▎     | 414/971 [00:07<00:09, 57.08it/s]backtest loop:  43%|████▎     | 421/971 [00:07<00:09, 58.81it/s]backtest loop:  44%|████▍     | 428/971 [00:07<00:09, 56.58it/s]backtest loop:  45%|████▍     | 434/971 [00:07<00:09, 56.95it/s]backtest loop:  45%|████▌     | 440/971 [00:08<00:09, 57.64it/s]backtest loop:  46%|████▌     | 447/971 [00:08<00:09, 55.70it/s]backtest loop:  47%|████▋     | 454/971 [00:08<00:08, 57.96it/s]backtest loop:  47%|████▋     | 460/971 [00:08<00:08, 58.43it/s]backtest loop:  48%|████▊     | 466/971 [00:08<00:08, 58.62it/s]backtest loop:  49%|████▊     | 472/971 [00:08<00:08, 56.00it/s]backtest loop:  49%|████▉     | 479/971 [00:08<00:08, 58.22it/s]backtest loop:  50%|████▉     | 485/971 [00:08<00:08, 58.66it/s]backtest loop:  51%|█████     | 491/971 [00:08<00:08, 56.02it/s]backtest loop:  51%|█████▏    | 498/971 [00:09<00:08, 58.11it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:08, 57.06it/s]backtest loop:  53%|█████▎    | 512/971 [00:09<00:08, 55.36it/s]backtest loop:  53%|█████▎    | 519/971 [00:09<00:07, 57.41it/s]backtest loop:  54%|█████▍    | 526/971 [00:09<00:07, 55.94it/s]backtest loop:  55%|█████▍    | 533/971 [00:09<00:07, 57.77it/s]backtest loop:  56%|█████▌    | 540/971 [00:09<00:07, 59.34it/s]backtest loop:  56%|█████▌    | 546/971 [00:09<00:07, 56.54it/s]backtest loop:  57%|█████▋    | 553/971 [00:10<00:07, 58.21it/s]backtest loop:  58%|█████▊    | 560/971 [00:10<00:06, 59.80it/s]backtest loop:  58%|█████▊    | 567/971 [00:10<00:07, 57.40it/s]backtest loop:  59%|█████▉    | 574/971 [00:10<00:06, 59.01it/s]backtest loop:  60%|█████▉    | 581/971 [00:10<00:06, 56.89it/s]backtest loop:  61%|██████    | 588/971 [00:10<00:06, 58.36it/s]backtest loop:  61%|██████▏   | 595/971 [00:10<00:06, 59.52it/s]backtest loop:  62%|██████▏   | 601/971 [00:10<00:06, 56.32it/s]backtest loop:  63%|██████▎   | 608/971 [00:11<00:06, 58.07it/s]backtest loop:  63%|██████▎   | 615/971 [00:11<00:06, 56.35it/s]backtest loop:  64%|██████▍   | 622/971 [00:11<00:05, 58.18it/s]backtest loop:  65%|██████▍   | 628/971 [00:11<00:05, 58.61it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:05, 56.58it/s]backtest loop:  66%|██████▌   | 642/971 [00:11<00:05, 58.20it/s]backtest loop:  67%|██████▋   | 649/971 [00:11<00:05, 59.48it/s]backtest loop:  67%|██████▋   | 655/971 [00:11<00:05, 56.76it/s]backtest loop:  68%|██████▊   | 662/971 [00:11<00:05, 58.40it/s]backtest loop:  69%|██████▉   | 669/971 [00:12<00:05, 59.66it/s]backtest loop:  70%|██████▉   | 675/971 [00:12<00:05, 56.25it/s]backtest loop:  70%|███████   | 682/971 [00:12<00:04, 58.23it/s]backtest loop:  71%|███████   | 688/971 [00:12<00:05, 56.49it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:05, 52.75it/s]backtest loop:  72%|███████▏  | 700/971 [00:12<00:05, 53.58it/s]backtest loop:  73%|███████▎  | 706/971 [00:12<00:04, 53.96it/s]backtest loop:  73%|███████▎  | 712/971 [00:12<00:04, 54.45it/s]backtest loop:  74%|███████▍  | 718/971 [00:12<00:04, 54.47it/s]backtest loop:  75%|███████▍  | 724/971 [00:13<00:04, 51.52it/s]backtest loop:  75%|███████▌  | 730/971 [00:13<00:04, 52.70it/s]backtest loop:  76%|███████▌  | 736/971 [00:13<00:04, 50.54it/s]backtest loop:  76%|███████▋  | 742/971 [00:13<00:04, 51.81it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 49.70it/s]backtest loop:  78%|███████▊  | 754/971 [00:13<00:04, 51.51it/s]backtest loop:  78%|███████▊  | 760/971 [00:13<00:04, 49.74it/s]backtest loop:  79%|███████▉  | 766/971 [00:13<00:03, 51.91it/s]backtest loop:  80%|███████▉  | 772/971 [00:14<00:03, 53.57it/s]backtest loop:  80%|████████  | 778/971 [00:14<00:03, 54.58it/s]backtest loop:  81%|████████  | 784/971 [00:14<00:03, 51.72it/s]backtest loop:  81%|████████▏ | 790/971 [00:14<00:03, 52.67it/s]backtest loop:  82%|████████▏ | 796/971 [00:14<00:03, 53.42it/s]backtest loop:  83%|████████▎ | 802/971 [00:14<00:03, 54.16it/s]backtest loop:  83%|████████▎ | 808/971 [00:14<00:03, 51.11it/s]backtest loop:  84%|████████▍ | 814/971 [00:14<00:02, 52.70it/s]backtest loop:  84%|████████▍ | 820/971 [00:14<00:02, 53.39it/s]backtest loop:  85%|████████▌ | 826/971 [00:15<00:02, 53.90it/s]backtest loop:  86%|████████▌ | 832/971 [00:15<00:02, 54.22it/s]backtest loop:  86%|████████▋ | 838/971 [00:15<00:02, 51.17it/s]backtest loop:  87%|████████▋ | 844/971 [00:15<00:02, 52.09it/s]backtest loop:  88%|████████▊ | 850/971 [00:15<00:02, 52.88it/s]backtest loop:  88%|████████▊ | 856/971 [00:15<00:02, 53.45it/s]backtest loop:  89%|████████▉ | 862/971 [00:15<00:02, 50.69it/s]backtest loop:  89%|████████▉ | 868/971 [00:15<00:01, 51.97it/s]backtest loop:  90%|█████████ | 874/971 [00:15<00:01, 52.87it/s]backtest loop:  91%|█████████ | 880/971 [00:16<00:01, 53.66it/s]backtest loop:  91%|█████████ | 886/971 [00:16<00:01, 54.13it/s]backtest loop:  92%|█████████▏| 892/971 [00:16<00:01, 51.09it/s]backtest loop:  92%|█████████▏| 898/971 [00:16<00:01, 52.23it/s]backtest loop:  93%|█████████▎| 904/971 [00:16<00:01, 52.96it/s]backtest loop:  94%|█████████▎| 910/971 [00:16<00:01, 53.61it/s]backtest loop:  94%|█████████▍| 916/971 [00:16<00:01, 50.84it/s]backtest loop:  95%|█████████▍| 922/971 [00:16<00:00, 52.11it/s]backtest loop:  96%|█████████▌| 928/971 [00:16<00:00, 52.75it/s]backtest loop:  96%|█████████▌| 934/971 [00:17<00:00, 53.54it/s]backtest loop:  97%|█████████▋| 940/971 [00:17<00:00, 51.01it/s]backtest loop:  97%|█████████▋| 946/971 [00:17<00:00, 52.08it/s]backtest loop:  98%|█████████▊| 952/971 [00:17<00:00, 52.89it/s]backtest loop:  99%|█████████▊| 958/971 [00:17<00:00, 53.54it/s]backtest loop:  99%|█████████▉| 964/971 [00:17<00:00, 53.98it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 50.83it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.52it/s]
[2955773:MainThread](2024-04-25 00:04:09,540) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000620
std                0.004596
annualized_return  0.147590
information_ratio  2.081391
max_drawdown      -0.059967
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000427
std                0.004599
annualized_return  0.101609
information_ratio  1.432225
max_drawdown      -0.061701
[2955773:MainThread](2024-04-25 00:04:09,557) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 2 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274],
 'IC': [0.027428014568116936, 0.02918433457730239],
 'ICIR': [0.2387005207618663, 0.26166720227076895],
 'Rank IC': [0.017899936121617426, 0.023050650417454972],
 'Rank ICIR': [0.15498014880934224, 0.2092031518636296],
 'mae': [0.6861302852630615, 0.6859831809997559],
 'mse': [0.9973626136779785, 0.9971274733543396]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-25 00:04:10,851) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-25 00:04:10,851) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:18, 11.70s/it]epoch:   2%|▏         | 2/100 [00:22<18:21, 11.24s/it]epoch:   3%|▎         | 3/100 [00:33<18:10, 11.24s/it]epoch:   4%|▍         | 4/100 [00:45<17:55, 11.20s/it]epoch:   5%|▌         | 5/100 [00:55<17:33, 11.09s/it]epoch:   6%|▌         | 6/100 [01:06<17:18, 11.04s/it]epoch:   7%|▋         | 7/100 [01:17<17:05, 11.03s/it]epoch:   8%|▊         | 8/100 [01:29<17:01, 11.10s/it]epoch:   9%|▉         | 9/100 [01:40<16:52, 11.13s/it]epoch:  10%|█         | 10/100 [01:51<16:34, 11.05s/it]epoch:  11%|█         | 11/100 [02:02<16:21, 11.02s/it]epoch:  12%|█▏        | 12/100 [02:13<16:11, 11.04s/it]epoch:  13%|█▎        | 13/100 [02:24<16:07, 11.12s/it]epoch:  14%|█▍        | 14/100 [02:35<16:01, 11.18s/it]epoch:  15%|█▌        | 15/100 [02:46<15:46, 11.14s/it]epoch:  16%|█▌        | 16/100 [02:57<15:30, 11.08s/it]epoch:  17%|█▋        | 17/100 [03:08<15:17, 11.06s/it]epoch:  18%|█▊        | 18/100 [03:20<15:12, 11.13s/it]epoch:  19%|█▉        | 19/100 [03:31<15:06, 11.19s/it]epoch:  20%|██        | 20/100 [03:42<14:49, 11.12s/it]0.04955025489724708
best ic: 0.04955025489724708
epoch:  21%|██        | 21/100 [03:54<15:08, 11.50s/it]0.04794037211393943
epoch:  22%|██▏       | 22/100 [04:07<15:18, 11.78s/it]0.05139542146004681
best ic: 0.05139542146004681
epoch:  23%|██▎       | 23/100 [04:20<15:30, 12.08s/it]0.05028226107495101
epoch:  24%|██▍       | 24/100 [04:32<15:30, 12.25s/it]0.0523732262735969
best ic: 0.0523732262735969
epoch:  25%|██▌       | 25/100 [04:45<15:22, 12.30s/it]0.05314786410554287
best ic: 0.05314786410554287
epoch:  26%|██▌       | 26/100 [04:57<15:13, 12.35s/it]0.04853484504843056
epoch:  27%|██▋       | 27/100 [05:10<15:06, 12.41s/it]0.05161998323170471
epoch:  28%|██▊       | 28/100 [05:23<15:06, 12.59s/it]0.0508092757947339
epoch:  29%|██▉       | 29/100 [05:35<14:54, 12.60s/it]0.050403022205714576
epoch:  30%|███       | 30/100 [05:48<14:38, 12.56s/it]0.04890746367678319
epoch:  31%|███       | 31/100 [06:00<14:24, 12.53s/it]0.050678783517459906
epoch:  32%|███▏      | 32/100 [06:13<14:17, 12.61s/it]0.050803630796012425
epoch:  33%|███▎      | 33/100 [06:26<14:19, 12.83s/it]0.05442818219335912
best ic: 0.05442818219335912
epoch:  34%|███▍      | 34/100 [06:39<14:01, 12.75s/it]0.05211800682371857
epoch:  35%|███▌      | 35/100 [06:51<13:43, 12.67s/it]0.051056750642628865
epoch:  36%|███▌      | 36/100 [07:04<13:26, 12.61s/it]0.052698960847442716
epoch:  37%|███▋      | 37/100 [07:17<13:18, 12.68s/it]0.05007929659972078
epoch:  38%|███▊      | 38/100 [07:30<13:12, 12.78s/it]0.04936668940613932
epoch:  39%|███▉      | 39/100 [07:42<12:54, 12.70s/it]0.05541473543226825
best ic: 0.05541473543226825
epoch:  40%|████      | 40/100 [07:55<12:37, 12.63s/it]0.050225422879621964
epoch:  41%|████      | 41/100 [08:07<12:24, 12.62s/it]0.05167788871667243
epoch:  42%|████▏     | 42/100 [08:20<12:18, 12.74s/it]0.049970841340489784
epoch:  43%|████▎     | 43/100 [08:33<12:10, 12.81s/it]0.05128400773947861
epoch:  44%|████▍     | 44/100 [08:46<11:54, 12.75s/it]0.051953904193509676
epoch:  45%|████▌     | 45/100 [08:58<11:36, 12.66s/it]0.05132060453158971
epoch:  46%|████▌     | 46/100 [09:11<11:25, 12.69s/it]0.05163058319839986
epoch:  47%|████▋     | 47/100 [09:24<11:17, 12.78s/it]0.05107111865467529
epoch:  47%|████▋     | 47/100 [09:37<10:51, 12.29s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 00:13:48,278) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 00:13:48,294) INFO - qlib.workflow - [recorder.py:341] - Recorder b3fca408057c45c3bbb038a902220b2c starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 11.03it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.58it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.69it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.66it/s]online:  16%|█▌        | 10/63 [00:00<00:04, 10.65it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.71it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.58it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.56it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.60it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.57it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.63it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.56it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.48it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.49it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.55it/s]online:  51%|█████     | 32/63 [00:03<00:02, 10.64it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.57it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.52it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.56it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.54it/s]online:  67%|██████▋   | 42/63 [00:03<00:01, 10.50it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.51it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.49it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.46it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.48it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.48it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.41it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.47it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.43it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.55it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.45it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.56it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 00:14:04,680) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9974363 mae 0.6860885
{'IC': 0.02841997940888336,
 'ICIR': 0.26074474219927596,
 'Rank IC': 0.021150826288890614,
 'Rank ICIR': 0.2079182482330708}
[2955773:MainThread](2024-04-25 00:14:06,538) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 00:14:21,381) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:14:21,384) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:14:27,454) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0fa96df850>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:41,  9.51it/s]backtest loop:   1%|          | 10/971 [00:00<00:35, 27.34it/s]backtest loop:   2%|▏         | 17/971 [00:00<00:26, 36.66it/s]backtest loop:   2%|▏         | 24/971 [00:00<00:22, 42.43it/s]backtest loop:   3%|▎         | 31/971 [00:00<00:19, 48.24it/s]backtest loop:   4%|▍         | 37/971 [00:00<00:18, 51.25it/s]backtest loop:   5%|▍         | 44/971 [00:01<00:17, 51.57it/s]backtest loop:   5%|▌         | 50/971 [00:01<00:17, 53.34it/s]backtest loop:   6%|▌         | 56/971 [00:01<00:16, 55.01it/s]backtest loop:   6%|▋         | 62/971 [00:01<00:16, 53.55it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:16, 56.21it/s]backtest loop:   8%|▊         | 76/971 [00:01<00:15, 58.08it/s]backtest loop:   8%|▊         | 82/971 [00:01<00:15, 55.66it/s]backtest loop:   9%|▉         | 89/971 [00:01<00:15, 58.16it/s]backtest loop:  10%|▉         | 96/971 [00:01<00:14, 59.97it/s]backtest loop:  11%|█         | 103/971 [00:02<00:15, 56.73it/s]backtest loop:  11%|█▏        | 110/971 [00:02<00:14, 58.46it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:15, 56.27it/s]backtest loop:  13%|█▎        | 124/971 [00:02<00:14, 57.92it/s]backtest loop:  13%|█▎        | 130/971 [00:02<00:15, 55.49it/s]backtest loop:  14%|█▍        | 136/971 [00:02<00:15, 53.78it/s]backtest loop:  15%|█▍        | 143/971 [00:02<00:14, 56.27it/s]backtest loop:  15%|█▌        | 150/971 [00:02<00:14, 57.99it/s]backtest loop:  16%|█▌        | 156/971 [00:03<00:14, 55.21it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:13, 58.08it/s]backtest loop:  17%|█▋        | 169/971 [00:03<00:13, 58.53it/s]backtest loop:  18%|█▊        | 176/971 [00:03<00:14, 56.45it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:13, 58.25it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:13, 56.59it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 58.75it/s]backtest loop:  21%|██        | 204/971 [00:03<00:12, 59.94it/s]backtest loop:  22%|██▏       | 211/971 [00:03<00:13, 57.27it/s]backtest loop:  22%|██▏       | 217/971 [00:04<00:13, 55.01it/s]backtest loop:  23%|██▎       | 224/971 [00:04<00:13, 57.28it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:13, 55.12it/s]backtest loop:  24%|██▍       | 236/971 [00:04<00:13, 56.31it/s]backtest loop:  25%|██▌       | 243/971 [00:04<00:12, 58.47it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:12, 56.17it/s]backtest loop:  26%|██▋       | 256/971 [00:04<00:12, 58.28it/s]backtest loop:  27%|██▋       | 262/971 [00:04<00:12, 58.43it/s]backtest loop:  28%|██▊       | 268/971 [00:04<00:12, 55.85it/s]backtest loop:  28%|██▊       | 275/971 [00:05<00:12, 57.75it/s]backtest loop:  29%|██▉       | 281/971 [00:05<00:12, 55.23it/s]backtest loop:  30%|██▉       | 287/971 [00:05<00:12, 56.34it/s]backtest loop:  30%|███       | 294/971 [00:05<00:11, 58.13it/s]backtest loop:  31%|███       | 300/971 [00:05<00:12, 55.83it/s]backtest loop:  32%|███▏      | 307/971 [00:05<00:11, 57.85it/s]backtest loop:  32%|███▏      | 314/971 [00:05<00:11, 59.34it/s]backtest loop:  33%|███▎      | 320/971 [00:05<00:11, 56.16it/s]backtest loop:  34%|███▎      | 327/971 [00:05<00:11, 58.00it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:10, 58.16it/s]backtest loop:  35%|███▍      | 339/971 [00:06<00:10, 58.28it/s]backtest loop:  36%|███▌      | 345/971 [00:06<00:11, 55.05it/s]backtest loop:  36%|███▋      | 352/971 [00:06<00:10, 57.16it/s]backtest loop:  37%|███▋      | 359/971 [00:06<00:10, 59.44it/s]backtest loop:  38%|███▊      | 365/971 [00:06<00:10, 57.50it/s]backtest loop:  38%|███▊      | 371/971 [00:06<00:10, 54.74it/s]backtest loop:  39%|███▉      | 378/971 [00:06<00:10, 54.09it/s]backtest loop:  40%|███▉      | 385/971 [00:07<00:10, 56.42it/s]backtest loop:  40%|████      | 392/971 [00:07<00:09, 58.10it/s]backtest loop:  41%|████      | 398/971 [00:07<00:10, 54.43it/s]backtest loop:  42%|████▏     | 405/971 [00:07<00:09, 57.07it/s]backtest loop:  42%|████▏     | 412/971 [00:07<00:09, 58.52it/s]backtest loop:  43%|████▎     | 418/971 [00:07<00:09, 55.80it/s]backtest loop:  44%|████▎     | 424/971 [00:07<00:09, 56.86it/s]backtest loop:  44%|████▍     | 430/971 [00:07<00:09, 56.03it/s]backtest loop:  45%|████▌     | 437/971 [00:07<00:09, 54.95it/s]backtest loop:  46%|████▌     | 444/971 [00:08<00:09, 57.19it/s]backtest loop:  46%|████▋     | 451/971 [00:08<00:08, 58.84it/s]backtest loop:  47%|████▋     | 457/971 [00:08<00:09, 55.86it/s]backtest loop:  48%|████▊     | 464/971 [00:08<00:08, 57.69it/s]backtest loop:  49%|████▊     | 471/971 [00:08<00:08, 59.13it/s]backtest loop:  49%|████▉     | 477/971 [00:08<00:08, 55.88it/s]backtest loop:  50%|████▉     | 484/971 [00:08<00:08, 57.93it/s]backtest loop:  50%|█████     | 490/971 [00:08<00:08, 55.86it/s]backtest loop:  51%|█████     | 496/971 [00:08<00:08, 54.43it/s]backtest loop:  52%|█████▏    | 502/971 [00:09<00:08, 54.52it/s]backtest loop:  52%|█████▏    | 508/971 [00:09<00:08, 51.67it/s]backtest loop:  53%|█████▎    | 514/971 [00:09<00:08, 52.74it/s]backtest loop:  54%|█████▎    | 520/971 [00:09<00:08, 53.31it/s]backtest loop:  54%|█████▍    | 526/971 [00:09<00:08, 50.67it/s]backtest loop:  55%|█████▍    | 532/971 [00:09<00:08, 51.99it/s]backtest loop:  55%|█████▌    | 538/971 [00:09<00:08, 52.53it/s]backtest loop:  56%|█████▌    | 544/971 [00:09<00:08, 53.21it/s]backtest loop:  57%|█████▋    | 550/971 [00:10<00:07, 53.85it/s]backtest loop:  57%|█████▋    | 556/971 [00:10<00:08, 50.48it/s]backtest loop:  58%|█████▊    | 562/971 [00:10<00:07, 51.74it/s]backtest loop:  58%|█████▊    | 568/971 [00:10<00:07, 52.78it/s]backtest loop:  59%|█████▉    | 574/971 [00:10<00:07, 53.31it/s]backtest loop:  60%|█████▉    | 580/971 [00:10<00:07, 53.79it/s]backtest loop:  60%|██████    | 586/971 [00:10<00:07, 50.86it/s]backtest loop:  61%|██████    | 592/971 [00:10<00:07, 52.08it/s]backtest loop:  62%|██████▏   | 598/971 [00:10<00:07, 52.72it/s]backtest loop:  62%|██████▏   | 604/971 [00:11<00:06, 53.52it/s]backtest loop:  63%|██████▎   | 610/971 [00:11<00:07, 50.69it/s]backtest loop:  63%|██████▎   | 616/971 [00:11<00:06, 52.00it/s]backtest loop:  64%|██████▍   | 622/971 [00:11<00:06, 52.75it/s]backtest loop:  65%|██████▍   | 628/971 [00:11<00:06, 53.63it/s]backtest loop:  65%|██████▌   | 634/971 [00:11<00:06, 54.12it/s]backtest loop:  66%|██████▌   | 640/971 [00:11<00:06, 50.87it/s]backtest loop:  67%|██████▋   | 646/971 [00:11<00:06, 52.17it/s]backtest loop:  67%|██████▋   | 652/971 [00:11<00:06, 52.94it/s]backtest loop:  68%|██████▊   | 658/971 [00:12<00:05, 53.47it/s]backtest loop:  68%|██████▊   | 664/971 [00:12<00:05, 53.90it/s]backtest loop:  69%|██████▉   | 670/971 [00:12<00:05, 50.84it/s]backtest loop:  70%|██████▉   | 676/971 [00:12<00:05, 51.57it/s]backtest loop:  70%|███████   | 682/971 [00:12<00:05, 52.33it/s]backtest loop:  71%|███████   | 688/971 [00:12<00:05, 52.82it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:05, 50.24it/s]backtest loop:  72%|███████▏  | 700/971 [00:12<00:05, 51.62it/s]backtest loop:  73%|███████▎  | 706/971 [00:12<00:05, 52.53it/s]backtest loop:  73%|███████▎  | 712/971 [00:13<00:04, 53.23it/s]backtest loop:  74%|███████▍  | 718/971 [00:13<00:04, 53.79it/s]backtest loop:  75%|███████▍  | 724/971 [00:13<00:04, 50.95it/s]backtest loop:  75%|███████▌  | 730/971 [00:13<00:04, 52.28it/s]backtest loop:  76%|███████▌  | 736/971 [00:13<00:04, 50.11it/s]backtest loop:  76%|███████▋  | 742/971 [00:13<00:04, 51.34it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 49.32it/s]backtest loop:  78%|███████▊  | 754/971 [00:13<00:04, 51.04it/s]backtest loop:  78%|███████▊  | 760/971 [00:14<00:04, 49.21it/s]backtest loop:  79%|███████▉  | 766/971 [00:14<00:04, 51.12it/s]backtest loop:  80%|███████▉  | 772/971 [00:14<00:03, 53.18it/s]backtest loop:  80%|████████  | 779/971 [00:14<00:03, 55.94it/s]backtest loop:  81%|████████  | 785/971 [00:14<00:03, 53.24it/s]backtest loop:  81%|████████▏ | 791/971 [00:14<00:03, 53.70it/s]backtest loop:  82%|████████▏ | 797/971 [00:14<00:03, 54.10it/s]backtest loop:  83%|████████▎ | 803/971 [00:14<00:03, 51.26it/s]backtest loop:  83%|████████▎ | 809/971 [00:14<00:03, 52.16it/s]backtest loop:  84%|████████▍ | 815/971 [00:15<00:02, 52.83it/s]backtest loop:  85%|████████▍ | 821/971 [00:15<00:02, 53.08it/s]backtest loop:  85%|████████▌ | 827/971 [00:15<00:02, 53.43it/s]backtest loop:  86%|████████▌ | 833/971 [00:15<00:02, 50.55it/s]backtest loop:  86%|████████▋ | 839/971 [00:15<00:02, 51.88it/s]backtest loop:  87%|████████▋ | 845/971 [00:15<00:02, 52.66it/s]backtest loop:  88%|████████▊ | 851/971 [00:15<00:02, 53.25it/s]backtest loop:  88%|████████▊ | 857/971 [00:15<00:02, 50.40it/s]backtest loop:  89%|████████▉ | 863/971 [00:16<00:02, 51.90it/s]backtest loop:  89%|████████▉ | 869/971 [00:16<00:01, 52.80it/s]backtest loop:  90%|█████████ | 875/971 [00:16<00:01, 53.46it/s]backtest loop:  91%|█████████ | 881/971 [00:16<00:01, 53.87it/s]backtest loop:  91%|█████████▏| 887/971 [00:16<00:01, 50.94it/s]backtest loop:  92%|█████████▏| 893/971 [00:16<00:01, 51.85it/s]backtest loop:  93%|█████████▎| 899/971 [00:16<00:01, 52.78it/s]backtest loop:  93%|█████████▎| 905/971 [00:16<00:01, 53.27it/s]backtest loop:  94%|█████████▍| 911/971 [00:16<00:01, 53.79it/s]backtest loop:  94%|█████████▍| 917/971 [00:17<00:01, 51.02it/s]backtest loop:  95%|█████████▌| 923/971 [00:17<00:00, 52.09it/s]backtest loop:  96%|█████████▌| 929/971 [00:17<00:00, 52.69it/s]backtest loop:  96%|█████████▋| 935/971 [00:17<00:00, 53.25it/s]backtest loop:  97%|█████████▋| 941/971 [00:17<00:00, 50.21it/s]backtest loop:  98%|█████████▊| 947/971 [00:17<00:00, 50.75it/s]backtest loop:  98%|█████████▊| 953/971 [00:17<00:00, 51.29it/s]backtest loop:  99%|█████████▉| 959/971 [00:17<00:00, 52.07it/s]backtest loop:  99%|█████████▉| 965/971 [00:17<00:00, 49.77it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 51.20it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 53.68it/s]
[2955773:MainThread](2024-04-25 00:14:45,619) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000272
std                0.004750
annualized_return  0.064843
information_ratio  0.884838
max_drawdown      -0.089428
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000080
std                0.004751
annualized_return  0.019106
information_ratio  0.260651
max_drawdown      -0.122941
[2955773:MainThread](2024-04-25 00:14:45,635) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 3 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464,
                                                    0.019105634311371505],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314,
                                                    0.2606514610551633],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274,
                                               -0.12294148723484218],
 'IC': [0.027428014568116936, 0.02918433457730239, 0.02841997940888336],
 'ICIR': [0.2387005207618663, 0.26166720227076895, 0.26074474219927596],
 'Rank IC': [0.017899936121617426, 0.023050650417454972, 0.021150826288890614],
 'Rank ICIR': [0.15498014880934224, 0.2092031518636296, 0.2079182482330708],
 'mae': [0.6861302852630615, 0.6859831809997559, 0.686088502407074],
 'mse': [0.9973626136779785, 0.9971274733543396, 0.9974362850189209]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-25 00:14:46,940) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-25 00:14:46,940) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:18, 11.71s/it]epoch:   2%|▏         | 2/100 [00:22<18:23, 11.26s/it]epoch:   3%|▎         | 3/100 [00:33<18:12, 11.27s/it]epoch:   4%|▍         | 4/100 [00:45<17:55, 11.21s/it]epoch:   5%|▌         | 5/100 [00:56<17:37, 11.13s/it]epoch:   6%|▌         | 6/100 [01:06<17:19, 11.06s/it]epoch:   7%|▋         | 7/100 [01:17<17:04, 11.02s/it]epoch:   8%|▊         | 8/100 [01:29<17:00, 11.09s/it]epoch:   9%|▉         | 9/100 [01:40<16:54, 11.15s/it]epoch:  10%|█         | 10/100 [01:51<16:39, 11.10s/it]epoch:  11%|█         | 11/100 [02:02<16:21, 11.03s/it]epoch:  12%|█▏        | 12/100 [02:13<16:09, 11.01s/it]epoch:  13%|█▎        | 13/100 [02:24<16:04, 11.09s/it]epoch:  14%|█▍        | 14/100 [02:35<15:59, 11.15s/it]epoch:  15%|█▌        | 15/100 [02:46<15:44, 11.11s/it]epoch:  16%|█▌        | 16/100 [02:57<15:27, 11.05s/it]epoch:  17%|█▋        | 17/100 [03:08<15:14, 11.02s/it]epoch:  18%|█▊        | 18/100 [03:19<15:06, 11.06s/it]epoch:  19%|█▉        | 19/100 [03:31<15:02, 11.15s/it]epoch:  20%|██        | 20/100 [03:42<14:49, 11.12s/it]0.0507205125914345
best ic: 0.0507205125914345
epoch:  21%|██        | 21/100 [03:54<15:10, 11.53s/it]0.05147781743920491
best ic: 0.05147781743920491
epoch:  22%|██▏       | 22/100 [04:07<15:21, 11.81s/it]0.049852528387373606
epoch:  23%|██▎       | 23/100 [04:20<15:34, 12.13s/it]0.05238026452418256
best ic: 0.05238026452418256
epoch:  24%|██▍       | 24/100 [04:32<15:38, 12.35s/it]0.0509163532108738
epoch:  25%|██▌       | 25/100 [04:45<15:26, 12.36s/it]0.05271484445924577
best ic: 0.05271484445924577
epoch:  26%|██▌       | 26/100 [04:57<15:15, 12.37s/it]0.0491167278821514
epoch:  27%|██▋       | 27/100 [05:10<15:04, 12.40s/it]0.05131069543798682
epoch:  28%|██▊       | 28/100 [05:23<15:03, 12.55s/it]0.05140224508841572
epoch:  29%|██▉       | 29/100 [05:35<14:56, 12.63s/it]0.050430941619380755
epoch:  30%|███       | 30/100 [05:48<14:40, 12.58s/it]0.05210267708978991
epoch:  31%|███       | 31/100 [06:00<14:24, 12.53s/it]0.054303303172478626
best ic: 0.054303303172478626
epoch:  32%|███▏      | 32/100 [06:13<14:14, 12.57s/it]0.052889764554845856
epoch:  33%|███▎      | 33/100 [06:26<14:10, 12.69s/it]0.05153657682796431
epoch:  34%|███▍      | 34/100 [06:39<13:58, 12.70s/it]0.05160853968488722
epoch:  35%|███▌      | 35/100 [06:51<13:40, 12.62s/it]0.05172384099350812
epoch:  36%|███▌      | 36/100 [07:03<13:23, 12.56s/it]0.05203196753148783
epoch:  37%|███▋      | 37/100 [07:16<13:16, 12.65s/it]0.05011747634831945
epoch:  38%|███▊      | 38/100 [07:29<13:09, 12.73s/it]0.05325337914574737
epoch:  39%|███▉      | 39/100 [07:42<12:52, 12.66s/it]0.048334417548386396
epoch:  39%|███▉      | 39/100 [07:54<12:22, 12.17s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 00:22:41,572) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 00:22:41,588) INFO - qlib.workflow - [recorder.py:341] - Recorder 42d91d3e4fa74694991350b8d2fdd661 starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 10.68it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.57it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.58it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.67it/s]online:  16%|█▌        | 10/63 [00:00<00:05, 10.60it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.65it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.63it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.60it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.65it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.64it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.66it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.66it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.63it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.64it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.64it/s]online:  51%|█████     | 32/63 [00:03<00:02, 10.64it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.59it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.62it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.69it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.59it/s]online:  67%|██████▋   | 42/63 [00:03<00:01, 10.69it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.64it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.68it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.63it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.62it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.64it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.63it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.65it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.64it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.64it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.64it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.65it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 00:22:58,084) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9972577 mae 0.68603104
{'IC': 0.028899194346999706,
 'ICIR': 0.25816670056249374,
 'Rank IC': 0.021484763144688775,
 'Rank ICIR': 0.19117984399097265}
[2955773:MainThread](2024-04-25 00:22:59,927) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 00:23:14,747) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:23:14,750) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:23:20,834) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0fa3fc62e0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:43,  9.31it/s]backtest loop:   1%|          | 9/971 [00:00<00:38, 24.84it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:26, 35.46it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 40.51it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:20, 45.90it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 48.05it/s]backtest loop:   4%|▍         | 40/971 [00:00<00:18, 50.95it/s]backtest loop:   5%|▍         | 47/971 [00:01<00:16, 54.54it/s]backtest loop:   5%|▌         | 53/971 [00:01<00:16, 55.41it/s]backtest loop:   6%|▌         | 59/971 [00:01<00:17, 53.21it/s]backtest loop:   7%|▋         | 66/971 [00:01<00:16, 56.15it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 53.97it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:15, 56.41it/s]backtest loop:   9%|▉         | 86/971 [00:01<00:15, 58.40it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 56.41it/s]backtest loop:  10%|█         | 99/971 [00:02<00:14, 58.18it/s]backtest loop:  11%|█         | 106/971 [00:02<00:14, 59.38it/s]backtest loop:  12%|█▏        | 112/971 [00:02<00:15, 56.37it/s]backtest loop:  12%|█▏        | 119/971 [00:02<00:14, 58.62it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:15, 55.82it/s]backtest loop:  13%|█▎        | 131/971 [00:02<00:15, 53.96it/s]backtest loop:  14%|█▍        | 137/971 [00:02<00:15, 55.42it/s]backtest loop:  15%|█▍        | 143/971 [00:02<00:14, 56.65it/s]backtest loop:  15%|█▌        | 149/971 [00:02<00:14, 57.32it/s]backtest loop:  16%|█▌        | 156/971 [00:03<00:14, 55.20it/s]backtest loop:  17%|█▋        | 162/971 [00:03<00:14, 56.39it/s]backtest loop:  17%|█▋        | 169/971 [00:03<00:13, 58.37it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:13, 58.58it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:14, 55.35it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:13, 57.58it/s]backtest loop:  20%|██        | 195/971 [00:03<00:13, 55.93it/s]backtest loop:  21%|██        | 202/971 [00:03<00:13, 57.61it/s]backtest loop:  21%|██▏       | 208/971 [00:03<00:13, 58.10it/s]backtest loop:  22%|██▏       | 214/971 [00:04<00:13, 55.77it/s]backtest loop:  23%|██▎       | 220/971 [00:04<00:13, 53.90it/s]backtest loop:  23%|██▎       | 226/971 [00:04<00:13, 55.39it/s]backtest loop:  24%|██▍       | 233/971 [00:04<00:12, 57.90it/s]backtest loop:  25%|██▍       | 239/971 [00:04<00:12, 58.43it/s]backtest loop:  25%|██▌       | 245/971 [00:04<00:13, 55.63it/s]backtest loop:  26%|██▌       | 252/971 [00:04<00:12, 57.68it/s]backtest loop:  27%|██▋       | 259/971 [00:04<00:12, 55.89it/s]backtest loop:  27%|██▋       | 266/971 [00:04<00:12, 55.11it/s]backtest loop:  28%|██▊       | 272/971 [00:05<00:12, 56.16it/s]backtest loop:  29%|██▊       | 279/971 [00:05<00:11, 57.88it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:12, 55.90it/s]backtest loop:  30%|███       | 293/971 [00:05<00:11, 57.81it/s]backtest loop:  31%|███       | 300/971 [00:05<00:12, 55.91it/s]backtest loop:  32%|███▏      | 306/971 [00:05<00:11, 56.83it/s]backtest loop:  32%|███▏      | 313/971 [00:05<00:11, 58.80it/s]backtest loop:  33%|███▎      | 319/971 [00:05<00:11, 59.03it/s]backtest loop:  33%|███▎      | 325/971 [00:05<00:11, 55.98it/s]backtest loop:  34%|███▍      | 331/971 [00:06<00:11, 56.92it/s]backtest loop:  35%|███▍      | 337/971 [00:06<00:11, 57.60it/s]backtest loop:  35%|███▌      | 343/971 [00:06<00:10, 57.78it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:11, 56.17it/s]backtest loop:  37%|███▋      | 357/971 [00:06<00:10, 58.21it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 56.14it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 53.65it/s]backtest loop:  39%|███▊      | 376/971 [00:06<00:10, 56.33it/s]backtest loop:  39%|███▉      | 383/971 [00:07<00:10, 54.97it/s]backtest loop:  40%|████      | 390/971 [00:07<00:10, 56.99it/s]backtest loop:  41%|████      | 397/971 [00:07<00:09, 58.61it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 55.48it/s]backtest loop:  42%|████▏     | 409/971 [00:07<00:09, 56.66it/s]backtest loop:  43%|████▎     | 415/971 [00:07<00:09, 57.20it/s]backtest loop:  43%|████▎     | 422/971 [00:07<00:09, 58.64it/s]backtest loop:  44%|████▍     | 428/971 [00:07<00:09, 55.75it/s]backtest loop:  45%|████▍     | 434/971 [00:07<00:09, 56.62it/s]backtest loop:  45%|████▌     | 441/971 [00:08<00:09, 58.27it/s]backtest loop:  46%|████▌     | 447/971 [00:08<00:09, 55.30it/s]backtest loop:  47%|████▋     | 454/971 [00:08<00:09, 57.32it/s]backtest loop:  47%|████▋     | 460/971 [00:08<00:08, 57.91it/s]backtest loop:  48%|████▊     | 466/971 [00:08<00:08, 58.42it/s]backtest loop:  49%|████▊     | 472/971 [00:08<00:08, 55.56it/s]backtest loop:  49%|████▉     | 479/971 [00:08<00:08, 58.08it/s]backtest loop:  50%|█████     | 486/971 [00:08<00:08, 59.90it/s]backtest loop:  51%|█████     | 493/971 [00:08<00:08, 57.87it/s]backtest loop:  51%|█████▏    | 500/971 [00:09<00:08, 56.19it/s]backtest loop:  52%|█████▏    | 507/971 [00:09<00:08, 55.86it/s]backtest loop:  53%|█████▎    | 514/971 [00:09<00:07, 57.81it/s]backtest loop:  54%|█████▎    | 521/971 [00:09<00:07, 59.24it/s]backtest loop:  54%|█████▍    | 527/971 [00:09<00:07, 56.38it/s]backtest loop:  55%|█████▍    | 534/971 [00:09<00:07, 58.16it/s]backtest loop:  56%|█████▌    | 541/971 [00:09<00:07, 56.20it/s]backtest loop:  56%|█████▋    | 548/971 [00:09<00:07, 58.15it/s]backtest loop:  57%|█████▋    | 555/971 [00:10<00:07, 59.36it/s]backtest loop:  58%|█████▊    | 561/971 [00:10<00:07, 56.38it/s]backtest loop:  58%|█████▊    | 568/971 [00:10<00:06, 58.06it/s]backtest loop:  59%|█████▉    | 575/971 [00:10<00:06, 59.19it/s]backtest loop:  60%|█████▉    | 581/971 [00:10<00:06, 55.97it/s]backtest loop:  61%|██████    | 588/971 [00:10<00:06, 57.85it/s]backtest loop:  61%|██████▏   | 595/971 [00:10<00:06, 59.12it/s]backtest loop:  62%|██████▏   | 601/971 [00:10<00:06, 55.48it/s]backtest loop:  63%|██████▎   | 607/971 [00:10<00:06, 56.66it/s]backtest loop:  63%|██████▎   | 613/971 [00:11<00:06, 57.53it/s]backtest loop:  64%|██████▍   | 620/971 [00:11<00:06, 55.70it/s]backtest loop:  65%|██████▍   | 627/971 [00:11<00:05, 58.07it/s]backtest loop:  65%|██████▌   | 634/971 [00:11<00:05, 59.40it/s]backtest loop:  66%|██████▌   | 640/971 [00:11<00:05, 56.60it/s]backtest loop:  67%|██████▋   | 646/971 [00:11<00:05, 57.42it/s]backtest loop:  67%|██████▋   | 653/971 [00:11<00:05, 59.08it/s]backtest loop:  68%|██████▊   | 660/971 [00:11<00:05, 56.82it/s]backtest loop:  69%|██████▊   | 667/971 [00:11<00:05, 58.32it/s]backtest loop:  69%|██████▉   | 673/971 [00:12<00:05, 58.74it/s]backtest loop:  70%|██████▉   | 679/971 [00:12<00:05, 55.94it/s]backtest loop:  71%|███████   | 685/971 [00:12<00:05, 56.97it/s]backtest loop:  71%|███████   | 691/971 [00:12<00:04, 57.50it/s]backtest loop:  72%|███████▏  | 698/971 [00:12<00:04, 58.94it/s]backtest loop:  73%|███████▎  | 704/971 [00:12<00:04, 56.15it/s]backtest loop:  73%|███████▎  | 711/971 [00:12<00:04, 57.99it/s]backtest loop:  74%|███████▍  | 718/971 [00:12<00:04, 59.30it/s]backtest loop:  75%|███████▍  | 724/971 [00:12<00:04, 56.42it/s]backtest loop:  75%|███████▌  | 731/971 [00:13<00:04, 55.39it/s]backtest loop:  76%|███████▌  | 738/971 [00:13<00:04, 54.29it/s]backtest loop:  77%|███████▋  | 745/971 [00:13<00:03, 56.63it/s]backtest loop:  77%|███████▋  | 751/971 [00:13<00:04, 54.82it/s]backtest loop:  78%|███████▊  | 757/971 [00:13<00:03, 56.07it/s]backtest loop:  79%|███████▊  | 763/971 [00:13<00:03, 57.09it/s]backtest loop:  79%|███████▉  | 770/971 [00:13<00:03, 56.37it/s]backtest loop:  80%|████████  | 777/971 [00:13<00:03, 58.90it/s]backtest loop:  81%|████████  | 783/971 [00:14<00:03, 56.51it/s]backtest loop:  81%|████████▏ | 790/971 [00:14<00:03, 58.23it/s]backtest loop:  82%|████████▏ | 797/971 [00:14<00:02, 59.74it/s]backtest loop:  83%|████████▎ | 803/971 [00:14<00:02, 56.80it/s]backtest loop:  83%|████████▎ | 809/971 [00:14<00:02, 57.65it/s]backtest loop:  84%|████████▍ | 816/971 [00:14<00:02, 59.43it/s]backtest loop:  85%|████████▍ | 823/971 [00:14<00:02, 57.05it/s]backtest loop:  85%|████████▌ | 830/971 [00:14<00:02, 58.39it/s]backtest loop:  86%|████████▌ | 837/971 [00:14<00:02, 59.70it/s]backtest loop:  87%|████████▋ | 843/971 [00:15<00:02, 56.51it/s]backtest loop:  88%|████████▊ | 850/971 [00:15<00:02, 58.15it/s]backtest loop:  88%|████████▊ | 857/971 [00:15<00:02, 56.15it/s]backtest loop:  89%|████████▉ | 864/971 [00:15<00:01, 58.08it/s]backtest loop:  90%|████████▉ | 871/971 [00:15<00:01, 59.28it/s]backtest loop:  90%|█████████ | 877/971 [00:15<00:01, 56.19it/s]backtest loop:  91%|█████████ | 884/971 [00:15<00:01, 58.23it/s]backtest loop:  92%|█████████▏| 890/971 [00:15<00:01, 58.70it/s]backtest loop:  92%|█████████▏| 897/971 [00:15<00:01, 56.79it/s]backtest loop:  93%|█████████▎| 904/971 [00:16<00:01, 58.30it/s]backtest loop:  94%|█████████▍| 911/971 [00:16<00:01, 59.60it/s]backtest loop:  94%|█████████▍| 917/971 [00:16<00:00, 56.48it/s]backtest loop:  95%|█████████▌| 923/971 [00:16<00:00, 57.24it/s]backtest loop:  96%|█████████▌| 930/971 [00:16<00:00, 58.83it/s]backtest loop:  96%|█████████▋| 936/971 [00:16<00:00, 55.91it/s]backtest loop:  97%|█████████▋| 943/971 [00:16<00:00, 57.95it/s]backtest loop:  98%|█████████▊| 950/971 [00:16<00:00, 56.06it/s]backtest loop:  99%|█████████▊| 957/971 [00:17<00:00, 57.85it/s]backtest loop:  99%|█████████▉| 964/971 [00:17<00:00, 59.33it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 56.06it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 56.25it/s]
[2955773:MainThread](2024-04-25 00:23:38,171) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000535
std                0.004584
annualized_return  0.127405
information_ratio  1.801529
max_drawdown      -0.065195
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000343
std                0.004586
annualized_return  0.081619
information_ratio  1.153760
max_drawdown      -0.071682
[2955773:MainThread](2024-04-25 00:23:38,188) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 4 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464,
                                                    0.019105634311371505,
                                                    0.0816192178944375],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314,
                                                    0.2606514610551633,
                                                    1.1537603040229327],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274,
                                               -0.12294148723484218,
                                               -0.07168188587056515],
 'IC': [0.027428014568116936,
        0.02918433457730239,
        0.02841997940888336,
        0.028899194346999706],
 'ICIR': [0.2387005207618663,
          0.26166720227076895,
          0.26074474219927596,
          0.25816670056249374],
 'Rank IC': [0.017899936121617426,
             0.023050650417454972,
             0.021150826288890614,
             0.021484763144688775],
 'Rank ICIR': [0.15498014880934224,
               0.2092031518636296,
               0.2079182482330708,
               0.19117984399097265],
 'mae': [0.6861302852630615,
         0.6859831809997559,
         0.686088502407074,
         0.6860310435295105],
 'mse': [0.9973626136779785,
         0.9971274733543396,
         0.9974362850189209,
         0.9972577095031738]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-25 00:23:39,470) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-25 00:23:39,470) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:17, 11.69s/it]epoch:   2%|▏         | 2/100 [00:22<18:22, 11.25s/it]epoch:   3%|▎         | 3/100 [00:33<18:09, 11.23s/it]epoch:   4%|▍         | 4/100 [00:45<17:56, 11.22s/it]epoch:   5%|▌         | 5/100 [00:55<17:34, 11.09s/it]epoch:   6%|▌         | 6/100 [01:06<17:14, 11.00s/it]epoch:   7%|▋         | 7/100 [01:17<17:01, 10.98s/it]epoch:   8%|▊         | 8/100 [01:28<16:56, 11.05s/it]epoch:   9%|▉         | 9/100 [01:40<16:50, 11.11s/it]epoch:  10%|█         | 10/100 [01:51<16:35, 11.06s/it]epoch:  11%|█         | 11/100 [02:01<16:18, 11.00s/it]epoch:  12%|█▏        | 12/100 [02:12<16:04, 10.96s/it]epoch:  13%|█▎        | 13/100 [02:24<16:02, 11.07s/it]epoch:  14%|█▍        | 14/100 [02:35<15:57, 11.14s/it]epoch:  15%|█▌        | 15/100 [02:46<15:44, 11.11s/it]epoch:  16%|█▌        | 16/100 [02:57<15:26, 11.03s/it]epoch:  17%|█▋        | 17/100 [03:08<15:12, 10.99s/it]epoch:  18%|█▊        | 18/100 [03:19<15:04, 11.04s/it]epoch:  19%|█▉        | 19/100 [03:30<15:01, 11.13s/it]epoch:  20%|██        | 20/100 [03:41<14:51, 11.15s/it]0.05050730347644039
best ic: 0.05050730347644039
epoch:  21%|██        | 21/100 [03:54<15:12, 11.55s/it]0.05203708290084269
best ic: 0.05203708290084269
epoch:  22%|██▏       | 22/100 [04:06<15:17, 11.77s/it]0.0515340958810977
epoch:  23%|██▎       | 23/100 [04:19<15:22, 11.98s/it]0.05106676087792174
epoch:  24%|██▍       | 24/100 [04:32<15:31, 12.26s/it]0.0528826022112836
best ic: 0.0528826022112836
epoch:  25%|██▌       | 25/100 [04:44<15:25, 12.34s/it]0.051709934406790135
epoch:  26%|██▌       | 26/100 [04:57<15:15, 12.38s/it]0.05353954645980921
best ic: 0.05353954645980921
epoch:  27%|██▋       | 27/100 [05:09<15:03, 12.38s/it]0.05070099021503245
epoch:  28%|██▊       | 28/100 [05:22<14:57, 12.47s/it]0.055532426304477626
best ic: 0.055532426304477626
epoch:  29%|██▉       | 29/100 [05:35<14:59, 12.67s/it]0.05135251455591481
epoch:  30%|███       | 30/100 [05:47<14:43, 12.62s/it]0.05562090091244873
best ic: 0.05562090091244873
epoch:  31%|███       | 31/100 [06:00<14:26, 12.56s/it]0.05580813760991016
best ic: 0.05580813760991016
epoch:  32%|███▏      | 32/100 [06:12<14:12, 12.53s/it]0.05590591431823232
best ic: 0.05590591431823232
epoch:  33%|███▎      | 33/100 [06:25<14:03, 12.59s/it]0.05236888669247192
epoch:  34%|███▍      | 34/100 [06:38<13:59, 12.72s/it]0.05392513265093506
epoch:  35%|███▌      | 35/100 [06:50<13:43, 12.67s/it]0.05284328813220555
epoch:  36%|███▌      | 36/100 [07:03<13:27, 12.62s/it]0.05269731798948076
epoch:  37%|███▋      | 37/100 [07:15<13:11, 12.56s/it]0.05245999039308658
epoch:  38%|███▊      | 38/100 [07:28<13:04, 12.65s/it]0.05216420207977164
epoch:  39%|███▉      | 39/100 [07:41<12:58, 12.77s/it]0.05473584357558817
epoch:  40%|████      | 40/100 [07:54<12:43, 12.72s/it]0.05521540619630462
epoch:  40%|████      | 40/100 [08:06<12:10, 12.17s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 00:31:46,484) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 00:31:46,500) INFO - qlib.workflow - [recorder.py:341] - Recorder 0bdc450237ea431f80f7a0cbb540e3f1 starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 10.91it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.68it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.65it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.62it/s]online:  16%|█▌        | 10/63 [00:00<00:04, 10.61it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.67it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.63it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.66it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.62it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.63it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.60it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.65it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.65it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.67it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.75it/s]online:  51%|█████     | 32/63 [00:03<00:02, 10.65it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.63it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.66it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.64it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.67it/s]online:  67%|██████▋   | 42/63 [00:03<00:01, 10.68it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.63it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.67it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.66it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.66it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.65it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.65it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.65it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.69it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.68it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.63it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.67it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 00:32:03,993) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9972613 mae 0.6860297
{'IC': 0.028319585873825204,
 'ICIR': 0.25939505641981636,
 'Rank IC': 0.021629620551719252,
 'Rank ICIR': 0.2027589236785842}
[2955773:MainThread](2024-04-25 00:32:05,860) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 00:32:20,848) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:32:20,851) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:32:27,020) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0fae718cd0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:41,  9.55it/s]backtest loop:   1%|          | 9/971 [00:00<00:39, 24.57it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:27, 34.56it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:24, 38.28it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:21, 43.30it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:19, 47.03it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:20, 46.34it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:18, 49.46it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 50.97it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 49.39it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:17, 50.87it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:17, 52.69it/s]backtest loop:   8%|▊         | 75/971 [00:01<00:16, 53.55it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:16, 53.67it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:17, 50.69it/s]backtest loop:  10%|▉         | 93/971 [00:02<00:16, 52.26it/s]backtest loop:  10%|█         | 99/971 [00:02<00:16, 52.95it/s]backtest loop:  11%|█         | 105/971 [00:02<00:16, 53.42it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:15, 53.97it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:16, 50.40it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:16, 51.27it/s]backtest loop:  13%|█▎        | 129/971 [00:02<00:17, 48.93it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:16, 50.56it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:17, 48.79it/s]backtest loop:  15%|█▌        | 147/971 [00:03<00:16, 50.65it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:15, 51.59it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:15, 52.45it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:15, 53.39it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:15, 50.72it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:15, 51.98it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:14, 52.60it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:14, 53.29it/s]backtest loop:  20%|██        | 195/971 [00:04<00:15, 50.71it/s]backtest loop:  21%|██        | 201/971 [00:04<00:14, 51.63it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:14, 52.41it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:15, 50.11it/s]backtest loop:  23%|██▎       | 219/971 [00:04<00:14, 51.48it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:15, 49.21it/s]backtest loop:  24%|██▍       | 231/971 [00:04<00:14, 50.79it/s]backtest loop:  24%|██▍       | 237/971 [00:04<00:14, 52.00it/s]backtest loop:  25%|██▌       | 243/971 [00:04<00:14, 51.66it/s]backtest loop:  26%|██▌       | 249/971 [00:05<00:14, 51.10it/s]backtest loop:  26%|██▋       | 256/971 [00:05<00:13, 54.46it/s]backtest loop:  27%|██▋       | 263/971 [00:05<00:12, 57.06it/s]backtest loop:  28%|██▊       | 269/971 [00:05<00:12, 54.74it/s]backtest loop:  28%|██▊       | 275/971 [00:05<00:12, 55.99it/s]backtest loop:  29%|██▉       | 281/971 [00:05<00:12, 54.07it/s]backtest loop:  30%|██▉       | 288/971 [00:05<00:12, 56.33it/s]backtest loop:  30%|███       | 295/971 [00:05<00:12, 55.10it/s]backtest loop:  31%|███       | 302/971 [00:05<00:11, 57.13it/s]backtest loop:  32%|███▏      | 308/971 [00:06<00:11, 57.78it/s]backtest loop:  32%|███▏      | 315/971 [00:06<00:11, 55.93it/s]backtest loop:  33%|███▎      | 322/971 [00:06<00:11, 57.74it/s]backtest loop:  34%|███▍      | 328/971 [00:06<00:11, 58.30it/s]backtest loop:  34%|███▍      | 334/971 [00:06<00:10, 58.58it/s]backtest loop:  35%|███▌      | 340/971 [00:06<00:11, 55.67it/s]backtest loop:  36%|███▌      | 346/971 [00:06<00:11, 56.76it/s]backtest loop:  36%|███▋      | 353/971 [00:06<00:10, 58.37it/s]backtest loop:  37%|███▋      | 360/971 [00:07<00:10, 56.71it/s]backtest loop:  38%|███▊      | 367/971 [00:07<00:10, 56.09it/s]backtest loop:  38%|███▊      | 373/971 [00:07<00:11, 54.26it/s]backtest loop:  39%|███▉      | 379/971 [00:07<00:10, 55.49it/s]backtest loop:  40%|███▉      | 386/971 [00:07<00:10, 57.54it/s]backtest loop:  40%|████      | 393/971 [00:07<00:10, 55.93it/s]backtest loop:  41%|████      | 400/971 [00:07<00:09, 58.04it/s]backtest loop:  42%|████▏     | 406/971 [00:07<00:09, 58.26it/s]backtest loop:  42%|████▏     | 412/971 [00:07<00:09, 58.71it/s]backtest loop:  43%|████▎     | 418/971 [00:08<00:09, 55.99it/s]backtest loop:  44%|████▍     | 425/971 [00:08<00:09, 57.82it/s]backtest loop:  44%|████▍     | 431/971 [00:08<00:09, 58.23it/s]backtest loop:  45%|████▌     | 437/971 [00:08<00:09, 55.20it/s]backtest loop:  46%|████▌     | 443/971 [00:08<00:09, 56.27it/s]backtest loop:  46%|████▌     | 449/971 [00:08<00:09, 57.09it/s]backtest loop:  47%|████▋     | 455/971 [00:08<00:08, 57.76it/s]backtest loop:  48%|████▊     | 462/971 [00:08<00:09, 55.81it/s]backtest loop:  48%|████▊     | 468/971 [00:08<00:08, 56.69it/s]backtest loop:  49%|████▉     | 474/971 [00:09<00:08, 57.47it/s]backtest loop:  50%|████▉     | 481/971 [00:09<00:08, 59.35it/s]backtest loop:  50%|█████     | 487/971 [00:09<00:08, 56.45it/s]backtest loop:  51%|█████     | 494/971 [00:09<00:08, 58.43it/s]backtest loop:  51%|█████▏    | 500/971 [00:09<00:08, 55.38it/s]backtest loop:  52%|█████▏    | 507/971 [00:09<00:08, 54.55it/s]backtest loop:  53%|█████▎    | 514/971 [00:09<00:08, 56.94it/s]backtest loop:  54%|█████▎    | 521/971 [00:09<00:07, 58.47it/s]backtest loop:  54%|█████▍    | 527/971 [00:09<00:07, 56.28it/s]backtest loop:  55%|█████▍    | 534/971 [00:10<00:07, 57.96it/s]backtest loop:  56%|█████▌    | 540/971 [00:10<00:07, 58.44it/s]backtest loop:  56%|█████▌    | 546/971 [00:10<00:07, 55.32it/s]backtest loop:  57%|█████▋    | 553/971 [00:10<00:07, 57.38it/s]backtest loop:  58%|█████▊    | 560/971 [00:10<00:06, 58.83it/s]backtest loop:  58%|█████▊    | 566/971 [00:10<00:07, 55.99it/s]backtest loop:  59%|█████▉    | 573/971 [00:10<00:06, 57.89it/s]backtest loop:  60%|█████▉    | 579/971 [00:10<00:06, 58.29it/s]backtest loop:  60%|██████    | 586/971 [00:10<00:06, 56.13it/s]backtest loop:  61%|██████    | 592/971 [00:11<00:06, 57.11it/s]backtest loop:  62%|██████▏   | 599/971 [00:11<00:06, 58.63it/s]backtest loop:  62%|██████▏   | 605/971 [00:11<00:06, 55.91it/s]backtest loop:  63%|██████▎   | 611/971 [00:11<00:06, 56.89it/s]backtest loop:  64%|██████▎   | 618/971 [00:11<00:06, 58.55it/s]backtest loop:  64%|██████▍   | 625/971 [00:11<00:06, 56.45it/s]backtest loop:  65%|██████▌   | 632/971 [00:11<00:05, 58.77it/s]backtest loop:  66%|██████▌   | 638/971 [00:11<00:05, 58.87it/s]backtest loop:  66%|██████▋   | 644/971 [00:11<00:05, 58.98it/s]backtest loop:  67%|██████▋   | 650/971 [00:12<00:05, 56.11it/s]backtest loop:  68%|██████▊   | 657/971 [00:12<00:05, 58.16it/s]backtest loop:  68%|██████▊   | 663/971 [00:12<00:05, 57.93it/s]backtest loop:  69%|██████▉   | 670/971 [00:12<00:05, 55.87it/s]backtest loop:  70%|██████▉   | 676/971 [00:12<00:05, 56.71it/s]backtest loop:  70%|███████   | 682/971 [00:12<00:05, 57.60it/s]backtest loop:  71%|███████   | 688/971 [00:12<00:04, 58.00it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:05, 55.01it/s]backtest loop:  72%|███████▏  | 701/971 [00:12<00:04, 57.16it/s]backtest loop:  73%|███████▎  | 707/971 [00:13<00:04, 57.65it/s]backtest loop:  73%|███████▎  | 713/971 [00:13<00:04, 58.04it/s]backtest loop:  74%|███████▍  | 719/971 [00:13<00:04, 55.27it/s]backtest loop:  75%|███████▍  | 726/971 [00:13<00:04, 57.47it/s]backtest loop:  75%|███████▌  | 732/971 [00:13<00:04, 55.14it/s]backtest loop:  76%|███████▌  | 738/971 [00:13<00:04, 53.45it/s]backtest loop:  77%|███████▋  | 745/971 [00:13<00:04, 55.94it/s]backtest loop:  77%|███████▋  | 751/971 [00:13<00:04, 53.94it/s]backtest loop:  78%|███████▊  | 758/971 [00:13<00:03, 56.75it/s]backtest loop:  79%|███████▉  | 765/971 [00:14<00:03, 55.78it/s]backtest loop:  80%|███████▉  | 772/971 [00:14<00:03, 58.51it/s]backtest loop:  80%|████████  | 779/971 [00:14<00:03, 60.09it/s]backtest loop:  81%|████████  | 786/971 [00:14<00:03, 57.73it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 55.87it/s]backtest loop:  82%|████████▏ | 800/971 [00:14<00:02, 57.78it/s]backtest loop:  83%|████████▎ | 807/971 [00:14<00:02, 58.98it/s]backtest loop:  84%|████████▎ | 813/971 [00:14<00:02, 55.11it/s]backtest loop:  84%|████████▍ | 819/971 [00:15<00:02, 56.04it/s]backtest loop:  85%|████████▌ | 826/971 [00:15<00:02, 57.84it/s]backtest loop:  86%|████████▌ | 833/971 [00:15<00:02, 55.90it/s]backtest loop:  87%|████████▋ | 840/971 [00:15<00:02, 57.67it/s]backtest loop:  87%|████████▋ | 846/971 [00:15<00:02, 57.96it/s]backtest loop:  88%|████████▊ | 852/971 [00:15<00:02, 55.20it/s]backtest loop:  88%|████████▊ | 859/971 [00:15<00:01, 57.19it/s]backtest loop:  89%|████████▉ | 866/971 [00:15<00:01, 58.89it/s]backtest loop:  90%|████████▉ | 872/971 [00:15<00:01, 55.92it/s]backtest loop:  90%|█████████ | 878/971 [00:16<00:01, 56.85it/s]backtest loop:  91%|█████████ | 885/971 [00:16<00:01, 58.47it/s]backtest loop:  92%|█████████▏| 891/971 [00:16<00:01, 58.80it/s]backtest loop:  92%|█████████▏| 897/971 [00:16<00:01, 56.19it/s]backtest loop:  93%|█████████▎| 904/971 [00:16<00:01, 57.92it/s]backtest loop:  94%|█████████▍| 911/971 [00:16<00:01, 59.21it/s]backtest loop:  94%|█████████▍| 917/971 [00:16<00:00, 56.10it/s]backtest loop:  95%|█████████▌| 924/971 [00:16<00:00, 57.88it/s]backtest loop:  96%|█████████▌| 931/971 [00:17<00:00, 55.99it/s]backtest loop:  97%|█████████▋| 938/971 [00:17<00:00, 57.97it/s]backtest loop:  97%|█████████▋| 944/971 [00:17<00:00, 58.30it/s]backtest loop:  98%|█████████▊| 950/971 [00:17<00:00, 55.38it/s]backtest loop:  98%|█████████▊| 956/971 [00:17<00:00, 56.53it/s]backtest loop:  99%|█████████▉| 963/971 [00:17<00:00, 58.60it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 56.39it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.81it/s]
[2955773:MainThread](2024-04-25 00:32:44,811) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000410
std                0.004809
annualized_return  0.097631
information_ratio  1.315915
max_drawdown      -0.088022
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000218
std                0.004811
annualized_return  0.051967
information_ratio  0.700210
max_drawdown      -0.104818
[2955773:MainThread](2024-04-25 00:32:44,828) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 5 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464,
                                                    0.019105634311371505,
                                                    0.0816192178944375,
                                                    0.05196743618995587],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314,
                                                    0.2606514610551633,
                                                    1.1537603040229327,
                                                    0.7002100933966647],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274,
                                               -0.12294148723484218,
                                               -0.07168188587056515,
                                               -0.10481767459217074],
 'IC': [0.027428014568116936,
        0.02918433457730239,
        0.02841997940888336,
        0.028899194346999706,
        0.028319585873825204],
 'ICIR': [0.2387005207618663,
          0.26166720227076895,
          0.26074474219927596,
          0.25816670056249374,
          0.25939505641981636],
 'Rank IC': [0.017899936121617426,
             0.023050650417454972,
             0.021150826288890614,
             0.021484763144688775,
             0.021629620551719252],
 'Rank ICIR': [0.15498014880934224,
               0.2092031518636296,
               0.2079182482330708,
               0.19117984399097265,
               0.2027589236785842],
 'mae': [0.6861302852630615,
         0.6859831809997559,
         0.686088502407074,
         0.6860310435295105,
         0.6860296726226807],
 'mse': [0.9973626136779785,
         0.9971274733543396,
         0.9974362850189209,
         0.9972577095031738,
         0.9972612857818604]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-25 00:32:46,123) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-25 00:32:46,123) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:18, 11.71s/it]epoch:   2%|▏         | 2/100 [00:22<18:18, 11.21s/it]epoch:   3%|▎         | 3/100 [00:33<18:07, 11.21s/it]epoch:   4%|▍         | 4/100 [00:45<17:59, 11.25s/it]epoch:   5%|▌         | 5/100 [00:55<17:34, 11.10s/it]epoch:   6%|▌         | 6/100 [01:06<17:16, 11.03s/it]epoch:   7%|▋         | 7/100 [01:17<17:01, 10.98s/it]epoch:   8%|▊         | 8/100 [01:28<16:56, 11.05s/it]epoch:   9%|▉         | 9/100 [01:40<16:53, 11.14s/it]epoch:  10%|█         | 10/100 [01:51<16:40, 11.12s/it]epoch:  11%|█         | 11/100 [02:02<16:22, 11.04s/it]epoch:  12%|█▏        | 12/100 [02:13<16:11, 11.04s/it]epoch:  13%|█▎        | 13/100 [02:24<16:06, 11.11s/it]epoch:  14%|█▍        | 14/100 [02:35<15:58, 11.14s/it]epoch:  15%|█▌        | 15/100 [02:46<15:44, 11.11s/it]epoch:  16%|█▌        | 16/100 [02:57<15:31, 11.09s/it]epoch:  17%|█▋        | 17/100 [03:08<15:17, 11.06s/it]epoch:  18%|█▊        | 18/100 [03:20<15:11, 11.12s/it]epoch:  19%|█▉        | 19/100 [03:31<15:04, 11.17s/it]epoch:  20%|██        | 20/100 [03:42<14:48, 11.11s/it]0.04849517761941628
best ic: 0.04849517761941628
epoch:  21%|██        | 21/100 [03:54<15:14, 11.57s/it]0.047650786310717154
epoch:  22%|██▏       | 22/100 [04:07<15:28, 11.90s/it]0.05011091956129771
best ic: 0.05011091956129771
epoch:  23%|██▎       | 23/100 [04:20<15:38, 12.19s/it]0.049752590035657275
epoch:  24%|██▍       | 24/100 [04:33<15:40, 12.38s/it]0.05133487607187791
best ic: 0.05133487607187791
epoch:  25%|██▌       | 25/100 [04:45<15:30, 12.40s/it]0.04936228660050875
epoch:  26%|██▌       | 26/100 [04:58<15:19, 12.43s/it]0.05288811958522372
best ic: 0.05288811958522372
epoch:  27%|██▋       | 27/100 [05:10<15:11, 12.49s/it]0.050556007764122134
epoch:  28%|██▊       | 28/100 [05:23<15:09, 12.64s/it]0.05409626199160577
best ic: 0.05409626199160577
epoch:  29%|██▉       | 29/100 [05:36<14:58, 12.65s/it]0.05275280142300796
epoch:  30%|███       | 30/100 [05:48<14:41, 12.59s/it]0.053298824073520226
epoch:  31%|███       | 31/100 [06:01<14:26, 12.55s/it]0.05355576792106157
epoch:  32%|███▏      | 32/100 [06:14<14:19, 12.63s/it]0.053911168771236626
epoch:  33%|███▎      | 33/100 [06:27<14:14, 12.75s/it]0.052247294318354905
epoch:  34%|███▍      | 34/100 [06:39<13:59, 12.72s/it]0.05295282468671006
epoch:  35%|███▌      | 35/100 [06:52<13:43, 12.67s/it]0.05248840570206035
epoch:  36%|███▌      | 36/100 [07:04<13:27, 12.62s/it]0.05530939163710518
best ic: 0.05530939163710518
epoch:  37%|███▋      | 37/100 [07:17<13:21, 12.72s/it]0.05392368921772958
epoch:  38%|███▊      | 38/100 [07:30<13:11, 12.77s/it]0.053415953248955476
epoch:  39%|███▉      | 39/100 [07:43<12:53, 12.67s/it]0.05416266559087443
epoch:  40%|████      | 40/100 [07:55<12:36, 12.60s/it]0.052951303809036725
epoch:  41%|████      | 41/100 [08:08<12:25, 12.64s/it]0.05365136319210623
epoch:  42%|████▏     | 42/100 [08:21<12:21, 12.79s/it]0.05405867866483152
epoch:  43%|████▎     | 43/100 [08:34<12:07, 12.76s/it]0.05517252785234895
epoch:  44%|████▍     | 44/100 [08:46<11:49, 12.67s/it]0.05313071054046108
epoch:  44%|████▍     | 44/100 [08:59<11:26, 12.26s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 00:41:45,398) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 00:41:45,414) INFO - qlib.workflow - [recorder.py:341] - Recorder 67b3b7bc88184008bb17f5368fb939a7 starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 10.90it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.77it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.71it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.70it/s]online:  16%|█▌        | 10/63 [00:00<00:04, 10.62it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.70it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.53it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.52it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.45it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.53it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.57it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.57it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.60it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.60it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.60it/s]online:  51%|█████     | 32/63 [00:03<00:02, 10.61it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.62it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.48it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.44it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.49it/s]online:  67%|██████▋   | 42/63 [00:03<00:02, 10.38it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.43it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.42it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.39it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.42it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.49it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.41it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.37it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.49it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.61it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.53it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.54it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 00:42:02,499) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9972525 mae 0.6861464
{'IC': 0.02899478143403294,
 'ICIR': 0.27354621293650927,
 'Rank IC': 0.022469562981714118,
 'Rank ICIR': 0.21744567464166992}
[2955773:MainThread](2024-04-25 00:42:04,430) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 00:42:20,425) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:42:20,428) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:42:26,403) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0fb804f700>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:38,  9.78it/s]backtest loop:   1%|          | 10/971 [00:00<00:34, 27.77it/s]backtest loop:   2%|▏         | 17/971 [00:00<00:25, 36.89it/s]backtest loop:   2%|▏         | 24/971 [00:00<00:22, 42.52it/s]backtest loop:   3%|▎         | 31/971 [00:00<00:19, 48.49it/s]backtest loop:   4%|▍         | 37/971 [00:00<00:18, 51.56it/s]backtest loop:   5%|▍         | 44/971 [00:01<00:17, 52.37it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:16, 55.28it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:17, 53.67it/s]backtest loop:   7%|▋         | 64/971 [00:01<00:15, 56.96it/s]backtest loop:   7%|▋         | 71/971 [00:01<00:15, 59.22it/s]backtest loop:   8%|▊         | 78/971 [00:01<00:15, 57.24it/s]backtest loop:   9%|▉         | 85/971 [00:01<00:15, 58.95it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 57.86it/s]backtest loop:  10%|█         | 99/971 [00:01<00:14, 59.17it/s]backtest loop:  11%|█         | 106/971 [00:02<00:14, 60.22it/s]backtest loop:  12%|█▏        | 113/971 [00:02<00:14, 57.71it/s]backtest loop:  12%|█▏        | 120/971 [00:02<00:14, 58.94it/s]backtest loop:  13%|█▎        | 126/971 [00:02<00:15, 53.24it/s]backtest loop:  14%|█▎        | 133/971 [00:02<00:14, 55.90it/s]backtest loop:  14%|█▍        | 140/971 [00:02<00:14, 57.81it/s]backtest loop:  15%|█▌        | 146/971 [00:02<00:14, 55.27it/s]backtest loop:  16%|█▌        | 153/971 [00:02<00:14, 57.32it/s]backtest loop:  16%|█▋        | 160/971 [00:03<00:13, 59.30it/s]backtest loop:  17%|█▋        | 166/971 [00:03<00:14, 56.43it/s]backtest loop:  18%|█▊        | 173/971 [00:03<00:13, 58.21it/s]backtest loop:  19%|█▊        | 180/971 [00:03<00:13, 59.42it/s]backtest loop:  19%|█▉        | 186/971 [00:03<00:13, 56.55it/s]backtest loop:  20%|█▉        | 193/971 [00:03<00:13, 58.77it/s]backtest loop:  21%|██        | 200/971 [00:03<00:13, 56.83it/s]backtest loop:  21%|██▏       | 207/971 [00:03<00:13, 58.10it/s]backtest loop:  22%|██▏       | 213/971 [00:03<00:13, 55.39it/s]backtest loop:  23%|██▎       | 220/971 [00:04<00:13, 54.60it/s]backtest loop:  23%|██▎       | 227/971 [00:04<00:13, 57.06it/s]backtest loop:  24%|██▍       | 234/971 [00:04<00:12, 58.63it/s]backtest loop:  25%|██▍       | 240/971 [00:04<00:13, 56.20it/s]backtest loop:  25%|██▌       | 246/971 [00:04<00:12, 57.15it/s]backtest loop:  26%|██▌       | 253/971 [00:04<00:12, 58.78it/s]backtest loop:  27%|██▋       | 259/971 [00:04<00:12, 56.01it/s]backtest loop:  27%|██▋       | 266/971 [00:04<00:12, 55.29it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:12, 57.38it/s]backtest loop:  29%|██▉       | 280/971 [00:05<00:11, 58.68it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:12, 55.79it/s]backtest loop:  30%|███       | 292/971 [00:05<00:11, 56.81it/s]backtest loop:  31%|███       | 299/971 [00:05<00:11, 58.90it/s]backtest loop:  31%|███▏      | 305/971 [00:05<00:11, 56.06it/s]backtest loop:  32%|███▏      | 311/971 [00:05<00:11, 57.08it/s]backtest loop:  33%|███▎      | 317/971 [00:05<00:11, 57.66it/s]backtest loop:  33%|███▎      | 324/971 [00:05<00:10, 59.10it/s]backtest loop:  34%|███▍      | 330/971 [00:06<00:11, 55.40it/s]backtest loop:  35%|███▍      | 336/971 [00:06<00:11, 56.50it/s]backtest loop:  35%|███▌      | 343/971 [00:06<00:10, 58.52it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:11, 56.42it/s]backtest loop:  37%|███▋      | 357/971 [00:06<00:10, 58.30it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 56.25it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 54.48it/s]backtest loop:  39%|███▊      | 376/971 [00:06<00:10, 57.00it/s]backtest loop:  39%|███▉      | 382/971 [00:06<00:10, 57.73it/s]backtest loop:  40%|███▉      | 388/971 [00:07<00:10, 55.31it/s]backtest loop:  41%|████      | 395/971 [00:07<00:10, 57.39it/s]backtest loop:  41%|████▏     | 402/971 [00:07<00:09, 58.98it/s]backtest loop:  42%|████▏     | 408/971 [00:07<00:10, 56.13it/s]backtest loop:  43%|████▎     | 414/971 [00:07<00:09, 57.03it/s]backtest loop:  43%|████▎     | 421/971 [00:07<00:09, 58.56it/s]backtest loop:  44%|████▍     | 428/971 [00:07<00:09, 56.48it/s]backtest loop:  45%|████▍     | 435/971 [00:07<00:09, 58.19it/s]backtest loop:  46%|████▌     | 442/971 [00:07<00:09, 56.35it/s]backtest loop:  46%|████▌     | 449/971 [00:08<00:08, 58.05it/s]backtest loop:  47%|████▋     | 456/971 [00:08<00:08, 59.44it/s]backtest loop:  48%|████▊     | 462/971 [00:08<00:09, 56.20it/s]backtest loop:  48%|████▊     | 469/971 [00:08<00:08, 58.10it/s]backtest loop:  49%|████▉     | 476/971 [00:08<00:08, 59.70it/s]backtest loop:  50%|████▉     | 482/971 [00:08<00:08, 56.77it/s]backtest loop:  50%|█████     | 489/971 [00:08<00:08, 58.89it/s]backtest loop:  51%|█████     | 495/971 [00:08<00:08, 56.20it/s]backtest loop:  52%|█████▏    | 502/971 [00:08<00:08, 58.53it/s]backtest loop:  52%|█████▏    | 508/971 [00:09<00:08, 56.06it/s]backtest loop:  53%|█████▎    | 514/971 [00:09<00:08, 57.02it/s]backtest loop:  54%|█████▎    | 521/971 [00:09<00:07, 58.81it/s]backtest loop:  54%|█████▍    | 527/971 [00:09<00:07, 56.31it/s]backtest loop:  55%|█████▍    | 534/971 [00:09<00:07, 58.23it/s]backtest loop:  56%|█████▌    | 541/971 [00:09<00:07, 56.53it/s]backtest loop:  56%|█████▋    | 547/971 [00:09<00:07, 57.11it/s]backtest loop:  57%|█████▋    | 553/971 [00:09<00:07, 57.76it/s]backtest loop:  58%|█████▊    | 560/971 [00:10<00:06, 59.30it/s]backtest loop:  58%|█████▊    | 566/971 [00:10<00:07, 56.23it/s]backtest loop:  59%|█████▉    | 573/971 [00:10<00:06, 58.38it/s]backtest loop:  60%|█████▉    | 580/971 [00:10<00:06, 59.69it/s]backtest loop:  60%|██████    | 586/971 [00:10<00:06, 56.08it/s]backtest loop:  61%|██████    | 593/971 [00:10<00:06, 58.05it/s]backtest loop:  62%|██████▏   | 600/971 [00:10<00:06, 56.35it/s]backtest loop:  63%|██████▎   | 607/971 [00:10<00:06, 58.08it/s]backtest loop:  63%|██████▎   | 614/971 [00:10<00:06, 59.28it/s]backtest loop:  64%|██████▍   | 620/971 [00:11<00:06, 55.97it/s]backtest loop:  65%|██████▍   | 627/971 [00:11<00:05, 58.02it/s]backtest loop:  65%|██████▌   | 633/971 [00:11<00:05, 58.56it/s]backtest loop:  66%|██████▌   | 640/971 [00:11<00:05, 56.33it/s]backtest loop:  67%|██████▋   | 647/971 [00:11<00:05, 57.96it/s]backtest loop:  67%|██████▋   | 653/971 [00:11<00:05, 58.39it/s]backtest loop:  68%|██████▊   | 660/971 [00:11<00:05, 56.52it/s]backtest loop:  69%|██████▊   | 667/971 [00:11<00:05, 58.39it/s]backtest loop:  69%|██████▉   | 674/971 [00:11<00:05, 56.32it/s]backtest loop:  70%|███████   | 680/971 [00:12<00:05, 56.92it/s]backtest loop:  71%|███████   | 686/971 [00:12<00:04, 57.29it/s]backtest loop:  71%|███████▏  | 692/971 [00:12<00:04, 57.85it/s]backtest loop:  72%|███████▏  | 698/971 [00:12<00:04, 58.24it/s]backtest loop:  73%|███████▎  | 704/971 [00:12<00:04, 55.57it/s]backtest loop:  73%|███████▎  | 711/971 [00:12<00:04, 57.74it/s]backtest loop:  74%|███████▍  | 717/971 [00:12<00:04, 57.71it/s]backtest loop:  75%|███████▍  | 724/971 [00:12<00:04, 55.75it/s]backtest loop:  75%|███████▌  | 731/971 [00:13<00:04, 54.84it/s]backtest loop:  76%|███████▌  | 738/971 [00:13<00:04, 54.04it/s]backtest loop:  77%|███████▋  | 745/971 [00:13<00:04, 56.38it/s]backtest loop:  77%|███████▋  | 751/971 [00:13<00:04, 54.08it/s]backtest loop:  78%|███████▊  | 758/971 [00:13<00:03, 56.53it/s]backtest loop:  79%|███████▉  | 765/971 [00:13<00:03, 55.70it/s]backtest loop:  80%|███████▉  | 772/971 [00:13<00:03, 58.47it/s]backtest loop:  80%|████████  | 779/971 [00:13<00:03, 60.24it/s]backtest loop:  81%|████████  | 786/971 [00:13<00:03, 57.67it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 55.92it/s]backtest loop:  82%|████████▏ | 800/971 [00:14<00:02, 57.86it/s]backtest loop:  83%|████████▎ | 807/971 [00:14<00:02, 59.25it/s]backtest loop:  84%|████████▎ | 813/971 [00:14<00:02, 56.55it/s]backtest loop:  84%|████████▍ | 819/971 [00:14<00:02, 57.23it/s]backtest loop:  85%|████████▌ | 826/971 [00:14<00:02, 58.78it/s]backtest loop:  86%|████████▌ | 833/971 [00:14<00:02, 56.65it/s]backtest loop:  87%|████████▋ | 840/971 [00:14<00:02, 58.32it/s]backtest loop:  87%|████████▋ | 847/971 [00:15<00:02, 59.55it/s]backtest loop:  88%|████████▊ | 853/971 [00:15<00:02, 56.14it/s]backtest loop:  89%|████████▊ | 860/971 [00:15<00:01, 57.99it/s]backtest loop:  89%|████████▉ | 867/971 [00:15<00:01, 56.14it/s]backtest loop:  90%|█████████ | 874/971 [00:15<00:01, 57.97it/s]backtest loop:  91%|█████████ | 881/971 [00:15<00:01, 59.25it/s]backtest loop:  91%|█████████▏| 887/971 [00:15<00:01, 55.82it/s]backtest loop:  92%|█████████▏| 894/971 [00:15<00:01, 57.78it/s]backtest loop:  93%|█████████▎| 901/971 [00:15<00:01, 59.23it/s]backtest loop:  93%|█████████▎| 907/971 [00:16<00:01, 56.40it/s]backtest loop:  94%|█████████▍| 914/971 [00:16<00:00, 58.10it/s]backtest loop:  95%|█████████▍| 920/971 [00:16<00:00, 58.44it/s]backtest loop:  95%|█████████▌| 926/971 [00:16<00:00, 55.61it/s]backtest loop:  96%|█████████▌| 933/971 [00:16<00:00, 57.57it/s]backtest loop:  97%|█████████▋| 940/971 [00:16<00:00, 56.00it/s]backtest loop:  98%|█████████▊| 947/971 [00:16<00:00, 57.85it/s]backtest loop:  98%|█████████▊| 953/971 [00:16<00:00, 58.20it/s]backtest loop:  99%|█████████▉| 960/971 [00:16<00:00, 56.24it/s]backtest loop:  99%|█████████▉| 966/971 [00:17<00:00, 57.11it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 56.50it/s]
[2955773:MainThread](2024-04-25 00:42:43,659) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000503
std                0.004462
annualized_return  0.119720
information_ratio  1.739127
max_drawdown      -0.092994
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000309
std                0.004464
annualized_return  0.073644
information_ratio  1.069453
max_drawdown      -0.104158
[2955773:MainThread](2024-04-25 00:42:43,676) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 6 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464,
                                                    0.019105634311371505,
                                                    0.0816192178944375,
                                                    0.05196743618995587,
                                                    0.07364360235459269],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314,
                                                    0.2606514610551633,
                                                    1.1537603040229327,
                                                    0.7002100933966647,
                                                    1.0694534222341312],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274,
                                               -0.12294148723484218,
                                               -0.07168188587056515,
                                               -0.10481767459217074,
                                               -0.10415757904585374],
 'IC': [0.027428014568116936,
        0.02918433457730239,
        0.02841997940888336,
        0.028899194346999706,
        0.028319585873825204,
        0.02899478143403294],
 'ICIR': [0.2387005207618663,
          0.26166720227076895,
          0.26074474219927596,
          0.25816670056249374,
          0.25939505641981636,
          0.27354621293650927],
 'Rank IC': [0.017899936121617426,
             0.023050650417454972,
             0.021150826288890614,
             0.021484763144688775,
             0.021629620551719252,
             0.022469562981714118],
 'Rank ICIR': [0.15498014880934224,
               0.2092031518636296,
               0.2079182482330708,
               0.19117984399097265,
               0.2027589236785842,
               0.21744567464166992],
 'mae': [0.6861302852630615,
         0.6859831809997559,
         0.686088502407074,
         0.6860310435295105,
         0.6860296726226807,
         0.6861463785171509],
 'mse': [0.9973626136779785,
         0.9971274733543396,
         0.9974362850189209,
         0.9972577095031738,
         0.9972612857818604,
         0.9972525238990784]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-25 00:42:44,948) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-25 00:42:44,948) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:17, 11.70s/it]epoch:   2%|▏         | 2/100 [00:22<18:15, 11.17s/it]epoch:   3%|▎         | 3/100 [00:33<17:52, 11.06s/it]epoch:   4%|▍         | 4/100 [00:44<17:52, 11.17s/it]epoch:   5%|▌         | 5/100 [00:56<17:50, 11.27s/it]epoch:   6%|▌         | 6/100 [01:07<17:30, 11.18s/it]epoch:   7%|▋         | 7/100 [01:18<17:14, 11.13s/it]epoch:   8%|▊         | 8/100 [01:29<16:58, 11.07s/it]epoch:   9%|▉         | 9/100 [01:40<16:52, 11.12s/it]epoch:  10%|█         | 10/100 [01:51<16:50, 11.22s/it]epoch:  11%|█         | 11/100 [02:03<16:42, 11.26s/it]epoch:  12%|█▏        | 12/100 [02:14<16:24, 11.19s/it]epoch:  13%|█▎        | 13/100 [02:25<16:07, 11.13s/it]epoch:  14%|█▍        | 14/100 [02:36<15:56, 11.13s/it]epoch:  15%|█▌        | 15/100 [02:47<15:55, 11.24s/it]epoch:  16%|█▌        | 16/100 [02:59<15:46, 11.27s/it]epoch:  17%|█▋        | 17/100 [03:10<15:28, 11.18s/it]epoch:  18%|█▊        | 18/100 [03:21<15:12, 11.13s/it]epoch:  19%|█▉        | 19/100 [03:32<15:07, 11.20s/it]epoch:  20%|██        | 20/100 [03:44<15:03, 11.29s/it]0.049604003572813644
best ic: 0.049604003572813644
epoch:  21%|██        | 21/100 [03:57<15:31, 11.79s/it]0.05368859943275819
best ic: 0.05368859943275819
epoch:  22%|██▏       | 22/100 [04:09<15:40, 12.06s/it]0.05280163612878544
epoch:  23%|██▎       | 23/100 [04:22<15:39, 12.21s/it]0.053493686797966546
epoch:  24%|██▍       | 24/100 [04:35<15:44, 12.43s/it]0.05213857927505761
epoch:  25%|██▌       | 25/100 [04:48<15:49, 12.66s/it]0.05448945007911221
best ic: 0.05448945007911221
epoch:  26%|██▌       | 26/100 [05:01<15:36, 12.65s/it]0.054598058036169565
best ic: 0.054598058036169565
epoch:  27%|██▋       | 27/100 [05:13<15:20, 12.61s/it]0.053470548066291125
epoch:  28%|██▊       | 28/100 [05:26<15:10, 12.65s/it]0.04860519904195427
epoch:  29%|██▉       | 29/100 [05:39<15:06, 12.77s/it]0.055302325837666096
best ic: 0.055302325837666096
epoch:  30%|███       | 30/100 [05:52<15:04, 12.92s/it]0.05340177517642901
epoch:  31%|███       | 31/100 [06:05<14:49, 12.89s/it]0.05243294062729635
epoch:  32%|███▏      | 32/100 [06:18<14:33, 12.84s/it]0.05498873391646965
epoch:  33%|███▎      | 33/100 [06:30<14:19, 12.83s/it]0.053848438169589334
epoch:  34%|███▍      | 34/100 [06:44<14:11, 12.89s/it]0.05097151996083822
epoch:  35%|███▌      | 35/100 [06:57<14:04, 13.00s/it]0.05506932419434928
epoch:  36%|███▌      | 36/100 [07:09<13:46, 12.91s/it]0.0548707206669445
epoch:  37%|███▋      | 37/100 [07:22<13:29, 12.86s/it]0.05555961431008786
best ic: 0.05555961431008786
epoch:  38%|███▊      | 38/100 [07:35<13:14, 12.81s/it]0.05461464375883942
epoch:  39%|███▉      | 39/100 [07:48<13:09, 12.94s/it]0.05568245806479048
best ic: 0.05568245806479048
epoch:  40%|████      | 40/100 [08:01<13:00, 13.01s/it]0.052244068524508226
epoch:  41%|████      | 41/100 [08:14<12:43, 12.93s/it]0.055208394075334545
epoch:  42%|████▏     | 42/100 [08:27<12:25, 12.86s/it]0.056525756692872284
best ic: 0.056525756692872284
epoch:  43%|████▎     | 43/100 [08:40<12:12, 12.86s/it]0.05689631289566376
best ic: 0.05689631289566376
epoch:  44%|████▍     | 44/100 [08:53<12:06, 12.97s/it]0.05371802119331382
epoch:  45%|████▌     | 45/100 [09:06<11:53, 12.98s/it]0.056195795868953645
epoch:  46%|████▌     | 46/100 [09:19<11:36, 12.89s/it]0.05285078514312326
epoch:  47%|████▋     | 47/100 [09:32<11:40, 13.22s/it]0.0545243274653695
epoch:  48%|████▊     | 48/100 [09:46<11:32, 13.32s/it]0.054392327811495514
epoch:  49%|████▉     | 49/100 [09:59<11:18, 13.31s/it]0.05531296641636619
epoch:  50%|█████     | 50/100 [10:13<11:09, 13.38s/it]0.05818497932464034
best ic: 0.05818497932464034
epoch:  51%|█████     | 51/100 [10:26<10:47, 13.21s/it]0.05501650322877081
epoch:  52%|█████▏    | 52/100 [10:38<10:24, 13.02s/it]0.05592365324146755
epoch:  53%|█████▎    | 53/100 [10:51<10:12, 13.03s/it]0.05829382181009837
best ic: 0.05829382181009837
epoch:  54%|█████▍    | 54/100 [11:04<10:01, 13.07s/it]0.05407698104122742
epoch:  55%|█████▌    | 55/100 [11:17<09:41, 12.92s/it]0.05171757346752737
epoch:  56%|█████▌    | 56/100 [11:30<09:24, 12.82s/it]0.05063266072999159
epoch:  57%|█████▋    | 57/100 [11:42<09:10, 12.79s/it]0.053568422395128164
epoch:  58%|█████▊    | 58/100 [11:55<09:01, 12.89s/it]0.052101688046841184
epoch:  59%|█████▉    | 59/100 [12:08<08:48, 12.90s/it]0.04803658119699656
epoch:  60%|██████    | 60/100 [12:21<08:32, 12.81s/it]0.050899788290245766
epoch:  61%|██████    | 61/100 [12:34<08:18, 12.78s/it]0.0511802625097006
epoch:  61%|██████    | 61/100 [12:47<08:10, 12.58s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 00:55:32,076) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 00:55:32,092) INFO - qlib.workflow - [recorder.py:341] - Recorder 7d092e445e024fafadbcb8aa7ed3c594 starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 10.94it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.73it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.68it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.56it/s]online:  16%|█▌        | 10/63 [00:00<00:04, 10.63it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.69it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.59it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.56it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.56it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.55it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.51it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.58it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.52it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.59it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.54it/s]online:  51%|█████     | 32/63 [00:03<00:02, 10.57it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.53it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.56it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.55it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.53it/s]online:  67%|██████▋   | 42/63 [00:03<00:01, 10.58it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.53it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.55it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.58it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.52it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.62it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.57it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.49it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.52it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.54it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.56it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.59it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 00:55:57,533) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99746567 mae 0.6860765
{'IC': 0.029984915772930446,
 'ICIR': 0.27204557251335987,
 'Rank IC': 0.02492360353697047,
 'Rank ICIR': 0.24825806870214548}
[2955773:MainThread](2024-04-25 00:55:59,449) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 00:56:14,877) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:56:14,880) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 00:56:21,042) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0fa174ef70>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:39,  9.74it/s]backtest loop:   1%|          | 9/971 [00:00<00:38, 24.86it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:27, 34.48it/s]backtest loop:   2%|▏         | 20/971 [00:00<00:24, 39.02it/s]backtest loop:   3%|▎         | 25/971 [00:00<00:23, 39.93it/s]backtest loop:   3%|▎         | 31/971 [00:00<00:21, 44.64it/s]backtest loop:   4%|▍         | 37/971 [00:00<00:19, 47.70it/s]backtest loop:   4%|▍         | 43/971 [00:01<00:18, 50.10it/s]backtest loop:   5%|▌         | 49/971 [00:01<00:19, 48.22it/s]backtest loop:   6%|▌         | 55/971 [00:01<00:18, 49.95it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:17, 50.78it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:18, 48.61it/s]backtest loop:   8%|▊         | 73/971 [00:01<00:17, 50.35it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:17, 51.23it/s]backtest loop:   9%|▉         | 85/971 [00:01<00:16, 52.13it/s]backtest loop:   9%|▉         | 91/971 [00:02<00:16, 53.21it/s]backtest loop:  10%|▉         | 97/971 [00:02<00:17, 50.86it/s]backtest loop:  11%|█         | 103/971 [00:02<00:16, 51.76it/s]backtest loop:  11%|█         | 109/971 [00:02<00:16, 52.42it/s]backtest loop:  12%|█▏        | 115/971 [00:02<00:16, 53.02it/s]backtest loop:  12%|█▏        | 121/971 [00:02<00:15, 53.94it/s]backtest loop:  13%|█▎        | 127/971 [00:02<00:17, 48.10it/s]backtest loop:  14%|█▎        | 133/971 [00:02<00:16, 49.94it/s]backtest loop:  14%|█▍        | 139/971 [00:02<00:16, 50.99it/s]backtest loop:  15%|█▍        | 145/971 [00:03<00:15, 51.89it/s]backtest loop:  16%|█▌        | 151/971 [00:03<00:16, 49.78it/s]backtest loop:  16%|█▌        | 157/971 [00:03<00:15, 51.20it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:15, 52.25it/s]backtest loop:  17%|█▋        | 169/971 [00:03<00:15, 52.93it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:15, 52.41it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:15, 49.77it/s]backtest loop:  19%|█▉        | 187/971 [00:03<00:15, 50.95it/s]backtest loop:  20%|█▉        | 193/971 [00:03<00:14, 52.11it/s]backtest loop:  20%|██        | 199/971 [00:04<00:14, 53.08it/s]backtest loop:  21%|██        | 205/971 [00:04<00:15, 49.89it/s]backtest loop:  22%|██▏       | 211/971 [00:04<00:14, 51.39it/s]backtest loop:  22%|██▏       | 217/971 [00:04<00:15, 49.63it/s]backtest loop:  23%|██▎       | 223/971 [00:04<00:14, 51.07it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:14, 52.04it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:14, 49.49it/s]backtest loop:  25%|██▍       | 241/971 [00:04<00:14, 51.27it/s]backtest loop:  25%|██▌       | 247/971 [00:05<00:13, 52.22it/s]backtest loop:  26%|██▌       | 253/971 [00:05<00:13, 52.64it/s]backtest loop:  27%|██▋       | 259/971 [00:05<00:14, 50.29it/s]backtest loop:  27%|██▋       | 265/971 [00:05<00:13, 51.47it/s]backtest loop:  28%|██▊       | 271/971 [00:05<00:14, 49.44it/s]backtest loop:  29%|██▊       | 277/971 [00:05<00:13, 51.02it/s]backtest loop:  29%|██▉       | 283/971 [00:05<00:13, 51.91it/s]backtest loop:  30%|██▉       | 289/971 [00:05<00:12, 52.66it/s]backtest loop:  30%|███       | 295/971 [00:06<00:13, 50.03it/s]backtest loop:  31%|███       | 301/971 [00:06<00:13, 51.25it/s]backtest loop:  32%|███▏      | 307/971 [00:06<00:12, 51.83it/s]backtest loop:  32%|███▏      | 313/971 [00:06<00:12, 52.40it/s]backtest loop:  33%|███▎      | 319/971 [00:06<00:12, 53.08it/s]backtest loop:  33%|███▎      | 325/971 [00:06<00:12, 49.80it/s]backtest loop:  34%|███▍      | 331/971 [00:06<00:12, 50.65it/s]backtest loop:  35%|███▍      | 337/971 [00:06<00:12, 51.85it/s]backtest loop:  35%|███▌      | 343/971 [00:06<00:11, 52.63it/s]backtest loop:  36%|███▌      | 349/971 [00:07<00:11, 53.38it/s]backtest loop:  37%|███▋      | 355/971 [00:07<00:12, 50.32it/s]backtest loop:  37%|███▋      | 361/971 [00:07<00:11, 51.31it/s]backtest loop:  38%|███▊      | 367/971 [00:07<00:12, 49.84it/s]backtest loop:  38%|███▊      | 373/971 [00:07<00:12, 48.89it/s]backtest loop:  39%|███▉      | 379/971 [00:07<00:11, 50.20it/s]backtest loop:  40%|███▉      | 385/971 [00:07<00:11, 51.13it/s]backtest loop:  40%|████      | 391/971 [00:07<00:11, 52.12it/s]backtest loop:  41%|████      | 397/971 [00:07<00:10, 53.61it/s]backtest loop:  42%|████▏     | 403/971 [00:08<00:10, 52.34it/s]backtest loop:  42%|████▏     | 409/971 [00:08<00:10, 54.33it/s]backtest loop:  43%|████▎     | 415/971 [00:08<00:09, 55.62it/s]backtest loop:  43%|████▎     | 421/971 [00:08<00:09, 56.83it/s]backtest loop:  44%|████▍     | 428/971 [00:08<00:09, 55.24it/s]backtest loop:  45%|████▍     | 434/971 [00:08<00:09, 56.49it/s]backtest loop:  45%|████▌     | 440/971 [00:08<00:09, 57.44it/s]backtest loop:  46%|████▌     | 446/971 [00:08<00:09, 57.86it/s]backtest loop:  47%|████▋     | 452/971 [00:08<00:09, 55.14it/s]backtest loop:  47%|████▋     | 459/971 [00:09<00:08, 57.27it/s]backtest loop:  48%|████▊     | 465/971 [00:09<00:08, 57.69it/s]backtest loop:  49%|████▊     | 471/971 [00:09<00:08, 58.20it/s]backtest loop:  49%|████▉     | 477/971 [00:09<00:08, 55.37it/s]backtest loop:  50%|████▉     | 483/971 [00:09<00:08, 56.49it/s]backtest loop:  50%|█████     | 490/971 [00:09<00:08, 55.19it/s]backtest loop:  51%|█████     | 497/971 [00:09<00:08, 57.43it/s]backtest loop:  52%|█████▏    | 504/971 [00:09<00:07, 59.61it/s]backtest loop:  53%|█████▎    | 510/971 [00:09<00:08, 56.97it/s]backtest loop:  53%|█████▎    | 516/971 [00:10<00:07, 57.51it/s]backtest loop:  54%|█████▍    | 522/971 [00:10<00:08, 55.02it/s]backtest loop:  54%|█████▍    | 528/971 [00:10<00:07, 56.29it/s]backtest loop:  55%|█████▍    | 534/971 [00:10<00:07, 57.16it/s]backtest loop:  56%|█████▌    | 540/971 [00:10<00:07, 57.91it/s]backtest loop:  56%|█████▌    | 546/971 [00:10<00:07, 54.90it/s]backtest loop:  57%|█████▋    | 552/971 [00:10<00:07, 56.11it/s]backtest loop:  58%|█████▊    | 559/971 [00:10<00:07, 58.00it/s]backtest loop:  58%|█████▊    | 566/971 [00:10<00:07, 56.00it/s]backtest loop:  59%|█████▉    | 573/971 [00:11<00:06, 57.79it/s]backtest loop:  60%|█████▉    | 579/971 [00:11<00:06, 58.03it/s]backtest loop:  60%|██████    | 585/971 [00:11<00:06, 58.34it/s]backtest loop:  61%|██████    | 591/971 [00:11<00:06, 55.48it/s]backtest loop:  62%|██████▏   | 598/971 [00:11<00:06, 57.47it/s]backtest loop:  62%|██████▏   | 604/971 [00:11<00:06, 58.00it/s]backtest loop:  63%|██████▎   | 610/971 [00:11<00:06, 55.23it/s]backtest loop:  63%|██████▎   | 616/971 [00:11<00:06, 56.20it/s]backtest loop:  64%|██████▍   | 622/971 [00:11<00:06, 57.19it/s]backtest loop:  65%|██████▍   | 628/971 [00:12<00:06, 55.67it/s]backtest loop:  65%|██████▌   | 634/971 [00:12<00:06, 55.28it/s]backtest loop:  66%|██████▌   | 640/971 [00:12<00:06, 51.95it/s]backtest loop:  67%|██████▋   | 646/971 [00:12<00:06, 52.32it/s]backtest loop:  67%|██████▋   | 652/971 [00:12<00:06, 52.97it/s]backtest loop:  68%|██████▊   | 658/971 [00:12<00:05, 53.31it/s]backtest loop:  68%|██████▊   | 664/971 [00:12<00:05, 53.71it/s]backtest loop:  69%|██████▉   | 670/971 [00:12<00:05, 50.83it/s]backtest loop:  70%|██████▉   | 676/971 [00:12<00:05, 51.44it/s]backtest loop:  70%|███████   | 682/971 [00:13<00:05, 52.34it/s]backtest loop:  71%|███████   | 688/971 [00:13<00:05, 52.65it/s]backtest loop:  71%|███████▏  | 694/971 [00:13<00:05, 49.91it/s]backtest loop:  72%|███████▏  | 700/971 [00:13<00:05, 51.29it/s]backtest loop:  73%|███████▎  | 706/971 [00:13<00:05, 51.81it/s]backtest loop:  73%|███████▎  | 712/971 [00:13<00:04, 52.27it/s]backtest loop:  74%|███████▍  | 718/971 [00:13<00:04, 53.01it/s]backtest loop:  75%|███████▍  | 724/971 [00:13<00:04, 50.28it/s]backtest loop:  75%|███████▌  | 730/971 [00:14<00:04, 51.64it/s]backtest loop:  76%|███████▌  | 736/971 [00:14<00:04, 49.51it/s]backtest loop:  76%|███████▋  | 742/971 [00:14<00:04, 50.72it/s]backtest loop:  77%|███████▋  | 748/971 [00:14<00:04, 48.93it/s]backtest loop:  78%|███████▊  | 754/971 [00:14<00:04, 50.38it/s]backtest loop:  78%|███████▊  | 760/971 [00:14<00:04, 48.99it/s]backtest loop:  79%|███████▉  | 766/971 [00:14<00:04, 50.29it/s]backtest loop:  80%|███████▉  | 772/971 [00:14<00:03, 51.56it/s]backtest loop:  80%|████████  | 778/971 [00:14<00:03, 52.59it/s]backtest loop:  81%|████████  | 784/971 [00:15<00:03, 50.02it/s]backtest loop:  81%|████████▏ | 790/971 [00:15<00:03, 51.23it/s]backtest loop:  82%|████████▏ | 796/971 [00:15<00:03, 51.58it/s]backtest loop:  83%|████████▎ | 802/971 [00:15<00:03, 51.90it/s]backtest loop:  83%|████████▎ | 808/971 [00:15<00:03, 49.35it/s]backtest loop:  84%|████████▍ | 814/971 [00:15<00:03, 51.13it/s]backtest loop:  84%|████████▍ | 820/971 [00:15<00:02, 52.11it/s]backtest loop:  85%|████████▌ | 826/971 [00:15<00:02, 52.45it/s]backtest loop:  86%|████████▌ | 832/971 [00:16<00:02, 52.95it/s]backtest loop:  86%|████████▋ | 838/971 [00:16<00:02, 50.00it/s]backtest loop:  87%|████████▋ | 844/971 [00:16<00:02, 51.28it/s]backtest loop:  88%|████████▊ | 850/971 [00:16<00:02, 52.14it/s]backtest loop:  88%|████████▊ | 856/971 [00:16<00:02, 52.34it/s]backtest loop:  89%|████████▉ | 862/971 [00:16<00:02, 49.94it/s]backtest loop:  89%|████████▉ | 868/971 [00:16<00:02, 51.14it/s]backtest loop:  90%|█████████ | 874/971 [00:16<00:01, 52.03it/s]backtest loop:  91%|█████████ | 880/971 [00:16<00:01, 52.89it/s]backtest loop:  91%|█████████ | 886/971 [00:17<00:01, 53.16it/s]backtest loop:  92%|█████████▏| 892/971 [00:17<00:01, 50.35it/s]backtest loop:  92%|█████████▏| 898/971 [00:17<00:01, 51.60it/s]backtest loop:  93%|█████████▎| 904/971 [00:17<00:01, 52.42it/s]backtest loop:  94%|█████████▎| 910/971 [00:17<00:01, 53.18it/s]backtest loop:  94%|█████████▍| 916/971 [00:17<00:01, 50.28it/s]backtest loop:  95%|█████████▍| 922/971 [00:17<00:00, 51.48it/s]backtest loop:  96%|█████████▌| 928/971 [00:17<00:00, 52.40it/s]backtest loop:  96%|█████████▌| 934/971 [00:17<00:00, 52.80it/s]backtest loop:  97%|█████████▋| 940/971 [00:18<00:00, 50.18it/s]backtest loop:  97%|█████████▋| 946/971 [00:18<00:00, 51.50it/s]backtest loop:  98%|█████████▊| 952/971 [00:18<00:00, 52.52it/s]backtest loop:  99%|█████████▊| 958/971 [00:18<00:00, 53.11it/s]backtest loop:  99%|█████████▉| 964/971 [00:18<00:00, 53.33it/s]backtest loop: 100%|█████████▉| 970/971 [00:18<00:00, 50.52it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 51.89it/s]
[2955773:MainThread](2024-04-25 00:56:39,829) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000510
std                0.004896
annualized_return  0.121276
information_ratio  1.605545
max_drawdown      -0.115962
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000316
std                0.004896
annualized_return  0.075295
information_ratio  0.996954
max_drawdown      -0.133862
[2955773:MainThread](2024-04-25 00:56:39,846) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 7 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464,
                                                    0.019105634311371505,
                                                    0.0816192178944375,
                                                    0.05196743618995587,
                                                    0.07364360235459269,
                                                    0.07529512078101458],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314,
                                                    0.2606514610551633,
                                                    1.1537603040229327,
                                                    0.7002100933966647,
                                                    1.0694534222341312,
                                                    0.9969539601730383],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274,
                                               -0.12294148723484218,
                                               -0.07168188587056515,
                                               -0.10481767459217074,
                                               -0.10415757904585374,
                                               -0.1338620400408268],
 'IC': [0.027428014568116936,
        0.02918433457730239,
        0.02841997940888336,
        0.028899194346999706,
        0.028319585873825204,
        0.02899478143403294,
        0.029984915772930446],
 'ICIR': [0.2387005207618663,
          0.26166720227076895,
          0.26074474219927596,
          0.25816670056249374,
          0.25939505641981636,
          0.27354621293650927,
          0.27204557251335987],
 'Rank IC': [0.017899936121617426,
             0.023050650417454972,
             0.021150826288890614,
             0.021484763144688775,
             0.021629620551719252,
             0.022469562981714118,
             0.02492360353697047],
 'Rank ICIR': [0.15498014880934224,
               0.2092031518636296,
               0.2079182482330708,
               0.19117984399097265,
               0.2027589236785842,
               0.21744567464166992,
               0.24825806870214548],
 'mae': [0.6861302852630615,
         0.6859831809997559,
         0.686088502407074,
         0.6860310435295105,
         0.6860296726226807,
         0.6861463785171509,
         0.6860765218734741],
 'mse': [0.9973626136779785,
         0.9971274733543396,
         0.9974362850189209,
         0.9972577095031738,
         0.9972612857818604,
         0.9972525238990784,
         0.9974656701087952]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-25 00:56:41,174) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-25 00:56:41,174) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:34, 11.86s/it]epoch:   2%|▏         | 2/100 [00:22<18:30, 11.33s/it]epoch:   3%|▎         | 3/100 [00:34<18:18, 11.32s/it]epoch:   4%|▍         | 4/100 [00:45<18:03, 11.29s/it]epoch:   5%|▌         | 5/100 [00:56<17:38, 11.15s/it]epoch:   6%|▌         | 6/100 [01:07<17:18, 11.05s/it]epoch:   7%|▋         | 7/100 [01:18<17:07, 11.05s/it]epoch:   8%|▊         | 8/100 [01:29<17:02, 11.12s/it]epoch:   9%|▉         | 9/100 [01:40<16:54, 11.15s/it]epoch:  10%|█         | 10/100 [01:51<16:35, 11.07s/it]epoch:  11%|█         | 11/100 [02:02<16:19, 11.01s/it]epoch:  12%|█▏        | 12/100 [02:13<16:11, 11.04s/it]epoch:  13%|█▎        | 13/100 [02:24<16:06, 11.11s/it]epoch:  14%|█▍        | 14/100 [02:36<15:58, 11.15s/it]epoch:  15%|█▌        | 15/100 [02:47<15:43, 11.10s/it]epoch:  16%|█▌        | 16/100 [02:57<15:28, 11.06s/it]epoch:  17%|█▋        | 17/100 [03:09<15:31, 11.23s/it]epoch:  18%|█▊        | 18/100 [03:20<15:24, 11.28s/it]epoch:  19%|█▉        | 19/100 [03:32<15:19, 11.35s/it]epoch:  20%|██        | 20/100 [03:43<14:57, 11.22s/it]0.05314388119171907
best ic: 0.05314388119171907
epoch:  21%|██        | 21/100 [03:56<15:19, 11.64s/it]0.04790367009770418
epoch:  22%|██▏       | 22/100 [04:08<15:31, 11.94s/it]0.05367777380150013
best ic: 0.05367777380150013
epoch:  23%|██▎       | 23/100 [04:21<15:42, 12.24s/it]0.05347300249729945
epoch:  24%|██▍       | 24/100 [04:34<15:41, 12.39s/it]0.05520573436833419
best ic: 0.05520573436833419
epoch:  25%|██▌       | 25/100 [04:46<15:29, 12.39s/it]0.05028044475466003
epoch:  26%|██▌       | 26/100 [04:59<15:17, 12.40s/it]0.052943714547549585
epoch:  27%|██▋       | 27/100 [05:11<15:10, 12.47s/it]0.05412048979519876
epoch:  28%|██▊       | 28/100 [05:24<15:11, 12.66s/it]0.05518255540017459
epoch:  29%|██▉       | 29/100 [05:37<14:59, 12.67s/it]0.054092372279008295
epoch:  30%|███       | 30/100 [05:50<14:58, 12.84s/it]0.05272168364939852
epoch:  31%|███       | 31/100 [06:03<14:42, 12.79s/it]0.05767414422532099
best ic: 0.05767414422532099
epoch:  32%|███▏      | 32/100 [06:16<14:36, 12.89s/it]0.05532062913884893
epoch:  33%|███▎      | 33/100 [06:29<14:19, 12.83s/it]0.05314724429774651
epoch:  34%|███▍      | 34/100 [06:41<14:02, 12.77s/it]0.05554303357810236
epoch:  35%|███▌      | 35/100 [06:54<13:52, 12.81s/it]0.05528170119683277
epoch:  36%|███▌      | 36/100 [07:07<13:44, 12.88s/it]0.05318890889454697
epoch:  37%|███▋      | 37/100 [07:20<13:26, 12.81s/it]0.051719691883681446
epoch:  38%|███▊      | 38/100 [07:33<13:11, 12.76s/it]0.053574758059740914
epoch:  39%|███▉      | 39/100 [07:46<13:03, 12.85s/it]0.05509648425160969
epoch:  39%|███▉      | 39/100 [07:59<12:29, 12.29s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 01:04:40,388) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 01:04:40,403) INFO - qlib.workflow - [recorder.py:341] - Recorder bb46f101fd864bb397cd948873022d67 starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 10.73it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.48it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.72it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.66it/s]online:  16%|█▌        | 10/63 [00:00<00:04, 10.65it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.65it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.59it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.61it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.60it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.56it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.58it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.61it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.62it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.60it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.59it/s]online:  51%|█████     | 32/63 [00:03<00:02, 10.60it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.50it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.57it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.58it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.48it/s]online:  67%|██████▋   | 42/63 [00:03<00:01, 10.58it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.60it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.56it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.64it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.63it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.64it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.58it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.65it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.58it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.59it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.61it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.62it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 01:05:12,492) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99725324 mae 0.68617785
{'IC': 0.029116316571044177,
 'ICIR': 0.2543607181386511,
 'Rank IC': 0.02069513703222315,
 'Rank ICIR': 0.1839782561248118}
[2955773:MainThread](2024-04-25 01:05:14,348) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 01:05:29,916) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 01:05:29,919) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 01:05:35,932) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0f9c9f4d60>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:43,  9.38it/s]backtest loop:   1%|          | 10/971 [00:00<00:35, 27.08it/s]backtest loop:   2%|▏         | 17/971 [00:00<00:26, 36.40it/s]backtest loop:   2%|▏         | 24/971 [00:00<00:22, 41.84it/s]backtest loop:   3%|▎         | 31/971 [00:00<00:19, 48.12it/s]backtest loop:   4%|▍         | 38/971 [00:00<00:17, 52.45it/s]backtest loop:   5%|▍         | 44/971 [00:01<00:17, 51.83it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:16, 55.21it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:17, 53.76it/s]backtest loop:   7%|▋         | 64/971 [00:01<00:15, 56.74it/s]backtest loop:   7%|▋         | 71/971 [00:01<00:15, 59.13it/s]backtest loop:   8%|▊         | 78/971 [00:01<00:15, 57.34it/s]backtest loop:   9%|▉         | 85/971 [00:01<00:15, 58.91it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 57.43it/s]backtest loop:  10%|█         | 99/971 [00:01<00:14, 58.97it/s]backtest loop:  11%|█         | 106/971 [00:02<00:14, 60.14it/s]backtest loop:  12%|█▏        | 113/971 [00:02<00:14, 57.76it/s]backtest loop:  12%|█▏        | 120/971 [00:02<00:14, 59.27it/s]backtest loop:  13%|█▎        | 126/971 [00:02<00:15, 53.53it/s]backtest loop:  14%|█▎        | 133/971 [00:02<00:14, 55.98it/s]backtest loop:  14%|█▍        | 140/971 [00:02<00:14, 57.95it/s]backtest loop:  15%|█▌        | 146/971 [00:02<00:14, 55.42it/s]backtest loop:  16%|█▌        | 153/971 [00:02<00:14, 57.43it/s]backtest loop:  16%|█▋        | 160/971 [00:03<00:13, 58.96it/s]backtest loop:  17%|█▋        | 166/971 [00:03<00:14, 56.14it/s]backtest loop:  18%|█▊        | 173/971 [00:03<00:13, 58.05it/s]backtest loop:  19%|█▊        | 180/971 [00:03<00:13, 59.62it/s]backtest loop:  19%|█▉        | 186/971 [00:03<00:13, 56.82it/s]backtest loop:  20%|█▉        | 193/971 [00:03<00:13, 58.63it/s]backtest loop:  21%|██        | 200/971 [00:03<00:13, 57.02it/s]backtest loop:  21%|██        | 206/971 [00:03<00:13, 57.76it/s]backtest loop:  22%|██▏       | 213/971 [00:03<00:13, 56.46it/s]backtest loop:  23%|██▎       | 220/971 [00:04<00:13, 55.32it/s]backtest loop:  23%|██▎       | 227/971 [00:04<00:12, 57.30it/s]backtest loop:  24%|██▍       | 234/971 [00:04<00:12, 58.81it/s]backtest loop:  25%|██▍       | 240/971 [00:04<00:12, 56.74it/s]backtest loop:  25%|██▌       | 247/971 [00:04<00:12, 58.45it/s]backtest loop:  26%|██▌       | 254/971 [00:04<00:12, 56.37it/s]backtest loop:  27%|██▋       | 261/971 [00:04<00:12, 58.35it/s]backtest loop:  27%|██▋       | 267/971 [00:04<00:12, 55.70it/s]backtest loop:  28%|██▊       | 274/971 [00:05<00:12, 57.73it/s]backtest loop:  29%|██▉       | 281/971 [00:05<00:12, 56.10it/s]backtest loop:  30%|██▉       | 288/971 [00:05<00:11, 57.82it/s]backtest loop:  30%|███       | 295/971 [00:05<00:12, 56.31it/s]backtest loop:  31%|███       | 301/971 [00:05<00:11, 57.13it/s]backtest loop:  32%|███▏      | 308/971 [00:05<00:11, 58.81it/s]backtest loop:  32%|███▏      | 315/971 [00:05<00:11, 56.63it/s]backtest loop:  33%|███▎      | 322/971 [00:05<00:11, 58.29it/s]backtest loop:  34%|███▍      | 329/971 [00:05<00:10, 59.76it/s]backtest loop:  35%|███▍      | 336/971 [00:06<00:11, 57.41it/s]backtest loop:  35%|███▌      | 343/971 [00:06<00:10, 58.86it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:10, 57.02it/s]backtest loop:  37%|███▋      | 357/971 [00:06<00:10, 58.81it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 56.57it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 54.42it/s]backtest loop:  39%|███▊      | 376/971 [00:06<00:10, 56.83it/s]backtest loop:  39%|███▉      | 383/971 [00:06<00:10, 55.30it/s]backtest loop:  40%|████      | 390/971 [00:07<00:10, 57.52it/s]backtest loop:  41%|████      | 396/971 [00:07<00:09, 57.68it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 55.96it/s]backtest loop:  42%|████▏     | 410/971 [00:07<00:09, 57.80it/s]backtest loop:  43%|████▎     | 417/971 [00:07<00:09, 59.20it/s]backtest loop:  44%|████▎     | 423/971 [00:07<00:09, 56.30it/s]backtest loop:  44%|████▍     | 430/971 [00:07<00:09, 58.09it/s]backtest loop:  45%|████▌     | 437/971 [00:07<00:09, 56.17it/s]backtest loop:  46%|████▌     | 444/971 [00:07<00:09, 57.92it/s]backtest loop:  46%|████▋     | 450/971 [00:08<00:08, 58.22it/s]backtest loop:  47%|████▋     | 457/971 [00:08<00:09, 56.38it/s]backtest loop:  48%|████▊     | 464/971 [00:08<00:08, 58.09it/s]backtest loop:  49%|████▊     | 471/971 [00:08<00:08, 59.60it/s]backtest loop:  49%|████▉     | 477/971 [00:08<00:08, 57.00it/s]backtest loop:  50%|████▉     | 484/971 [00:08<00:08, 58.93it/s]backtest loop:  50%|█████     | 490/971 [00:08<00:08, 55.83it/s]backtest loop:  51%|█████     | 496/971 [00:08<00:08, 56.67it/s]backtest loop:  52%|█████▏    | 503/971 [00:09<00:07, 58.72it/s]backtest loop:  52%|█████▏    | 509/971 [00:09<00:08, 56.47it/s]backtest loop:  53%|█████▎    | 515/971 [00:09<00:07, 57.16it/s]backtest loop:  54%|█████▍    | 522/971 [00:09<00:08, 55.44it/s]backtest loop:  54%|█████▍    | 529/971 [00:09<00:07, 57.73it/s]backtest loop:  55%|█████▌    | 536/971 [00:09<00:07, 56.09it/s]backtest loop:  56%|█████▌    | 543/971 [00:09<00:07, 57.96it/s]backtest loop:  57%|█████▋    | 549/971 [00:09<00:07, 58.40it/s]backtest loop:  57%|█████▋    | 555/971 [00:09<00:07, 58.50it/s]backtest loop:  58%|█████▊    | 561/971 [00:10<00:07, 55.77it/s]backtest loop:  58%|█████▊    | 568/971 [00:10<00:06, 57.72it/s]backtest loop:  59%|█████▉    | 575/971 [00:10<00:06, 59.27it/s]backtest loop:  60%|█████▉    | 581/971 [00:10<00:06, 56.02it/s]backtest loop:  60%|██████    | 587/971 [00:10<00:06, 56.97it/s]backtest loop:  61%|██████    | 594/971 [00:10<00:06, 58.55it/s]backtest loop:  62%|██████▏   | 600/971 [00:10<00:06, 55.66it/s]backtest loop:  62%|██████▏   | 606/971 [00:10<00:06, 56.29it/s]backtest loop:  63%|██████▎   | 612/971 [00:10<00:06, 57.31it/s]backtest loop:  64%|██████▎   | 618/971 [00:11<00:06, 58.07it/s]backtest loop:  64%|██████▍   | 625/971 [00:11<00:06, 56.10it/s]backtest loop:  65%|██████▌   | 632/971 [00:11<00:05, 58.12it/s]backtest loop:  66%|██████▌   | 639/971 [00:11<00:05, 59.35it/s]backtest loop:  66%|██████▋   | 645/971 [00:11<00:05, 56.24it/s]backtest loop:  67%|██████▋   | 652/971 [00:11<00:05, 58.02it/s]backtest loop:  68%|██████▊   | 659/971 [00:11<00:05, 59.54it/s]backtest loop:  68%|██████▊   | 665/971 [00:11<00:05, 55.52it/s]backtest loop:  69%|██████▉   | 671/971 [00:11<00:05, 56.64it/s]backtest loop:  70%|██████▉   | 678/971 [00:12<00:05, 58.38it/s]backtest loop:  70%|███████   | 684/971 [00:12<00:05, 55.52it/s]backtest loop:  71%|███████   | 690/971 [00:12<00:04, 56.65it/s]backtest loop:  72%|███████▏  | 697/971 [00:12<00:04, 58.34it/s]backtest loop:  73%|███████▎  | 704/971 [00:12<00:04, 56.47it/s]backtest loop:  73%|███████▎  | 711/971 [00:12<00:04, 58.12it/s]backtest loop:  74%|███████▍  | 717/971 [00:12<00:04, 58.15it/s]backtest loop:  75%|███████▍  | 724/971 [00:12<00:04, 56.16it/s]backtest loop:  75%|███████▌  | 731/971 [00:13<00:04, 55.19it/s]backtest loop:  76%|███████▌  | 738/971 [00:13<00:04, 54.27it/s]backtest loop:  77%|███████▋  | 745/971 [00:13<00:03, 56.61it/s]backtest loop:  77%|███████▋  | 751/971 [00:13<00:04, 54.49it/s]backtest loop:  78%|███████▊  | 758/971 [00:13<00:03, 56.98it/s]backtest loop:  79%|███████▉  | 765/971 [00:13<00:03, 56.02it/s]backtest loop:  80%|███████▉  | 772/971 [00:13<00:03, 58.11it/s]backtest loop:  80%|████████  | 779/971 [00:13<00:03, 59.92it/s]backtest loop:  81%|████████  | 786/971 [00:13<00:03, 57.83it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 56.10it/s]backtest loop:  82%|████████▏ | 800/971 [00:14<00:02, 58.25it/s]backtest loop:  83%|████████▎ | 807/971 [00:14<00:02, 59.52it/s]backtest loop:  84%|████████▎ | 813/971 [00:14<00:02, 56.93it/s]backtest loop:  84%|████████▍ | 820/971 [00:14<00:02, 58.67it/s]backtest loop:  85%|████████▌ | 827/971 [00:14<00:02, 59.78it/s]backtest loop:  86%|████████▌ | 833/971 [00:14<00:02, 56.56it/s]backtest loop:  87%|████████▋ | 840/971 [00:14<00:02, 58.29it/s]backtest loop:  87%|████████▋ | 847/971 [00:15<00:02, 59.45it/s]backtest loop:  88%|████████▊ | 853/971 [00:15<00:02, 56.31it/s]backtest loop:  89%|████████▊ | 860/971 [00:15<00:01, 58.03it/s]backtest loop:  89%|████████▉ | 867/971 [00:15<00:01, 56.06it/s]backtest loop:  90%|█████████ | 874/971 [00:15<00:01, 57.75it/s]backtest loop:  91%|█████████ | 881/971 [00:15<00:01, 59.26it/s]backtest loop:  91%|█████████▏| 887/971 [00:15<00:01, 56.32it/s]backtest loop:  92%|█████████▏| 894/971 [00:15<00:01, 57.99it/s]backtest loop:  93%|█████████▎| 901/971 [00:15<00:01, 59.35it/s]backtest loop:  93%|█████████▎| 907/971 [00:16<00:01, 56.58it/s]backtest loop:  94%|█████████▍| 913/971 [00:16<00:01, 57.49it/s]backtest loop:  95%|█████████▍| 920/971 [00:16<00:00, 59.05it/s]backtest loop:  95%|█████████▌| 926/971 [00:16<00:00, 55.99it/s]backtest loop:  96%|█████████▌| 933/971 [00:16<00:00, 57.90it/s]backtest loop:  97%|█████████▋| 940/971 [00:16<00:00, 56.64it/s]backtest loop:  98%|█████████▊| 947/971 [00:16<00:00, 58.22it/s]backtest loop:  98%|█████████▊| 954/971 [00:16<00:00, 59.51it/s]backtest loop:  99%|█████████▉| 960/971 [00:16<00:00, 56.45it/s]backtest loop: 100%|█████████▉| 967/971 [00:17<00:00, 58.08it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 56.53it/s]
[2955773:MainThread](2024-04-25 01:05:53,185) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000429
std                0.004720
annualized_return  0.102088
information_ratio  1.402043
max_drawdown      -0.088100
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000235
std                0.004721
annualized_return  0.055897
information_ratio  0.767465
max_drawdown      -0.110013
[2955773:MainThread](2024-04-25 01:05:53,202) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 8 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464,
                                                    0.019105634311371505,
                                                    0.0816192178944375,
                                                    0.05196743618995587,
                                                    0.07364360235459269,
                                                    0.07529512078101458,
                                                    0.05589678848065261],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314,
                                                    0.2606514610551633,
                                                    1.1537603040229327,
                                                    0.7002100933966647,
                                                    1.0694534222341312,
                                                    0.9969539601730383,
                                                    0.7674654740722182],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274,
                                               -0.12294148723484218,
                                               -0.07168188587056515,
                                               -0.10481767459217074,
                                               -0.10415757904585374,
                                               -0.1338620400408268,
                                               -0.11001319606469137],
 'IC': [0.027428014568116936,
        0.02918433457730239,
        0.02841997940888336,
        0.028899194346999706,
        0.028319585873825204,
        0.02899478143403294,
        0.029984915772930446,
        0.029116316571044177],
 'ICIR': [0.2387005207618663,
          0.26166720227076895,
          0.26074474219927596,
          0.25816670056249374,
          0.25939505641981636,
          0.27354621293650927,
          0.27204557251335987,
          0.2543607181386511],
 'Rank IC': [0.017899936121617426,
             0.023050650417454972,
             0.021150826288890614,
             0.021484763144688775,
             0.021629620551719252,
             0.022469562981714118,
             0.02492360353697047,
             0.02069513703222315],
 'Rank ICIR': [0.15498014880934224,
               0.2092031518636296,
               0.2079182482330708,
               0.19117984399097265,
               0.2027589236785842,
               0.21744567464166992,
               0.24825806870214548,
               0.1839782561248118],
 'mae': [0.6861302852630615,
         0.6859831809997559,
         0.686088502407074,
         0.6860310435295105,
         0.6860296726226807,
         0.6861463785171509,
         0.6860765218734741,
         0.6861778497695923],
 'mse': [0.9973626136779785,
         0.9971274733543396,
         0.9974362850189209,
         0.9972577095031738,
         0.9972612857818604,
         0.9972525238990784,
         0.9974656701087952,
         0.9972532391548157]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-25 01:05:54,511) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-25 01:05:54,512) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:15, 11.67s/it]epoch:   2%|▏         | 2/100 [00:22<18:20, 11.23s/it]epoch:   3%|▎         | 3/100 [00:34<18:18, 11.32s/it]epoch:   4%|▍         | 4/100 [00:45<18:05, 11.31s/it]epoch:   5%|▌         | 5/100 [00:56<17:40, 11.16s/it]epoch:   6%|▌         | 6/100 [01:07<17:18, 11.04s/it]epoch:   7%|▋         | 7/100 [01:18<17:09, 11.07s/it]epoch:   8%|▊         | 8/100 [01:29<17:07, 11.17s/it]epoch:   9%|▉         | 9/100 [01:40<16:52, 11.13s/it]epoch:  10%|█         | 10/100 [01:51<16:33, 11.04s/it]epoch:  11%|█         | 11/100 [02:02<16:22, 11.04s/it]epoch:  12%|█▏        | 12/100 [02:13<16:19, 11.13s/it]epoch:  13%|█▎        | 13/100 [02:25<16:12, 11.17s/it]epoch:  14%|█▍        | 14/100 [02:36<15:57, 11.13s/it]epoch:  15%|█▌        | 15/100 [02:47<15:42, 11.09s/it]epoch:  16%|█▌        | 16/100 [02:58<15:28, 11.06s/it]epoch:  17%|█▋        | 17/100 [03:09<15:23, 11.13s/it]epoch:  18%|█▊        | 18/100 [03:20<15:16, 11.18s/it]epoch:  19%|█▉        | 19/100 [03:31<14:59, 11.11s/it]epoch:  20%|██        | 20/100 [03:42<14:42, 11.03s/it]0.04831566920583257
best ic: 0.04831566920583257
epoch:  21%|██        | 21/100 [03:55<15:07, 11.49s/it]0.04944771780817143
best ic: 0.04944771780817143
epoch:  22%|██▏       | 22/100 [04:08<15:33, 11.96s/it]0.05044025466384991
best ic: 0.05044025466384991
epoch:  23%|██▎       | 23/100 [04:20<15:40, 12.21s/it]0.05277988190364473
best ic: 0.05277988190364473
epoch:  24%|██▍       | 24/100 [04:33<15:31, 12.26s/it]0.05016735293279937
epoch:  25%|██▌       | 25/100 [04:45<15:20, 12.27s/it]0.05014300924410811
epoch:  26%|██▌       | 26/100 [04:58<15:15, 12.37s/it]0.04971248513618725
epoch:  27%|██▋       | 27/100 [05:11<15:14, 12.53s/it]0.05175087765297273
epoch:  28%|██▊       | 28/100 [05:23<15:09, 12.63s/it]0.051976041725252525
epoch:  29%|██▉       | 29/100 [05:36<14:51, 12.56s/it]0.05275643340638928
epoch:  30%|███       | 30/100 [05:48<14:38, 12.55s/it]0.053046983189413685
best ic: 0.053046983189413685
epoch:  31%|███       | 31/100 [06:01<14:29, 12.60s/it]0.05033839081265322
epoch:  32%|███▏      | 32/100 [06:14<14:23, 12.70s/it]0.05516780118309975
best ic: 0.05516780118309975
epoch:  33%|███▎      | 33/100 [06:27<14:10, 12.69s/it]0.0520871247339012
epoch:  34%|███▍      | 34/100 [06:39<13:53, 12.63s/it]0.055862700334343554
best ic: 0.055862700334343554
epoch:  35%|███▌      | 35/100 [06:52<13:39, 12.60s/it]0.0539146440029869
epoch:  36%|███▌      | 36/100 [07:04<13:30, 12.66s/it]0.04986010841751219
epoch:  37%|███▋      | 37/100 [07:18<13:26, 12.80s/it]0.05409665768134693
epoch:  38%|███▊      | 38/100 [07:30<13:10, 12.75s/it]0.05013417928821896
epoch:  39%|███▉      | 39/100 [07:43<12:52, 12.67s/it]0.0504485106283788
epoch:  40%|████      | 40/100 [07:55<12:37, 12.62s/it]0.053702625063084215
epoch:  41%|████      | 41/100 [08:08<12:29, 12.70s/it]0.05215598995414818
epoch:  42%|████▏     | 42/100 [08:21<12:21, 12.79s/it]0.05181569432754945
epoch:  42%|████▏     | 42/100 [08:34<11:49, 12.24s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 01:14:28,637) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 01:14:28,653) INFO - qlib.workflow - [recorder.py:341] - Recorder b994d4b0d5334b01b7243288cc3d7c4b starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 10.91it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.78it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.76it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.74it/s]online:  16%|█▌        | 10/63 [00:00<00:04, 10.70it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.68it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.66it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.72it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.65it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.70it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.68it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.68it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.70it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.64it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.71it/s]online:  51%|█████     | 32/63 [00:02<00:02, 10.63it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.69it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.68it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.67it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.65it/s]online:  67%|██████▋   | 42/63 [00:03<00:01, 10.63it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.64it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.64it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.67it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.71it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.67it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.68it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.75it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.63it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.65it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.67it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.70it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 01:14:47,894) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9973021 mae 0.68617964
{'IC': 0.028109255801935545,
 'ICIR': 0.25496326449677176,
 'Rank IC': 0.021522371019578584,
 'Rank ICIR': 0.19963250968796312}
[2955773:MainThread](2024-04-25 01:14:49,740) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 01:15:05,659) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 01:15:05,662) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 01:15:11,768) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0c6423e7c0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:47,  9.05it/s]backtest loop:   1%|          | 9/971 [00:00<00:39, 24.17it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:25, 36.78it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:24, 39.40it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:20, 46.57it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 47.09it/s]backtest loop:   4%|▍         | 41/971 [00:01<00:17, 52.22it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:16, 55.43it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 53.52it/s]backtest loop:   6%|▌         | 60/971 [00:01<00:16, 55.11it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:16, 54.58it/s]backtest loop:   8%|▊         | 74/971 [00:01<00:15, 57.51it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:15, 59.01it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:15, 56.37it/s]backtest loop:  10%|▉         | 94/971 [00:01<00:14, 58.48it/s]backtest loop:  10%|█         | 101/971 [00:02<00:14, 59.65it/s]backtest loop:  11%|█         | 107/971 [00:02<00:15, 56.43it/s]backtest loop:  12%|█▏        | 114/971 [00:02<00:14, 58.11it/s]backtest loop:  12%|█▏        | 121/971 [00:02<00:14, 59.43it/s]backtest loop:  13%|█▎        | 127/971 [00:02<00:15, 53.21it/s]backtest loop:  14%|█▍        | 134/971 [00:02<00:15, 55.73it/s]backtest loop:  14%|█▍        | 140/971 [00:02<00:14, 56.44it/s]backtest loop:  15%|█▌        | 146/971 [00:02<00:15, 54.19it/s]backtest loop:  16%|█▌        | 152/971 [00:02<00:14, 55.06it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:14, 57.11it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:13, 57.67it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:14, 54.80it/s]backtest loop:  18%|█▊        | 178/971 [00:03<00:13, 57.23it/s]backtest loop:  19%|█▉        | 185/971 [00:03<00:14, 55.42it/s]backtest loop:  20%|█▉        | 192/971 [00:03<00:13, 57.88it/s]backtest loop:  20%|██        | 199/971 [00:03<00:13, 59.19it/s]backtest loop:  21%|██        | 205/971 [00:03<00:13, 56.10it/s]backtest loop:  22%|██▏       | 212/971 [00:03<00:13, 57.91it/s]backtest loop:  22%|██▏       | 218/971 [00:04<00:13, 55.56it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:13, 54.49it/s]backtest loop:  24%|██▍       | 232/971 [00:04<00:13, 56.80it/s]backtest loop:  25%|██▍       | 239/971 [00:04<00:12, 58.61it/s]backtest loop:  25%|██▌       | 245/971 [00:04<00:12, 55.89it/s]backtest loop:  26%|██▌       | 251/971 [00:04<00:12, 56.79it/s]backtest loop:  26%|██▋       | 257/971 [00:04<00:12, 57.67it/s]backtest loop:  27%|██▋       | 264/971 [00:04<00:12, 55.73it/s]backtest loop:  28%|██▊       | 270/971 [00:05<00:12, 56.51it/s]backtest loop:  28%|██▊       | 276/971 [00:05<00:12, 54.26it/s]backtest loop:  29%|██▉       | 282/971 [00:05<00:12, 54.78it/s]backtest loop:  30%|██▉       | 288/971 [00:05<00:12, 55.98it/s]backtest loop:  30%|███       | 295/971 [00:05<00:12, 54.72it/s]backtest loop:  31%|███       | 301/971 [00:05<00:11, 56.07it/s]backtest loop:  32%|███▏      | 307/971 [00:05<00:11, 56.77it/s]backtest loop:  32%|███▏      | 313/971 [00:05<00:11, 57.49it/s]backtest loop:  33%|███▎      | 320/971 [00:05<00:11, 55.58it/s]backtest loop:  34%|███▎      | 326/971 [00:06<00:11, 56.56it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:10, 58.31it/s]backtest loop:  35%|███▌      | 340/971 [00:06<00:11, 56.26it/s]backtest loop:  36%|███▌      | 346/971 [00:06<00:10, 56.99it/s]backtest loop:  36%|███▋      | 353/971 [00:06<00:10, 58.83it/s]backtest loop:  37%|███▋      | 360/971 [00:06<00:10, 57.15it/s]backtest loop:  38%|███▊      | 367/971 [00:06<00:10, 55.79it/s]backtest loop:  38%|███▊      | 373/971 [00:06<00:11, 53.79it/s]backtest loop:  39%|███▉      | 379/971 [00:06<00:10, 55.20it/s]backtest loop:  40%|███▉      | 386/971 [00:07<00:10, 57.44it/s]backtest loop:  40%|████      | 393/971 [00:07<00:10, 55.72it/s]backtest loop:  41%|████      | 400/971 [00:07<00:09, 57.84it/s]backtest loop:  42%|████▏     | 406/971 [00:07<00:09, 58.36it/s]backtest loop:  42%|████▏     | 412/971 [00:07<00:09, 58.64it/s]backtest loop:  43%|████▎     | 418/971 [00:07<00:09, 55.46it/s]backtest loop:  44%|████▎     | 424/971 [00:07<00:09, 56.63it/s]backtest loop:  44%|████▍     | 430/971 [00:07<00:09, 57.44it/s]backtest loop:  45%|████▍     | 436/971 [00:07<00:09, 58.04it/s]backtest loop:  46%|████▌     | 442/971 [00:08<00:09, 55.12it/s]backtest loop:  46%|████▌     | 448/971 [00:08<00:09, 56.23it/s]backtest loop:  47%|████▋     | 455/971 [00:08<00:08, 58.47it/s]backtest loop:  47%|████▋     | 461/971 [00:08<00:08, 58.86it/s]backtest loop:  48%|████▊     | 467/971 [00:08<00:09, 55.41it/s]backtest loop:  49%|████▊     | 473/971 [00:08<00:08, 56.67it/s]backtest loop:  49%|████▉     | 479/971 [00:08<00:08, 57.57it/s]backtest loop:  50%|█████     | 486/971 [00:08<00:08, 59.09it/s]backtest loop:  51%|█████     | 492/971 [00:08<00:08, 56.17it/s]backtest loop:  51%|█████▏    | 499/971 [00:09<00:08, 58.10it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:08, 55.96it/s]backtest loop:  53%|█████▎    | 511/971 [00:09<00:08, 56.86it/s]backtest loop:  53%|█████▎    | 517/971 [00:09<00:08, 54.33it/s]backtest loop:  54%|█████▍    | 524/971 [00:09<00:07, 56.77it/s]backtest loop:  55%|█████▍    | 531/971 [00:09<00:07, 55.50it/s]backtest loop:  55%|█████▌    | 537/971 [00:09<00:07, 56.56it/s]backtest loop:  56%|█████▌    | 543/971 [00:09<00:07, 57.45it/s]backtest loop:  57%|█████▋    | 550/971 [00:09<00:07, 58.90it/s]backtest loop:  57%|█████▋    | 556/971 [00:10<00:07, 56.03it/s]backtest loop:  58%|█████▊    | 562/971 [00:10<00:07, 56.91it/s]backtest loop:  59%|█████▊    | 569/971 [00:10<00:06, 58.46it/s]backtest loop:  59%|█████▉    | 576/971 [00:10<00:07, 56.33it/s]backtest loop:  60%|█████▉    | 582/971 [00:10<00:06, 57.17it/s]backtest loop:  61%|██████    | 588/971 [00:10<00:06, 57.88it/s]backtest loop:  61%|██████    | 594/971 [00:10<00:06, 58.38it/s]backtest loop:  62%|██████▏   | 600/971 [00:10<00:06, 55.28it/s]backtest loop:  63%|██████▎   | 607/971 [00:10<00:06, 57.35it/s]backtest loop:  63%|██████▎   | 613/971 [00:11<00:06, 57.81it/s]backtest loop:  64%|██████▎   | 619/971 [00:11<00:06, 56.46it/s]backtest loop:  64%|██████▍   | 625/971 [00:11<00:06, 52.47it/s]backtest loop:  65%|██████▍   | 631/971 [00:11<00:06, 53.11it/s]backtest loop:  66%|██████▌   | 637/971 [00:11<00:06, 53.57it/s]backtest loop:  66%|██████▌   | 643/971 [00:11<00:06, 53.67it/s]backtest loop:  67%|██████▋   | 649/971 [00:11<00:05, 53.98it/s]backtest loop:  67%|██████▋   | 655/971 [00:11<00:06, 51.11it/s]backtest loop:  68%|██████▊   | 661/971 [00:11<00:05, 52.14it/s]backtest loop:  69%|██████▊   | 667/971 [00:12<00:05, 52.69it/s]backtest loop:  69%|██████▉   | 673/971 [00:12<00:05, 53.15it/s]backtest loop:  70%|██████▉   | 679/971 [00:12<00:05, 50.23it/s]backtest loop:  71%|███████   | 685/971 [00:12<00:05, 51.34it/s]backtest loop:  71%|███████   | 691/971 [00:12<00:05, 52.22it/s]backtest loop:  72%|███████▏  | 697/971 [00:12<00:05, 52.91it/s]backtest loop:  72%|███████▏  | 703/971 [00:12<00:05, 53.59it/s]backtest loop:  73%|███████▎  | 709/971 [00:12<00:05, 50.37it/s]backtest loop:  74%|███████▎  | 715/971 [00:13<00:04, 51.36it/s]backtest loop:  74%|███████▍  | 721/971 [00:13<00:04, 52.27it/s]backtest loop:  75%|███████▍  | 727/971 [00:13<00:04, 52.93it/s]backtest loop:  75%|███████▌  | 733/971 [00:13<00:05, 47.15it/s]backtest loop:  76%|███████▌  | 739/971 [00:13<00:04, 48.97it/s]backtest loop:  77%|███████▋  | 745/971 [00:13<00:04, 50.62it/s]backtest loop:  77%|███████▋  | 751/971 [00:13<00:04, 48.95it/s]backtest loop:  78%|███████▊  | 757/971 [00:13<00:04, 50.89it/s]backtest loop:  79%|███████▊  | 763/971 [00:13<00:03, 52.11it/s]backtest loop:  79%|███████▉  | 769/971 [00:14<00:03, 53.67it/s]backtest loop:  80%|███████▉  | 775/971 [00:14<00:03, 51.39it/s]backtest loop:  80%|████████  | 781/971 [00:14<00:03, 52.75it/s]backtest loop:  81%|████████  | 787/971 [00:14<00:03, 53.97it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 50.80it/s]backtest loop:  82%|████████▏ | 799/971 [00:14<00:03, 51.85it/s]backtest loop:  83%|████████▎ | 805/971 [00:14<00:03, 52.73it/s]backtest loop:  84%|████████▎ | 811/971 [00:14<00:03, 53.33it/s]backtest loop:  84%|████████▍ | 817/971 [00:15<00:02, 53.62it/s]backtest loop:  85%|████████▍ | 823/971 [00:15<00:02, 50.66it/s]backtest loop:  85%|████████▌ | 829/971 [00:15<00:02, 51.46it/s]backtest loop:  86%|████████▌ | 835/971 [00:15<00:02, 52.30it/s]backtest loop:  87%|████████▋ | 841/971 [00:15<00:02, 52.98it/s]backtest loop:  87%|████████▋ | 847/971 [00:15<00:02, 53.54it/s]backtest loop:  88%|████████▊ | 853/971 [00:15<00:02, 50.63it/s]backtest loop:  88%|████████▊ | 859/971 [00:15<00:02, 51.37it/s]backtest loop:  89%|████████▉ | 865/971 [00:15<00:02, 52.42it/s]backtest loop:  90%|████████▉ | 871/971 [00:16<00:01, 53.08it/s]backtest loop:  90%|█████████ | 877/971 [00:16<00:01, 50.36it/s]backtest loop:  91%|█████████ | 883/971 [00:16<00:01, 51.84it/s]backtest loop:  92%|█████████▏| 889/971 [00:16<00:01, 52.30it/s]backtest loop:  92%|█████████▏| 895/971 [00:16<00:01, 52.92it/s]backtest loop:  93%|█████████▎| 901/971 [00:16<00:01, 53.46it/s]backtest loop:  93%|█████████▎| 907/971 [00:16<00:01, 50.86it/s]backtest loop:  94%|█████████▍| 913/971 [00:16<00:01, 51.84it/s]backtest loop:  95%|█████████▍| 919/971 [00:16<00:00, 52.25it/s]backtest loop:  95%|█████████▌| 925/971 [00:17<00:00, 52.87it/s]backtest loop:  96%|█████████▌| 931/971 [00:17<00:00, 50.18it/s]backtest loop:  96%|█████████▋| 937/971 [00:17<00:00, 51.54it/s]backtest loop:  97%|█████████▋| 943/971 [00:17<00:00, 52.42it/s]backtest loop:  98%|█████████▊| 949/971 [00:17<00:00, 52.77it/s]backtest loop:  98%|█████████▊| 955/971 [00:17<00:00, 50.16it/s]backtest loop:  99%|█████████▉| 961/971 [00:17<00:00, 51.38it/s]backtest loop: 100%|█████████▉| 967/971 [00:17<00:00, 52.42it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 53.99it/s]
[2955773:MainThread](2024-04-25 01:15:29,831) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000441
std                0.004840
annualized_return  0.105059
information_ratio  1.407147
max_drawdown      -0.099918
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000249
std                0.004842
annualized_return  0.059165
information_ratio  0.792087
max_drawdown      -0.117511
[2955773:MainThread](2024-04-25 01:15:29,848) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 9 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464,
                                                    0.019105634311371505,
                                                    0.0816192178944375,
                                                    0.05196743618995587,
                                                    0.07364360235459269,
                                                    0.07529512078101458,
                                                    0.05589678848065261,
                                                    0.059165261532363934],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314,
                                                    0.2606514610551633,
                                                    1.1537603040229327,
                                                    0.7002100933966647,
                                                    1.0694534222341312,
                                                    0.9969539601730383,
                                                    0.7674654740722182,
                                                    0.7920868737464651],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274,
                                               -0.12294148723484218,
                                               -0.07168188587056515,
                                               -0.10481767459217074,
                                               -0.10415757904585374,
                                               -0.1338620400408268,
                                               -0.11001319606469137,
                                               -0.11751058757290644],
 'IC': [0.027428014568116936,
        0.02918433457730239,
        0.02841997940888336,
        0.028899194346999706,
        0.028319585873825204,
        0.02899478143403294,
        0.029984915772930446,
        0.029116316571044177,
        0.028109255801935545],
 'ICIR': [0.2387005207618663,
          0.26166720227076895,
          0.26074474219927596,
          0.25816670056249374,
          0.25939505641981636,
          0.27354621293650927,
          0.27204557251335987,
          0.2543607181386511,
          0.25496326449677176],
 'Rank IC': [0.017899936121617426,
             0.023050650417454972,
             0.021150826288890614,
             0.021484763144688775,
             0.021629620551719252,
             0.022469562981714118,
             0.02492360353697047,
             0.02069513703222315,
             0.021522371019578584],
 'Rank ICIR': [0.15498014880934224,
               0.2092031518636296,
               0.2079182482330708,
               0.19117984399097265,
               0.2027589236785842,
               0.21744567464166992,
               0.24825806870214548,
               0.1839782561248118,
               0.19963250968796312],
 'mae': [0.6861302852630615,
         0.6859831809997559,
         0.686088502407074,
         0.6860310435295105,
         0.6860296726226807,
         0.6861463785171509,
         0.6860765218734741,
         0.6861778497695923,
         0.6861796379089355],
 'mse': [0.9973626136779785,
         0.9971274733543396,
         0.9974362850189209,
         0.9972577095031738,
         0.9972612857818604,
         0.9972525238990784,
         0.9974656701087952,
         0.9972532391548157,
         0.9973021149635315]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2955773:MainThread](2024-04-25 01:15:31,187) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[2955773:MainThread](2024-04-25 01:15:31,187) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:11<19:21, 11.73s/it]epoch:   2%|▏         | 2/100 [00:22<18:20, 11.23s/it]epoch:   3%|▎         | 3/100 [00:33<18:08, 11.22s/it]epoch:   4%|▍         | 4/100 [00:45<17:58, 11.23s/it]epoch:   5%|▌         | 5/100 [00:56<17:37, 11.13s/it]epoch:   6%|▌         | 6/100 [01:06<17:17, 11.04s/it]epoch:   7%|▋         | 7/100 [01:17<17:03, 11.00s/it]epoch:   8%|▊         | 8/100 [01:29<16:58, 11.08s/it]epoch:   9%|▉         | 9/100 [01:40<16:54, 11.14s/it]epoch:  10%|█         | 10/100 [01:51<16:38, 11.10s/it]epoch:  11%|█         | 11/100 [02:02<16:24, 11.07s/it]epoch:  12%|█▏        | 12/100 [02:13<16:10, 11.02s/it]epoch:  13%|█▎        | 13/100 [02:24<16:06, 11.11s/it]epoch:  14%|█▍        | 14/100 [02:36<16:05, 11.23s/it]epoch:  15%|█▌        | 15/100 [02:47<15:48, 11.16s/it]epoch:  16%|█▌        | 16/100 [02:57<15:30, 11.08s/it]epoch:  17%|█▋        | 17/100 [03:08<15:17, 11.05s/it]epoch:  18%|█▊        | 18/100 [03:20<15:13, 11.14s/it]epoch:  19%|█▉        | 19/100 [03:31<15:08, 11.21s/it]epoch:  20%|██        | 20/100 [03:42<14:52, 11.15s/it]0.052439302110689034
best ic: 0.052439302110689034
epoch:  21%|██        | 21/100 [03:55<15:15, 11.59s/it]0.05111505202095186
epoch:  22%|██▏       | 22/100 [04:07<15:27, 11.89s/it]0.0525716173124379
best ic: 0.0525716173124379
epoch:  23%|██▎       | 23/100 [04:20<15:40, 12.21s/it]0.05141461392265008
epoch:  24%|██▍       | 24/100 [04:33<15:41, 12.39s/it]0.053026484166454016
best ic: 0.053026484166454016
epoch:  25%|██▌       | 25/100 [04:46<15:32, 12.43s/it]0.056090694994706876
best ic: 0.056090694994706876
epoch:  26%|██▌       | 26/100 [04:58<15:19, 12.42s/it]0.05580156302513025
epoch:  27%|██▋       | 27/100 [05:11<15:09, 12.46s/it]0.05061429569067343
epoch:  28%|██▊       | 28/100 [05:24<15:08, 12.61s/it]0.04865775185826405
epoch:  29%|██▉       | 29/100 [05:36<14:56, 12.63s/it]0.05284432701268105
epoch:  30%|███       | 30/100 [05:49<14:40, 12.58s/it]0.05284259251363887
epoch:  31%|███       | 31/100 [06:01<14:26, 12.55s/it]0.049814497515700135
epoch:  32%|███▏      | 32/100 [06:14<14:20, 12.66s/it]0.05192501072760917
epoch:  33%|███▎      | 33/100 [06:27<14:16, 12.78s/it]0.05680389953975715
best ic: 0.05680389953975715
epoch:  34%|███▍      | 34/100 [06:40<14:01, 12.76s/it]0.05273824093857246
epoch:  35%|███▌      | 35/100 [06:52<13:44, 12.68s/it]0.05571878518246874
epoch:  36%|███▌      | 36/100 [07:05<13:28, 12.63s/it]0.05224730941087181
epoch:  37%|███▋      | 37/100 [07:18<13:21, 12.73s/it]0.05196362799449258
epoch:  38%|███▊      | 38/100 [07:31<13:15, 12.83s/it]0.05194715654124684
epoch:  39%|███▉      | 39/100 [07:44<12:59, 12.77s/it]0.05243242230253006
epoch:  40%|████      | 40/100 [07:56<12:40, 12.68s/it]0.05345153004493604
epoch:  41%|████      | 41/100 [08:09<12:25, 12.64s/it]0.0510139223655126
epoch:  41%|████      | 41/100 [08:22<12:02, 12.25s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2955773:MainThread](2024-04-25 01:23:53,401) INFO - qlib.workflow - [exp.py:258] - Experiment 44 starts running ...
[2955773:MainThread](2024-04-25 01:23:53,416) INFO - qlib.workflow - [recorder.py:341] - Recorder eebd314ef39a47e8b31d934c324c5350 starts running under Experiment 44 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|▎         | 2/63 [00:00<00:05, 10.95it/s]online:   6%|▋         | 4/63 [00:00<00:05, 10.56it/s]online:  10%|▉         | 6/63 [00:00<00:05, 10.53it/s]online:  13%|█▎        | 8/63 [00:00<00:05, 10.58it/s]online:  16%|█▌        | 10/63 [00:00<00:05, 10.50it/s]online:  19%|█▉        | 12/63 [00:01<00:04, 10.50it/s]online:  22%|██▏       | 14/63 [00:01<00:04, 10.71it/s]online:  25%|██▌       | 16/63 [00:01<00:04, 10.55it/s]online:  29%|██▊       | 18/63 [00:01<00:04, 10.59it/s]online:  32%|███▏      | 20/63 [00:01<00:04, 10.67it/s]online:  35%|███▍      | 22/63 [00:02<00:03, 10.54it/s]online:  38%|███▊      | 24/63 [00:02<00:03, 10.61it/s]online:  41%|████▏     | 26/63 [00:02<00:03, 10.61it/s]online:  44%|████▍     | 28/63 [00:02<00:03, 10.73it/s]online:  48%|████▊     | 30/63 [00:02<00:03, 10.72it/s]online:  51%|█████     | 32/63 [00:03<00:02, 10.72it/s]online:  54%|█████▍    | 34/63 [00:03<00:02, 10.66it/s]online:  57%|█████▋    | 36/63 [00:03<00:02, 10.58it/s]online:  60%|██████    | 38/63 [00:03<00:02, 10.65it/s]online:  63%|██████▎   | 40/63 [00:03<00:02, 10.64it/s]online:  67%|██████▋   | 42/63 [00:03<00:01, 10.59it/s]online:  70%|██████▉   | 44/63 [00:04<00:01, 10.60it/s]online:  73%|███████▎  | 46/63 [00:04<00:01, 10.61it/s]online:  76%|███████▌  | 48/63 [00:04<00:01, 10.63it/s]online:  79%|███████▉  | 50/63 [00:04<00:01, 10.67it/s]online:  83%|████████▎ | 52/63 [00:04<00:01, 10.71it/s]online:  86%|████████▌ | 54/63 [00:05<00:00, 10.48it/s]online:  89%|████████▉ | 56/63 [00:05<00:00, 10.66it/s]online:  92%|█████████▏| 58/63 [00:05<00:00, 10.64it/s]online:  95%|█████████▌| 60/63 [00:05<00:00, 10.65it/s]online:  98%|█████████▊| 62/63 [00:05<00:00, 10.61it/s]online: 100%|██████████| 63/63 [00:05<00:00, 10.65it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2955773:MainThread](2024-04-25 01:24:12,472) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9972941 mae 0.68610334
{'IC': 0.026704243032308082,
 'ICIR': 0.23597571651898117,
 'Rank IC': 0.01941591157985472,
 'Rank ICIR': 0.1755450158459971}
[2955773:MainThread](2024-04-25 01:24:14,420) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2955773:MainThread](2024-04-25 01:24:30,021) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 01:24:30,024) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2955773:MainThread](2024-04-25 01:24:36,133) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0c645ce9a0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:46,  9.08it/s]backtest loop:   1%|          | 9/971 [00:00<00:39, 24.40it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:27, 34.96it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 40.27it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:20, 45.75it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 48.21it/s]backtest loop:   4%|▍         | 40/971 [00:00<00:18, 51.09it/s]backtest loop:   5%|▍         | 47/971 [00:01<00:16, 54.51it/s]backtest loop:   5%|▌         | 53/971 [00:01<00:16, 56.04it/s]backtest loop:   6%|▌         | 59/971 [00:01<00:16, 53.70it/s]backtest loop:   7%|▋         | 66/971 [00:01<00:16, 56.54it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 54.23it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:15, 56.86it/s]backtest loop:   9%|▉         | 86/971 [00:01<00:15, 58.53it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 56.21it/s]backtest loop:  10%|█         | 99/971 [00:02<00:15, 57.95it/s]backtest loop:  11%|█         | 106/971 [00:02<00:14, 59.28it/s]backtest loop:  12%|█▏        | 112/971 [00:02<00:15, 56.37it/s]backtest loop:  12%|█▏        | 119/971 [00:02<00:14, 57.95it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:15, 55.48it/s]backtest loop:  13%|█▎        | 131/971 [00:02<00:15, 53.64it/s]backtest loop:  14%|█▍        | 138/971 [00:02<00:14, 56.16it/s]backtest loop:  15%|█▍        | 145/971 [00:02<00:14, 57.93it/s]backtest loop:  16%|█▌        | 151/971 [00:02<00:14, 55.24it/s]backtest loop:  16%|█▌        | 157/971 [00:03<00:14, 56.23it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:14, 57.20it/s]backtest loop:  17%|█▋        | 169/971 [00:03<00:13, 57.49it/s]backtest loop:  18%|█▊        | 176/971 [00:03<00:14, 55.92it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:13, 57.83it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:13, 56.29it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 58.09it/s]backtest loop:  21%|██        | 203/971 [00:03<00:13, 58.52it/s]backtest loop:  22%|██▏       | 210/971 [00:03<00:13, 56.29it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 53.99it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:13, 55.55it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:12, 57.65it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:13, 55.29it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:12, 57.46it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:12, 55.82it/s]backtest loop:  26%|██▋       | 256/971 [00:04<00:12, 57.72it/s]backtest loop:  27%|██▋       | 263/971 [00:04<00:11, 59.20it/s]backtest loop:  28%|██▊       | 269/971 [00:05<00:12, 56.16it/s]backtest loop:  28%|██▊       | 275/971 [00:05<00:12, 57.14it/s]backtest loop:  29%|██▉       | 281/971 [00:05<00:12, 54.64it/s]backtest loop:  30%|██▉       | 288/971 [00:05<00:12, 56.67it/s]backtest loop:  30%|███       | 295/971 [00:05<00:12, 55.36it/s]backtest loop:  31%|███       | 302/971 [00:05<00:11, 57.42it/s]backtest loop:  32%|███▏      | 309/971 [00:05<00:11, 58.81it/s]backtest loop:  32%|███▏      | 315/971 [00:05<00:11, 56.02it/s]backtest loop:  33%|███▎      | 322/971 [00:05<00:11, 58.08it/s]backtest loop:  34%|███▍      | 329/971 [00:06<00:10, 59.39it/s]backtest loop:  35%|███▍      | 335/971 [00:06<00:11, 56.31it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:10, 57.91it/s]backtest loop:  36%|███▌      | 349/971 [00:06<00:10, 59.62it/s]backtest loop:  37%|███▋      | 355/971 [00:06<00:10, 56.31it/s]backtest loop:  37%|███▋      | 362/971 [00:06<00:10, 58.14it/s]backtest loop:  38%|███▊      | 368/971 [00:06<00:11, 52.75it/s]backtest loop:  39%|███▊      | 375/971 [00:06<00:10, 55.40it/s]backtest loop:  39%|███▉      | 382/971 [00:06<00:10, 57.40it/s]backtest loop:  40%|███▉      | 388/971 [00:07<00:10, 54.90it/s]backtest loop:  41%|████      | 394/971 [00:07<00:10, 56.20it/s]backtest loop:  41%|████      | 400/971 [00:07<00:10, 57.05it/s]backtest loop:  42%|████▏     | 406/971 [00:07<00:09, 57.71it/s]backtest loop:  42%|████▏     | 412/971 [00:07<00:09, 58.36it/s]backtest loop:  43%|████▎     | 418/971 [00:07<00:10, 55.18it/s]backtest loop:  44%|████▎     | 424/971 [00:07<00:09, 56.20it/s]backtest loop:  44%|████▍     | 430/971 [00:07<00:09, 57.19it/s]backtest loop:  45%|████▍     | 436/971 [00:07<00:09, 57.87it/s]backtest loop:  46%|████▌     | 442/971 [00:08<00:09, 54.85it/s]backtest loop:  46%|████▌     | 448/971 [00:08<00:09, 56.18it/s]backtest loop:  47%|████▋     | 454/971 [00:08<00:09, 57.25it/s]backtest loop:  47%|████▋     | 460/971 [00:08<00:08, 57.87it/s]backtest loop:  48%|████▊     | 466/971 [00:08<00:08, 58.43it/s]backtest loop:  49%|████▊     | 472/971 [00:08<00:09, 55.17it/s]backtest loop:  49%|████▉     | 479/971 [00:08<00:08, 57.78it/s]backtest loop:  50%|█████     | 486/971 [00:08<00:08, 59.54it/s]backtest loop:  51%|█████     | 492/971 [00:08<00:08, 56.56it/s]backtest loop:  51%|█████▏    | 499/971 [00:09<00:08, 58.28it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:08, 55.94it/s]backtest loop:  53%|█████▎    | 512/971 [00:09<00:08, 54.57it/s]backtest loop:  53%|█████▎    | 519/971 [00:09<00:07, 56.77it/s]backtest loop:  54%|█████▍    | 526/971 [00:09<00:08, 55.31it/s]backtest loop:  55%|█████▍    | 533/971 [00:09<00:07, 57.23it/s]backtest loop:  56%|█████▌    | 540/971 [00:09<00:07, 58.63it/s]backtest loop:  56%|█████▌    | 546/971 [00:09<00:07, 55.80it/s]backtest loop:  57%|█████▋    | 552/971 [00:09<00:07, 56.75it/s]backtest loop:  58%|█████▊    | 559/971 [00:10<00:07, 58.54it/s]backtest loop:  58%|█████▊    | 566/971 [00:10<00:07, 56.37it/s]backtest loop:  59%|█████▉    | 573/971 [00:10<00:06, 58.11it/s]backtest loop:  60%|█████▉    | 580/971 [00:10<00:06, 59.38it/s]backtest loop:  60%|██████    | 586/971 [00:10<00:06, 56.30it/s]backtest loop:  61%|██████    | 593/971 [00:10<00:06, 58.05it/s]backtest loop:  62%|██████▏   | 599/971 [00:10<00:06, 58.58it/s]backtest loop:  62%|██████▏   | 605/971 [00:10<00:06, 55.77it/s]backtest loop:  63%|██████▎   | 611/971 [00:11<00:06, 56.51it/s]backtest loop:  64%|██████▎   | 618/971 [00:11<00:06, 58.46it/s]backtest loop:  64%|██████▍   | 625/971 [00:11<00:06, 56.27it/s]backtest loop:  65%|██████▍   | 631/971 [00:11<00:05, 56.85it/s]backtest loop:  66%|██████▌   | 638/971 [00:11<00:05, 58.36it/s]backtest loop:  66%|██████▋   | 645/971 [00:11<00:05, 56.23it/s]backtest loop:  67%|██████▋   | 652/971 [00:11<00:05, 57.97it/s]backtest loop:  68%|██████▊   | 659/971 [00:11<00:05, 59.43it/s]backtest loop:  68%|██████▊   | 665/971 [00:11<00:05, 56.31it/s]backtest loop:  69%|██████▉   | 672/971 [00:12<00:05, 57.99it/s]backtest loop:  70%|██████▉   | 678/971 [00:12<00:05, 58.25it/s]backtest loop:  70%|███████   | 684/971 [00:12<00:05, 55.16it/s]backtest loop:  71%|███████   | 690/971 [00:12<00:04, 56.46it/s]backtest loop:  72%|███████▏  | 697/971 [00:12<00:04, 58.14it/s]backtest loop:  73%|███████▎  | 704/971 [00:12<00:04, 56.13it/s]backtest loop:  73%|███████▎  | 711/971 [00:12<00:04, 58.03it/s]backtest loop:  74%|███████▍  | 718/971 [00:12<00:04, 59.31it/s]backtest loop:  75%|███████▍  | 724/971 [00:12<00:04, 56.14it/s]backtest loop:  75%|███████▌  | 731/971 [00:13<00:04, 55.23it/s]backtest loop:  76%|███████▌  | 738/971 [00:13<00:04, 54.25it/s]backtest loop:  77%|███████▋  | 745/971 [00:13<00:04, 56.40it/s]backtest loop:  77%|███████▋  | 751/971 [00:13<00:04, 54.30it/s]backtest loop:  78%|███████▊  | 758/971 [00:13<00:03, 56.74it/s]backtest loop:  79%|███████▉  | 765/971 [00:13<00:03, 55.26it/s]backtest loop:  79%|███████▉  | 771/971 [00:13<00:03, 56.39it/s]backtest loop:  80%|████████  | 778/971 [00:13<00:03, 58.19it/s]backtest loop:  81%|████████  | 784/971 [00:14<00:03, 55.71it/s]backtest loop:  81%|████████▏ | 791/971 [00:14<00:03, 57.56it/s]backtest loop:  82%|████████▏ | 798/971 [00:14<00:03, 56.07it/s]backtest loop:  83%|████████▎ | 805/971 [00:14<00:02, 57.71it/s]backtest loop:  84%|████████▎ | 812/971 [00:14<00:02, 59.00it/s]backtest loop:  84%|████████▍ | 818/971 [00:14<00:02, 55.97it/s]backtest loop:  85%|████████▍ | 825/971 [00:14<00:02, 57.72it/s]backtest loop:  86%|████████▌ | 832/971 [00:14<00:02, 58.95it/s]backtest loop:  86%|████████▋ | 838/971 [00:15<00:02, 55.75it/s]backtest loop:  87%|████████▋ | 844/971 [00:15<00:02, 56.80it/s]backtest loop:  88%|████████▊ | 851/971 [00:15<00:02, 58.35it/s]backtest loop:  88%|████████▊ | 857/971 [00:15<00:02, 55.50it/s]backtest loop:  89%|████████▉ | 863/971 [00:15<00:01, 56.71it/s]backtest loop:  90%|████████▉ | 870/971 [00:15<00:01, 58.30it/s]backtest loop:  90%|█████████ | 876/971 [00:15<00:01, 58.55it/s]backtest loop:  91%|█████████ | 882/971 [00:15<00:01, 55.63it/s]backtest loop:  92%|█████████▏| 889/971 [00:15<00:01, 57.55it/s]backtest loop:  92%|█████████▏| 896/971 [00:16<00:01, 58.90it/s]backtest loop:  93%|█████████▎| 902/971 [00:16<00:01, 55.98it/s]backtest loop:  94%|█████████▎| 908/971 [00:16<00:01, 56.68it/s]backtest loop:  94%|█████████▍| 915/971 [00:16<00:00, 58.31it/s]backtest loop:  95%|█████████▍| 921/971 [00:16<00:00, 55.48it/s]backtest loop:  96%|█████████▌| 928/971 [00:16<00:00, 57.45it/s]backtest loop:  96%|█████████▋| 935/971 [00:16<00:00, 59.01it/s]backtest loop:  97%|█████████▋| 941/971 [00:16<00:00, 55.56it/s]backtest loop:  98%|█████████▊| 947/971 [00:16<00:00, 56.74it/s]backtest loop:  98%|█████████▊| 953/971 [00:17<00:00, 57.64it/s]backtest loop:  99%|█████████▉| 960/971 [00:17<00:00, 55.74it/s]backtest loop: 100%|█████████▉| 967/971 [00:17<00:00, 57.85it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 56.02it/s]
[2955773:MainThread](2024-04-25 01:24:53,542) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000145
std                0.012140
annualized_return  0.034434
information_ratio  0.183856
max_drawdown      -0.500754
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000442
std                0.004872
annualized_return  0.105143
information_ratio  1.399015
max_drawdown      -0.107392
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000246
std                0.004874
annualized_return  0.058619
information_ratio  0.779571
max_drawdown      -0.128123
[2955773:MainThread](2024-04-25 01:24:53,559) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 44
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_online`.
Round 10 Done!
{'1day.excess_return_with_cost.annualized_return': [0.07995628701867473,
                                                    0.10160859748005464,
                                                    0.019105634311371505,
                                                    0.0816192178944375,
                                                    0.05196743618995587,
                                                    0.07364360235459269,
                                                    0.07529512078101458,
                                                    0.05589678848065261,
                                                    0.059165261532363934,
                                                    0.05861861148142165],
 '1day.excess_return_with_cost.information_ratio': [1.1149653565093183,
                                                    1.4322250019096314,
                                                    0.2606514610551633,
                                                    1.1537603040229327,
                                                    0.7002100933966647,
                                                    1.0694534222341312,
                                                    0.9969539601730383,
                                                    0.7674654740722182,
                                                    0.7920868737464651,
                                                    0.7795707045947114],
 '1day.excess_return_with_cost.max_drawdown': [-0.06796823734818074,
                                               -0.061701145979184274,
                                               -0.12294148723484218,
                                               -0.07168188587056515,
                                               -0.10481767459217074,
                                               -0.10415757904585374,
                                               -0.1338620400408268,
                                               -0.11001319606469137,
                                               -0.11751058757290644,
                                               -0.12812340277167777],
 'IC': [0.027428014568116936,
        0.02918433457730239,
        0.02841997940888336,
        0.028899194346999706,
        0.028319585873825204,
        0.02899478143403294,
        0.029984915772930446,
        0.029116316571044177,
        0.028109255801935545,
        0.026704243032308082],
 'ICIR': [0.2387005207618663,
          0.26166720227076895,
          0.26074474219927596,
          0.25816670056249374,
          0.25939505641981636,
          0.27354621293650927,
          0.27204557251335987,
          0.2543607181386511,
          0.25496326449677176,
          0.23597571651898117],
 'Rank IC': [0.017899936121617426,
             0.023050650417454972,
             0.021150826288890614,
             0.021484763144688775,
             0.021629620551719252,
             0.022469562981714118,
             0.02492360353697047,
             0.02069513703222315,
             0.021522371019578584,
             0.01941591157985472],
 'Rank ICIR': [0.15498014880934224,
               0.2092031518636296,
               0.2079182482330708,
               0.19117984399097265,
               0.2027589236785842,
               0.21744567464166992,
               0.24825806870214548,
               0.1839782561248118,
               0.19963250968796312,
               0.1755450158459971],
 'mae': [0.6861302852630615,
         0.6859831809997559,
         0.686088502407074,
         0.6860310435295105,
         0.6860296726226807,
         0.6861463785171509,
         0.6860765218734741,
         0.6861778497695923,
         0.6861796379089355,
         0.686103343963623],
 'mse': [0.9973626136779785,
         0.9971274733543396,
         0.9974362850189209,
         0.9972577095031738,
         0.9972612857818604,
         0.9972525238990784,
         0.9974656701087952,
         0.9972532391548157,
         0.9973021149635315,
         0.9972941279411316]}
[2955773:MainThread](2024-04-25 01:24:54,921) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_final.
[2955773:MainThread](2024-04-25 01:24:54,956) INFO - qlib.workflow - [exp.py:258] - Experiment 45 starts running ...
[2955773:MainThread](2024-04-25 01:24:54,970) INFO - qlib.workflow - [recorder.py:341] - Recorder dd4bc96947904c4e9d358719ce9d7bac starts running under Experiment 45 ...
Time cost: 516.0496527194977	62.03915808200836
Final results:
{'1day.excess_return_with_cost.annualized_return': [0.06568765575245397,
                                                    0.021094611343389972],
 '1day.excess_return_with_cost.information_ratio': [0.9067342651714274,
                                                    0.3039613952601208],
 '1day.excess_return_with_cost.max_drawdown': [-0.10227772365208994,
                                               0.02480751292591214],
 'IC': [0.02851606213873788, 0.0008955584339782344],
 'ICIR': [0.2569565706818494, 0.011537055286775504],
 'Rank IC': [0.021424238267471207, 0.001819323421781146],
 'Rank ICIR': [0.1990899841578187, 0.023957002146679902],
 'mae': [0.6860946416854858, 6.263069904981753e-05],
 'mse': [0.9973013043403626, 9.351784972967481e-05]}
Your final results can be found in the experiment named `csi500_LSTM_alpha360_horizon1_step20_rankFalse_2024-04-24_23:48:33_final`.
All Done!
[2955773:MainThread](2024-04-25 01:24:56,207) INFO - qlib.timer - [log.py:127] - Time cost: 0.030s | waiting `async_log` Done
