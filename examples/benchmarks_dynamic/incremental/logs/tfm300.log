['main.py', 'run_all', '--forecast_model', 'Transformer', '-num_head', '8', '--train_start=2008-01-01', '--train_end=2018-12-31', '--valid_start=2019-01-01', '--valid_end=2020-03-31', '--test_start=2020-04-01', '--test_end=2024-03-31', '--tau', '10', '--lr_da', '0.01', '--market', 'csi300', '--data_dir', 'crowd_data', '--rank_label', 'False', '--begin_valid_epoch', '30']
[2943066:MainThread](2024-04-24 22:58:20,476) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[2943066:MainThread](2024-04-24 22:58:20,485) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[2943066:MainThread](2024-04-24 22:58:20,485) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Remove CSRankNorm
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSZScoreNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
[2943066:MainThread](2024-04-24 22:58:29,892) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-02 00:00:00'), Timestamp('2008-01-29 00:00:00')), 'test': (Timestamp('2008-01-31 00:00:00'), Timestamp('2008-03-05 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/147 [00:00<?, ?it/s]creating meta tasks:  24%|██▍       | 36/147 [00:00<00:00, 353.67it/s]creating meta tasks:  52%|█████▏    | 76/147 [00:00<00:00, 378.66it/s]creating meta tasks:  80%|████████  | 118/147 [00:00<00:00, 394.99it/s]creating meta tasks: 100%|██████████| 147/147 [00:00<00:00, 393.74it/s]
[2943066:MainThread](2024-04-24 22:58:30,547) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'TransformerModel', 'module_path': 'qlib.contrib.model.pytorch_transformer', 'kwargs': {'d_feat': 6, 'seed': None, 'dim_feedforward': 32, 'reg': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankFalse_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2019-01-02 00:00:00'), Timestamp('2019-01-29 00:00:00')), 'test': (Timestamp('2019-01-31 00:00:00'), Timestamp('2019-03-06 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
creating meta tasks:   0%|          | 0/63 [00:00<?, ?it/s]creating meta tasks:  52%|█████▏    | 33/63 [00:00<00:00, 327.44it/s]creating meta tasks: 100%|██████████| 63/63 [00:00<00:00, 328.16it/s]
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-24 22:58:34,523) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:19<32:30, 19.71s/it]epoch:   2%|▏         | 2/100 [00:37<29:58, 18.35s/it]epoch:   3%|▎         | 3/100 [00:54<29:02, 17.97s/it]epoch:   4%|▍         | 4/100 [01:12<28:27, 17.78s/it]epoch:   5%|▌         | 5/100 [01:29<27:57, 17.65s/it]epoch:   6%|▌         | 6/100 [01:47<27:34, 17.60s/it]epoch:   7%|▋         | 7/100 [02:04<27:11, 17.54s/it]epoch:   8%|▊         | 8/100 [02:21<26:50, 17.50s/it]epoch:   9%|▉         | 9/100 [02:39<26:27, 17.44s/it]epoch:  10%|█         | 10/100 [02:56<26:09, 17.44s/it]epoch:  11%|█         | 11/100 [03:13<25:47, 17.39s/it]epoch:  12%|█▏        | 12/100 [03:31<25:28, 17.37s/it]epoch:  13%|█▎        | 13/100 [03:48<25:10, 17.36s/it]epoch:  14%|█▍        | 14/100 [04:05<24:51, 17.34s/it]epoch:  15%|█▌        | 15/100 [04:23<24:34, 17.34s/it]epoch:  16%|█▌        | 16/100 [04:40<24:21, 17.40s/it]epoch:  17%|█▋        | 17/100 [04:57<23:58, 17.33s/it]epoch:  18%|█▊        | 18/100 [05:15<23:39, 17.31s/it]epoch:  19%|█▉        | 19/100 [05:32<23:27, 17.37s/it]epoch:  20%|██        | 20/100 [05:49<23:05, 17.32s/it]epoch:  21%|██        | 21/100 [06:07<22:45, 17.29s/it]epoch:  22%|██▏       | 22/100 [06:24<22:30, 17.32s/it]epoch:  23%|██▎       | 23/100 [06:41<22:13, 17.31s/it]epoch:  24%|██▍       | 24/100 [06:59<21:54, 17.30s/it]epoch:  25%|██▌       | 25/100 [07:16<21:38, 17.31s/it]epoch:  26%|██▌       | 26/100 [07:33<21:20, 17.31s/it]epoch:  27%|██▋       | 27/100 [07:51<21:03, 17.31s/it]epoch:  28%|██▊       | 28/100 [08:08<20:45, 17.30s/it]epoch:  29%|██▉       | 29/100 [08:25<20:33, 17.37s/it]epoch:  30%|███       | 30/100 [08:42<20:11, 17.31s/it]0.0561175904004304
best ic: 0.0561175904004304
epoch:  31%|███       | 31/100 [09:02<20:39, 17.96s/it]0.050509015391443236
epoch:  32%|███▏      | 32/100 [09:22<20:58, 18.50s/it]0.05573357877304442
epoch:  33%|███▎      | 33/100 [09:41<21:01, 18.83s/it]0.06234932706854832
best ic: 0.06234932706854832
epoch:  34%|███▍      | 34/100 [10:01<20:57, 19.05s/it]0.05051355063017964
epoch:  35%|███▌      | 35/100 [10:21<20:50, 19.23s/it]0.04599951304052044
epoch:  36%|███▌      | 36/100 [10:40<20:35, 19.30s/it]0.055504515936735714
epoch:  37%|███▋      | 37/100 [10:59<20:17, 19.33s/it]0.05451403114204415
epoch:  38%|███▊      | 38/100 [11:19<20:04, 19.42s/it]0.0546447051045714
epoch:  39%|███▉      | 39/100 [11:39<19:46, 19.46s/it]0.05511052371130181
epoch:  40%|████      | 40/100 [11:58<19:26, 19.45s/it]0.05258360979942322
epoch:  41%|████      | 41/100 [12:18<19:12, 19.53s/it]0.050237455855119795
epoch:  41%|████      | 41/100 [12:37<18:10, 18.48s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-24 23:11:18,074) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online.
[2943066:MainThread](2024-04-24 23:11:18,105) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-24 23:11:19,624) INFO - qlib.workflow - [recorder.py:341] - Recorder 5b01ea36fee54610823dbdc4861d8905 starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:07,  7.90it/s]online:   3%|▎         | 2/63 [00:00<00:07,  7.64it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.47it/s]online:   6%|▋         | 4/63 [00:00<00:08,  7.25it/s]online:   8%|▊         | 5/63 [00:00<00:07,  7.26it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.23it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.21it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.34it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.19it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.21it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.21it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  7.25it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.22it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.24it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.23it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.18it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.26it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.27it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.29it/s]online:  32%|███▏      | 20/63 [00:02<00:05,  7.27it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.17it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.17it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.30it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.25it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.19it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.18it/s]online:  43%|████▎     | 27/63 [00:03<00:05,  7.18it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.25it/s]online:  46%|████▌     | 29/63 [00:04<00:04,  7.20it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.29it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  7.30it/s]online:  51%|█████     | 32/63 [00:04<00:04,  7.24it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  7.17it/s]online:  54%|█████▍    | 34/63 [00:04<00:04,  7.19it/s]online:  56%|█████▌    | 35/63 [00:04<00:03,  7.18it/s]online:  57%|█████▋    | 36/63 [00:04<00:03,  7.21it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.20it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.27it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.30it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.16it/s]online:  65%|██████▌   | 41/63 [00:05<00:03,  7.15it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.20it/s]online:  68%|██████▊   | 43/63 [00:05<00:02,  7.20it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.22it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.32it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.35it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.20it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.14it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.20it/s]online:  79%|███████▉  | 50/63 [00:06<00:01,  7.20it/s]online:  81%|████████  | 51/63 [00:07<00:01,  7.19it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.31it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.20it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.35it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.33it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.31it/s]online:  90%|█████████ | 57/63 [00:07<00:00,  7.31it/s]online:  92%|█████████▏| 58/63 [00:08<00:00,  7.31it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.31it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.31it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.29it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.23it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.43it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.26it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-24 23:11:35,123) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99589074 mae 0.70734394
{'IC': 0.02587224613755935,
 'ICIR': 0.18518614400027864,
 'Rank IC': 0.02043466903243119,
 'Rank ICIR': 0.14468640124580973}
[2943066:MainThread](2024-04-24 23:11:36,854) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-24 23:11:48,346) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-24 23:11:48,349) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-24 23:11:55,017) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe11c017850>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   1%|          | 5/971 [00:00<00:20, 46.23it/s]backtest loop:   1%|          | 12/971 [00:00<00:19, 49.88it/s]backtest loop:   2%|▏         | 18/971 [00:00<00:17, 53.25it/s]backtest loop:   2%|▏         | 24/971 [00:00<00:18, 51.31it/s]backtest loop:   3%|▎         | 31/971 [00:00<00:16, 55.30it/s]backtest loop:   4%|▍         | 38/971 [00:00<00:16, 57.63it/s]backtest loop:   5%|▍         | 44/971 [00:00<00:16, 55.05it/s]backtest loop:   5%|▌         | 51/971 [00:00<00:16, 57.24it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:16, 54.71it/s]backtest loop:   7%|▋         | 64/971 [00:01<00:15, 57.44it/s]backtest loop:   7%|▋         | 71/971 [00:01<00:15, 58.91it/s]backtest loop:   8%|▊         | 77/971 [00:01<00:15, 56.08it/s]backtest loop:   9%|▊         | 84/971 [00:01<00:15, 57.81it/s]backtest loop:   9%|▉         | 91/971 [00:01<00:14, 59.11it/s]backtest loop:  10%|▉         | 97/971 [00:01<00:15, 56.35it/s]backtest loop:  11%|█         | 104/971 [00:01<00:14, 58.29it/s]backtest loop:  11%|█▏        | 111/971 [00:01<00:14, 59.45it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:15, 56.47it/s]backtest loop:  13%|█▎        | 124/971 [00:02<00:14, 58.32it/s]backtest loop:  13%|█▎        | 130/971 [00:02<00:15, 55.66it/s]backtest loop:  14%|█▍        | 136/971 [00:02<00:15, 53.77it/s]backtest loop:  15%|█▍        | 143/971 [00:02<00:14, 56.27it/s]backtest loop:  15%|█▌        | 149/971 [00:02<00:22, 37.19it/s]backtest loop:  16%|█▌        | 156/971 [00:02<00:19, 41.02it/s]backtest loop:  17%|█▋        | 163/971 [00:03<00:17, 45.99it/s]backtest loop:  17%|█▋        | 169/971 [00:03<00:16, 49.15it/s]backtest loop:  18%|█▊        | 176/971 [00:03<00:15, 50.18it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:14, 53.46it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:14, 53.18it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 55.69it/s]backtest loop:  21%|██        | 204/971 [00:03<00:13, 57.74it/s]backtest loop:  22%|██▏       | 210/971 [00:03<00:13, 55.36it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:14, 53.60it/s]backtest loop:  23%|██▎       | 223/971 [00:04<00:13, 56.21it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:13, 55.20it/s]backtest loop:  24%|██▍       | 237/971 [00:04<00:12, 57.24it/s]backtest loop:  25%|██▌       | 244/971 [00:04<00:12, 58.79it/s]backtest loop:  26%|██▌       | 250/971 [00:04<00:12, 55.68it/s]backtest loop:  26%|██▋       | 257/971 [00:04<00:12, 57.93it/s]backtest loop:  27%|██▋       | 263/971 [00:04<00:12, 58.47it/s]backtest loop:  28%|██▊       | 269/971 [00:04<00:12, 55.89it/s]backtest loop:  28%|██▊       | 275/971 [00:05<00:12, 56.57it/s]backtest loop:  29%|██▉       | 281/971 [00:05<00:12, 54.29it/s]backtest loop:  30%|██▉       | 288/971 [00:05<00:12, 56.70it/s]backtest loop:  30%|███       | 295/971 [00:05<00:12, 55.28it/s]backtest loop:  31%|███       | 302/971 [00:05<00:11, 57.37it/s]backtest loop:  32%|███▏      | 309/971 [00:05<00:11, 58.77it/s]backtest loop:  32%|███▏      | 315/971 [00:05<00:11, 56.00it/s]backtest loop:  33%|███▎      | 322/971 [00:05<00:11, 58.04it/s]backtest loop:  34%|███▍      | 329/971 [00:05<00:10, 59.53it/s]backtest loop:  35%|███▍      | 335/971 [00:06<00:11, 56.71it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:10, 58.25it/s]backtest loop:  36%|███▌      | 349/971 [00:06<00:10, 59.72it/s]backtest loop:  37%|███▋      | 355/971 [00:06<00:10, 56.74it/s]backtest loop:  37%|███▋      | 361/971 [00:06<00:10, 57.48it/s]backtest loop:  38%|███▊      | 367/971 [00:06<00:11, 54.30it/s]backtest loop:  38%|███▊      | 373/971 [00:06<00:11, 52.82it/s]backtest loop:  39%|███▉      | 380/971 [00:06<00:10, 55.81it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:10, 57.89it/s]backtest loop:  40%|████      | 393/971 [00:07<00:10, 55.45it/s]backtest loop:  41%|████      | 400/971 [00:07<00:09, 57.42it/s]backtest loop:  42%|████▏     | 407/971 [00:07<00:09, 58.94it/s]backtest loop:  43%|████▎     | 413/971 [00:07<00:09, 56.32it/s]backtest loop:  43%|████▎     | 419/971 [00:07<00:09, 57.29it/s]backtest loop:  44%|████▍     | 426/971 [00:07<00:09, 59.08it/s]backtest loop:  44%|████▍     | 432/971 [00:07<00:09, 56.15it/s]backtest loop:  45%|████▌     | 438/971 [00:07<00:09, 57.18it/s]backtest loop:  46%|████▌     | 445/971 [00:08<00:08, 58.74it/s]backtest loop:  47%|████▋     | 452/971 [00:08<00:09, 56.58it/s]backtest loop:  47%|████▋     | 459/971 [00:08<00:08, 58.33it/s]backtest loop:  48%|████▊     | 466/971 [00:08<00:08, 59.31it/s]backtest loop:  49%|████▊     | 472/971 [00:08<00:08, 56.43it/s]backtest loop:  49%|████▉     | 479/971 [00:08<00:08, 58.13it/s]backtest loop:  50%|█████     | 486/971 [00:08<00:08, 59.38it/s]backtest loop:  51%|█████     | 492/971 [00:08<00:08, 56.35it/s]backtest loop:  51%|█████▏    | 499/971 [00:08<00:08, 58.05it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:08, 55.66it/s]backtest loop:  53%|█████▎    | 512/971 [00:09<00:08, 54.60it/s]backtest loop:  53%|█████▎    | 519/971 [00:09<00:07, 56.78it/s]backtest loop:  54%|█████▍    | 526/971 [00:09<00:08, 55.38it/s]backtest loop:  55%|█████▍    | 532/971 [00:09<00:07, 56.47it/s]backtest loop:  56%|█████▌    | 539/971 [00:09<00:07, 58.47it/s]backtest loop:  56%|█████▌    | 546/971 [00:09<00:07, 56.75it/s]backtest loop:  57%|█████▋    | 553/971 [00:09<00:07, 58.42it/s]backtest loop:  58%|█████▊    | 560/971 [00:10<00:06, 59.72it/s]backtest loop:  58%|█████▊    | 567/971 [00:10<00:07, 57.40it/s]backtest loop:  59%|█████▉    | 574/971 [00:10<00:06, 58.82it/s]backtest loop:  60%|█████▉    | 581/971 [00:10<00:06, 56.80it/s]backtest loop:  61%|██████    | 588/971 [00:10<00:06, 58.52it/s]backtest loop:  61%|██████▏   | 595/971 [00:10<00:06, 59.62it/s]backtest loop:  62%|██████▏   | 601/971 [00:10<00:06, 56.76it/s]backtest loop:  63%|██████▎   | 608/971 [00:10<00:06, 58.54it/s]backtest loop:  63%|██████▎   | 615/971 [00:10<00:06, 56.75it/s]backtest loop:  64%|██████▍   | 622/971 [00:11<00:05, 58.49it/s]backtest loop:  65%|██████▍   | 629/971 [00:11<00:05, 59.73it/s]backtest loop:  65%|██████▌   | 636/971 [00:11<00:05, 57.25it/s]backtest loop:  66%|██████▌   | 643/971 [00:11<00:05, 58.81it/s]backtest loop:  67%|██████▋   | 650/971 [00:11<00:05, 56.94it/s]backtest loop:  68%|██████▊   | 657/971 [00:11<00:05, 58.27it/s]backtest loop:  68%|██████▊   | 664/971 [00:11<00:05, 59.58it/s]backtest loop:  69%|██████▉   | 670/971 [00:11<00:05, 56.55it/s]backtest loop:  70%|██████▉   | 677/971 [00:12<00:05, 58.27it/s]backtest loop:  70%|███████   | 683/971 [00:12<00:04, 58.51it/s]backtest loop:  71%|███████   | 689/971 [00:12<00:05, 55.79it/s]backtest loop:  72%|███████▏  | 696/971 [00:12<00:04, 57.75it/s]backtest loop:  72%|███████▏  | 702/971 [00:12<00:04, 58.34it/s]backtest loop:  73%|███████▎  | 709/971 [00:12<00:04, 56.41it/s]backtest loop:  74%|███████▎  | 716/971 [00:12<00:04, 58.15it/s]backtest loop:  74%|███████▍  | 722/971 [00:12<00:04, 58.48it/s]backtest loop:  75%|███████▌  | 729/971 [00:12<00:04, 56.52it/s]backtest loop:  76%|███████▌  | 735/971 [00:13<00:04, 54.39it/s]backtest loop:  76%|███████▋  | 742/971 [00:13<00:04, 56.74it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 54.71it/s]backtest loop:  78%|███████▊  | 755/971 [00:13<00:04, 53.94it/s]backtest loop:  78%|███████▊  | 761/971 [00:13<00:03, 55.48it/s]backtest loop:  79%|███████▉  | 768/971 [00:13<00:03, 57.71it/s]backtest loop:  80%|███████▉  | 775/971 [00:13<00:03, 56.14it/s]backtest loop:  80%|████████  | 781/971 [00:13<00:03, 57.07it/s]backtest loop:  81%|████████  | 788/971 [00:14<00:03, 55.50it/s]backtest loop:  82%|████████▏ | 795/971 [00:14<00:03, 57.53it/s]backtest loop:  83%|████████▎ | 802/971 [00:14<00:02, 59.20it/s]backtest loop:  83%|████████▎ | 808/971 [00:14<00:02, 56.11it/s]backtest loop:  84%|████████▍ | 815/971 [00:14<00:02, 57.97it/s]backtest loop:  85%|████████▍ | 822/971 [00:14<00:02, 59.36it/s]backtest loop:  85%|████████▌ | 828/971 [00:14<00:02, 56.67it/s]backtest loop:  86%|████████▌ | 835/971 [00:14<00:02, 58.46it/s]backtest loop:  87%|████████▋ | 841/971 [00:14<00:02, 58.83it/s]backtest loop:  87%|████████▋ | 848/971 [00:15<00:02, 56.67it/s]backtest loop:  88%|████████▊ | 855/971 [00:15<00:01, 58.49it/s]backtest loop:  89%|████████▉ | 862/971 [00:15<00:01, 56.54it/s]backtest loop:  89%|████████▉ | 869/971 [00:15<00:01, 58.38it/s]backtest loop:  90%|█████████ | 876/971 [00:15<00:01, 59.65it/s]backtest loop:  91%|█████████ | 882/971 [00:15<00:01, 56.69it/s]backtest loop:  92%|█████████▏| 889/971 [00:15<00:01, 58.53it/s]backtest loop:  92%|█████████▏| 896/971 [00:15<00:01, 59.71it/s]backtest loop:  93%|█████████▎| 902/971 [00:15<00:01, 56.74it/s]backtest loop:  94%|█████████▎| 909/971 [00:16<00:01, 58.67it/s]backtest loop:  94%|█████████▍| 916/971 [00:16<00:00, 56.68it/s]backtest loop:  95%|█████████▌| 923/971 [00:16<00:00, 58.35it/s]backtest loop:  96%|█████████▌| 930/971 [00:16<00:00, 59.99it/s]backtest loop:  96%|█████████▋| 937/971 [00:16<00:00, 57.52it/s]backtest loop:  97%|█████████▋| 944/971 [00:16<00:00, 59.02it/s]backtest loop:  98%|█████████▊| 950/971 [00:16<00:00, 56.04it/s]backtest loop:  99%|█████████▊| 957/971 [00:16<00:00, 58.02it/s]backtest loop:  99%|█████████▉| 964/971 [00:17<00:00, 59.42it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 56.48it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 56.53it/s]
[2943066:MainThread](2024-04-24 23:12:12,272) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000415
std                0.006222
annualized_return  0.098835
information_ratio  1.029677
max_drawdown      -0.172579
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000216
std                0.006221
annualized_return  0.051435
information_ratio  0.535947
max_drawdown      -0.200239
[2943066:MainThread](2024-04-24 23:12:12,307) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 1 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714],
 'IC': [0.02587224613755935],
 'ICIR': [0.18518614400027864],
 'Rank IC': [0.02043466903243119],
 'Rank ICIR': [0.14468640124580973],
 'mae': [0.7073439359664917],
 'mse': [0.995890736579895]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-24 23:12:13,486) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<29:01, 17.59s/it]epoch:   2%|▏         | 2/100 [00:35<28:43, 17.58s/it]epoch:   3%|▎         | 3/100 [00:52<28:22, 17.55s/it]epoch:   4%|▍         | 4/100 [01:10<27:57, 17.47s/it]epoch:   5%|▌         | 5/100 [01:27<27:38, 17.46s/it]epoch:   6%|▌         | 6/100 [01:44<27:21, 17.46s/it]epoch:   7%|▋         | 7/100 [02:02<27:11, 17.54s/it]epoch:   8%|▊         | 8/100 [02:20<26:49, 17.49s/it]epoch:   9%|▉         | 9/100 [02:37<26:33, 17.51s/it]epoch:  10%|█         | 10/100 [02:54<26:08, 17.43s/it]epoch:  11%|█         | 11/100 [03:12<25:52, 17.44s/it]epoch:  12%|█▏        | 12/100 [03:29<25:36, 17.46s/it]epoch:  13%|█▎        | 13/100 [03:47<25:14, 17.41s/it]epoch:  14%|█▍        | 14/100 [04:04<24:54, 17.38s/it]epoch:  15%|█▌        | 15/100 [04:22<24:43, 17.46s/it]epoch:  16%|█▌        | 16/100 [04:39<24:24, 17.43s/it]epoch:  17%|█▋        | 17/100 [04:56<24:03, 17.39s/it]epoch:  18%|█▊        | 18/100 [05:14<23:49, 17.43s/it]epoch:  19%|█▉        | 19/100 [05:31<23:33, 17.46s/it]epoch:  20%|██        | 20/100 [05:49<23:13, 17.41s/it]epoch:  21%|██        | 21/100 [06:06<22:54, 17.40s/it]epoch:  22%|██▏       | 22/100 [06:24<22:42, 17.46s/it]epoch:  23%|██▎       | 23/100 [06:41<22:23, 17.44s/it]epoch:  24%|██▍       | 24/100 [06:58<22:04, 17.42s/it]epoch:  25%|██▌       | 25/100 [07:16<21:55, 17.53s/it]epoch:  26%|██▌       | 26/100 [07:34<21:38, 17.55s/it]epoch:  27%|██▋       | 27/100 [07:51<21:15, 17.48s/it]epoch:  28%|██▊       | 28/100 [08:08<20:53, 17.41s/it]epoch:  29%|██▉       | 29/100 [08:26<20:40, 17.48s/it]epoch:  30%|███       | 30/100 [08:43<20:22, 17.46s/it]0.040669191446579746
best ic: 0.040669191446579746
epoch:  31%|███       | 31/100 [09:03<20:48, 18.09s/it]0.03961722269171196
epoch:  32%|███▏      | 32/100 [09:23<21:02, 18.57s/it]0.042180013985681074
best ic: 0.042180013985681074
epoch:  33%|███▎      | 33/100 [09:42<21:07, 18.91s/it]0.03952481383368494
epoch:  34%|███▍      | 34/100 [10:02<20:59, 19.08s/it]0.043979544360600725
best ic: 0.043979544360600725
epoch:  35%|███▌      | 35/100 [10:21<20:52, 19.27s/it]0.04928955307478997
best ic: 0.04928955307478997
epoch:  36%|███▌      | 36/100 [10:41<20:41, 19.41s/it]0.04882278091856909
epoch:  37%|███▋      | 37/100 [11:01<20:24, 19.44s/it]0.047879252207140545
epoch:  38%|███▊      | 38/100 [11:20<20:09, 19.51s/it]0.04987646833739962
best ic: 0.04987646833739962
epoch:  39%|███▉      | 39/100 [11:40<19:55, 19.60s/it]0.04923080453485918
epoch:  40%|████      | 40/100 [12:00<19:33, 19.56s/it]0.053679084735295354
best ic: 0.053679084735295354
epoch:  41%|████      | 41/100 [12:19<19:16, 19.60s/it]0.04879229102462152
epoch:  42%|████▏     | 42/100 [12:39<19:00, 19.66s/it]0.05012523675548473
epoch:  43%|████▎     | 43/100 [12:59<18:39, 19.64s/it]0.04782990721252825
epoch:  44%|████▍     | 44/100 [13:18<18:19, 19.63s/it]0.05066855446432952
epoch:  45%|████▌     | 45/100 [13:38<18:01, 19.66s/it]0.05271803943188176
epoch:  46%|████▌     | 46/100 [13:58<17:39, 19.63s/it]0.04959896821869286
epoch:  47%|████▋     | 47/100 [14:17<17:17, 19.58s/it]0.049404015805921846
epoch:  48%|████▊     | 48/100 [14:37<16:59, 19.61s/it]0.0569527915800064
best ic: 0.0569527915800064
epoch:  49%|████▉     | 49/100 [14:56<16:39, 19.60s/it]0.04475821145454039
epoch:  50%|█████     | 50/100 [15:16<16:20, 19.61s/it]0.0511070960145156
epoch:  51%|█████     | 51/100 [15:36<16:00, 19.60s/it]0.05504134860487282
epoch:  52%|█████▏    | 52/100 [15:55<15:41, 19.61s/it]0.05270032707116704
epoch:  53%|█████▎    | 53/100 [16:15<15:22, 19.62s/it]0.05369160759517663
epoch:  54%|█████▍    | 54/100 [16:34<15:01, 19.60s/it]0.046986956088203434
epoch:  55%|█████▌    | 55/100 [16:54<14:45, 19.68s/it]0.0423226383605866
epoch:  56%|█████▌    | 56/100 [17:14<14:24, 19.65s/it]0.0499266413334316
epoch:  56%|█████▌    | 56/100 [17:33<13:48, 18.82s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-24 23:29:47,344) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-24 23:29:47,359) INFO - qlib.workflow - [recorder.py:341] - Recorder 62a0be9cbaeb4518b038ed3d3677a3f2 starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:07,  8.21it/s]online:   3%|▎         | 2/63 [00:00<00:08,  7.55it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.29it/s]online:   6%|▋         | 4/63 [00:00<00:08,  7.33it/s]online:   8%|▊         | 5/63 [00:00<00:08,  7.22it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.28it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.22it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.22it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.34it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.31it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.29it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  7.16it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.30it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.22it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.27it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.23it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.26it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.27it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.20it/s]online:  32%|███▏      | 20/63 [00:02<00:05,  7.19it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.24it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.27it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.25it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.37it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.25it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.27it/s]online:  43%|████▎     | 27/63 [00:03<00:05,  7.18it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.18it/s]online:  46%|████▌     | 29/63 [00:03<00:04,  7.17it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.36it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  7.16it/s]online:  51%|█████     | 32/63 [00:04<00:04,  7.21it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  7.33it/s]online:  54%|█████▍    | 34/63 [00:04<00:04,  7.20it/s]online:  56%|█████▌    | 35/63 [00:04<00:03,  7.18it/s]online:  57%|█████▋    | 36/63 [00:04<00:03,  7.17it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.20it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.30it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.29it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.26it/s]online:  65%|██████▌   | 41/63 [00:05<00:03,  7.18it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.17it/s]online:  68%|██████▊   | 43/63 [00:05<00:02,  7.24it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.15it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.16it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.25it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.24it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.16it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.27it/s]online:  79%|███████▉  | 50/63 [00:06<00:01,  7.24it/s]online:  81%|████████  | 51/63 [00:07<00:01,  7.24it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.27it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.25it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.24it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.21it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.22it/s]online:  90%|█████████ | 57/63 [00:07<00:00,  7.22it/s]online:  92%|█████████▏| 58/63 [00:08<00:00,  7.24it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.29it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.27it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.27it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.23it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.42it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.26it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-24 23:30:02,537) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9962073 mae 0.70749974
{'IC': 0.021163409656197618,
 'ICIR': 0.1544866993423066,
 'Rank IC': 0.01549351371921764,
 'Rank ICIR': 0.11103740542301493}
[2943066:MainThread](2024-04-24 23:30:04,309) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-24 23:30:16,085) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-24 23:30:16,088) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-24 23:30:22,117) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe2a6d3ae20>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:40,  9.66it/s]backtest loop:   1%|          | 9/971 [00:00<00:37, 25.45it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:26, 35.58it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 40.02it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:20, 46.98it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 47.53it/s]backtest loop:   4%|▍         | 41/971 [00:00<00:17, 51.98it/s]backtest loop:   5%|▍         | 47/971 [00:01<00:17, 53.93it/s]backtest loop:   5%|▌         | 53/971 [00:01<00:16, 55.46it/s]backtest loop:   6%|▌         | 59/971 [00:01<00:17, 53.44it/s]backtest loop:   7%|▋         | 66/971 [00:01<00:15, 56.61it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 53.78it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:15, 56.60it/s]backtest loop:   9%|▉         | 86/971 [00:01<00:15, 58.53it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 55.30it/s]backtest loop:  10%|█         | 99/971 [00:02<00:15, 57.26it/s]backtest loop:  11%|█         | 105/971 [00:02<00:14, 57.88it/s]backtest loop:  12%|█▏        | 112/971 [00:02<00:15, 55.87it/s]backtest loop:  12%|█▏        | 119/971 [00:02<00:14, 57.94it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:15, 54.13it/s]backtest loop:  13%|█▎        | 131/971 [00:02<00:15, 52.74it/s]backtest loop:  14%|█▍        | 138/971 [00:02<00:15, 55.50it/s]backtest loop:  15%|█▍        | 145/971 [00:02<00:14, 57.51it/s]backtest loop:  16%|█▌        | 151/971 [00:02<00:14, 55.03it/s]backtest loop:  16%|█▌        | 157/971 [00:03<00:14, 56.27it/s]backtest loop:  17%|█▋        | 164/971 [00:03<00:13, 58.05it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:14, 56.06it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:14, 56.51it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:13, 57.14it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:14, 55.51it/s]backtest loop:  20%|██        | 196/971 [00:03<00:13, 56.60it/s]backtest loop:  21%|██        | 203/971 [00:03<00:13, 58.31it/s]backtest loop:  22%|██▏       | 210/971 [00:03<00:13, 56.11it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 54.18it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:13, 55.00it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:12, 57.58it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:13, 55.05it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:12, 57.17it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:13, 55.49it/s]backtest loop:  26%|██▋       | 256/971 [00:04<00:12, 57.68it/s]backtest loop:  27%|██▋       | 263/971 [00:04<00:11, 59.03it/s]backtest loop:  28%|██▊       | 269/971 [00:05<00:12, 55.80it/s]backtest loop:  28%|██▊       | 276/971 [00:05<00:12, 54.77it/s]backtest loop:  29%|██▉       | 283/971 [00:05<00:12, 56.85it/s]backtest loop:  30%|██▉       | 289/971 [00:05<00:11, 57.68it/s]backtest loop:  30%|███       | 295/971 [00:05<00:12, 55.31it/s]backtest loop:  31%|███       | 301/971 [00:05<00:11, 56.32it/s]backtest loop:  32%|███▏      | 307/971 [00:05<00:11, 57.10it/s]backtest loop:  32%|███▏      | 313/971 [00:05<00:11, 57.31it/s]backtest loop:  33%|███▎      | 319/971 [00:05<00:11, 57.62it/s]backtest loop:  33%|███▎      | 325/971 [00:06<00:11, 55.05it/s]backtest loop:  34%|███▍      | 331/971 [00:06<00:11, 55.24it/s]backtest loop:  35%|███▍      | 338/971 [00:06<00:11, 57.52it/s]backtest loop:  36%|███▌      | 345/971 [00:06<00:11, 55.62it/s]backtest loop:  36%|███▌      | 351/971 [00:06<00:10, 56.78it/s]backtest loop:  37%|███▋      | 358/971 [00:06<00:10, 58.79it/s]backtest loop:  37%|███▋      | 364/971 [00:06<00:10, 56.19it/s]backtest loop:  38%|███▊      | 370/971 [00:06<00:11, 54.09it/s]backtest loop:  39%|███▉      | 377/971 [00:06<00:10, 56.63it/s]backtest loop:  39%|███▉      | 383/971 [00:07<00:10, 54.33it/s]backtest loop:  40%|████      | 390/971 [00:07<00:10, 56.71it/s]backtest loop:  41%|████      | 397/971 [00:07<00:09, 58.34it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 55.42it/s]backtest loop:  42%|████▏     | 410/971 [00:07<00:09, 57.42it/s]backtest loop:  43%|████▎     | 417/971 [00:07<00:09, 58.80it/s]backtest loop:  44%|████▎     | 423/971 [00:07<00:15, 35.28it/s]backtest loop:  44%|████▍     | 430/971 [00:08<00:13, 40.87it/s]backtest loop:  45%|████▌     | 437/971 [00:08<00:12, 43.80it/s]backtest loop:  46%|████▌     | 443/971 [00:08<00:11, 47.31it/s]backtest loop:  46%|████▋     | 450/971 [00:08<00:10, 51.23it/s]backtest loop:  47%|████▋     | 457/971 [00:08<00:09, 51.44it/s]backtest loop:  48%|████▊     | 464/971 [00:08<00:09, 54.33it/s]backtest loop:  49%|████▊     | 471/971 [00:08<00:08, 56.57it/s]backtest loop:  49%|████▉     | 477/971 [00:08<00:09, 54.39it/s]backtest loop:  50%|████▉     | 484/971 [00:09<00:08, 56.56it/s]backtest loop:  50%|█████     | 490/971 [00:09<00:08, 54.39it/s]backtest loop:  51%|█████     | 497/971 [00:09<00:08, 56.63it/s]backtest loop:  52%|█████▏    | 504/971 [00:09<00:07, 58.40it/s]backtest loop:  53%|█████▎    | 510/971 [00:09<00:08, 55.54it/s]backtest loop:  53%|█████▎    | 517/971 [00:09<00:08, 54.41it/s]backtest loop:  54%|█████▍    | 524/971 [00:09<00:07, 56.73it/s]backtest loop:  55%|█████▍    | 530/971 [00:09<00:07, 57.45it/s]backtest loop:  55%|█████▌    | 536/971 [00:09<00:07, 55.16it/s]backtest loop:  56%|█████▌    | 543/971 [00:10<00:07, 57.38it/s]backtest loop:  57%|█████▋    | 549/971 [00:10<00:07, 57.87it/s]backtest loop:  57%|█████▋    | 556/971 [00:10<00:07, 55.82it/s]backtest loop:  58%|█████▊    | 563/971 [00:10<00:07, 57.72it/s]backtest loop:  59%|█████▊    | 569/971 [00:10<00:06, 58.11it/s]backtest loop:  59%|█████▉    | 576/971 [00:10<00:07, 56.04it/s]backtest loop:  60%|█████▉    | 582/971 [00:10<00:06, 56.96it/s]backtest loop:  61%|██████    | 588/971 [00:10<00:06, 57.51it/s]backtest loop:  61%|██████▏   | 595/971 [00:10<00:06, 58.97it/s]backtest loop:  62%|██████▏   | 601/971 [00:11<00:06, 55.91it/s]backtest loop:  63%|██████▎   | 608/971 [00:11<00:06, 57.79it/s]backtest loop:  63%|██████▎   | 615/971 [00:11<00:06, 55.97it/s]backtest loop:  64%|██████▍   | 621/971 [00:11<00:06, 57.02it/s]backtest loop:  65%|██████▍   | 628/971 [00:11<00:05, 58.96it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:05, 56.95it/s]backtest loop:  66%|██████▌   | 642/971 [00:11<00:05, 58.57it/s]backtest loop:  67%|██████▋   | 648/971 [00:11<00:05, 58.81it/s]backtest loop:  67%|██████▋   | 655/971 [00:12<00:05, 56.42it/s]backtest loop:  68%|██████▊   | 662/971 [00:12<00:05, 58.15it/s]backtest loop:  69%|██████▉   | 668/971 [00:12<00:05, 58.60it/s]backtest loop:  69%|██████▉   | 674/971 [00:12<00:05, 55.79it/s]backtest loop:  70%|███████   | 681/971 [00:12<00:05, 57.86it/s]backtest loop:  71%|███████   | 687/971 [00:12<00:04, 58.40it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:04, 56.13it/s]backtest loop:  72%|███████▏  | 701/971 [00:12<00:04, 58.07it/s]backtest loop:  73%|███████▎  | 708/971 [00:12<00:04, 59.38it/s]backtest loop:  74%|███████▎  | 714/971 [00:13<00:04, 56.33it/s]backtest loop:  74%|███████▍  | 721/971 [00:13<00:04, 58.08it/s]backtest loop:  75%|███████▍  | 728/971 [00:13<00:04, 59.45it/s]backtest loop:  76%|███████▌  | 734/971 [00:13<00:04, 53.37it/s]backtest loop:  76%|███████▌  | 740/971 [00:13<00:04, 54.98it/s]backtest loop:  77%|███████▋  | 747/971 [00:13<00:03, 57.04it/s]backtest loop:  78%|███████▊  | 753/971 [00:13<00:03, 54.85it/s]backtest loop:  78%|███████▊  | 759/971 [00:13<00:03, 56.02it/s]backtest loop:  79%|███████▉  | 765/971 [00:13<00:03, 53.93it/s]backtest loop:  80%|███████▉  | 772/971 [00:14<00:03, 56.51it/s]backtest loop:  80%|████████  | 779/971 [00:14<00:03, 58.34it/s]backtest loop:  81%|████████  | 785/971 [00:14<00:03, 55.65it/s]backtest loop:  82%|████████▏ | 792/971 [00:14<00:03, 57.64it/s]backtest loop:  82%|████████▏ | 798/971 [00:14<00:03, 55.06it/s]backtest loop:  83%|████████▎ | 804/971 [00:14<00:02, 56.29it/s]backtest loop:  83%|████████▎ | 810/971 [00:14<00:02, 57.31it/s]backtest loop:  84%|████████▍ | 817/971 [00:14<00:02, 58.82it/s]backtest loop:  85%|████████▍ | 823/971 [00:15<00:02, 55.62it/s]backtest loop:  85%|████████▌ | 830/971 [00:15<00:02, 57.69it/s]backtest loop:  86%|████████▌ | 837/971 [00:15<00:02, 59.12it/s]backtest loop:  87%|████████▋ | 843/971 [00:15<00:02, 56.00it/s]backtest loop:  88%|████████▊ | 850/971 [00:15<00:02, 57.81it/s]backtest loop:  88%|████████▊ | 857/971 [00:15<00:02, 55.91it/s]backtest loop:  89%|████████▉ | 864/971 [00:15<00:01, 57.76it/s]backtest loop:  90%|████████▉ | 871/971 [00:15<00:01, 59.17it/s]backtest loop:  90%|█████████ | 877/971 [00:15<00:01, 56.02it/s]backtest loop:  91%|█████████ | 884/971 [00:16<00:01, 57.99it/s]backtest loop:  92%|█████████▏| 890/971 [00:16<00:01, 58.48it/s]backtest loop:  92%|█████████▏| 897/971 [00:16<00:01, 56.38it/s]backtest loop:  93%|█████████▎| 904/971 [00:16<00:01, 58.18it/s]backtest loop:  94%|█████████▎| 910/971 [00:16<00:01, 58.21it/s]backtest loop:  94%|█████████▍| 916/971 [00:16<00:00, 55.63it/s]backtest loop:  95%|█████████▌| 923/971 [00:16<00:00, 57.67it/s]backtest loop:  96%|█████████▌| 930/971 [00:16<00:00, 59.16it/s]backtest loop:  96%|█████████▋| 936/971 [00:16<00:00, 55.77it/s]backtest loop:  97%|█████████▋| 943/971 [00:17<00:00, 57.70it/s]backtest loop:  98%|█████████▊| 950/971 [00:17<00:00, 56.20it/s]backtest loop:  99%|█████████▊| 957/971 [00:17<00:00, 58.21it/s]backtest loop:  99%|█████████▉| 963/971 [00:17<00:00, 58.62it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 56.33it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 55.26it/s]
[2943066:MainThread](2024-04-24 23:30:39,766) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000383
std                0.005662
annualized_return  0.091256
information_ratio  1.044697
max_drawdown      -0.190196
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000186
std                0.005662
annualized_return  0.044249
information_ratio  0.506542
max_drawdown      -0.246498
[2943066:MainThread](2024-04-24 23:30:39,782) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 2 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334],
 'IC': [0.02587224613755935, 0.021163409656197618],
 'ICIR': [0.18518614400027864, 0.1544866993423066],
 'Rank IC': [0.02043466903243119, 0.01549351371921764],
 'Rank ICIR': [0.14468640124580973, 0.11103740542301493],
 'mae': [0.7073439359664917, 0.7074997425079346],
 'mse': [0.995890736579895, 0.9962072968482971]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-24 23:30:40,976) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<29:04, 17.62s/it]epoch:   2%|▏         | 2/100 [00:35<28:38, 17.54s/it]epoch:   3%|▎         | 3/100 [00:52<28:20, 17.53s/it]epoch:   4%|▍         | 4/100 [01:10<28:01, 17.52s/it]epoch:   5%|▌         | 5/100 [01:27<27:43, 17.52s/it]epoch:   6%|▌         | 6/100 [01:45<27:27, 17.53s/it]epoch:   7%|▋         | 7/100 [02:02<27:07, 17.50s/it]epoch:   8%|▊         | 8/100 [02:20<26:59, 17.60s/it]epoch:   9%|▉         | 9/100 [02:37<26:35, 17.53s/it]epoch:  10%|█         | 10/100 [02:55<26:16, 17.52s/it]epoch:  11%|█         | 11/100 [03:12<25:53, 17.46s/it]epoch:  12%|█▏        | 12/100 [03:30<25:41, 17.52s/it]epoch:  13%|█▎        | 13/100 [03:47<25:20, 17.48s/it]epoch:  14%|█▍        | 14/100 [04:04<24:57, 17.41s/it]epoch:  15%|█▌        | 15/100 [04:22<24:39, 17.41s/it]epoch:  16%|█▌        | 16/100 [04:39<24:27, 17.47s/it]epoch:  17%|█▋        | 17/100 [04:57<24:06, 17.43s/it]epoch:  18%|█▊        | 18/100 [05:14<23:47, 17.40s/it]epoch:  19%|█▉        | 19/100 [05:32<23:37, 17.50s/it]epoch:  20%|██        | 20/100 [05:49<23:15, 17.44s/it]epoch:  21%|██        | 21/100 [06:06<22:52, 17.38s/it]epoch:  22%|██▏       | 22/100 [06:24<22:37, 17.40s/it]epoch:  23%|██▎       | 23/100 [06:41<22:23, 17.45s/it]epoch:  24%|██▍       | 24/100 [06:59<22:02, 17.40s/it]epoch:  25%|██▌       | 25/100 [07:16<21:45, 17.40s/it]epoch:  26%|██▌       | 26/100 [07:34<21:34, 17.49s/it]epoch:  27%|██▋       | 27/100 [07:51<21:16, 17.48s/it]epoch:  28%|██▊       | 28/100 [08:09<20:56, 17.45s/it]epoch:  29%|██▉       | 29/100 [08:26<20:42, 17.50s/it]epoch:  30%|███       | 30/100 [08:44<20:24, 17.49s/it]0.0563019070718335
best ic: 0.0563019070718335
epoch:  31%|███       | 31/100 [09:03<20:49, 18.11s/it]0.05405938580197638
epoch:  32%|███▏      | 32/100 [09:23<21:05, 18.61s/it]0.057283476503544685
best ic: 0.057283476503544685
epoch:  33%|███▎      | 33/100 [09:43<21:10, 18.96s/it]0.05470453956340975
epoch:  34%|███▍      | 34/100 [10:02<21:02, 19.13s/it]0.05047115622377877
epoch:  35%|███▌      | 35/100 [10:22<20:54, 19.31s/it]0.05588925464729306
epoch:  36%|███▌      | 36/100 [10:42<20:44, 19.44s/it]0.04430049124030276
epoch:  37%|███▋      | 37/100 [11:01<20:25, 19.45s/it]0.05352204756968939
epoch:  38%|███▊      | 38/100 [11:21<20:07, 19.48s/it]0.05142163163503635
epoch:  39%|███▉      | 39/100 [11:41<19:54, 19.58s/it]0.05478341973336201
epoch:  40%|████      | 40/100 [12:00<19:31, 19.53s/it]0.05033697646666635
epoch:  40%|████      | 40/100 [12:20<18:30, 18.50s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-24 23:43:01,181) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-24 23:43:01,197) INFO - qlib.workflow - [recorder.py:341] - Recorder f5d7ea5867404222925f106c2ec88ed9 starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:08,  7.66it/s]online:   3%|▎         | 2/63 [00:00<00:08,  7.39it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.35it/s]online:   6%|▋         | 4/63 [00:00<00:08,  7.36it/s]online:   8%|▊         | 5/63 [00:00<00:07,  7.31it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.24it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.37it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.20it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.25it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.23it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.28it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  7.26it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.24it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.32it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.34it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.17it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.22it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.28it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.27it/s]online:  32%|███▏      | 20/63 [00:02<00:05,  7.34it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.23it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.16it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.15it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.20it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.32it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.19it/s]online:  43%|████▎     | 27/63 [00:03<00:04,  7.27it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.25it/s]online:  46%|████▌     | 29/63 [00:03<00:04,  7.31it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.35it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  7.32it/s]online:  51%|█████     | 32/63 [00:04<00:04,  7.20it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  7.30it/s]online:  54%|█████▍    | 34/63 [00:04<00:04,  7.21it/s]online:  56%|█████▌    | 35/63 [00:04<00:03,  7.17it/s]online:  57%|█████▋    | 36/63 [00:04<00:03,  7.29it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.24it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.17it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.21it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.23it/s]online:  65%|██████▌   | 41/63 [00:05<00:03,  7.22it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.28it/s]online:  68%|██████▊   | 43/63 [00:05<00:02,  7.23it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.43it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.30it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.28it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.23it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.24it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.29it/s]online:  79%|███████▉  | 50/63 [00:06<00:01,  7.26it/s]online:  81%|████████  | 51/63 [00:07<00:01,  7.27it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.24it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.21it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.23it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.35it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.25it/s]online:  90%|█████████ | 57/63 [00:07<00:00,  7.17it/s]online:  92%|█████████▏| 58/63 [00:07<00:00,  7.23it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.22it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.18it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.25it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.33it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.53it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.27it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-24 23:43:16,343) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9961547 mae 0.70739776
{'IC': 0.022316224135223012,
 'ICIR': 0.15670848538695684,
 'Rank IC': 0.01806255713632389,
 'Rank ICIR': 0.12281036940312468}
[2943066:MainThread](2024-04-24 23:43:18,077) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-24 23:43:30,084) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-24 23:43:30,087) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-24 23:43:36,156) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe2ae1713a0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:35, 10.18it/s]backtest loop:   1%|          | 9/971 [00:00<00:36, 26.45it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:24, 38.86it/s]backtest loop:   2%|▏         | 22/971 [00:00<00:22, 42.69it/s]backtest loop:   3%|▎         | 29/971 [00:00<00:20, 46.09it/s]backtest loop:   4%|▎         | 36/971 [00:00<00:18, 49.67it/s]backtest loop:   4%|▍         | 43/971 [00:00<00:17, 53.41it/s]backtest loop:   5%|▌         | 49/971 [00:01<00:17, 52.32it/s]backtest loop:   6%|▌         | 56/971 [00:01<00:16, 55.29it/s]backtest loop:   6%|▋         | 62/971 [00:01<00:16, 53.57it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:15, 56.65it/s]backtest loop:   8%|▊         | 76/971 [00:01<00:15, 58.54it/s]backtest loop:   8%|▊         | 82/971 [00:01<00:15, 55.99it/s]backtest loop:   9%|▉         | 89/971 [00:01<00:15, 57.96it/s]backtest loop:  10%|▉         | 96/971 [00:01<00:14, 59.55it/s]backtest loop:  11%|█         | 102/971 [00:02<00:15, 56.36it/s]backtest loop:  11%|█         | 109/971 [00:02<00:14, 58.29it/s]backtest loop:  12%|█▏        | 116/971 [00:02<00:14, 59.54it/s]backtest loop:  13%|█▎        | 122/971 [00:02<00:15, 56.46it/s]backtest loop:  13%|█▎        | 128/971 [00:02<00:15, 54.39it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:14, 56.79it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:15, 54.71it/s]backtest loop:  15%|█▌        | 148/971 [00:02<00:14, 57.11it/s]backtest loop:  16%|█▌        | 155/971 [00:02<00:13, 58.73it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:14, 56.02it/s]backtest loop:  17%|█▋        | 168/971 [00:03<00:13, 57.94it/s]backtest loop:  18%|█▊        | 175/971 [00:03<00:13, 59.30it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:13, 56.48it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:13, 58.35it/s]backtest loop:  20%|██        | 195/971 [00:03<00:13, 56.25it/s]backtest loop:  21%|██        | 202/971 [00:03<00:13, 58.26it/s]backtest loop:  22%|██▏       | 209/971 [00:03<00:12, 59.59it/s]backtest loop:  22%|██▏       | 215/971 [00:04<00:14, 53.89it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:13, 56.28it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:12, 58.29it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:13, 55.43it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:12, 57.70it/s]backtest loop:  26%|██▌       | 248/971 [00:04<00:12, 58.02it/s]backtest loop:  26%|██▌       | 254/971 [00:04<00:12, 55.38it/s]backtest loop:  27%|██▋       | 260/971 [00:04<00:12, 56.58it/s]backtest loop:  27%|██▋       | 266/971 [00:04<00:12, 54.39it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:12, 56.81it/s]backtest loop:  29%|██▉       | 280/971 [00:05<00:11, 58.67it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:12, 55.79it/s]backtest loop:  30%|███       | 293/971 [00:05<00:11, 57.99it/s]backtest loop:  31%|███       | 300/971 [00:05<00:11, 56.02it/s]backtest loop:  32%|███▏      | 307/971 [00:05<00:11, 57.89it/s]backtest loop:  32%|███▏      | 314/971 [00:05<00:11, 59.20it/s]backtest loop:  33%|███▎      | 320/971 [00:05<00:11, 56.30it/s]backtest loop:  34%|███▎      | 327/971 [00:05<00:11, 58.12it/s]backtest loop:  34%|███▍      | 334/971 [00:06<00:10, 59.46it/s]backtest loop:  35%|███▌      | 340/971 [00:06<00:11, 56.52it/s]backtest loop:  36%|███▌      | 347/971 [00:06<00:10, 58.29it/s]backtest loop:  36%|███▋      | 354/971 [00:06<00:10, 59.56it/s]backtest loop:  37%|███▋      | 360/971 [00:06<00:10, 56.32it/s]backtest loop:  38%|███▊      | 367/971 [00:06<00:10, 55.02it/s]backtest loop:  38%|███▊      | 373/971 [00:06<00:11, 53.36it/s]backtest loop:  39%|███▉      | 380/971 [00:06<00:10, 55.88it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:10, 57.79it/s]backtest loop:  40%|████      | 393/971 [00:07<00:10, 55.23it/s]backtest loop:  41%|████      | 400/971 [00:07<00:09, 57.30it/s]backtest loop:  42%|████▏     | 407/971 [00:07<00:09, 58.94it/s]backtest loop:  43%|████▎     | 413/971 [00:07<00:09, 55.98it/s]backtest loop:  43%|████▎     | 419/971 [00:07<00:09, 57.04it/s]backtest loop:  44%|████▍     | 426/971 [00:07<00:09, 58.74it/s]backtest loop:  44%|████▍     | 432/971 [00:07<00:09, 55.77it/s]backtest loop:  45%|████▌     | 439/971 [00:07<00:09, 57.72it/s]backtest loop:  46%|████▌     | 446/971 [00:08<00:08, 59.13it/s]backtest loop:  47%|████▋     | 452/971 [00:08<00:09, 55.98it/s]backtest loop:  47%|████▋     | 459/971 [00:08<00:08, 57.87it/s]backtest loop:  48%|████▊     | 466/971 [00:08<00:08, 59.18it/s]backtest loop:  49%|████▊     | 472/971 [00:08<00:08, 56.19it/s]backtest loop:  49%|████▉     | 478/971 [00:08<00:08, 57.18it/s]backtest loop:  50%|████▉     | 484/971 [00:08<00:12, 37.56it/s]backtest loop:  50%|█████     | 490/971 [00:09<00:11, 40.36it/s]backtest loop:  51%|█████     | 497/971 [00:09<00:10, 45.77it/s]backtest loop:  52%|█████▏    | 504/971 [00:09<00:09, 50.05it/s]backtest loop:  53%|█████▎    | 510/971 [00:09<00:09, 49.96it/s]backtest loop:  53%|█████▎    | 517/971 [00:09<00:08, 50.76it/s]backtest loop:  54%|█████▍    | 524/971 [00:09<00:08, 53.90it/s]backtest loop:  55%|█████▍    | 531/971 [00:09<00:08, 53.41it/s]backtest loop:  55%|█████▌    | 538/971 [00:09<00:07, 56.04it/s]backtest loop:  56%|█████▌    | 545/971 [00:09<00:07, 57.84it/s]backtest loop:  57%|█████▋    | 551/971 [00:10<00:07, 55.33it/s]backtest loop:  57%|█████▋    | 558/971 [00:10<00:07, 57.28it/s]backtest loop:  58%|█████▊    | 565/971 [00:10<00:06, 58.77it/s]backtest loop:  59%|█████▉    | 571/971 [00:10<00:07, 55.88it/s]backtest loop:  60%|█████▉    | 578/971 [00:10<00:06, 57.72it/s]backtest loop:  60%|██████    | 585/971 [00:10<00:06, 59.08it/s]backtest loop:  61%|██████    | 591/971 [00:10<00:06, 55.72it/s]backtest loop:  61%|██████▏   | 597/971 [00:10<00:06, 56.64it/s]backtest loop:  62%|██████▏   | 603/971 [00:10<00:06, 57.44it/s]backtest loop:  63%|██████▎   | 609/971 [00:11<00:06, 57.88it/s]backtest loop:  63%|██████▎   | 615/971 [00:11<00:06, 55.11it/s]backtest loop:  64%|██████▍   | 621/971 [00:11<00:06, 56.41it/s]backtest loop:  65%|██████▍   | 628/971 [00:11<00:05, 58.12it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:05, 56.45it/s]backtest loop:  66%|██████▌   | 642/971 [00:11<00:05, 58.30it/s]backtest loop:  67%|██████▋   | 649/971 [00:11<00:05, 59.46it/s]backtest loop:  67%|██████▋   | 655/971 [00:11<00:05, 56.30it/s]backtest loop:  68%|██████▊   | 662/971 [00:12<00:05, 58.06it/s]backtest loop:  69%|██████▉   | 669/971 [00:12<00:05, 59.36it/s]backtest loop:  70%|██████▉   | 675/971 [00:12<00:05, 55.98it/s]backtest loop:  70%|███████   | 681/971 [00:12<00:05, 57.02it/s]backtest loop:  71%|███████   | 687/971 [00:12<00:04, 57.82it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:04, 55.74it/s]backtest loop:  72%|███████▏  | 701/971 [00:12<00:04, 57.73it/s]backtest loop:  73%|███████▎  | 708/971 [00:12<00:04, 59.23it/s]backtest loop:  74%|███████▎  | 714/971 [00:12<00:04, 55.98it/s]backtest loop:  74%|███████▍  | 721/971 [00:13<00:04, 57.79it/s]backtest loop:  75%|███████▍  | 728/971 [00:13<00:04, 59.30it/s]backtest loop:  76%|███████▌  | 734/971 [00:13<00:04, 53.35it/s]backtest loop:  76%|███████▋  | 741/971 [00:13<00:04, 55.90it/s]backtest loop:  77%|███████▋  | 747/971 [00:13<00:03, 56.98it/s]backtest loop:  78%|███████▊  | 753/971 [00:13<00:03, 54.82it/s]backtest loop:  78%|███████▊  | 760/971 [00:13<00:03, 53.88it/s]backtest loop:  79%|███████▉  | 767/971 [00:13<00:03, 56.30it/s]backtest loop:  80%|███████▉  | 774/971 [00:13<00:03, 58.14it/s]backtest loop:  80%|████████  | 780/971 [00:14<00:03, 55.54it/s]backtest loop:  81%|████████  | 787/971 [00:14<00:03, 57.93it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 55.36it/s]backtest loop:  82%|████████▏ | 800/971 [00:14<00:02, 57.43it/s]backtest loop:  83%|████████▎ | 807/971 [00:14<00:02, 59.00it/s]backtest loop:  84%|████████▎ | 813/971 [00:14<00:02, 55.96it/s]backtest loop:  84%|████████▍ | 820/971 [00:14<00:02, 57.84it/s]backtest loop:  85%|████████▌ | 827/971 [00:14<00:02, 59.34it/s]backtest loop:  86%|████████▌ | 833/971 [00:15<00:02, 56.24it/s]backtest loop:  86%|████████▋ | 839/971 [00:15<00:02, 57.15it/s]backtest loop:  87%|████████▋ | 846/971 [00:15<00:02, 58.75it/s]backtest loop:  88%|████████▊ | 852/971 [00:15<00:02, 55.84it/s]backtest loop:  88%|████████▊ | 859/971 [00:15<00:01, 57.83it/s]backtest loop:  89%|████████▉ | 866/971 [00:15<00:01, 59.30it/s]backtest loop:  90%|████████▉ | 872/971 [00:15<00:01, 56.26it/s]backtest loop:  91%|█████████ | 879/971 [00:15<00:01, 58.19it/s]backtest loop:  91%|█████████ | 886/971 [00:15<00:01, 59.53it/s]backtest loop:  92%|█████████▏| 892/971 [00:16<00:01, 56.35it/s]backtest loop:  93%|█████████▎| 899/971 [00:16<00:01, 58.17it/s]backtest loop:  93%|█████████▎| 906/971 [00:16<00:01, 59.35it/s]backtest loop:  94%|█████████▍| 912/971 [00:16<00:01, 56.40it/s]backtest loop:  95%|█████████▍| 919/971 [00:16<00:00, 58.29it/s]backtest loop:  95%|█████████▌| 926/971 [00:16<00:00, 56.30it/s]backtest loop:  96%|█████████▌| 933/971 [00:16<00:00, 58.27it/s]backtest loop:  97%|█████████▋| 939/971 [00:16<00:00, 58.66it/s]backtest loop:  97%|█████████▋| 945/971 [00:16<00:00, 55.70it/s]backtest loop:  98%|█████████▊| 952/971 [00:17<00:00, 57.82it/s]backtest loop:  99%|█████████▉| 959/971 [00:17<00:00, 59.15it/s]backtest loop:  99%|█████████▉| 965/971 [00:17<00:00, 55.58it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 55.72it/s]
[2943066:MainThread](2024-04-24 23:43:53,652) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000451
std                0.006189
annualized_return  0.107368
information_ratio  1.124442
max_drawdown      -0.192548
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000253
std                0.006189
annualized_return  0.060123
information_ratio  0.629657
max_drawdown      -0.249331
[2943066:MainThread](2024-04-24 23:43:53,669) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 3 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244,
                                                    0.06012304631775825],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835,
                                                    0.6296566548029155],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334,
                                               -0.24933141070803327],
 'IC': [0.02587224613755935, 0.021163409656197618, 0.022316224135223012],
 'ICIR': [0.18518614400027864, 0.1544866993423066, 0.15670848538695684],
 'Rank IC': [0.02043466903243119, 0.01549351371921764, 0.01806255713632389],
 'Rank ICIR': [0.14468640124580973, 0.11103740542301493, 0.12281036940312468],
 'mae': [0.7073439359664917, 0.7074997425079346, 0.7073977589607239],
 'mse': [0.995890736579895, 0.9962072968482971, 0.9961547255516052]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-24 23:43:54,822) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<28:46, 17.44s/it]epoch:   2%|▏         | 2/100 [00:34<28:15, 17.30s/it]epoch:   3%|▎         | 3/100 [00:52<28:03, 17.36s/it]epoch:   4%|▍         | 4/100 [01:09<27:47, 17.37s/it]epoch:   5%|▌         | 5/100 [01:26<27:26, 17.33s/it]epoch:   6%|▌         | 6/100 [01:44<27:10, 17.35s/it]epoch:   7%|▋         | 7/100 [02:01<26:57, 17.39s/it]epoch:   8%|▊         | 8/100 [02:18<26:36, 17.35s/it]epoch:   9%|▉         | 9/100 [02:36<26:22, 17.38s/it]epoch:  10%|█         | 10/100 [02:53<26:06, 17.41s/it]epoch:  11%|█         | 11/100 [03:11<25:45, 17.37s/it]epoch:  12%|█▏        | 12/100 [03:28<25:29, 17.38s/it]epoch:  13%|█▎        | 13/100 [03:46<25:26, 17.55s/it]epoch:  14%|█▍        | 14/100 [04:03<25:03, 17.48s/it]epoch:  15%|█▌        | 15/100 [04:21<24:44, 17.47s/it]epoch:  16%|█▌        | 16/100 [04:39<24:43, 17.66s/it]epoch:  17%|█▋        | 17/100 [04:56<24:16, 17.55s/it]epoch:  18%|█▊        | 18/100 [05:13<23:52, 17.47s/it]epoch:  19%|█▉        | 19/100 [05:31<23:35, 17.48s/it]epoch:  20%|██        | 20/100 [05:48<23:21, 17.52s/it]epoch:  21%|██        | 21/100 [06:06<22:58, 17.45s/it]epoch:  22%|██▏       | 22/100 [06:23<22:41, 17.45s/it]epoch:  23%|██▎       | 23/100 [06:41<22:29, 17.53s/it]epoch:  24%|██▍       | 24/100 [06:58<22:06, 17.45s/it]epoch:  25%|██▌       | 25/100 [07:15<21:43, 17.38s/it]epoch:  26%|██▌       | 26/100 [07:33<21:31, 17.45s/it]epoch:  27%|██▋       | 27/100 [07:50<21:14, 17.46s/it]epoch:  28%|██▊       | 28/100 [08:08<20:54, 17.43s/it]epoch:  29%|██▉       | 29/100 [08:25<20:40, 17.47s/it]epoch:  30%|███       | 30/100 [08:43<20:24, 17.49s/it]0.05267530158395121
best ic: 0.05267530158395121
epoch:  31%|███       | 31/100 [09:02<20:46, 18.06s/it]0.05950876965738536
best ic: 0.05950876965738536
epoch:  32%|███▏      | 32/100 [09:22<21:01, 18.55s/it]0.05196951092927612
epoch:  33%|███▎      | 33/100 [09:42<21:08, 18.94s/it]0.05229907082697684
epoch:  34%|███▍      | 34/100 [10:01<20:59, 19.09s/it]0.05453451344860804
epoch:  35%|███▌      | 35/100 [10:21<20:51, 19.25s/it]0.04848964084871818
epoch:  36%|███▌      | 36/100 [10:41<20:42, 19.41s/it]0.056698161380457794
epoch:  37%|███▋      | 37/100 [11:00<20:29, 19.51s/it]0.05569348117576842
epoch:  38%|███▊      | 38/100 [11:20<20:15, 19.61s/it]0.05206612599958067
epoch:  39%|███▉      | 39/100 [11:40<19:57, 19.63s/it]0.05435457684831132
epoch:  39%|███▉      | 39/100 [12:00<18:46, 18.47s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-24 23:55:55,178) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-24 23:55:55,194) INFO - qlib.workflow - [recorder.py:341] - Recorder 2c71948c5567414b8767ffe9454d23cb starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:07,  8.27it/s]online:   3%|▎         | 2/63 [00:00<00:08,  7.56it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.35it/s]online:   6%|▋         | 4/63 [00:00<00:08,  7.28it/s]online:   8%|▊         | 5/63 [00:00<00:07,  7.30it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.30it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.34it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.41it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.31it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.35it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.34it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  7.19it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.25it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.26it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.22it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.22it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.25it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.24it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.26it/s]online:  32%|███▏      | 20/63 [00:02<00:05,  7.23it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.23it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.24it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.25it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.29it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.19it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.21it/s]online:  43%|████▎     | 27/63 [00:03<00:04,  7.20it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.28it/s]online:  46%|████▌     | 29/63 [00:03<00:04,  7.09it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.16it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  7.11it/s]online:  51%|█████     | 32/63 [00:04<00:04,  7.19it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  7.19it/s]online:  54%|█████▍    | 34/63 [00:04<00:03,  7.32it/s]online:  56%|█████▌    | 35/63 [00:04<00:03,  7.18it/s]online:  57%|█████▋    | 36/63 [00:04<00:03,  7.32it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.33it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.25it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.28it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.30it/s]online:  65%|██████▌   | 41/63 [00:05<00:03,  7.26it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.39it/s]online:  68%|██████▊   | 43/63 [00:05<00:02,  7.35it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.25it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.35it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.28it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.27it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.39it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.35it/s]online:  79%|███████▉  | 50/63 [00:06<00:01,  7.35it/s]online:  81%|████████  | 51/63 [00:07<00:01,  7.20it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.24it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.23it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.22it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.24it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.34it/s]online:  90%|█████████ | 57/63 [00:07<00:00,  7.19it/s]online:  92%|█████████▏| 58/63 [00:07<00:00,  7.25it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.28it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.18it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.18it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.23it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.46it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.28it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-24 23:56:21,349) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9959004 mae 0.7072641
{'IC': 0.025285754183174552,
 'ICIR': 0.18641023059651965,
 'Rank IC': 0.024278838529892835,
 'Rank ICIR': 0.1780547655378848}
[2943066:MainThread](2024-04-24 23:56:23,111) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-24 23:56:35,762) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-24 23:56:35,765) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-24 23:56:41,967) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe2aba33b50>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:47,  9.00it/s]backtest loop:   1%|          | 9/971 [00:00<00:39, 24.22it/s]backtest loop:   2%|▏         | 16/971 [00:00<00:26, 36.63it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:24, 39.45it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:20, 46.65it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 47.56it/s]backtest loop:   4%|▍         | 40/971 [00:00<00:18, 50.83it/s]backtest loop:   5%|▍         | 47/971 [00:01<00:16, 54.63it/s]backtest loop:   5%|▌         | 53/971 [00:01<00:16, 55.85it/s]backtest loop:   6%|▌         | 59/971 [00:01<00:16, 53.77it/s]backtest loop:   7%|▋         | 66/971 [00:01<00:16, 56.37it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 54.59it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:15, 57.14it/s]backtest loop:   9%|▉         | 86/971 [00:01<00:15, 58.92it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 56.13it/s]backtest loop:  10%|█         | 99/971 [00:02<00:15, 58.07it/s]backtest loop:  11%|█         | 106/971 [00:02<00:14, 59.54it/s]backtest loop:  12%|█▏        | 112/971 [00:02<00:15, 56.44it/s]backtest loop:  12%|█▏        | 119/971 [00:02<00:14, 58.72it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:14, 56.64it/s]backtest loop:  13%|█▎        | 131/971 [00:02<00:15, 54.81it/s]backtest loop:  14%|█▍        | 137/971 [00:02<00:14, 56.01it/s]backtest loop:  15%|█▍        | 144/971 [00:02<00:14, 57.98it/s]backtest loop:  16%|█▌        | 151/971 [00:02<00:14, 55.94it/s]backtest loop:  16%|█▋        | 158/971 [00:03<00:14, 57.92it/s]backtest loop:  17%|█▋        | 164/971 [00:03<00:13, 58.47it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:14, 56.30it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:13, 57.12it/s]backtest loop:  19%|█▉        | 184/971 [00:03<00:13, 58.84it/s]backtest loop:  20%|█▉        | 190/971 [00:03<00:14, 55.78it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 57.82it/s]backtest loop:  21%|██        | 204/971 [00:03<00:12, 59.56it/s]backtest loop:  22%|██▏       | 210/971 [00:03<00:13, 56.51it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 54.36it/s]backtest loop:  23%|██▎       | 223/971 [00:04<00:13, 56.67it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:13, 55.46it/s]backtest loop:  24%|██▍       | 236/971 [00:04<00:13, 56.54it/s]backtest loop:  25%|██▌       | 243/971 [00:04<00:12, 58.38it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:13, 54.64it/s]backtest loop:  26%|██▋       | 255/971 [00:04<00:13, 52.46it/s]backtest loop:  27%|██▋       | 261/971 [00:04<00:13, 52.62it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:13, 51.78it/s]backtest loop:  28%|██▊       | 274/971 [00:05<00:12, 54.83it/s]backtest loop:  29%|██▉       | 280/971 [00:05<00:12, 56.10it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:12, 53.63it/s]backtest loop:  30%|███       | 292/971 [00:05<00:12, 54.92it/s]backtest loop:  31%|███       | 298/971 [00:05<00:11, 56.10it/s]backtest loop:  31%|███▏      | 305/971 [00:05<00:12, 54.66it/s]backtest loop:  32%|███▏      | 312/971 [00:05<00:11, 57.06it/s]backtest loop:  33%|███▎      | 319/971 [00:05<00:11, 58.74it/s]backtest loop:  33%|███▎      | 325/971 [00:06<00:11, 55.81it/s]backtest loop:  34%|███▍      | 332/971 [00:06<00:11, 57.83it/s]backtest loop:  35%|███▍      | 338/971 [00:06<00:10, 58.30it/s]backtest loop:  35%|███▌      | 344/971 [00:06<00:10, 58.62it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:11, 55.87it/s]backtest loop:  37%|███▋      | 356/971 [00:06<00:10, 56.98it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:11, 55.18it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 53.35it/s]backtest loop:  39%|███▊      | 376/971 [00:06<00:10, 55.92it/s]backtest loop:  39%|███▉      | 382/971 [00:07<00:10, 56.58it/s]backtest loop:  40%|███▉      | 388/971 [00:07<00:10, 54.20it/s]backtest loop:  41%|████      | 395/971 [00:07<00:10, 56.53it/s]backtest loop:  41%|████▏     | 402/971 [00:07<00:09, 58.22it/s]backtest loop:  42%|████▏     | 408/971 [00:07<00:10, 55.48it/s]backtest loop:  43%|████▎     | 415/971 [00:07<00:09, 57.51it/s]backtest loop:  43%|████▎     | 421/971 [00:07<00:15, 35.17it/s]backtest loop:  44%|████▍     | 427/971 [00:08<00:13, 39.56it/s]backtest loop:  44%|████▍     | 432/971 [00:08<00:13, 40.99it/s]backtest loop:  45%|████▌     | 439/971 [00:08<00:11, 46.29it/s]backtest loop:  46%|████▌     | 445/971 [00:08<00:10, 49.39it/s]backtest loop:  47%|████▋     | 452/971 [00:08<00:10, 50.16it/s]backtest loop:  47%|████▋     | 458/971 [00:08<00:09, 52.32it/s]backtest loop:  48%|████▊     | 465/971 [00:08<00:09, 55.21it/s]backtest loop:  49%|████▊     | 472/971 [00:08<00:09, 54.12it/s]backtest loop:  49%|████▉     | 479/971 [00:08<00:08, 56.44it/s]backtest loop:  50%|█████     | 486/971 [00:09<00:08, 58.15it/s]backtest loop:  51%|█████     | 492/971 [00:09<00:08, 55.48it/s]backtest loop:  51%|█████▏    | 499/971 [00:09<00:08, 57.55it/s]backtest loop:  52%|█████▏    | 505/971 [00:09<00:08, 55.36it/s]backtest loop:  53%|█████▎    | 511/971 [00:09<00:08, 56.17it/s]backtest loop:  53%|█████▎    | 517/971 [00:09<00:08, 54.20it/s]backtest loop:  54%|█████▍    | 523/971 [00:09<00:08, 54.85it/s]backtest loop:  54%|█████▍    | 529/971 [00:09<00:07, 55.44it/s]backtest loop:  55%|█████▌    | 536/971 [00:10<00:08, 54.29it/s]backtest loop:  56%|█████▌    | 543/971 [00:10<00:07, 56.55it/s]backtest loop:  57%|█████▋    | 549/971 [00:10<00:07, 57.45it/s]backtest loop:  57%|█████▋    | 556/971 [00:10<00:07, 55.65it/s]backtest loop:  58%|█████▊    | 562/971 [00:10<00:07, 56.51it/s]backtest loop:  58%|█████▊    | 568/971 [00:10<00:07, 57.30it/s]backtest loop:  59%|█████▉    | 575/971 [00:10<00:06, 57.95it/s]backtest loop:  60%|█████▉    | 581/971 [00:10<00:07, 55.11it/s]backtest loop:  60%|██████    | 587/971 [00:10<00:06, 55.13it/s]backtest loop:  61%|██████    | 593/971 [00:11<00:06, 56.17it/s]backtest loop:  62%|██████▏   | 599/971 [00:11<00:06, 56.65it/s]backtest loop:  62%|██████▏   | 605/971 [00:11<00:06, 54.13it/s]backtest loop:  63%|██████▎   | 612/971 [00:11<00:06, 56.63it/s]backtest loop:  64%|██████▎   | 618/971 [00:11<00:06, 57.33it/s]backtest loop:  64%|██████▍   | 624/971 [00:11<00:05, 57.84it/s]backtest loop:  65%|██████▍   | 630/971 [00:11<00:06, 53.97it/s]backtest loop:  66%|██████▌   | 637/971 [00:11<00:05, 56.56it/s]backtest loop:  66%|██████▋   | 644/971 [00:11<00:05, 58.35it/s]backtest loop:  67%|██████▋   | 650/971 [00:12<00:05, 55.46it/s]backtest loop:  68%|██████▊   | 656/971 [00:12<00:05, 56.51it/s]backtest loop:  68%|██████▊   | 662/971 [00:12<00:05, 57.45it/s]backtest loop:  69%|██████▉   | 668/971 [00:12<00:05, 58.03it/s]backtest loop:  69%|██████▉   | 674/971 [00:12<00:05, 54.44it/s]backtest loop:  70%|███████   | 680/971 [00:12<00:05, 55.89it/s]backtest loop:  71%|███████   | 686/971 [00:12<00:05, 56.80it/s]backtest loop:  71%|███████▏  | 692/971 [00:12<00:04, 57.65it/s]backtest loop:  72%|███████▏  | 698/971 [00:12<00:04, 58.26it/s]backtest loop:  73%|███████▎  | 704/971 [00:12<00:04, 55.24it/s]backtest loop:  73%|███████▎  | 711/971 [00:13<00:04, 57.37it/s]backtest loop:  74%|███████▍  | 718/971 [00:13<00:04, 58.89it/s]backtest loop:  75%|███████▍  | 724/971 [00:13<00:04, 55.41it/s]backtest loop:  75%|███████▌  | 731/971 [00:13<00:04, 54.24it/s]backtest loop:  76%|███████▌  | 738/971 [00:13<00:04, 52.23it/s]backtest loop:  77%|███████▋  | 744/971 [00:13<00:04, 53.36it/s]backtest loop:  77%|███████▋  | 750/971 [00:13<00:04, 52.09it/s]backtest loop:  78%|███████▊  | 756/971 [00:13<00:03, 53.82it/s]backtest loop:  79%|███████▊  | 763/971 [00:14<00:03, 56.31it/s]backtest loop:  79%|███████▉  | 769/971 [00:14<00:03, 57.28it/s]backtest loop:  80%|███████▉  | 775/971 [00:14<00:03, 54.51it/s]backtest loop:  80%|████████  | 781/971 [00:14<00:03, 55.57it/s]backtest loop:  81%|████████  | 787/971 [00:14<00:03, 55.93it/s]backtest loop:  82%|████████▏ | 793/971 [00:14<00:03, 53.72it/s]backtest loop:  82%|████████▏ | 799/971 [00:14<00:03, 54.73it/s]backtest loop:  83%|████████▎ | 806/971 [00:14<00:02, 57.03it/s]backtest loop:  84%|████████▎ | 812/971 [00:14<00:02, 57.83it/s]backtest loop:  84%|████████▍ | 818/971 [00:15<00:02, 55.01it/s]backtest loop:  85%|████████▍ | 825/971 [00:15<00:02, 57.15it/s]backtest loop:  86%|████████▌ | 831/971 [00:15<00:02, 57.79it/s]backtest loop:  86%|████████▌ | 837/971 [00:15<00:02, 57.57it/s]backtest loop:  87%|████████▋ | 843/971 [00:15<00:02, 54.69it/s]backtest loop:  88%|████████▊ | 850/971 [00:15<00:02, 56.93it/s]backtest loop:  88%|████████▊ | 856/971 [00:15<00:02, 57.19it/s]backtest loop:  89%|████████▉ | 862/971 [00:15<00:01, 54.64it/s]backtest loop:  89%|████████▉ | 869/971 [00:15<00:01, 56.97it/s]backtest loop:  90%|█████████ | 876/971 [00:16<00:01, 58.54it/s]backtest loop:  91%|█████████ | 882/971 [00:16<00:01, 55.38it/s]backtest loop:  91%|█████████▏| 888/971 [00:16<00:01, 56.56it/s]backtest loop:  92%|█████████▏| 895/971 [00:16<00:01, 58.34it/s]backtest loop:  93%|█████████▎| 902/971 [00:16<00:01, 56.32it/s]backtest loop:  94%|█████████▎| 908/971 [00:16<00:01, 57.04it/s]backtest loop:  94%|█████████▍| 915/971 [00:16<00:00, 58.52it/s]backtest loop:  95%|█████████▍| 921/971 [00:16<00:00, 55.61it/s]backtest loop:  96%|█████████▌| 928/971 [00:16<00:00, 57.55it/s]backtest loop:  96%|█████████▋| 935/971 [00:17<00:00, 58.96it/s]backtest loop:  97%|█████████▋| 941/971 [00:17<00:00, 55.45it/s]backtest loop:  98%|█████████▊| 947/971 [00:17<00:00, 56.15it/s]backtest loop:  98%|█████████▊| 953/971 [00:17<00:00, 57.00it/s]backtest loop:  99%|█████████▉| 959/971 [00:17<00:00, 57.49it/s]backtest loop:  99%|█████████▉| 965/971 [00:17<00:00, 54.67it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 55.95it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.70it/s]
[2943066:MainThread](2024-04-24 23:56:59,795) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000391
std                0.005967
annualized_return  0.093035
information_ratio  1.010666
max_drawdown      -0.226982
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000193
std                0.005967
annualized_return  0.045880
information_ratio  0.498430
max_drawdown      -0.281297
[2943066:MainThread](2024-04-24 23:56:59,812) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 4 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244,
                                                    0.06012304631775825,
                                                    0.045880009775050655],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835,
                                                    0.6296566548029155,
                                                    0.49843034034936584],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334,
                                               -0.24933141070803327,
                                               -0.2812966065033353],
 'IC': [0.02587224613755935,
        0.021163409656197618,
        0.022316224135223012,
        0.025285754183174552],
 'ICIR': [0.18518614400027864,
          0.1544866993423066,
          0.15670848538695684,
          0.18641023059651965],
 'Rank IC': [0.02043466903243119,
             0.01549351371921764,
             0.01806255713632389,
             0.024278838529892835],
 'Rank ICIR': [0.14468640124580973,
               0.11103740542301493,
               0.12281036940312468,
               0.1780547655378848],
 'mae': [0.7073439359664917,
         0.7074997425079346,
         0.7073977589607239,
         0.7072641253471375],
 'mse': [0.995890736579895,
         0.9962072968482971,
         0.9961547255516052,
         0.9959003925323486]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-24 23:57:01,092) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<29:12, 17.70s/it]epoch:   2%|▏         | 2/100 [00:35<28:53, 17.69s/it]epoch:   3%|▎         | 3/100 [00:53<28:34, 17.67s/it]epoch:   4%|▍         | 4/100 [01:10<28:13, 17.64s/it]epoch:   5%|▌         | 5/100 [01:28<27:56, 17.65s/it]epoch:   6%|▌         | 6/100 [01:46<27:42, 17.69s/it]epoch:   7%|▋         | 7/100 [02:03<27:20, 17.64s/it]epoch:   8%|▊         | 8/100 [02:21<27:01, 17.63s/it]epoch:   9%|▉         | 9/100 [02:38<26:39, 17.57s/it]epoch:  10%|█         | 10/100 [02:56<26:21, 17.58s/it]epoch:  11%|█         | 11/100 [03:13<25:59, 17.53s/it]epoch:  12%|█▏        | 12/100 [03:31<25:51, 17.63s/it]epoch:  13%|█▎        | 13/100 [03:48<25:26, 17.55s/it]epoch:  14%|█▍        | 14/100 [04:06<25:05, 17.51s/it]epoch:  15%|█▌        | 15/100 [04:23<24:50, 17.54s/it]epoch:  16%|█▌        | 16/100 [04:41<24:33, 17.54s/it]epoch:  17%|█▋        | 17/100 [04:58<24:10, 17.48s/it]epoch:  18%|█▊        | 18/100 [05:16<23:53, 17.48s/it]epoch:  19%|█▉        | 19/100 [05:33<23:37, 17.51s/it]epoch:  20%|██        | 20/100 [05:51<23:14, 17.43s/it]epoch:  21%|██        | 21/100 [06:08<22:57, 17.44s/it]epoch:  22%|██▏       | 22/100 [06:26<22:43, 17.48s/it]epoch:  23%|██▎       | 23/100 [06:43<22:29, 17.52s/it]epoch:  24%|██▍       | 24/100 [07:01<22:07, 17.47s/it]epoch:  25%|██▌       | 25/100 [07:18<21:53, 17.52s/it]epoch:  26%|██▌       | 26/100 [07:36<21:33, 17.47s/it]epoch:  27%|██▋       | 27/100 [07:53<21:14, 17.46s/it]epoch:  28%|██▊       | 28/100 [08:11<20:59, 17.50s/it]epoch:  29%|██▉       | 29/100 [08:28<20:40, 17.47s/it]epoch:  30%|███       | 30/100 [08:45<20:23, 17.47s/it]0.04935662699267367
best ic: 0.04935662699267367
epoch:  31%|███       | 31/100 [09:05<20:52, 18.15s/it]0.05085248959718315
best ic: 0.05085248959718315
epoch:  32%|███▏      | 32/100 [09:25<21:05, 18.61s/it]0.04989260047601557
epoch:  33%|███▎      | 33/100 [09:45<21:07, 18.92s/it]0.04373295709691486
epoch:  34%|███▍      | 34/100 [10:04<21:04, 19.17s/it]0.05396210870211812
best ic: 0.05396210870211812
epoch:  35%|███▌      | 35/100 [10:24<20:56, 19.33s/it]0.04773716807585793
epoch:  36%|███▌      | 36/100 [10:44<20:43, 19.42s/it]0.046658665898162595
epoch:  37%|███▋      | 37/100 [11:03<20:25, 19.46s/it]0.050623760715682954
epoch:  38%|███▊      | 38/100 [11:23<20:11, 19.53s/it]0.047711221673560886
epoch:  39%|███▉      | 39/100 [11:43<19:54, 19.59s/it]0.04802618457026712
epoch:  40%|████      | 40/100 [12:02<19:37, 19.62s/it]0.04758340309425416
epoch:  41%|████      | 41/100 [12:22<19:20, 19.66s/it]0.046097048923813846
epoch:  42%|████▏     | 42/100 [12:42<18:59, 19.64s/it]0.04446469208552905
epoch:  42%|████▏     | 42/100 [13:01<17:59, 18.62s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-25 00:10:03,114) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-25 00:10:03,130) INFO - qlib.workflow - [recorder.py:341] - Recorder b7c82d12b70f43ad982b6ceaf76e3b2c starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:08,  7.66it/s]online:   3%|▎         | 2/63 [00:00<00:08,  7.62it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.42it/s]online:   6%|▋         | 4/63 [00:00<00:07,  7.54it/s]online:   8%|▊         | 5/63 [00:00<00:07,  7.27it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.29it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.25it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.27it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.36it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.30it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.36it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  7.21it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.18it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.18it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.20it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.24it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.16it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.27it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.24it/s]online:  32%|███▏      | 20/63 [00:02<00:05,  7.19it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.31it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.24it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.29it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.20it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.21it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.39it/s]online:  43%|████▎     | 27/63 [00:03<00:04,  7.38it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.38it/s]online:  46%|████▌     | 29/63 [00:03<00:04,  7.30it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.32it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  7.32it/s]online:  51%|█████     | 32/63 [00:04<00:04,  7.33it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  7.34it/s]online:  54%|█████▍    | 34/63 [00:04<00:03,  7.33it/s]online:  56%|█████▌    | 35/63 [00:04<00:03,  7.35it/s]online:  57%|█████▋    | 36/63 [00:04<00:03,  7.35it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.35it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.35it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.34it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.32it/s]online:  65%|██████▌   | 41/63 [00:05<00:02,  7.33it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.32it/s]online:  68%|██████▊   | 43/63 [00:05<00:02,  7.23it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.30it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.31it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.29it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.20it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.16it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.21it/s]online:  79%|███████▉  | 50/63 [00:06<00:01,  7.24it/s]online:  81%|████████  | 51/63 [00:06<00:01,  7.23it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.33it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.28it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.23it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.25it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.23it/s]online:  90%|█████████ | 57/63 [00:07<00:00,  7.25it/s]online:  92%|█████████▏| 58/63 [00:07<00:00,  7.24it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.20it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.26it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.20it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.31it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.47it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.29it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-25 00:10:18,385) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9960065 mae 0.7073571
{'IC': 0.024794335302755766,
 'ICIR': 0.1718703473411494,
 'Rank IC': 0.021080508001620087,
 'Rank ICIR': 0.14405894542010167}
[2943066:MainThread](2024-04-25 00:10:20,117) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-25 00:10:33,194) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 00:10:33,197) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 00:10:39,325) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe2b0dbcbb0>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:48,  8.93it/s]backtest loop:   1%|          | 9/971 [00:00<00:39, 24.10it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:27, 34.56it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:24, 39.49it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:20, 45.10it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:19, 49.21it/s]backtest loop:   4%|▍         | 39/971 [00:00<00:19, 48.27it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:18, 51.34it/s]backtest loop:   5%|▌         | 52/971 [00:01<00:16, 54.66it/s]backtest loop:   6%|▌         | 58/971 [00:01<00:17, 52.82it/s]backtest loop:   7%|▋         | 65/971 [00:01<00:16, 55.81it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 54.76it/s]backtest loop:   8%|▊         | 79/971 [00:01<00:15, 57.08it/s]backtest loop:   9%|▉         | 86/971 [00:01<00:15, 58.65it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 55.60it/s]backtest loop:  10%|█         | 98/971 [00:02<00:15, 56.47it/s]backtest loop:  11%|█         | 104/971 [00:02<00:15, 56.39it/s]backtest loop:  11%|█▏        | 110/971 [00:02<00:15, 56.59it/s]backtest loop:  12%|█▏        | 116/971 [00:02<00:14, 57.10it/s]backtest loop:  13%|█▎        | 122/971 [00:02<00:15, 54.65it/s]backtest loop:  13%|█▎        | 128/971 [00:02<00:15, 53.07it/s]backtest loop:  14%|█▍        | 134/971 [00:02<00:15, 54.83it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:15, 53.90it/s]backtest loop:  15%|█▌        | 147/971 [00:02<00:14, 55.43it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:14, 56.43it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:14, 57.19it/s]backtest loop:  17%|█▋        | 166/971 [00:03<00:14, 55.34it/s]backtest loop:  18%|█▊        | 173/971 [00:03<00:13, 57.46it/s]backtest loop:  18%|█▊        | 179/971 [00:03<00:13, 58.07it/s]backtest loop:  19%|█▉        | 185/971 [00:03<00:14, 55.52it/s]backtest loop:  20%|█▉        | 191/971 [00:03<00:13, 56.68it/s]backtest loop:  20%|██        | 197/971 [00:03<00:13, 57.36it/s]backtest loop:  21%|██        | 203/971 [00:03<00:13, 57.90it/s]backtest loop:  22%|██▏       | 210/971 [00:04<00:13, 56.04it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 53.93it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:13, 55.49it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:12, 57.58it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:13, 54.93it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:12, 57.10it/s]backtest loop:  26%|██▌       | 248/971 [00:04<00:12, 57.48it/s]backtest loop:  26%|██▌       | 254/971 [00:04<00:13, 53.54it/s]backtest loop:  27%|██▋       | 261/971 [00:04<00:12, 56.15it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:13, 53.15it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:12, 54.12it/s]backtest loop:  29%|██▉       | 280/971 [00:05<00:12, 56.66it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:12, 54.08it/s]backtest loop:  30%|███       | 293/971 [00:05<00:12, 56.45it/s]backtest loop:  31%|███       | 299/971 [00:05<00:11, 57.20it/s]backtest loop:  31%|███▏      | 305/971 [00:05<00:12, 54.31it/s]backtest loop:  32%|███▏      | 311/971 [00:05<00:12, 54.77it/s]backtest loop:  33%|███▎      | 317/971 [00:05<00:11, 55.34it/s]backtest loop:  33%|███▎      | 323/971 [00:06<00:11, 54.37it/s]backtest loop:  34%|███▍      | 330/971 [00:06<00:11, 53.77it/s]backtest loop:  35%|███▍      | 336/971 [00:06<00:11, 55.37it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:11, 56.59it/s]backtest loop:  36%|███▌      | 348/971 [00:06<00:10, 57.49it/s]backtest loop:  37%|███▋      | 355/971 [00:06<00:11, 55.59it/s]backtest loop:  37%|███▋      | 362/971 [00:06<00:10, 57.61it/s]backtest loop:  38%|███▊      | 368/971 [00:06<00:11, 52.31it/s]backtest loop:  39%|███▊      | 374/971 [00:06<00:11, 54.25it/s]backtest loop:  39%|███▉      | 380/971 [00:07<00:10, 55.75it/s]backtest loop:  40%|███▉      | 386/971 [00:07<00:10, 56.92it/s]backtest loop:  40%|████      | 392/971 [00:07<00:10, 57.18it/s]backtest loop:  41%|████      | 398/971 [00:07<00:10, 54.79it/s]backtest loop:  42%|████▏     | 404/971 [00:07<00:10, 56.17it/s]backtest loop:  42%|████▏     | 410/971 [00:07<00:09, 56.87it/s]backtest loop:  43%|████▎     | 417/971 [00:07<00:09, 58.57it/s]backtest loop:  44%|████▎     | 423/971 [00:08<00:16, 33.30it/s]backtest loop:  44%|████▍     | 429/971 [00:08<00:14, 38.14it/s]backtest loop:  45%|████▍     | 435/971 [00:08<00:12, 42.45it/s]backtest loop:  45%|████▌     | 441/971 [00:08<00:11, 46.25it/s]backtest loop:  46%|████▌     | 447/971 [00:08<00:11, 46.96it/s]backtest loop:  47%|████▋     | 453/971 [00:08<00:10, 50.14it/s]backtest loop:  47%|████▋     | 459/971 [00:08<00:09, 52.44it/s]backtest loop:  48%|████▊     | 465/971 [00:08<00:09, 54.45it/s]backtest loop:  49%|████▊     | 471/971 [00:08<00:09, 55.42it/s]backtest loop:  49%|████▉     | 477/971 [00:09<00:09, 53.28it/s]backtest loop:  50%|████▉     | 483/971 [00:09<00:08, 54.93it/s]backtest loop:  50%|█████     | 489/971 [00:09<00:08, 56.12it/s]backtest loop:  51%|█████     | 495/971 [00:09<00:08, 53.74it/s]backtest loop:  52%|█████▏    | 501/971 [00:09<00:08, 55.11it/s]backtest loop:  52%|█████▏    | 507/971 [00:09<00:08, 52.66it/s]backtest loop:  53%|█████▎    | 513/971 [00:09<00:08, 54.59it/s]backtest loop:  53%|█████▎    | 519/971 [00:09<00:08, 55.78it/s]backtest loop:  54%|█████▍    | 525/971 [00:09<00:07, 56.91it/s]backtest loop:  55%|█████▍    | 531/971 [00:10<00:08, 54.26it/s]backtest loop:  55%|█████▌    | 537/971 [00:10<00:07, 55.71it/s]backtest loop:  56%|█████▌    | 543/971 [00:10<00:07, 56.85it/s]backtest loop:  57%|█████▋    | 549/971 [00:10<00:07, 57.76it/s]backtest loop:  57%|█████▋    | 555/971 [00:10<00:07, 58.37it/s]backtest loop:  58%|█████▊    | 561/971 [00:10<00:07, 55.00it/s]backtest loop:  58%|█████▊    | 567/971 [00:10<00:07, 56.31it/s]backtest loop:  59%|█████▉    | 573/971 [00:10<00:06, 57.35it/s]backtest loop:  60%|█████▉    | 579/971 [00:10<00:06, 58.01it/s]backtest loop:  60%|██████    | 585/971 [00:10<00:06, 58.22it/s]backtest loop:  61%|██████    | 591/971 [00:11<00:06, 55.10it/s]backtest loop:  61%|██████▏   | 597/971 [00:11<00:06, 56.48it/s]backtest loop:  62%|██████▏   | 603/971 [00:11<00:06, 57.14it/s]backtest loop:  63%|██████▎   | 609/971 [00:11<00:06, 57.71it/s]backtest loop:  63%|██████▎   | 615/971 [00:11<00:06, 54.03it/s]backtest loop:  64%|██████▍   | 621/971 [00:11<00:06, 55.57it/s]backtest loop:  65%|██████▍   | 628/971 [00:11<00:05, 57.67it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:06, 56.00it/s]backtest loop:  66%|██████▌   | 642/971 [00:11<00:05, 58.00it/s]backtest loop:  67%|██████▋   | 648/971 [00:12<00:05, 58.54it/s]backtest loop:  67%|██████▋   | 654/971 [00:12<00:05, 58.94it/s]backtest loop:  68%|██████▊   | 660/971 [00:12<00:05, 55.75it/s]backtest loop:  69%|██████▊   | 666/971 [00:12<00:05, 56.64it/s]backtest loop:  69%|██████▉   | 673/971 [00:12<00:05, 58.32it/s]backtest loop:  70%|██████▉   | 679/971 [00:12<00:05, 55.26it/s]backtest loop:  71%|███████   | 685/971 [00:12<00:05, 56.32it/s]backtest loop:  71%|███████   | 691/971 [00:12<00:04, 57.28it/s]backtest loop:  72%|███████▏  | 697/971 [00:12<00:04, 58.02it/s]backtest loop:  73%|███████▎  | 704/971 [00:13<00:04, 55.93it/s]backtest loop:  73%|███████▎  | 711/971 [00:13<00:04, 57.75it/s]backtest loop:  74%|███████▍  | 717/971 [00:13<00:04, 58.36it/s]backtest loop:  74%|███████▍  | 723/971 [00:13<00:04, 58.66it/s]backtest loop:  75%|███████▌  | 729/971 [00:13<00:04, 55.65it/s]backtest loop:  76%|███████▌  | 735/971 [00:13<00:04, 53.60it/s]backtest loop:  76%|███████▋  | 741/971 [00:13<00:04, 55.31it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 54.21it/s]backtest loop:  78%|███████▊  | 755/971 [00:14<00:04, 53.52it/s]backtest loop:  78%|███████▊  | 762/971 [00:14<00:03, 56.02it/s]backtest loop:  79%|███████▉  | 769/971 [00:14<00:03, 57.77it/s]backtest loop:  80%|███████▉  | 775/971 [00:14<00:03, 54.39it/s]backtest loop:  80%|████████  | 781/971 [00:14<00:03, 55.36it/s]backtest loop:  81%|████████  | 788/971 [00:14<00:03, 54.01it/s]backtest loop:  82%|████████▏ | 794/971 [00:14<00:03, 55.53it/s]backtest loop:  82%|████████▏ | 800/971 [00:14<00:03, 56.71it/s]backtest loop:  83%|████████▎ | 806/971 [00:14<00:02, 57.27it/s]backtest loop:  84%|████████▎ | 812/971 [00:15<00:02, 57.89it/s]backtest loop:  84%|████████▍ | 818/971 [00:15<00:02, 54.96it/s]backtest loop:  85%|████████▍ | 824/971 [00:15<00:02, 56.08it/s]backtest loop:  85%|████████▌ | 830/971 [00:15<00:02, 57.08it/s]backtest loop:  86%|████████▌ | 837/971 [00:15<00:02, 58.64it/s]backtest loop:  87%|████████▋ | 843/971 [00:15<00:02, 55.48it/s]backtest loop:  87%|████████▋ | 849/971 [00:15<00:02, 56.44it/s]backtest loop:  88%|████████▊ | 856/971 [00:15<00:01, 58.24it/s]backtest loop:  89%|████████▉ | 862/971 [00:15<00:01, 55.22it/s]backtest loop:  89%|████████▉ | 868/971 [00:16<00:01, 56.30it/s]backtest loop:  90%|█████████ | 874/971 [00:16<00:01, 57.25it/s]backtest loop:  91%|█████████ | 880/971 [00:16<00:01, 57.58it/s]backtest loop:  91%|█████████ | 886/971 [00:16<00:01, 58.22it/s]backtest loop:  92%|█████████▏| 892/971 [00:16<00:01, 55.10it/s]backtest loop:  93%|█████████▎| 899/971 [00:16<00:01, 57.24it/s]backtest loop:  93%|█████████▎| 905/971 [00:16<00:01, 56.41it/s]backtest loop:  94%|█████████▍| 911/971 [00:16<00:01, 57.34it/s]backtest loop:  94%|█████████▍| 917/971 [00:16<00:01, 53.97it/s]backtest loop:  95%|█████████▌| 924/971 [00:16<00:00, 56.38it/s]backtest loop:  96%|█████████▌| 930/971 [00:17<00:00, 57.26it/s]backtest loop:  96%|█████████▋| 936/971 [00:17<00:00, 54.33it/s]backtest loop:  97%|█████████▋| 942/971 [00:17<00:00, 55.84it/s]backtest loop:  98%|█████████▊| 948/971 [00:17<00:00, 55.28it/s]backtest loop:  98%|█████████▊| 954/971 [00:17<00:00, 55.01it/s]backtest loop:  99%|█████████▉| 960/971 [00:17<00:00, 53.25it/s]backtest loop:  99%|█████████▉| 966/971 [00:17<00:00, 54.78it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 54.41it/s]
[2943066:MainThread](2024-04-25 00:10:57,250) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000462
std                0.005729
annualized_return  0.109861
information_ratio  1.243005
max_drawdown      -0.108110
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000263
std                0.005729
annualized_return  0.062700
information_ratio  0.709418
max_drawdown      -0.147667
[2943066:MainThread](2024-04-25 00:10:57,267) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 5 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244,
                                                    0.06012304631775825,
                                                    0.045880009775050655,
                                                    0.06270025818975491],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835,
                                                    0.6296566548029155,
                                                    0.49843034034936584,
                                                    0.7094182267806647],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334,
                                               -0.24933141070803327,
                                               -0.2812966065033353,
                                               -0.1476673679402031],
 'IC': [0.02587224613755935,
        0.021163409656197618,
        0.022316224135223012,
        0.025285754183174552,
        0.024794335302755766],
 'ICIR': [0.18518614400027864,
          0.1544866993423066,
          0.15670848538695684,
          0.18641023059651965,
          0.1718703473411494],
 'Rank IC': [0.02043466903243119,
             0.01549351371921764,
             0.01806255713632389,
             0.024278838529892835,
             0.021080508001620087],
 'Rank ICIR': [0.14468640124580973,
               0.11103740542301493,
               0.12281036940312468,
               0.1780547655378848,
               0.14405894542010167],
 'mae': [0.7073439359664917,
         0.7074997425079346,
         0.7073977589607239,
         0.7072641253471375,
         0.7073571085929871],
 'mse': [0.995890736579895,
         0.9962072968482971,
         0.9961547255516052,
         0.9959003925323486,
         0.9960064888000488]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-25 00:10:58,483) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<29:07, 17.65s/it]epoch:   2%|▏         | 2/100 [00:35<28:46, 17.62s/it]epoch:   3%|▎         | 3/100 [00:52<28:26, 17.59s/it]epoch:   4%|▍         | 4/100 [01:10<28:09, 17.60s/it]epoch:   5%|▌         | 5/100 [01:28<27:51, 17.59s/it]epoch:   6%|▌         | 6/100 [01:45<27:28, 17.54s/it]epoch:   7%|▋         | 7/100 [02:03<27:11, 17.55s/it]epoch:   8%|▊         | 8/100 [02:20<26:51, 17.52s/it]epoch:   9%|▉         | 9/100 [02:38<26:35, 17.54s/it]epoch:  10%|█         | 10/100 [02:55<26:13, 17.49s/it]epoch:  11%|█         | 11/100 [03:13<25:59, 17.53s/it]epoch:  12%|█▏        | 12/100 [03:30<25:46, 17.58s/it]epoch:  13%|█▎        | 13/100 [03:48<25:25, 17.54s/it]epoch:  14%|█▍        | 14/100 [04:05<25:08, 17.55s/it]epoch:  15%|█▌        | 15/100 [04:23<24:46, 17.49s/it]epoch:  16%|█▌        | 16/100 [04:40<24:29, 17.49s/it]epoch:  17%|█▋        | 17/100 [04:58<24:15, 17.53s/it]epoch:  18%|█▊        | 18/100 [05:15<23:54, 17.49s/it]epoch:  19%|█▉        | 19/100 [05:33<23:36, 17.49s/it]epoch:  20%|██        | 20/100 [05:50<23:20, 17.51s/it]epoch:  21%|██        | 21/100 [06:08<23:02, 17.51s/it]epoch:  22%|██▏       | 22/100 [06:25<22:40, 17.45s/it]epoch:  23%|██▎       | 23/100 [06:43<22:26, 17.49s/it]epoch:  24%|██▍       | 24/100 [07:00<22:11, 17.52s/it]epoch:  25%|██▌       | 25/100 [07:17<21:50, 17.47s/it]epoch:  26%|██▌       | 26/100 [07:35<21:31, 17.45s/it]epoch:  27%|██▋       | 27/100 [07:53<21:18, 17.52s/it]epoch:  28%|██▊       | 28/100 [08:10<20:58, 17.47s/it]epoch:  29%|██▉       | 29/100 [08:27<20:38, 17.44s/it]epoch:  30%|███       | 30/100 [08:45<20:26, 17.52s/it]0.051868981848750245
best ic: 0.051868981848750245
epoch:  31%|███       | 31/100 [09:05<20:54, 18.18s/it]0.055796605531838885
best ic: 0.055796605531838885
epoch:  32%|███▏      | 32/100 [09:24<21:04, 18.59s/it]0.053583410595857486
epoch:  33%|███▎      | 33/100 [09:44<21:13, 19.00s/it]0.05094905191551391
epoch:  34%|███▍      | 34/100 [10:04<21:05, 19.17s/it]0.05092291751937756
epoch:  35%|███▌      | 35/100 [10:23<20:52, 19.27s/it]0.052319275278331266
epoch:  36%|███▌      | 36/100 [10:43<20:46, 19.47s/it]0.052587443524227506
epoch:  37%|███▋      | 37/100 [11:03<20:30, 19.53s/it]0.054718481098076276
epoch:  38%|███▊      | 38/100 [11:23<20:12, 19.56s/it]0.05700159715766717
best ic: 0.05700159715766717
epoch:  39%|███▉      | 39/100 [11:43<20:01, 19.69s/it]0.05840108810641451
best ic: 0.05840108810641451
epoch:  40%|████      | 40/100 [12:02<19:41, 19.68s/it]0.05577227994572444
epoch:  41%|████      | 41/100 [12:22<19:21, 19.68s/it]0.05519034967124637
epoch:  42%|████▏     | 42/100 [12:42<19:06, 19.77s/it]0.04780850672420006
epoch:  43%|████▎     | 43/100 [13:02<18:45, 19.74s/it]0.05579142059146195
epoch:  44%|████▍     | 44/100 [13:21<18:20, 19.65s/it]0.04494521892805824
epoch:  45%|████▌     | 45/100 [13:41<18:02, 19.68s/it]0.053459250828586255
epoch:  46%|████▌     | 46/100 [14:01<17:45, 19.73s/it]0.043306121505150376
epoch:  47%|████▋     | 47/100 [14:20<17:22, 19.66s/it]0.04986559203419306
epoch:  47%|████▋     | 47/100 [14:40<16:32, 18.73s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-25 00:25:38,759) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-25 00:25:38,775) INFO - qlib.workflow - [recorder.py:341] - Recorder 010ae5aeae19404fba514a8147306c0c starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:07,  7.85it/s]online:   3%|▎         | 2/63 [00:00<00:08,  7.62it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.37it/s]online:   6%|▋         | 4/63 [00:00<00:07,  7.44it/s]online:   8%|▊         | 5/63 [00:00<00:07,  7.27it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.26it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.24it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.24it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.19it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.24it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.20it/s]online:  19%|█▉        | 12/63 [00:01<00:06,  7.31it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.19it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.25it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.20it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.26it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.22it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.32it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.20it/s]online:  32%|███▏      | 20/63 [00:02<00:05,  7.29it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.21it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.18it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.17it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.29it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.19it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.22it/s]online:  43%|████▎     | 27/63 [00:03<00:04,  7.22it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.26it/s]online:  46%|████▌     | 29/63 [00:03<00:04,  7.22it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.20it/s]online:  49%|████▉     | 31/63 [00:04<00:06,  5.30it/s]online:  51%|█████     | 32/63 [00:04<00:05,  5.76it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  6.18it/s]online:  54%|█████▍    | 34/63 [00:04<00:04,  6.44it/s]online:  56%|█████▌    | 35/63 [00:04<00:04,  6.64it/s]online:  57%|█████▋    | 36/63 [00:05<00:03,  6.86it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.00it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.06it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.15it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.17it/s]online:  65%|██████▌   | 41/63 [00:05<00:03,  7.17it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.17it/s]online:  68%|██████▊   | 43/63 [00:06<00:02,  7.16it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.16it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.18it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.17it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.19it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.23it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.25it/s]online:  79%|███████▉  | 50/63 [00:07<00:01,  7.23it/s]online:  81%|████████  | 51/63 [00:07<00:01,  7.21it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.24it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.17it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.22it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.20it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.23it/s]online:  90%|█████████ | 57/63 [00:08<00:00,  7.22it/s]online:  92%|█████████▏| 58/63 [00:08<00:00,  7.26it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.26it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.27it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.21it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.29it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.46it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.12it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-25 00:25:54,029) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9958209 mae 0.7073238
{'IC': 0.027614520063657392,
 'ICIR': 0.19735804355129996,
 'Rank IC': 0.025720809985435574,
 'Rank ICIR': 0.18164244212693723}
[2943066:MainThread](2024-04-25 00:25:55,757) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-25 00:26:08,563) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 00:26:08,566) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 00:26:14,656) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe2b5801b20>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:48,  8.90it/s]backtest loop:   1%|          | 9/971 [00:00<00:40, 24.04it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:27, 34.62it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 39.60it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:20, 46.59it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 47.19it/s]backtest loop:   4%|▍         | 41/971 [00:01<00:17, 51.73it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:16, 54.95it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 53.01it/s]backtest loop:   6%|▌         | 60/971 [00:01<00:16, 54.85it/s]backtest loop:   7%|▋         | 66/971 [00:01<00:16, 55.84it/s]backtest loop:   7%|▋         | 72/971 [00:01<00:16, 53.57it/s]backtest loop:   8%|▊         | 78/971 [00:01<00:16, 55.34it/s]backtest loop:   9%|▉         | 85/971 [00:01<00:15, 58.03it/s]backtest loop:   9%|▉         | 92/971 [00:01<00:15, 55.96it/s]backtest loop:  10%|█         | 99/971 [00:02<00:15, 57.74it/s]backtest loop:  11%|█         | 106/971 [00:02<00:14, 59.13it/s]backtest loop:  12%|█▏        | 112/971 [00:02<00:15, 56.21it/s]backtest loop:  12%|█▏        | 119/971 [00:02<00:14, 58.09it/s]backtest loop:  13%|█▎        | 125/971 [00:02<00:15, 55.49it/s]backtest loop:  13%|█▎        | 131/971 [00:02<00:15, 53.33it/s]backtest loop:  14%|█▍        | 137/971 [00:02<00:15, 55.02it/s]backtest loop:  15%|█▍        | 143/971 [00:02<00:14, 56.37it/s]backtest loop:  15%|█▌        | 149/971 [00:02<00:14, 57.35it/s]backtest loop:  16%|█▌        | 155/971 [00:03<00:14, 57.91it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:14, 54.88it/s]backtest loop:  17%|█▋        | 167/971 [00:03<00:14, 56.07it/s]backtest loop:  18%|█▊        | 174/971 [00:03<00:13, 57.98it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:14, 56.05it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:13, 57.85it/s]backtest loop:  20%|██        | 195/971 [00:03<00:13, 55.76it/s]backtest loop:  21%|██        | 201/971 [00:03<00:13, 56.74it/s]backtest loop:  21%|██▏       | 208/971 [00:03<00:13, 58.54it/s]backtest loop:  22%|██▏       | 214/971 [00:04<00:13, 55.82it/s]backtest loop:  23%|██▎       | 220/971 [00:04<00:13, 53.81it/s]backtest loop:  23%|██▎       | 227/971 [00:04<00:13, 56.07it/s]backtest loop:  24%|██▍       | 234/971 [00:04<00:12, 58.05it/s]backtest loop:  25%|██▍       | 240/971 [00:04<00:13, 55.31it/s]backtest loop:  25%|██▌       | 247/971 [00:04<00:12, 57.48it/s]backtest loop:  26%|██▌       | 254/971 [00:04<00:12, 55.61it/s]backtest loop:  27%|██▋       | 260/971 [00:04<00:12, 56.73it/s]backtest loop:  27%|██▋       | 266/971 [00:05<00:13, 53.97it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:12, 56.46it/s]backtest loop:  29%|██▊       | 279/971 [00:05<00:12, 57.25it/s]backtest loop:  29%|██▉       | 286/971 [00:05<00:12, 55.54it/s]backtest loop:  30%|███       | 292/971 [00:05<00:12, 56.55it/s]backtest loop:  31%|███       | 298/971 [00:05<00:11, 57.31it/s]backtest loop:  31%|███▏      | 305/971 [00:05<00:11, 55.55it/s]backtest loop:  32%|███▏      | 312/971 [00:05<00:11, 57.60it/s]backtest loop:  33%|███▎      | 319/971 [00:05<00:11, 59.05it/s]backtest loop:  33%|███▎      | 325/971 [00:06<00:11, 56.20it/s]backtest loop:  34%|███▍      | 331/971 [00:06<00:11, 57.03it/s]backtest loop:  35%|███▍      | 338/971 [00:06<00:10, 58.70it/s]backtest loop:  35%|███▌      | 344/971 [00:06<00:10, 59.04it/s]backtest loop:  36%|███▌      | 350/971 [00:06<00:11, 55.96it/s]backtest loop:  37%|███▋      | 357/971 [00:06<00:10, 58.11it/s]backtest loop:  37%|███▋      | 363/971 [00:06<00:10, 55.48it/s]backtest loop:  38%|███▊      | 369/971 [00:06<00:11, 53.41it/s]backtest loop:  39%|███▊      | 376/971 [00:06<00:10, 55.89it/s]backtest loop:  39%|███▉      | 382/971 [00:07<00:10, 56.85it/s]backtest loop:  40%|███▉      | 388/971 [00:07<00:10, 54.37it/s]backtest loop:  41%|████      | 395/971 [00:07<00:10, 56.63it/s]backtest loop:  41%|████▏     | 401/971 [00:07<00:09, 57.50it/s]backtest loop:  42%|████▏     | 408/971 [00:07<00:10, 55.31it/s]backtest loop:  43%|████▎     | 414/971 [00:07<00:09, 56.17it/s]backtest loop:  43%|████▎     | 420/971 [00:07<00:16, 34.40it/s]backtest loop:  44%|████▍     | 427/971 [00:08<00:13, 40.23it/s]backtest loop:  45%|████▍     | 433/971 [00:08<00:12, 42.44it/s]backtest loop:  45%|████▌     | 439/971 [00:08<00:11, 46.34it/s]backtest loop:  46%|████▌     | 446/971 [00:08<00:10, 50.50it/s]backtest loop:  47%|████▋     | 452/971 [00:08<00:10, 50.10it/s]backtest loop:  47%|████▋     | 458/971 [00:08<00:09, 52.47it/s]backtest loop:  48%|████▊     | 464/971 [00:08<00:09, 54.43it/s]backtest loop:  48%|████▊     | 470/971 [00:08<00:09, 55.36it/s]backtest loop:  49%|████▉     | 477/971 [00:08<00:09, 54.26it/s]backtest loop:  50%|████▉     | 483/971 [00:09<00:08, 55.64it/s]backtest loop:  50%|█████     | 489/971 [00:09<00:08, 56.76it/s]backtest loop:  51%|█████     | 495/971 [00:09<00:08, 54.40it/s]backtest loop:  52%|█████▏    | 502/971 [00:09<00:08, 56.86it/s]backtest loop:  52%|█████▏    | 508/971 [00:09<00:08, 54.47it/s]backtest loop:  53%|█████▎    | 515/971 [00:09<00:08, 56.77it/s]backtest loop:  54%|█████▍    | 522/971 [00:09<00:08, 55.39it/s]backtest loop:  54%|█████▍    | 529/971 [00:09<00:07, 57.35it/s]backtest loop:  55%|█████▌    | 536/971 [00:10<00:07, 55.68it/s]backtest loop:  56%|█████▌    | 543/971 [00:10<00:07, 57.54it/s]backtest loop:  57%|█████▋    | 550/971 [00:10<00:07, 58.95it/s]backtest loop:  57%|█████▋    | 556/971 [00:10<00:07, 56.08it/s]backtest loop:  58%|█████▊    | 563/971 [00:10<00:07, 57.85it/s]backtest loop:  59%|█████▊    | 570/971 [00:10<00:06, 59.18it/s]backtest loop:  59%|█████▉    | 576/971 [00:10<00:07, 56.17it/s]backtest loop:  60%|██████    | 583/971 [00:10<00:06, 58.06it/s]backtest loop:  61%|██████    | 590/971 [00:10<00:06, 59.40it/s]backtest loop:  61%|██████▏   | 596/971 [00:11<00:06, 56.23it/s]backtest loop:  62%|██████▏   | 603/971 [00:11<00:06, 58.06it/s]backtest loop:  63%|██████▎   | 610/971 [00:11<00:06, 56.11it/s]backtest loop:  64%|██████▎   | 617/971 [00:11<00:06, 57.97it/s]backtest loop:  64%|██████▍   | 624/971 [00:11<00:05, 59.31it/s]backtest loop:  65%|██████▍   | 630/971 [00:11<00:06, 55.96it/s]backtest loop:  66%|██████▌   | 637/971 [00:11<00:05, 58.00it/s]backtest loop:  66%|██████▋   | 644/971 [00:11<00:05, 59.43it/s]backtest loop:  67%|██████▋   | 650/971 [00:11<00:05, 55.99it/s]backtest loop:  68%|██████▊   | 657/971 [00:12<00:05, 57.76it/s]backtest loop:  68%|██████▊   | 664/971 [00:12<00:05, 59.08it/s]backtest loop:  69%|██████▉   | 670/971 [00:12<00:05, 55.84it/s]backtest loop:  70%|██████▉   | 677/971 [00:12<00:05, 57.81it/s]backtest loop:  70%|███████   | 683/971 [00:12<00:04, 57.92it/s]backtest loop:  71%|███████   | 689/971 [00:12<00:05, 55.19it/s]backtest loop:  72%|███████▏  | 695/971 [00:12<00:04, 56.49it/s]backtest loop:  72%|███████▏  | 701/971 [00:12<00:04, 57.45it/s]backtest loop:  73%|███████▎  | 707/971 [00:12<00:04, 58.16it/s]backtest loop:  74%|███████▎  | 714/971 [00:13<00:04, 56.03it/s]backtest loop:  74%|███████▍  | 720/971 [00:13<00:04, 56.90it/s]backtest loop:  75%|███████▍  | 727/971 [00:13<00:04, 58.57it/s]backtest loop:  75%|███████▌  | 733/971 [00:13<00:04, 52.50it/s]backtest loop:  76%|███████▌  | 739/971 [00:13<00:04, 54.24it/s]backtest loop:  77%|███████▋  | 745/971 [00:13<00:04, 55.44it/s]backtest loop:  77%|███████▋  | 751/971 [00:13<00:04, 53.26it/s]backtest loop:  78%|███████▊  | 757/971 [00:13<00:03, 54.99it/s]backtest loop:  79%|███████▊  | 764/971 [00:14<00:03, 57.26it/s]backtest loop:  79%|███████▉  | 770/971 [00:14<00:03, 54.65it/s]backtest loop:  80%|████████  | 777/971 [00:14<00:03, 57.00it/s]backtest loop:  81%|████████  | 783/971 [00:14<00:03, 54.38it/s]backtest loop:  81%|████████▏ | 789/971 [00:14<00:03, 55.46it/s]backtest loop:  82%|████████▏ | 795/971 [00:14<00:03, 56.70it/s]backtest loop:  83%|████████▎ | 802/971 [00:14<00:02, 58.43it/s]backtest loop:  83%|████████▎ | 808/971 [00:14<00:02, 55.58it/s]backtest loop:  84%|████████▍ | 814/971 [00:14<00:02, 56.35it/s]backtest loop:  85%|████████▍ | 821/971 [00:15<00:02, 58.17it/s]backtest loop:  85%|████████▌ | 828/971 [00:15<00:02, 56.18it/s]backtest loop:  86%|████████▌ | 834/971 [00:15<00:02, 57.02it/s]backtest loop:  87%|████████▋ | 841/971 [00:15<00:02, 58.64it/s]backtest loop:  87%|████████▋ | 847/971 [00:15<00:02, 58.78it/s]backtest loop:  88%|████████▊ | 853/971 [00:15<00:02, 55.59it/s]backtest loop:  89%|████████▊ | 860/971 [00:15<00:01, 57.58it/s]backtest loop:  89%|████████▉ | 867/971 [00:15<00:01, 55.65it/s]backtest loop:  90%|████████▉ | 873/971 [00:15<00:01, 56.73it/s]backtest loop:  91%|█████████ | 879/971 [00:16<00:01, 57.30it/s]backtest loop:  91%|█████████ | 886/971 [00:16<00:01, 58.77it/s]backtest loop:  92%|█████████▏| 892/971 [00:16<00:01, 55.80it/s]backtest loop:  93%|█████████▎| 899/971 [00:16<00:01, 57.74it/s]backtest loop:  93%|█████████▎| 906/971 [00:16<00:01, 59.18it/s]backtest loop:  94%|█████████▍| 912/971 [00:16<00:01, 55.98it/s]backtest loop:  95%|█████████▍| 918/971 [00:16<00:00, 56.56it/s]backtest loop:  95%|█████████▌| 925/971 [00:16<00:00, 58.22it/s]backtest loop:  96%|█████████▌| 931/971 [00:16<00:00, 55.47it/s]backtest loop:  96%|█████████▋| 937/971 [00:17<00:00, 56.68it/s]backtest loop:  97%|█████████▋| 944/971 [00:17<00:00, 58.33it/s]backtest loop:  98%|█████████▊| 950/971 [00:17<00:00, 55.32it/s]backtest loop:  99%|█████████▊| 957/971 [00:17<00:00, 57.35it/s]backtest loop:  99%|█████████▉| 963/971 [00:17<00:00, 57.81it/s]backtest loop: 100%|█████████▉| 970/971 [00:17<00:00, 55.77it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 55.01it/s]
[2943066:MainThread](2024-04-25 00:26:32,384) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000515
std                0.005837
annualized_return  0.122483
information_ratio  1.360150
max_drawdown      -0.142500
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000317
std                0.005836
annualized_return  0.075380
information_ratio  0.837269
max_drawdown      -0.181565
[2943066:MainThread](2024-04-25 00:26:32,401) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 6 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244,
                                                    0.06012304631775825,
                                                    0.045880009775050655,
                                                    0.06270025818975491,
                                                    0.0753799417472258],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835,
                                                    0.6296566548029155,
                                                    0.49843034034936584,
                                                    0.7094182267806647,
                                                    0.8372692588899964],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334,
                                               -0.24933141070803327,
                                               -0.2812966065033353,
                                               -0.1476673679402031,
                                               -0.18156490131955264],
 'IC': [0.02587224613755935,
        0.021163409656197618,
        0.022316224135223012,
        0.025285754183174552,
        0.024794335302755766,
        0.027614520063657392],
 'ICIR': [0.18518614400027864,
          0.1544866993423066,
          0.15670848538695684,
          0.18641023059651965,
          0.1718703473411494,
          0.19735804355129996],
 'Rank IC': [0.02043466903243119,
             0.01549351371921764,
             0.01806255713632389,
             0.024278838529892835,
             0.021080508001620087,
             0.025720809985435574],
 'Rank ICIR': [0.14468640124580973,
               0.11103740542301493,
               0.12281036940312468,
               0.1780547655378848,
               0.14405894542010167,
               0.18164244212693723],
 'mae': [0.7073439359664917,
         0.7074997425079346,
         0.7073977589607239,
         0.7072641253471375,
         0.7073571085929871,
         0.7073237895965576],
 'mse': [0.995890736579895,
         0.9962072968482971,
         0.9961547255516052,
         0.9959003925323486,
         0.9960064888000488,
         0.9958208799362183]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-25 00:26:33,604) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<29:14, 17.72s/it]epoch:   2%|▏         | 2/100 [00:35<28:55, 17.71s/it]epoch:   3%|▎         | 3/100 [00:53<28:35, 17.69s/it]epoch:   4%|▍         | 4/100 [01:10<28:14, 17.65s/it]epoch:   5%|▌         | 5/100 [01:28<27:56, 17.65s/it]epoch:   6%|▌         | 6/100 [01:45<27:38, 17.65s/it]epoch:   7%|▋         | 7/100 [02:03<27:17, 17.60s/it]epoch:   8%|▊         | 8/100 [02:21<27:09, 17.72s/it]epoch:   9%|▉         | 9/100 [02:38<26:45, 17.64s/it]epoch:  10%|█         | 10/100 [02:56<26:27, 17.64s/it]epoch:  11%|█         | 11/100 [03:13<26:00, 17.53s/it]epoch:  12%|█▏        | 12/100 [03:31<25:44, 17.55s/it]epoch:  13%|█▎        | 13/100 [03:48<25:26, 17.54s/it]epoch:  14%|█▍        | 14/100 [04:06<25:04, 17.50s/it]epoch:  15%|█▌        | 15/100 [04:23<24:47, 17.50s/it]epoch:  16%|█▌        | 16/100 [04:41<24:33, 17.54s/it]epoch:  17%|█▋        | 17/100 [04:58<24:11, 17.48s/it]epoch:  18%|█▊        | 18/100 [05:16<23:49, 17.44s/it]epoch:  19%|█▉        | 19/100 [05:33<23:39, 17.52s/it]epoch:  20%|██        | 20/100 [05:51<23:21, 17.52s/it]epoch:  21%|██        | 21/100 [06:08<23:00, 17.48s/it]epoch:  22%|██▏       | 22/100 [06:26<22:44, 17.49s/it]epoch:  23%|██▎       | 23/100 [06:43<22:28, 17.51s/it]epoch:  24%|██▍       | 24/100 [07:01<22:06, 17.46s/it]epoch:  25%|██▌       | 25/100 [07:18<21:51, 17.49s/it]epoch:  26%|██▌       | 26/100 [07:36<21:36, 17.52s/it]epoch:  27%|██▋       | 27/100 [07:53<21:13, 17.45s/it]epoch:  28%|██▊       | 28/100 [08:11<20:57, 17.46s/it]epoch:  29%|██▉       | 29/100 [08:28<20:41, 17.48s/it]epoch:  30%|███       | 30/100 [08:46<20:22, 17.46s/it]0.048043736041239515
best ic: 0.048043736041239515
epoch:  31%|███       | 31/100 [09:05<20:51, 18.13s/it]0.048083405610306225
best ic: 0.048083405610306225
epoch:  32%|███▏      | 32/100 [09:25<21:08, 18.65s/it]0.05737388111878945
best ic: 0.05737388111878945
epoch:  33%|███▎      | 33/100 [09:45<21:11, 18.97s/it]0.04971801604884013
epoch:  34%|███▍      | 34/100 [10:04<21:04, 19.16s/it]0.05412451630772661
epoch:  35%|███▌      | 35/100 [10:24<20:58, 19.35s/it]0.05010939367284326
epoch:  36%|███▌      | 36/100 [10:44<20:45, 19.46s/it]0.04916067195438559
epoch:  37%|███▋      | 37/100 [11:03<20:26, 19.47s/it]0.0521261070439505
epoch:  38%|███▊      | 38/100 [11:23<20:14, 19.59s/it]0.05054322994336795
epoch:  39%|███▉      | 39/100 [11:43<19:56, 19.61s/it]0.03968380706345817
epoch:  40%|████      | 40/100 [12:03<19:35, 19.60s/it]0.04833204798053252
epoch:  40%|████      | 40/100 [12:22<18:34, 18.57s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-25 00:38:56,539) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-25 00:38:56,555) INFO - qlib.workflow - [recorder.py:341] - Recorder 912523dd91bb41f88a8067b5e11d3821 starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:07,  8.18it/s]online:   3%|▎         | 2/63 [00:00<00:08,  7.50it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.40it/s]online:   6%|▋         | 4/63 [00:00<00:08,  7.37it/s]online:   8%|▊         | 5/63 [00:00<00:07,  7.28it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.36it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.24it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.22it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.25it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.22it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.34it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  7.21it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.23it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.25it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.24it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.22it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.23it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.27it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.25it/s]online:  32%|███▏      | 20/63 [00:02<00:06,  7.14it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.21it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.27it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.24it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.19it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.23it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.31it/s]online:  43%|████▎     | 27/63 [00:03<00:04,  7.27it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.18it/s]online:  46%|████▌     | 29/63 [00:03<00:04,  7.17it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.22it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  7.20it/s]online:  51%|█████     | 32/63 [00:04<00:04,  7.20it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  7.18it/s]online:  54%|█████▍    | 34/63 [00:04<00:04,  7.22it/s]online:  56%|█████▌    | 35/63 [00:04<00:03,  7.22it/s]online:  57%|█████▋    | 36/63 [00:04<00:03,  7.23it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.16it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.31it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.22it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.25it/s]online:  65%|██████▌   | 41/63 [00:05<00:03,  7.17it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.23it/s]online:  68%|██████▊   | 43/63 [00:05<00:02,  7.20it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.23it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.32it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.21it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.21it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.25it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.21it/s]online:  79%|███████▉  | 50/63 [00:06<00:01,  7.25it/s]online:  81%|████████  | 51/63 [00:07<00:01,  7.36it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.17it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.21it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.20it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.18it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.29it/s]online:  90%|█████████ | 57/63 [00:07<00:00,  7.17it/s]online:  92%|█████████▏| 58/63 [00:08<00:00,  7.18it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.16it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.33it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.25it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.23it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.48it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.25it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-25 00:39:11,760) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9961486 mae 0.7074754
{'IC': 0.02140857387664198,
 'ICIR': 0.14499978059710222,
 'Rank IC': 0.015033439290787839,
 'Rank ICIR': 0.09908168825597151}
[2943066:MainThread](2024-04-25 00:39:13,456) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-25 00:39:26,417) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 00:39:26,421) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 00:39:32,457) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe11c061790>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:40,  9.61it/s]backtest loop:   1%|          | 9/971 [00:00<00:38, 25.26it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:26, 35.62it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:23, 40.31it/s]backtest loop:   3%|▎         | 28/971 [00:00<00:19, 47.32it/s]backtest loop:   4%|▎         | 34/971 [00:00<00:19, 48.08it/s]backtest loop:   4%|▍         | 41/971 [00:00<00:17, 52.56it/s]backtest loop:   5%|▍         | 48/971 [00:01<00:16, 55.73it/s]backtest loop:   6%|▌         | 54/971 [00:01<00:17, 53.83it/s]backtest loop:   6%|▋         | 61/971 [00:01<00:16, 56.48it/s]backtest loop:   7%|▋         | 67/971 [00:01<00:16, 55.05it/s]backtest loop:   8%|▊         | 74/971 [00:01<00:15, 57.48it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:14, 59.47it/s]backtest loop:   9%|▉         | 88/971 [00:01<00:15, 57.09it/s]backtest loop:  10%|▉         | 94/971 [00:01<00:15, 57.86it/s]backtest loop:  10%|█         | 101/971 [00:02<00:14, 59.37it/s]backtest loop:  11%|█         | 107/971 [00:02<00:15, 56.52it/s]backtest loop:  12%|█▏        | 114/971 [00:02<00:14, 58.47it/s]backtest loop:  12%|█▏        | 121/971 [00:02<00:14, 60.56it/s]backtest loop:  13%|█▎        | 128/971 [00:02<00:15, 55.75it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:14, 57.77it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:15, 55.31it/s]backtest loop:  15%|█▌        | 148/971 [00:02<00:14, 57.44it/s]backtest loop:  16%|█▌        | 155/971 [00:02<00:13, 59.03it/s]backtest loop:  17%|█▋        | 161/971 [00:03<00:14, 56.11it/s]backtest loop:  17%|█▋        | 167/971 [00:03<00:14, 57.09it/s]backtest loop:  18%|█▊        | 174/971 [00:03<00:13, 58.72it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:13, 56.74it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:13, 58.87it/s]backtest loop:  20%|██        | 195/971 [00:03<00:13, 56.67it/s]backtest loop:  21%|██        | 202/971 [00:03<00:13, 58.52it/s]backtest loop:  22%|██▏       | 209/971 [00:03<00:12, 59.93it/s]backtest loop:  22%|██▏       | 216/971 [00:04<00:13, 54.35it/s]backtest loop:  23%|██▎       | 222/971 [00:04<00:13, 55.76it/s]backtest loop:  24%|██▎       | 229/971 [00:04<00:12, 58.17it/s]backtest loop:  24%|██▍       | 235/971 [00:04<00:13, 55.80it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:12, 57.61it/s]backtest loop:  26%|██▌       | 249/971 [00:04<00:12, 55.64it/s]backtest loop:  26%|██▋       | 256/971 [00:04<00:12, 57.75it/s]backtest loop:  27%|██▋       | 263/971 [00:04<00:11, 59.17it/s]backtest loop:  28%|██▊       | 269/971 [00:04<00:12, 56.29it/s]backtest loop:  28%|██▊       | 276/971 [00:05<00:12, 55.12it/s]backtest loop:  29%|██▉       | 283/971 [00:05<00:12, 57.21it/s]backtest loop:  30%|██▉       | 290/971 [00:05<00:11, 58.72it/s]backtest loop:  30%|███       | 296/971 [00:05<00:12, 55.76it/s]backtest loop:  31%|███       | 303/971 [00:05<00:11, 57.83it/s]backtest loop:  32%|███▏      | 310/971 [00:05<00:11, 55.79it/s]backtest loop:  33%|███▎      | 317/971 [00:05<00:11, 57.82it/s]backtest loop:  33%|███▎      | 324/971 [00:05<00:10, 59.14it/s]backtest loop:  34%|███▍      | 330/971 [00:06<00:11, 56.33it/s]backtest loop:  35%|███▍      | 337/971 [00:06<00:10, 58.44it/s]backtest loop:  35%|███▌      | 344/971 [00:06<00:10, 59.93it/s]backtest loop:  36%|███▌      | 351/971 [00:06<00:10, 57.48it/s]backtest loop:  37%|███▋      | 358/971 [00:06<00:10, 58.91it/s]backtest loop:  37%|███▋      | 364/971 [00:06<00:10, 56.31it/s]backtest loop:  38%|███▊      | 370/971 [00:06<00:11, 53.68it/s]backtest loop:  39%|███▉      | 377/971 [00:06<00:10, 56.28it/s]backtest loop:  39%|███▉      | 383/971 [00:06<00:10, 53.96it/s]backtest loop:  40%|████      | 390/971 [00:07<00:10, 56.60it/s]backtest loop:  41%|████      | 397/971 [00:07<00:09, 58.68it/s]backtest loop:  42%|████▏     | 403/971 [00:07<00:10, 55.88it/s]backtest loop:  42%|████▏     | 410/971 [00:07<00:09, 58.02it/s]backtest loop:  43%|████▎     | 417/971 [00:07<00:09, 59.50it/s]backtest loop:  44%|████▎     | 423/971 [00:07<00:14, 37.36it/s]backtest loop:  44%|████▍     | 430/971 [00:07<00:12, 42.80it/s]backtest loop:  45%|████▌     | 437/971 [00:08<00:11, 45.34it/s]backtest loop:  46%|████▌     | 443/971 [00:08<00:10, 48.45it/s]backtest loop:  46%|████▋     | 450/971 [00:08<00:09, 52.26it/s]backtest loop:  47%|████▋     | 457/971 [00:08<00:09, 52.28it/s]backtest loop:  48%|████▊     | 464/971 [00:08<00:09, 55.09it/s]backtest loop:  49%|████▊     | 471/971 [00:08<00:08, 57.26it/s]backtest loop:  49%|████▉     | 477/971 [00:08<00:08, 54.92it/s]backtest loop:  50%|████▉     | 484/971 [00:08<00:08, 57.06it/s]backtest loop:  50%|█████     | 490/971 [00:09<00:08, 54.84it/s]backtest loop:  51%|█████     | 497/971 [00:09<00:08, 57.08it/s]backtest loop:  52%|█████▏    | 504/971 [00:09<00:07, 58.73it/s]backtest loop:  53%|█████▎    | 510/971 [00:09<00:08, 56.04it/s]backtest loop:  53%|█████▎    | 516/971 [00:09<00:07, 56.90it/s]backtest loop:  54%|█████▍    | 522/971 [00:09<00:08, 54.65it/s]backtest loop:  54%|█████▍    | 529/971 [00:09<00:07, 57.05it/s]backtest loop:  55%|█████▌    | 536/971 [00:09<00:07, 55.54it/s]backtest loop:  56%|█████▌    | 543/971 [00:09<00:07, 57.61it/s]backtest loop:  57%|█████▋    | 550/971 [00:10<00:07, 59.28it/s]backtest loop:  57%|█████▋    | 556/971 [00:10<00:07, 56.34it/s]backtest loop:  58%|█████▊    | 563/971 [00:10<00:07, 58.21it/s]backtest loop:  59%|█████▊    | 570/971 [00:10<00:06, 59.54it/s]backtest loop:  59%|█████▉    | 576/971 [00:10<00:06, 56.50it/s]backtest loop:  60%|██████    | 583/971 [00:10<00:06, 58.33it/s]backtest loop:  61%|██████    | 589/971 [00:10<00:06, 58.58it/s]backtest loop:  61%|██████▏   | 595/971 [00:10<00:06, 58.69it/s]backtest loop:  62%|██████▏   | 601/971 [00:10<00:06, 55.48it/s]backtest loop:  63%|██████▎   | 608/971 [00:11<00:06, 57.62it/s]backtest loop:  63%|██████▎   | 615/971 [00:11<00:06, 56.11it/s]backtest loop:  64%|██████▍   | 622/971 [00:11<00:06, 57.99it/s]backtest loop:  65%|██████▍   | 629/971 [00:11<00:05, 59.52it/s]backtest loop:  65%|██████▌   | 635/971 [00:11<00:05, 56.76it/s]backtest loop:  66%|██████▌   | 642/971 [00:11<00:05, 58.53it/s]backtest loop:  67%|██████▋   | 648/971 [00:11<00:05, 58.75it/s]backtest loop:  67%|██████▋   | 654/971 [00:11<00:05, 58.88it/s]backtest loop:  68%|██████▊   | 660/971 [00:11<00:05, 55.60it/s]backtest loop:  69%|██████▊   | 667/971 [00:12<00:05, 57.72it/s]backtest loop:  69%|██████▉   | 674/971 [00:12<00:05, 55.88it/s]backtest loop:  70%|███████   | 680/971 [00:12<00:05, 56.27it/s]backtest loop:  71%|███████   | 687/971 [00:12<00:04, 57.99it/s]backtest loop:  71%|███████▏  | 694/971 [00:12<00:04, 55.99it/s]backtest loop:  72%|███████▏  | 701/971 [00:12<00:04, 57.95it/s]backtest loop:  73%|███████▎  | 708/971 [00:12<00:04, 59.32it/s]backtest loop:  74%|███████▎  | 714/971 [00:12<00:04, 56.36it/s]backtest loop:  74%|███████▍  | 721/971 [00:13<00:04, 58.19it/s]backtest loop:  75%|███████▍  | 728/971 [00:13<00:04, 59.54it/s]backtest loop:  76%|███████▌  | 734/971 [00:13<00:04, 53.18it/s]backtest loop:  76%|███████▋  | 741/971 [00:13<00:04, 55.85it/s]backtest loop:  77%|███████▋  | 748/971 [00:13<00:04, 54.62it/s]backtest loop:  78%|███████▊  | 755/971 [00:13<00:04, 53.90it/s]backtest loop:  78%|███████▊  | 762/971 [00:13<00:03, 56.34it/s]backtest loop:  79%|███████▉  | 769/971 [00:13<00:03, 58.21it/s]backtest loop:  80%|███████▉  | 775/971 [00:13<00:03, 55.57it/s]backtest loop:  81%|████████  | 782/971 [00:14<00:03, 57.59it/s]backtest loop:  81%|████████  | 788/971 [00:14<00:03, 55.13it/s]backtest loop:  82%|████████▏ | 795/971 [00:14<00:03, 57.28it/s]backtest loop:  83%|████████▎ | 802/971 [00:14<00:02, 58.85it/s]backtest loop:  83%|████████▎ | 808/971 [00:14<00:02, 55.70it/s]backtest loop:  84%|████████▍ | 814/971 [00:14<00:02, 56.81it/s]backtest loop:  85%|████████▍ | 821/971 [00:14<00:02, 58.57it/s]backtest loop:  85%|████████▌ | 828/971 [00:14<00:02, 56.70it/s]backtest loop:  86%|████████▌ | 835/971 [00:15<00:02, 58.42it/s]backtest loop:  87%|████████▋ | 842/971 [00:15<00:02, 59.66it/s]backtest loop:  87%|████████▋ | 848/971 [00:15<00:02, 56.50it/s]backtest loop:  88%|████████▊ | 855/971 [00:15<00:01, 58.43it/s]backtest loop:  89%|████████▉ | 862/971 [00:15<00:01, 56.37it/s]backtest loop:  89%|████████▉ | 869/971 [00:15<00:01, 58.19it/s]backtest loop:  90%|█████████ | 876/971 [00:15<00:01, 59.13it/s]backtest loop:  91%|█████████ | 882/971 [00:15<00:01, 56.26it/s]backtest loop:  92%|█████████▏| 889/971 [00:15<00:01, 58.16it/s]backtest loop:  92%|█████████▏| 896/971 [00:16<00:01, 59.42it/s]backtest loop:  93%|█████████▎| 902/971 [00:16<00:01, 56.41it/s]backtest loop:  94%|█████████▎| 909/971 [00:16<00:01, 58.25it/s]backtest loop:  94%|█████████▍| 916/971 [00:16<00:00, 56.27it/s]backtest loop:  95%|█████████▌| 923/971 [00:16<00:00, 58.11it/s]backtest loop:  96%|█████████▌| 930/971 [00:16<00:00, 59.33it/s]backtest loop:  96%|█████████▋| 936/971 [00:16<00:00, 56.13it/s]backtest loop:  97%|█████████▋| 943/971 [00:16<00:00, 57.84it/s]backtest loop:  98%|█████████▊| 949/971 [00:17<00:00, 58.02it/s]backtest loop:  98%|█████████▊| 955/971 [00:17<00:00, 54.73it/s]backtest loop:  99%|█████████▉| 961/971 [00:17<00:00, 55.89it/s]backtest loop: 100%|█████████▉| 968/971 [00:17<00:00, 57.99it/s]backtest loop: 100%|██████████| 971/971 [00:17<00:00, 55.78it/s]
[2943066:MainThread](2024-04-25 00:39:49,938) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000229
std                0.006336
annualized_return  0.054526
information_ratio  0.557834
max_drawdown      -0.197687
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000031
std                0.006336
annualized_return  0.007337
information_ratio  0.075068
max_drawdown      -0.246883
[2943066:MainThread](2024-04-25 00:39:49,954) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 7 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244,
                                                    0.06012304631775825,
                                                    0.045880009775050655,
                                                    0.06270025818975491,
                                                    0.0753799417472258,
                                                    0.00733742814004799],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835,
                                                    0.6296566548029155,
                                                    0.49843034034936584,
                                                    0.7094182267806647,
                                                    0.8372692588899964,
                                                    0.0750675890199243],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334,
                                               -0.24933141070803327,
                                               -0.2812966065033353,
                                               -0.1476673679402031,
                                               -0.18156490131955264,
                                               -0.24688258794279827],
 'IC': [0.02587224613755935,
        0.021163409656197618,
        0.022316224135223012,
        0.025285754183174552,
        0.024794335302755766,
        0.027614520063657392,
        0.02140857387664198],
 'ICIR': [0.18518614400027864,
          0.1544866993423066,
          0.15670848538695684,
          0.18641023059651965,
          0.1718703473411494,
          0.19735804355129996,
          0.14499978059710222],
 'Rank IC': [0.02043466903243119,
             0.01549351371921764,
             0.01806255713632389,
             0.024278838529892835,
             0.021080508001620087,
             0.025720809985435574,
             0.015033439290787839],
 'Rank ICIR': [0.14468640124580973,
               0.11103740542301493,
               0.12281036940312468,
               0.1780547655378848,
               0.14405894542010167,
               0.18164244212693723,
               0.09908168825597151],
 'mae': [0.7073439359664917,
         0.7074997425079346,
         0.7073977589607239,
         0.7072641253471375,
         0.7073571085929871,
         0.7073237895965576,
         0.7074754238128662],
 'mse': [0.995890736579895,
         0.9962072968482971,
         0.9961547255516052,
         0.9959003925323486,
         0.9960064888000488,
         0.9958208799362183,
         0.9961485862731934]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-25 00:39:51,134) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<28:34, 17.32s/it]epoch:   2%|▏         | 2/100 [00:34<28:32, 17.48s/it]epoch:   3%|▎         | 3/100 [00:52<28:13, 17.46s/it]epoch:   4%|▍         | 4/100 [01:09<27:51, 17.41s/it]epoch:   5%|▌         | 5/100 [01:27<27:37, 17.44s/it]epoch:   6%|▌         | 6/100 [01:44<27:16, 17.41s/it]epoch:   7%|▋         | 7/100 [02:02<27:04, 17.47s/it]epoch:   8%|▊         | 8/100 [02:21<27:45, 18.10s/it]epoch:   9%|▉         | 9/100 [02:40<27:41, 18.25s/it]epoch:  10%|█         | 10/100 [02:57<27:10, 18.12s/it]epoch:  11%|█         | 11/100 [03:15<26:47, 18.07s/it]epoch:  12%|█▏        | 12/100 [03:33<26:27, 18.04s/it]epoch:  13%|█▎        | 13/100 [03:51<25:59, 17.92s/it]epoch:  14%|█▍        | 14/100 [04:09<25:31, 17.81s/it]epoch:  15%|█▌        | 15/100 [04:26<25:11, 17.78s/it]epoch:  16%|█▌        | 16/100 [04:44<24:53, 17.78s/it]epoch:  17%|█▋        | 17/100 [05:02<24:32, 17.75s/it]epoch:  18%|█▊        | 18/100 [05:19<24:10, 17.69s/it]epoch:  19%|█▉        | 19/100 [05:37<23:54, 17.70s/it]epoch:  20%|██        | 20/100 [05:55<23:33, 17.66s/it]epoch:  21%|██        | 21/100 [06:12<23:13, 17.64s/it]epoch:  22%|██▏       | 22/100 [06:30<22:57, 17.66s/it]epoch:  23%|██▎       | 23/100 [06:47<22:36, 17.61s/it]epoch:  24%|██▍       | 24/100 [07:05<22:13, 17.54s/it]epoch:  25%|██▌       | 25/100 [07:22<21:58, 17.57s/it]epoch:  26%|██▌       | 26/100 [07:40<21:39, 17.57s/it]epoch:  27%|██▋       | 27/100 [07:57<21:19, 17.52s/it]epoch:  28%|██▊       | 28/100 [08:15<21:05, 17.58s/it]epoch:  29%|██▉       | 29/100 [08:33<20:47, 17.58s/it]epoch:  30%|███       | 30/100 [08:50<20:33, 17.62s/it]0.052278003011987234
best ic: 0.052278003011987234
epoch:  31%|███       | 31/100 [09:11<21:12, 18.44s/it]0.05520511550176198
best ic: 0.05520511550176198
epoch:  32%|███▏      | 32/100 [09:31<21:29, 18.96s/it]0.051684578980193116
epoch:  33%|███▎      | 33/100 [09:51<21:28, 19.23s/it]0.04735855015804037
epoch:  34%|███▍      | 34/100 [10:11<21:24, 19.46s/it]0.05498852581077012
epoch:  35%|███▌      | 35/100 [10:31<21:19, 19.68s/it]0.05272903367710513
epoch:  36%|███▌      | 36/100 [10:51<21:06, 19.79s/it]0.057461287905256404
best ic: 0.057461287905256404
epoch:  37%|███▋      | 37/100 [11:11<20:53, 19.90s/it]0.05591411781973991
epoch:  38%|███▊      | 38/100 [11:31<20:35, 19.93s/it]0.054336843284397494
epoch:  39%|███▉      | 39/100 [11:51<20:11, 19.86s/it]0.055747026199643224
epoch:  40%|████      | 40/100 [12:11<19:54, 19.91s/it]0.05905251947338377
best ic: 0.05905251947338377
epoch:  41%|████      | 41/100 [12:31<19:42, 20.05s/it]0.04833359652228039
epoch:  42%|████▏     | 42/100 [12:51<19:17, 19.96s/it]0.0546459446356769
epoch:  43%|████▎     | 43/100 [13:11<18:55, 19.91s/it]0.05922760147907937
best ic: 0.05922760147907937
epoch:  44%|████▍     | 44/100 [13:30<18:25, 19.75s/it]0.056275518658097025
epoch:  45%|████▌     | 45/100 [13:50<18:12, 19.86s/it]0.05687324707878567
epoch:  46%|████▌     | 46/100 [14:10<17:48, 19.79s/it]0.061792871027844545
best ic: 0.061792871027844545
epoch:  47%|████▋     | 47/100 [14:30<17:25, 19.72s/it]0.054941486435168135
epoch:  48%|████▊     | 48/100 [14:49<17:08, 19.77s/it]0.05983078845455631
epoch:  49%|████▉     | 49/100 [15:09<16:42, 19.65s/it]0.051930277259794204
epoch:  50%|█████     | 50/100 [15:28<16:21, 19.64s/it]0.05365607814793243
epoch:  51%|█████     | 51/100 [15:48<16:05, 19.71s/it]0.04839725612443104
epoch:  52%|█████▏    | 52/100 [16:08<15:42, 19.64s/it]0.0541856631614434
epoch:  53%|█████▎    | 53/100 [16:28<15:27, 19.74s/it]0.06203069237558961
best ic: 0.06203069237558961
epoch:  54%|█████▍    | 54/100 [16:48<15:08, 19.76s/it]0.04509643340089982
epoch:  55%|█████▌    | 55/100 [17:07<14:43, 19.63s/it]0.05577226024817451
epoch:  56%|█████▌    | 56/100 [17:27<14:25, 19.66s/it]0.04864460226784409
epoch:  57%|█████▋    | 57/100 [17:46<14:07, 19.70s/it]0.05416035599867669
epoch:  58%|█████▊    | 58/100 [18:06<13:44, 19.63s/it]0.05781647306635101
epoch:  59%|█████▉    | 59/100 [18:26<13:29, 19.74s/it]0.05288737199085957
epoch:  60%|██████    | 60/100 [18:46<13:10, 19.75s/it]0.06049530622129341
epoch:  61%|██████    | 61/100 [19:05<12:48, 19.69s/it]0.05215438165197684
epoch:  61%|██████    | 61/100 [19:25<12:25, 19.11s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-25 00:59:16,746) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-25 00:59:16,762) INFO - qlib.workflow - [recorder.py:341] - Recorder 806e26fbe3b54d21b8cb68a129ded3ad starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:08,  7.16it/s]online:   3%|▎         | 2/63 [00:00<00:08,  6.80it/s]online:   5%|▍         | 3/63 [00:00<00:08,  6.91it/s]online:   6%|▋         | 4/63 [00:00<00:08,  6.69it/s]online:   8%|▊         | 5/63 [00:00<00:08,  6.76it/s]online:  10%|▉         | 6/63 [00:00<00:08,  6.77it/s]online:  11%|█         | 7/63 [00:01<00:08,  6.82it/s]online:  13%|█▎        | 8/63 [00:01<00:08,  6.79it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  6.86it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  6.85it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  6.81it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  6.70it/s]online:  21%|██        | 13/63 [00:01<00:07,  6.70it/s]online:  22%|██▏       | 14/63 [00:02<00:07,  6.68it/s]online:  24%|██▍       | 15/63 [00:02<00:07,  6.69it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  6.72it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  6.68it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  6.70it/s]online:  30%|███       | 19/63 [00:02<00:06,  6.71it/s]online:  32%|███▏      | 20/63 [00:02<00:06,  6.68it/s]online:  33%|███▎      | 21/63 [00:03<00:06,  6.68it/s]online:  35%|███▍      | 22/63 [00:03<00:06,  6.71it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  6.81it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  6.77it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  6.75it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  6.68it/s]online:  43%|████▎     | 27/63 [00:03<00:05,  6.78it/s]online:  44%|████▍     | 28/63 [00:04<00:05,  6.69it/s]online:  46%|████▌     | 29/63 [00:04<00:05,  6.71it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  6.79it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  6.77it/s]online:  51%|█████     | 32/63 [00:04<00:04,  6.79it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  6.84it/s]online:  54%|█████▍    | 34/63 [00:05<00:04,  6.79it/s]online:  56%|█████▌    | 35/63 [00:05<00:04,  6.79it/s]online:  57%|█████▋    | 36/63 [00:05<00:03,  6.80it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  6.82it/s]online:  60%|██████    | 38/63 [00:05<00:03,  6.80it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  6.84it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  6.87it/s]online:  65%|██████▌   | 41/63 [00:06<00:03,  6.83it/s]online:  67%|██████▋   | 42/63 [00:06<00:03,  6.83it/s]online:  68%|██████▊   | 43/63 [00:06<00:02,  6.84it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  6.82it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  6.90it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  6.83it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  6.80it/s]online:  76%|███████▌  | 48/63 [00:07<00:02,  6.84it/s]online:  78%|███████▊  | 49/63 [00:07<00:02,  6.85it/s]online:  79%|███████▉  | 50/63 [00:07<00:01,  6.83it/s]online:  81%|████████  | 51/63 [00:07<00:01,  6.83it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  6.81it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  6.84it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  6.83it/s]online:  87%|████████▋ | 55/63 [00:08<00:01,  6.87it/s]online:  89%|████████▉ | 56/63 [00:08<00:01,  6.82it/s]online:  90%|█████████ | 57/63 [00:08<00:00,  6.83it/s]online:  92%|█████████▏| 58/63 [00:08<00:00,  6.78it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  6.86it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  6.73it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  6.80it/s]online:  98%|█████████▊| 62/63 [00:09<00:00,  6.81it/s]online: 100%|██████████| 63/63 [00:09<00:00,  7.00it/s]online: 100%|██████████| 63/63 [00:09<00:00,  6.80it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-25 00:59:33,123) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9959833 mae 0.7073764
{'IC': 0.025598294351956503,
 'ICIR': 0.18934619960171314,
 'Rank IC': 0.022029561636039398,
 'Rank ICIR': 0.16430282874668095}
[2943066:MainThread](2024-04-25 00:59:34,873) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-25 00:59:49,268) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 00:59:49,271) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 00:59:55,817) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe049634e50>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<03:24,  4.73it/s]backtest loop:   1%|          | 9/971 [00:00<01:04, 14.84it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:39, 24.17it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:30, 30.74it/s]backtest loop:   3%|▎         | 27/971 [00:01<00:25, 37.66it/s]backtest loop:   4%|▎         | 34/971 [00:01<00:22, 42.09it/s]backtest loop:   4%|▍         | 41/971 [00:01<00:19, 47.63it/s]backtest loop:   5%|▍         | 47/971 [00:01<00:18, 50.52it/s]backtest loop:   5%|▌         | 53/971 [00:01<00:17, 52.85it/s]backtest loop:   6%|▌         | 59/971 [00:01<00:17, 51.46it/s]backtest loop:   7%|▋         | 65/971 [00:01<00:16, 53.37it/s]backtest loop:   7%|▋         | 71/971 [00:01<00:16, 55.14it/s]backtest loop:   8%|▊         | 77/971 [00:01<00:16, 53.35it/s]backtest loop:   9%|▊         | 84/971 [00:02<00:15, 56.63it/s]backtest loop:   9%|▉         | 90/971 [00:02<00:15, 56.68it/s]backtest loop:  10%|▉         | 96/971 [00:02<00:15, 57.32it/s]backtest loop:  11%|█         | 102/971 [00:02<00:16, 53.56it/s]backtest loop:  11%|█         | 108/971 [00:02<00:15, 54.00it/s]backtest loop:  12%|█▏        | 114/971 [00:02<00:15, 54.92it/s]backtest loop:  12%|█▏        | 120/971 [00:02<00:15, 55.56it/s]backtest loop:  13%|█▎        | 126/971 [00:02<00:16, 50.13it/s]backtest loop:  14%|█▎        | 132/971 [00:02<00:16, 51.64it/s]backtest loop:  14%|█▍        | 138/971 [00:03<00:15, 53.67it/s]backtest loop:  15%|█▍        | 144/971 [00:03<00:14, 55.24it/s]backtest loop:  15%|█▌        | 150/971 [00:03<00:14, 56.57it/s]backtest loop:  16%|█▌        | 156/971 [00:03<00:15, 53.57it/s]backtest loop:  17%|█▋        | 162/971 [00:03<00:14, 54.80it/s]backtest loop:  17%|█▋        | 168/971 [00:03<00:14, 56.20it/s]backtest loop:  18%|█▊        | 174/971 [00:03<00:13, 57.22it/s]backtest loop:  19%|█▊        | 181/971 [00:03<00:14, 55.66it/s]backtest loop:  19%|█▉        | 188/971 [00:03<00:13, 57.88it/s]backtest loop:  20%|█▉        | 194/971 [00:04<00:13, 58.12it/s]backtest loop:  21%|██        | 200/971 [00:04<00:14, 54.75it/s]backtest loop:  21%|██        | 206/971 [00:04<00:13, 56.17it/s]backtest loop:  22%|██▏       | 212/971 [00:04<00:13, 57.21it/s]backtest loop:  22%|██▏       | 218/971 [00:04<00:13, 54.63it/s]backtest loop:  23%|██▎       | 224/971 [00:04<00:13, 55.90it/s]backtest loop:  24%|██▎       | 230/971 [00:04<00:13, 53.28it/s]backtest loop:  24%|██▍       | 236/971 [00:04<00:13, 55.12it/s]backtest loop:  25%|██▍       | 242/971 [00:04<00:12, 56.48it/s]backtest loop:  26%|██▌       | 248/971 [00:05<00:12, 57.48it/s]backtest loop:  26%|██▌       | 254/971 [00:05<00:13, 54.92it/s]backtest loop:  27%|██▋       | 260/971 [00:05<00:12, 56.28it/s]backtest loop:  27%|██▋       | 266/971 [00:05<00:13, 53.70it/s]backtest loop:  28%|██▊       | 272/971 [00:05<00:12, 55.40it/s]backtest loop:  29%|██▊       | 278/971 [00:05<00:12, 56.64it/s]backtest loop:  29%|██▉       | 284/971 [00:05<00:11, 57.52it/s]backtest loop:  30%|██▉       | 290/971 [00:05<00:11, 57.56it/s]backtest loop:  30%|███       | 296/971 [00:05<00:12, 54.14it/s]backtest loop:  31%|███       | 303/971 [00:06<00:11, 56.65it/s]backtest loop:  32%|███▏      | 310/971 [00:06<00:11, 55.10it/s]backtest loop:  33%|███▎      | 317/971 [00:06<00:11, 57.21it/s]backtest loop:  33%|███▎      | 323/971 [00:06<00:11, 57.96it/s]backtest loop:  34%|███▍      | 329/971 [00:06<00:10, 58.42it/s]backtest loop:  35%|███▍      | 335/971 [00:06<00:11, 55.42it/s]backtest loop:  35%|███▌      | 342/971 [00:06<00:10, 57.30it/s]backtest loop:  36%|███▌      | 349/971 [00:06<00:10, 59.08it/s]backtest loop:  37%|███▋      | 355/971 [00:06<00:10, 56.03it/s]backtest loop:  37%|███▋      | 362/971 [00:07<00:10, 58.01it/s]backtest loop:  38%|███▊      | 368/971 [00:07<00:11, 52.33it/s]backtest loop:  39%|███▊      | 375/971 [00:07<00:10, 55.12it/s]backtest loop:  39%|███▉      | 381/971 [00:07<00:10, 56.13it/s]backtest loop:  40%|███▉      | 388/971 [00:07<00:10, 54.76it/s]backtest loop:  41%|████      | 394/971 [00:07<00:10, 55.64it/s]backtest loop:  41%|████      | 400/971 [00:07<00:10, 56.70it/s]backtest loop:  42%|████▏     | 406/971 [00:07<00:09, 57.37it/s]backtest loop:  43%|████▎     | 413/971 [00:07<00:10, 55.52it/s]backtest loop:  43%|████▎     | 419/971 [00:08<00:09, 56.59it/s]backtest loop:  44%|████▍     | 425/971 [00:08<00:09, 56.97it/s]backtest loop:  44%|████▍     | 431/971 [00:08<00:09, 57.62it/s]backtest loop:  45%|████▌     | 437/971 [00:08<00:09, 54.85it/s]backtest loop:  46%|████▌     | 443/971 [00:08<00:09, 56.18it/s]backtest loop:  46%|████▌     | 449/971 [00:08<00:09, 57.27it/s]backtest loop:  47%|████▋     | 455/971 [00:08<00:08, 57.94it/s]backtest loop:  47%|████▋     | 461/971 [00:08<00:08, 58.11it/s]backtest loop:  48%|████▊     | 467/971 [00:08<00:09, 55.05it/s]backtest loop:  49%|████▊     | 473/971 [00:09<00:08, 56.37it/s]backtest loop:  49%|████▉     | 479/971 [00:09<00:08, 57.21it/s]backtest loop:  50%|████▉     | 485/971 [00:09<00:14, 34.00it/s]backtest loop:  50%|█████     | 490/971 [00:09<00:13, 36.46it/s]backtest loop:  51%|█████     | 496/971 [00:09<00:11, 41.49it/s]backtest loop:  52%|█████▏    | 502/971 [00:09<00:10, 45.82it/s]backtest loop:  52%|█████▏    | 508/971 [00:09<00:09, 46.52it/s]backtest loop:  53%|█████▎    | 514/971 [00:10<00:09, 49.89it/s]backtest loop:  54%|█████▎    | 521/971 [00:10<00:08, 53.71it/s]backtest loop:  54%|█████▍    | 527/971 [00:10<00:08, 52.43it/s]backtest loop:  55%|█████▍    | 534/971 [00:10<00:07, 55.50it/s]backtest loop:  56%|█████▌    | 541/971 [00:10<00:07, 54.33it/s]backtest loop:  56%|█████▋    | 547/971 [00:10<00:07, 55.65it/s]backtest loop:  57%|█████▋    | 553/971 [00:10<00:07, 56.64it/s]backtest loop:  58%|█████▊    | 560/971 [00:10<00:07, 58.31it/s]backtest loop:  58%|█████▊    | 566/971 [00:10<00:07, 55.41it/s]backtest loop:  59%|█████▉    | 573/971 [00:11<00:06, 57.52it/s]backtest loop:  60%|█████▉    | 579/971 [00:11<00:06, 57.84it/s]backtest loop:  60%|██████    | 586/971 [00:11<00:06, 55.88it/s]backtest loop:  61%|██████    | 593/971 [00:11<00:06, 57.70it/s]backtest loop:  62%|██████▏   | 599/971 [00:11<00:06, 58.00it/s]backtest loop:  62%|██████▏   | 605/971 [00:11<00:06, 55.12it/s]backtest loop:  63%|██████▎   | 611/971 [00:11<00:06, 56.06it/s]backtest loop:  64%|██████▎   | 617/971 [00:11<00:06, 57.12it/s]backtest loop:  64%|██████▍   | 623/971 [00:11<00:06, 57.91it/s]backtest loop:  65%|██████▍   | 630/971 [00:12<00:06, 55.99it/s]backtest loop:  65%|██████▌   | 636/971 [00:12<00:05, 57.06it/s]backtest loop:  66%|██████▌   | 642/971 [00:12<00:05, 57.31it/s]backtest loop:  67%|██████▋   | 648/971 [00:12<00:05, 57.95it/s]backtest loop:  67%|██████▋   | 654/971 [00:12<00:05, 58.47it/s]backtest loop:  68%|██████▊   | 660/971 [00:12<00:05, 55.35it/s]backtest loop:  69%|██████▊   | 666/971 [00:12<00:05, 56.62it/s]backtest loop:  69%|██████▉   | 672/971 [00:12<00:05, 57.54it/s]backtest loop:  70%|██████▉   | 678/971 [00:12<00:05, 57.77it/s]backtest loop:  70%|███████   | 684/971 [00:13<00:05, 54.62it/s]backtest loop:  71%|███████   | 690/971 [00:13<00:05, 55.93it/s]backtest loop:  72%|███████▏  | 696/971 [00:13<00:04, 56.95it/s]backtest loop:  72%|███████▏  | 703/971 [00:13<00:04, 58.55it/s]backtest loop:  73%|███████▎  | 709/971 [00:13<00:04, 55.10it/s]backtest loop:  74%|███████▎  | 716/971 [00:13<00:04, 57.21it/s]backtest loop:  74%|███████▍  | 722/971 [00:13<00:04, 57.97it/s]backtest loop:  75%|███████▌  | 729/971 [00:13<00:04, 55.94it/s]backtest loop:  76%|███████▌  | 735/971 [00:13<00:04, 53.45it/s]backtest loop:  76%|███████▋  | 741/971 [00:14<00:04, 54.75it/s]backtest loop:  77%|███████▋  | 747/971 [00:14<00:04, 55.98it/s]backtest loop:  78%|███████▊  | 753/971 [00:14<00:04, 53.70it/s]backtest loop:  78%|███████▊  | 759/971 [00:14<00:03, 55.42it/s]backtest loop:  79%|███████▉  | 765/971 [00:14<00:03, 53.46it/s]backtest loop:  79%|███████▉  | 771/971 [00:14<00:03, 54.93it/s]backtest loop:  80%|████████  | 777/971 [00:14<00:03, 56.11it/s]backtest loop:  81%|████████  | 783/971 [00:14<00:03, 54.01it/s]backtest loop:  81%|████████▏ | 789/971 [00:14<00:03, 55.66it/s]backtest loop:  82%|████████▏ | 796/971 [00:14<00:03, 57.72it/s]backtest loop:  83%|████████▎ | 803/971 [00:15<00:03, 55.52it/s]backtest loop:  83%|████████▎ | 809/971 [00:15<00:02, 56.37it/s]backtest loop:  84%|████████▍ | 816/971 [00:15<00:02, 58.06it/s]backtest loop:  85%|████████▍ | 823/971 [00:15<00:02, 55.87it/s]backtest loop:  85%|████████▌ | 829/971 [00:15<00:02, 56.95it/s]backtest loop:  86%|████████▌ | 835/971 [00:15<00:02, 57.55it/s]backtest loop:  87%|████████▋ | 841/971 [00:15<00:02, 57.73it/s]backtest loop:  87%|████████▋ | 847/971 [00:15<00:02, 58.12it/s]backtest loop:  88%|████████▊ | 853/971 [00:16<00:02, 54.83it/s]backtest loop:  89%|████████▊ | 860/971 [00:16<00:01, 57.12it/s]backtest loop:  89%|████████▉ | 866/971 [00:16<00:01, 57.89it/s]backtest loop:  90%|████████▉ | 872/971 [00:16<00:01, 54.52it/s]backtest loop:  91%|█████████ | 879/971 [00:16<00:01, 56.89it/s]backtest loop:  91%|█████████ | 886/971 [00:16<00:01, 58.55it/s]backtest loop:  92%|█████████▏| 892/971 [00:16<00:01, 55.59it/s]backtest loop:  93%|█████████▎| 899/971 [00:16<00:01, 57.56it/s]backtest loop:  93%|█████████▎| 905/971 [00:16<00:01, 57.85it/s]backtest loop:  94%|█████████▍| 912/971 [00:17<00:01, 55.86it/s]backtest loop:  95%|█████████▍| 918/971 [00:17<00:00, 56.89it/s]backtest loop:  95%|█████████▌| 925/971 [00:17<00:00, 58.52it/s]backtest loop:  96%|█████████▌| 931/971 [00:17<00:00, 55.83it/s]backtest loop:  96%|█████████▋| 937/971 [00:17<00:00, 56.61it/s]backtest loop:  97%|█████████▋| 943/971 [00:17<00:00, 57.51it/s]backtest loop:  98%|█████████▊| 950/971 [00:17<00:00, 55.65it/s]backtest loop:  99%|█████████▊| 957/971 [00:17<00:00, 57.62it/s]backtest loop:  99%|█████████▉| 963/971 [00:17<00:00, 57.87it/s]backtest loop: 100%|█████████▉| 969/971 [00:18<00:00, 58.27it/s]backtest loop: 100%|██████████| 971/971 [00:18<00:00, 53.69it/s]
[2943066:MainThread](2024-04-25 01:00:13,980) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000546
std                0.005617
annualized_return  0.129907
information_ratio  1.499064
max_drawdown      -0.136853
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000348
std                0.005618
annualized_return  0.082863
information_ratio  0.956121
max_drawdown      -0.165288
[2943066:MainThread](2024-04-25 01:00:13,997) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 8 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244,
                                                    0.06012304631775825,
                                                    0.045880009775050655,
                                                    0.06270025818975491,
                                                    0.0753799417472258,
                                                    0.00733742814004799,
                                                    0.08286283990715226],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835,
                                                    0.6296566548029155,
                                                    0.49843034034936584,
                                                    0.7094182267806647,
                                                    0.8372692588899964,
                                                    0.0750675890199243,
                                                    0.9561205976236687],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334,
                                               -0.24933141070803327,
                                               -0.2812966065033353,
                                               -0.1476673679402031,
                                               -0.18156490131955264,
                                               -0.24688258794279827,
                                               -0.16528792423187974],
 'IC': [0.02587224613755935,
        0.021163409656197618,
        0.022316224135223012,
        0.025285754183174552,
        0.024794335302755766,
        0.027614520063657392,
        0.02140857387664198,
        0.025598294351956503],
 'ICIR': [0.18518614400027864,
          0.1544866993423066,
          0.15670848538695684,
          0.18641023059651965,
          0.1718703473411494,
          0.19735804355129996,
          0.14499978059710222,
          0.18934619960171314],
 'Rank IC': [0.02043466903243119,
             0.01549351371921764,
             0.01806255713632389,
             0.024278838529892835,
             0.021080508001620087,
             0.025720809985435574,
             0.015033439290787839,
             0.022029561636039398],
 'Rank ICIR': [0.14468640124580973,
               0.11103740542301493,
               0.12281036940312468,
               0.1780547655378848,
               0.14405894542010167,
               0.18164244212693723,
               0.09908168825597151,
               0.16430282874668095],
 'mae': [0.7073439359664917,
         0.7074997425079346,
         0.7073977589607239,
         0.7072641253471375,
         0.7073571085929871,
         0.7073237895965576,
         0.7074754238128662,
         0.7073764204978943],
 'mse': [0.995890736579895,
         0.9962072968482971,
         0.9961547255516052,
         0.9959003925323486,
         0.9960064888000488,
         0.9958208799362183,
         0.9961485862731934,
         0.9959833025932312]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-25 01:00:15,236) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<29:05, 17.63s/it]epoch:   2%|▏         | 2/100 [00:34<28:27, 17.42s/it]epoch:   3%|▎         | 3/100 [00:52<28:03, 17.36s/it]epoch:   4%|▍         | 4/100 [01:09<27:52, 17.42s/it]epoch:   5%|▌         | 5/100 [01:26<27:29, 17.36s/it]epoch:   6%|▌         | 6/100 [01:44<27:12, 17.36s/it]epoch:   7%|▋         | 7/100 [02:01<26:59, 17.42s/it]epoch:   8%|▊         | 8/100 [02:20<27:08, 17.70s/it]epoch:   9%|▉         | 9/100 [02:37<26:52, 17.71s/it]epoch:  10%|█         | 10/100 [02:55<26:36, 17.74s/it]epoch:  11%|█         | 11/100 [03:13<26:11, 17.66s/it]epoch:  12%|█▏        | 12/100 [03:30<25:49, 17.61s/it]epoch:  13%|█▎        | 13/100 [03:48<25:33, 17.62s/it]epoch:  14%|█▍        | 14/100 [04:05<25:12, 17.59s/it]epoch:  15%|█▌        | 15/100 [04:23<24:45, 17.48s/it]epoch:  16%|█▌        | 16/100 [04:40<24:30, 17.51s/it]epoch:  17%|█▋        | 17/100 [04:58<24:15, 17.54s/it]epoch:  18%|█▊        | 18/100 [05:15<24:00, 17.56s/it]epoch:  19%|█▉        | 19/100 [05:33<23:35, 17.48s/it]epoch:  20%|██        | 20/100 [05:50<23:16, 17.46s/it]epoch:  21%|██        | 21/100 [06:08<23:02, 17.50s/it]epoch:  22%|██▏       | 22/100 [06:25<22:38, 17.41s/it]epoch:  23%|██▎       | 23/100 [06:42<22:19, 17.40s/it]epoch:  24%|██▍       | 24/100 [07:00<22:04, 17.43s/it]epoch:  25%|██▌       | 25/100 [07:17<21:44, 17.39s/it]epoch:  26%|██▌       | 26/100 [07:34<21:23, 17.34s/it]epoch:  27%|██▋       | 27/100 [07:52<21:13, 17.44s/it]epoch:  28%|██▊       | 28/100 [08:09<20:56, 17.45s/it]epoch:  29%|██▉       | 29/100 [08:27<20:33, 17.37s/it]epoch:  30%|███       | 30/100 [08:44<20:16, 17.38s/it]0.05529782622147195
best ic: 0.05529782622147195
epoch:  31%|███       | 31/100 [09:04<20:52, 18.15s/it]0.0506605244741951
epoch:  32%|███▏      | 32/100 [09:23<21:02, 18.56s/it]0.057625036408790326
best ic: 0.057625036408790326
epoch:  33%|███▎      | 33/100 [09:43<21:04, 18.88s/it]0.04046458859101241
epoch:  34%|███▍      | 34/100 [10:03<21:04, 19.16s/it]0.05167103206765771
epoch:  35%|███▌      | 35/100 [10:23<20:54, 19.30s/it]0.05750783052464672
epoch:  36%|███▌      | 36/100 [10:42<20:38, 19.35s/it]0.04960571242042591
epoch:  37%|███▋      | 37/100 [11:02<20:30, 19.53s/it]0.05262685823567344
epoch:  38%|███▊      | 38/100 [11:21<20:07, 19.48s/it]0.05258902602653856
epoch:  39%|███▉      | 39/100 [11:41<19:47, 19.47s/it]0.05428363813596505
epoch:  40%|████      | 40/100 [12:01<19:39, 19.65s/it]0.048068775607092856
epoch:  40%|████      | 40/100 [12:20<18:31, 18.52s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-25 01:12:36,028) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-25 01:12:36,044) INFO - qlib.workflow - [recorder.py:341] - Recorder 4da10de28bc14581a56eabae1315d235 starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:07,  7.94it/s]online:   3%|▎         | 2/63 [00:00<00:08,  7.49it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.42it/s]online:   6%|▋         | 4/63 [00:00<00:08,  7.25it/s]online:   8%|▊         | 5/63 [00:00<00:08,  7.22it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.24it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.28it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.17it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.17it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.17it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.27it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  7.19it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.23it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.30it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.22it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.31it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.30it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.29it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.29it/s]online:  32%|███▏      | 20/63 [00:02<00:05,  7.28it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.28it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.28it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.26it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.23it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.25it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.26it/s]online:  43%|████▎     | 27/63 [00:03<00:04,  7.24it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.23it/s]online:  46%|████▌     | 29/63 [00:03<00:04,  7.25it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.27it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  7.25it/s]online:  51%|█████     | 32/63 [00:04<00:04,  7.23it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  7.24it/s]online:  54%|█████▍    | 34/63 [00:04<00:04,  7.25it/s]online:  56%|█████▌    | 35/63 [00:04<00:03,  7.26it/s]online:  57%|█████▋    | 36/63 [00:04<00:03,  7.26it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.26it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.21it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.19it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.19it/s]online:  65%|██████▌   | 41/63 [00:05<00:03,  7.24it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.21it/s]online:  68%|██████▊   | 43/63 [00:05<00:02,  7.24it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.29it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.32it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.26it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.32it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.16it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.28it/s]online:  79%|███████▉  | 50/63 [00:06<00:01,  7.24it/s]online:  81%|████████  | 51/63 [00:07<00:01,  7.21it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.21it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.19it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.18it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.19it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.15it/s]online:  90%|█████████ | 57/63 [00:07<00:00,  7.06it/s]online:  92%|█████████▏| 58/63 [00:08<00:00,  7.14it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.15it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.22it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.20it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.18it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.49it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.25it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-25 01:12:52,695) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99632394 mae 0.7074818
{'IC': 0.01891527464478308,
 'ICIR': 0.13439379156943246,
 'Rank IC': 0.014773563851960174,
 'Rank ICIR': 0.10187939426283874}
[2943066:MainThread](2024-04-25 01:12:54,446) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-25 01:13:08,219) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 01:13:08,222) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 01:13:14,636) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe2b0bc8520>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:49,  8.87it/s]backtest loop:   1%|          | 9/971 [00:00<00:41, 23.14it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:29, 32.78it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:25, 37.33it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:22, 42.48it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:20, 46.29it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:20, 45.64it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:19, 48.27it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 50.29it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 48.65it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:17, 50.84it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:17, 51.98it/s]backtest loop:   8%|▊         | 75/971 [00:01<00:16, 52.98it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:16, 53.84it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:17, 51.52it/s]backtest loop:  10%|▉         | 93/971 [00:02<00:16, 52.77it/s]backtest loop:  10%|█         | 99/971 [00:02<00:16, 52.86it/s]backtest loop:  11%|█         | 105/971 [00:02<00:16, 53.26it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:15, 53.87it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:16, 51.22it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:16, 52.28it/s]backtest loop:  13%|█▎        | 129/971 [00:02<00:16, 49.89it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:16, 51.11it/s]backtest loop:  15%|█▍        | 141/971 [00:03<00:16, 49.02it/s]backtest loop:  15%|█▌        | 147/971 [00:03<00:16, 50.70it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:15, 51.95it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:15, 52.89it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:15, 53.06it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:15, 50.65it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:15, 52.04it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:14, 53.11it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:14, 53.47it/s]backtest loop:  20%|██        | 195/971 [00:04<00:15, 49.63it/s]backtest loop:  21%|██        | 201/971 [00:04<00:15, 51.16it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:14, 52.30it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:15, 50.15it/s]backtest loop:  23%|██▎       | 219/971 [00:04<00:14, 51.66it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:15, 49.39it/s]backtest loop:  24%|██▍       | 231/971 [00:04<00:14, 50.98it/s]backtest loop:  24%|██▍       | 237/971 [00:04<00:14, 52.26it/s]backtest loop:  25%|██▌       | 243/971 [00:04<00:13, 53.10it/s]backtest loop:  26%|██▌       | 249/971 [00:05<00:14, 50.46it/s]backtest loop:  26%|██▋       | 255/971 [00:05<00:13, 51.78it/s]backtest loop:  27%|██▋       | 261/971 [00:05<00:13, 52.88it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:14, 50.19it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:13, 51.51it/s]backtest loop:  29%|██▊       | 279/971 [00:05<00:13, 52.53it/s]backtest loop:  29%|██▉       | 285/971 [00:05<00:12, 52.88it/s]backtest loop:  30%|██▉       | 291/971 [00:05<00:13, 49.90it/s]backtest loop:  31%|███       | 297/971 [00:06<00:13, 51.55it/s]backtest loop:  31%|███       | 303/971 [00:06<00:12, 52.51it/s]backtest loop:  32%|███▏      | 309/971 [00:06<00:12, 53.30it/s]backtest loop:  32%|███▏      | 315/971 [00:06<00:13, 50.19it/s]backtest loop:  33%|███▎      | 321/971 [00:06<00:12, 51.64it/s]backtest loop:  34%|███▎      | 327/971 [00:06<00:12, 52.67it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:11, 53.31it/s]backtest loop:  35%|███▍      | 339/971 [00:06<00:11, 54.01it/s]backtest loop:  36%|███▌      | 345/971 [00:06<00:12, 50.64it/s]backtest loop:  36%|███▌      | 351/971 [00:07<00:11, 52.50it/s]backtest loop:  37%|███▋      | 357/971 [00:07<00:11, 53.29it/s]backtest loop:  37%|███▋      | 363/971 [00:07<00:11, 50.82it/s]backtest loop:  38%|███▊      | 369/971 [00:07<00:12, 49.07it/s]backtest loop:  39%|███▊      | 375/971 [00:07<00:11, 50.41it/s]backtest loop:  39%|███▉      | 381/971 [00:07<00:11, 51.72it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:11, 53.05it/s]backtest loop:  40%|████      | 393/971 [00:07<00:11, 50.75it/s]backtest loop:  41%|████      | 399/971 [00:07<00:10, 52.27it/s]backtest loop:  42%|████▏     | 405/971 [00:08<00:10, 52.70it/s]backtest loop:  42%|████▏     | 411/971 [00:08<00:10, 53.58it/s]backtest loop:  43%|████▎     | 417/971 [00:08<00:10, 53.88it/s]backtest loop:  44%|████▎     | 423/971 [00:08<00:10, 51.16it/s]backtest loop:  44%|████▍     | 429/971 [00:08<00:10, 52.39it/s]backtest loop:  45%|████▍     | 435/971 [00:08<00:10, 52.75it/s]backtest loop:  45%|████▌     | 441/971 [00:08<00:09, 53.31it/s]backtest loop:  46%|████▌     | 447/971 [00:08<00:10, 50.57it/s]backtest loop:  47%|████▋     | 453/971 [00:09<00:10, 51.77it/s]backtest loop:  47%|████▋     | 459/971 [00:09<00:09, 52.56it/s]backtest loop:  48%|████▊     | 465/971 [00:09<00:09, 52.81it/s]backtest loop:  49%|████▊     | 471/971 [00:09<00:09, 53.27it/s]backtest loop:  49%|████▉     | 477/971 [00:09<00:09, 50.81it/s]backtest loop:  50%|████▉     | 483/971 [00:09<00:09, 51.97it/s]backtest loop:  50%|█████     | 489/971 [00:09<00:15, 31.99it/s]backtest loop:  51%|█████     | 495/971 [00:10<00:13, 35.09it/s]backtest loop:  52%|█████▏    | 501/971 [00:10<00:11, 39.43it/s]backtest loop:  52%|█████▏    | 507/971 [00:10<00:11, 41.09it/s]backtest loop:  53%|█████▎    | 513/971 [00:10<00:10, 44.23it/s]backtest loop:  53%|█████▎    | 519/971 [00:10<00:09, 46.86it/s]backtest loop:  54%|█████▍    | 525/971 [00:10<00:09, 49.07it/s]backtest loop:  55%|█████▍    | 531/971 [00:10<00:09, 47.80it/s]backtest loop:  55%|█████▌    | 537/971 [00:10<00:08, 49.92it/s]backtest loop:  56%|█████▌    | 543/971 [00:11<00:08, 51.05it/s]backtest loop:  57%|█████▋    | 549/971 [00:11<00:08, 52.22it/s]backtest loop:  57%|█████▋    | 555/971 [00:11<00:07, 53.10it/s]backtest loop:  58%|█████▊    | 561/971 [00:11<00:08, 50.50it/s]backtest loop:  58%|█████▊    | 567/971 [00:11<00:07, 51.81it/s]backtest loop:  59%|█████▉    | 573/971 [00:11<00:07, 52.39it/s]backtest loop:  60%|█████▉    | 579/971 [00:11<00:07, 53.14it/s]backtest loop:  60%|██████    | 585/971 [00:11<00:07, 53.69it/s]backtest loop:  61%|██████    | 591/971 [00:11<00:07, 50.93it/s]backtest loop:  61%|██████▏   | 597/971 [00:12<00:07, 52.17it/s]backtest loop:  62%|██████▏   | 603/971 [00:12<00:06, 52.95it/s]backtest loop:  63%|██████▎   | 609/971 [00:12<00:06, 53.28it/s]backtest loop:  63%|██████▎   | 615/971 [00:12<00:07, 50.55it/s]backtest loop:  64%|██████▍   | 621/971 [00:12<00:06, 51.71it/s]backtest loop:  65%|██████▍   | 627/971 [00:12<00:06, 52.84it/s]backtest loop:  65%|██████▌   | 633/971 [00:12<00:06, 53.45it/s]backtest loop:  66%|██████▌   | 639/971 [00:12<00:06, 54.02it/s]backtest loop:  66%|██████▋   | 645/971 [00:12<00:06, 51.22it/s]backtest loop:  67%|██████▋   | 651/971 [00:13<00:06, 52.30it/s]backtest loop:  68%|██████▊   | 657/971 [00:13<00:05, 52.93it/s]backtest loop:  68%|██████▊   | 663/971 [00:13<00:05, 53.52it/s]backtest loop:  69%|██████▉   | 669/971 [00:13<00:05, 53.55it/s]backtest loop:  70%|██████▉   | 675/971 [00:13<00:05, 50.73it/s]backtest loop:  70%|███████   | 681/971 [00:13<00:05, 51.87it/s]backtest loop:  71%|███████   | 687/971 [00:13<00:05, 52.64it/s]backtest loop:  71%|███████▏  | 693/971 [00:13<00:05, 53.35it/s]backtest loop:  72%|███████▏  | 699/971 [00:13<00:05, 49.97it/s]backtest loop:  73%|███████▎  | 705/971 [00:14<00:05, 51.32it/s]backtest loop:  73%|███████▎  | 711/971 [00:14<00:04, 52.39it/s]backtest loop:  74%|███████▍  | 717/971 [00:14<00:04, 53.22it/s]backtest loop:  74%|███████▍  | 723/971 [00:14<00:04, 53.76it/s]backtest loop:  75%|███████▌  | 729/971 [00:14<00:04, 50.77it/s]backtest loop:  76%|███████▌  | 735/971 [00:14<00:04, 48.91it/s]backtest loop:  76%|███████▋  | 741/971 [00:14<00:04, 50.62it/s]backtest loop:  77%|███████▋  | 747/971 [00:14<00:04, 51.88it/s]backtest loop:  78%|███████▊  | 753/971 [00:15<00:04, 49.97it/s]backtest loop:  78%|███████▊  | 759/971 [00:15<00:04, 51.02it/s]backtest loop:  79%|███████▉  | 765/971 [00:15<00:04, 49.24it/s]backtest loop:  79%|███████▉  | 771/971 [00:15<00:03, 50.87it/s]backtest loop:  80%|████████  | 777/971 [00:15<00:03, 52.27it/s]backtest loop:  81%|████████  | 783/971 [00:15<00:03, 50.11it/s]backtest loop:  81%|████████▏ | 789/971 [00:15<00:03, 51.11it/s]backtest loop:  82%|████████▏ | 795/971 [00:15<00:03, 52.20it/s]backtest loop:  82%|████████▏ | 801/971 [00:15<00:03, 53.04it/s]backtest loop:  83%|████████▎ | 807/971 [00:16<00:03, 53.66it/s]backtest loop:  84%|████████▎ | 813/971 [00:16<00:03, 50.81it/s]backtest loop:  84%|████████▍ | 819/971 [00:16<00:02, 51.70it/s]backtest loop:  85%|████████▍ | 825/971 [00:16<00:02, 52.60it/s]backtest loop:  86%|████████▌ | 831/971 [00:16<00:02, 53.65it/s]backtest loop:  86%|████████▌ | 837/971 [00:16<00:02, 54.08it/s]backtest loop:  87%|████████▋ | 843/971 [00:16<00:02, 51.22it/s]backtest loop:  87%|████████▋ | 849/971 [00:16<00:02, 52.03it/s]backtest loop:  88%|████████▊ | 855/971 [00:16<00:02, 53.00it/s]backtest loop:  89%|████████▊ | 861/971 [00:17<00:02, 53.60it/s]backtest loop:  89%|████████▉ | 867/971 [00:17<00:02, 50.44it/s]backtest loop:  90%|████████▉ | 873/971 [00:17<00:01, 51.62it/s]backtest loop:  91%|█████████ | 879/971 [00:17<00:01, 52.27it/s]backtest loop:  91%|█████████ | 885/971 [00:17<00:01, 53.05it/s]backtest loop:  92%|█████████▏| 891/971 [00:17<00:01, 53.61it/s]backtest loop:  92%|█████████▏| 897/971 [00:17<00:01, 50.94it/s]backtest loop:  93%|█████████▎| 903/971 [00:17<00:01, 52.05it/s]backtest loop:  94%|█████████▎| 909/971 [00:18<00:01, 52.07it/s]backtest loop:  94%|█████████▍| 915/971 [00:18<00:01, 52.84it/s]backtest loop:  95%|█████████▍| 921/971 [00:18<00:00, 50.40it/s]backtest loop:  95%|█████████▌| 927/971 [00:18<00:00, 51.77it/s]backtest loop:  96%|█████████▌| 933/971 [00:18<00:00, 52.72it/s]backtest loop:  97%|█████████▋| 939/971 [00:18<00:00, 53.18it/s]backtest loop:  97%|█████████▋| 945/971 [00:18<00:00, 50.32it/s]backtest loop:  98%|█████████▊| 951/971 [00:18<00:00, 51.80it/s]backtest loop:  99%|█████████▊| 957/971 [00:18<00:00, 52.66it/s]backtest loop:  99%|█████████▉| 963/971 [00:19<00:00, 52.92it/s]backtest loop: 100%|█████████▉| 969/971 [00:19<00:00, 54.83it/s]backtest loop: 100%|██████████| 971/971 [00:19<00:00, 50.54it/s]
[2943066:MainThread](2024-04-25 01:13:33,930) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000405
std                0.005614
annualized_return  0.096332
information_ratio  1.112234
max_drawdown      -0.102142
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000209
std                0.005616
annualized_return  0.049708
information_ratio  0.573708
max_drawdown      -0.129258
[2943066:MainThread](2024-04-25 01:13:33,947) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 9 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244,
                                                    0.06012304631775825,
                                                    0.045880009775050655,
                                                    0.06270025818975491,
                                                    0.0753799417472258,
                                                    0.00733742814004799,
                                                    0.08286283990715226,
                                                    0.04970754461816316],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835,
                                                    0.6296566548029155,
                                                    0.49843034034936584,
                                                    0.7094182267806647,
                                                    0.8372692588899964,
                                                    0.0750675890199243,
                                                    0.9561205976236687,
                                                    0.573708021394878],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334,
                                               -0.24933141070803327,
                                               -0.2812966065033353,
                                               -0.1476673679402031,
                                               -0.18156490131955264,
                                               -0.24688258794279827,
                                               -0.16528792423187974,
                                               -0.1292581870630385],
 'IC': [0.02587224613755935,
        0.021163409656197618,
        0.022316224135223012,
        0.025285754183174552,
        0.024794335302755766,
        0.027614520063657392,
        0.02140857387664198,
        0.025598294351956503,
        0.01891527464478308],
 'ICIR': [0.18518614400027864,
          0.1544866993423066,
          0.15670848538695684,
          0.18641023059651965,
          0.1718703473411494,
          0.19735804355129996,
          0.14499978059710222,
          0.18934619960171314,
          0.13439379156943246],
 'Rank IC': [0.02043466903243119,
             0.01549351371921764,
             0.01806255713632389,
             0.024278838529892835,
             0.021080508001620087,
             0.025720809985435574,
             0.015033439290787839,
             0.022029561636039398,
             0.014773563851960174],
 'Rank ICIR': [0.14468640124580973,
               0.11103740542301493,
               0.12281036940312468,
               0.1780547655378848,
               0.14405894542010167,
               0.18164244212693723,
               0.09908168825597151,
               0.16430282874668095,
               0.10187939426283874],
 'mae': [0.7073439359664917,
         0.7074997425079346,
         0.7073977589607239,
         0.7072641253471375,
         0.7073571085929871,
         0.7073237895965576,
         0.7074754238128662,
         0.7073764204978943,
         0.7074818015098572],
 'mse': [0.995890736579895,
         0.9962072968482971,
         0.9961547255516052,
         0.9959003925323486,
         0.9960064888000488,
         0.9958208799362183,
         0.9961485862731934,
         0.9959833025932312,
         0.9963239431381226]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[2943066:MainThread](2024-04-25 01:13:35,189) INFO - qlib.TransformerModel - [pytorch_transformer.py:66] - Naive Transformer:
batch_size : 2048
dim : 32
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:17<29:24, 17.82s/it]epoch:   2%|▏         | 2/100 [00:34<28:28, 17.43s/it]epoch:   3%|▎         | 3/100 [00:52<28:09, 17.42s/it]epoch:   4%|▍         | 4/100 [01:10<28:01, 17.51s/it]epoch:   5%|▌         | 5/100 [01:27<27:41, 17.49s/it]epoch:   6%|▌         | 6/100 [01:44<27:21, 17.46s/it]epoch:   7%|▋         | 7/100 [02:02<27:08, 17.51s/it]epoch:   8%|▊         | 8/100 [02:19<26:46, 17.47s/it]epoch:   9%|▉         | 9/100 [02:37<26:33, 17.51s/it]epoch:  10%|█         | 10/100 [02:54<26:14, 17.50s/it]epoch:  11%|█         | 11/100 [03:12<25:51, 17.43s/it]epoch:  12%|█▏        | 12/100 [03:29<25:32, 17.42s/it]epoch:  13%|█▎        | 13/100 [03:47<25:21, 17.49s/it]epoch:  14%|█▍        | 14/100 [04:04<25:02, 17.47s/it]epoch:  15%|█▌        | 15/100 [04:21<24:38, 17.39s/it]epoch:  16%|█▌        | 16/100 [04:39<24:26, 17.45s/it]epoch:  17%|█▋        | 17/100 [04:57<24:10, 17.48s/it]epoch:  18%|█▊        | 18/100 [05:14<23:47, 17.41s/it]epoch:  19%|█▉        | 19/100 [05:31<23:33, 17.45s/it]epoch:  20%|██        | 20/100 [05:49<23:17, 17.47s/it]epoch:  21%|██        | 21/100 [06:06<22:55, 17.41s/it]epoch:  22%|██▏       | 22/100 [06:23<22:32, 17.34s/it]epoch:  23%|██▎       | 23/100 [06:41<22:22, 17.44s/it]epoch:  24%|██▍       | 24/100 [06:58<22:01, 17.39s/it]epoch:  25%|██▌       | 25/100 [07:15<21:40, 17.34s/it]epoch:  26%|██▌       | 26/100 [07:33<21:34, 17.49s/it]epoch:  27%|██▋       | 27/100 [07:51<21:17, 17.49s/it]epoch:  28%|██▊       | 28/100 [08:08<20:52, 17.40s/it]epoch:  29%|██▉       | 29/100 [08:25<20:35, 17.40s/it]epoch:  30%|███       | 30/100 [08:43<20:25, 17.50s/it]0.04967325746881672
best ic: 0.04967325746881672
epoch:  31%|███       | 31/100 [09:03<20:50, 18.12s/it]0.046221117009630726
epoch:  32%|███▏      | 32/100 [09:22<21:02, 18.57s/it]0.046181723935493045
epoch:  33%|███▎      | 33/100 [09:42<21:15, 19.04s/it]0.05546506820258484
best ic: 0.05546506820258484
epoch:  34%|███▍      | 34/100 [10:02<21:07, 19.20s/it]0.05012957355173927
epoch:  35%|███▌      | 35/100 [10:22<20:56, 19.32s/it]0.05052325575079614
epoch:  36%|███▌      | 36/100 [10:42<20:54, 19.61s/it]0.04703568710365549
epoch:  37%|███▋      | 37/100 [11:02<20:35, 19.61s/it]0.053897188100585185
epoch:  38%|███▊      | 38/100 [11:21<20:14, 19.59s/it]0.05427250244100224
epoch:  39%|███▉      | 39/100 [11:41<20:04, 19.74s/it]0.0455988226651048
epoch:  40%|████      | 40/100 [12:00<19:36, 19.60s/it]0.047403529733685126
epoch:  41%|████      | 41/100 [12:20<19:15, 19.59s/it]0.049271067497977036
epoch:  41%|████      | 41/100 [12:40<18:14, 18.55s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[2943066:MainThread](2024-04-25 01:26:15,846) INFO - qlib.workflow - [exp.py:258] - Experiment 42 starts running ...
[2943066:MainThread](2024-04-25 01:26:15,862) INFO - qlib.workflow - [recorder.py:341] - Recorder ef5e6e9ca8464615be84f496b4439a56 starts running under Experiment 42 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   2%|▏         | 1/63 [00:00<00:07,  8.00it/s]online:   3%|▎         | 2/63 [00:00<00:08,  7.49it/s]online:   5%|▍         | 3/63 [00:00<00:08,  7.49it/s]online:   6%|▋         | 4/63 [00:00<00:08,  7.23it/s]online:   8%|▊         | 5/63 [00:00<00:07,  7.33it/s]online:  10%|▉         | 6/63 [00:00<00:07,  7.28it/s]online:  11%|█         | 7/63 [00:00<00:07,  7.24it/s]online:  13%|█▎        | 8/63 [00:01<00:07,  7.35it/s]online:  14%|█▍        | 9/63 [00:01<00:07,  7.33it/s]online:  16%|█▌        | 10/63 [00:01<00:07,  7.29it/s]online:  17%|█▋        | 11/63 [00:01<00:07,  7.34it/s]online:  19%|█▉        | 12/63 [00:01<00:07,  7.22it/s]online:  21%|██        | 13/63 [00:01<00:06,  7.22it/s]online:  22%|██▏       | 14/63 [00:01<00:06,  7.27it/s]online:  24%|██▍       | 15/63 [00:02<00:06,  7.26it/s]online:  25%|██▌       | 16/63 [00:02<00:06,  7.23it/s]online:  27%|██▋       | 17/63 [00:02<00:06,  7.23it/s]online:  29%|██▊       | 18/63 [00:02<00:06,  7.25it/s]online:  30%|███       | 19/63 [00:02<00:06,  7.24it/s]online:  32%|███▏      | 20/63 [00:02<00:05,  7.22it/s]online:  33%|███▎      | 21/63 [00:02<00:05,  7.20it/s]online:  35%|███▍      | 22/63 [00:03<00:05,  7.23it/s]online:  37%|███▋      | 23/63 [00:03<00:05,  7.21it/s]online:  38%|███▊      | 24/63 [00:03<00:05,  7.27it/s]online:  40%|███▉      | 25/63 [00:03<00:05,  7.22it/s]online:  41%|████▏     | 26/63 [00:03<00:05,  7.24it/s]online:  43%|████▎     | 27/63 [00:03<00:04,  7.23it/s]online:  44%|████▍     | 28/63 [00:03<00:04,  7.29it/s]online:  46%|████▌     | 29/63 [00:03<00:04,  7.18it/s]online:  48%|████▊     | 30/63 [00:04<00:04,  7.26it/s]online:  49%|████▉     | 31/63 [00:04<00:04,  7.29it/s]online:  51%|█████     | 32/63 [00:04<00:04,  7.40it/s]online:  52%|█████▏    | 33/63 [00:04<00:04,  7.29it/s]online:  54%|█████▍    | 34/63 [00:04<00:03,  7.32it/s]online:  56%|█████▌    | 35/63 [00:04<00:03,  7.25it/s]online:  57%|█████▋    | 36/63 [00:04<00:03,  7.28it/s]online:  59%|█████▊    | 37/63 [00:05<00:03,  7.30it/s]online:  60%|██████    | 38/63 [00:05<00:03,  7.38it/s]online:  62%|██████▏   | 39/63 [00:05<00:03,  7.31it/s]online:  63%|██████▎   | 40/63 [00:05<00:03,  7.31it/s]online:  65%|██████▌   | 41/63 [00:05<00:03,  7.29it/s]online:  67%|██████▋   | 42/63 [00:05<00:02,  7.26it/s]online:  68%|██████▊   | 43/63 [00:05<00:02,  7.25it/s]online:  70%|██████▉   | 44/63 [00:06<00:02,  7.24it/s]online:  71%|███████▏  | 45/63 [00:06<00:02,  7.26it/s]online:  73%|███████▎  | 46/63 [00:06<00:02,  7.22it/s]online:  75%|███████▍  | 47/63 [00:06<00:02,  7.18it/s]online:  76%|███████▌  | 48/63 [00:06<00:02,  7.35it/s]online:  78%|███████▊  | 49/63 [00:06<00:01,  7.27it/s]online:  79%|███████▉  | 50/63 [00:06<00:01,  7.27it/s]online:  81%|████████  | 51/63 [00:07<00:01,  7.23it/s]online:  83%|████████▎ | 52/63 [00:07<00:01,  7.21it/s]online:  84%|████████▍ | 53/63 [00:07<00:01,  7.24it/s]online:  86%|████████▌ | 54/63 [00:07<00:01,  7.24it/s]online:  87%|████████▋ | 55/63 [00:07<00:01,  7.22it/s]online:  89%|████████▉ | 56/63 [00:07<00:00,  7.23it/s]online:  90%|█████████ | 57/63 [00:07<00:00,  7.26it/s]online:  92%|█████████▏| 58/63 [00:07<00:00,  7.25it/s]online:  94%|█████████▎| 59/63 [00:08<00:00,  7.24it/s]online:  95%|█████████▌| 60/63 [00:08<00:00,  7.22it/s]online:  97%|█████████▋| 61/63 [00:08<00:00,  7.23it/s]online:  98%|█████████▊| 62/63 [00:08<00:00,  7.25it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.48it/s]online: 100%|██████████| 63/63 [00:08<00:00,  7.28it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[2943066:MainThread](2024-04-25 01:26:36,630) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9958212 mae 0.7072505
{'IC': 0.030247147064445323,
 'ICIR': 0.2202180787521618,
 'Rank IC': 0.027840534477291203,
 'Rank ICIR': 0.20304459581771744}
[2943066:MainThread](2024-04-25 01:26:38,370) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[2943066:MainThread](2024-04-25 01:26:52,703) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 01:26:52,706) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[2943066:MainThread](2024-04-25 01:26:58,902) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7fe2a6aa7310>
backtest loop:   0%|          | 0/971 [00:00<?, ?it/s]/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop:   0%|          | 3/971 [00:00<01:52,  8.64it/s]backtest loop:   1%|          | 9/971 [00:00<00:42, 22.86it/s]backtest loop:   2%|▏         | 15/971 [00:00<00:29, 32.60it/s]backtest loop:   2%|▏         | 21/971 [00:00<00:25, 37.16it/s]backtest loop:   3%|▎         | 27/971 [00:00<00:22, 42.43it/s]backtest loop:   3%|▎         | 33/971 [00:00<00:20, 46.35it/s]backtest loop:   4%|▍         | 39/971 [00:01<00:20, 45.64it/s]backtest loop:   5%|▍         | 45/971 [00:01<00:19, 48.58it/s]backtest loop:   5%|▌         | 51/971 [00:01<00:18, 50.69it/s]backtest loop:   6%|▌         | 57/971 [00:01<00:18, 49.00it/s]backtest loop:   6%|▋         | 63/971 [00:01<00:17, 50.96it/s]backtest loop:   7%|▋         | 69/971 [00:01<00:17, 52.18it/s]backtest loop:   8%|▊         | 75/971 [00:01<00:16, 53.42it/s]backtest loop:   8%|▊         | 81/971 [00:01<00:16, 54.52it/s]backtest loop:   9%|▉         | 87/971 [00:01<00:17, 51.70it/s]backtest loop:  10%|▉         | 93/971 [00:02<00:16, 53.02it/s]backtest loop:  10%|█         | 99/971 [00:02<00:16, 53.54it/s]backtest loop:  11%|█         | 105/971 [00:02<00:15, 54.22it/s]backtest loop:  11%|█▏        | 111/971 [00:02<00:15, 54.71it/s]backtest loop:  12%|█▏        | 117/971 [00:02<00:16, 51.85it/s]backtest loop:  13%|█▎        | 123/971 [00:02<00:16, 52.72it/s]backtest loop:  13%|█▎        | 129/971 [00:02<00:16, 50.31it/s]backtest loop:  14%|█▍        | 135/971 [00:02<00:16, 51.68it/s]backtest loop:  15%|█▍        | 141/971 [00:02<00:16, 49.55it/s]backtest loop:  15%|█▌        | 147/971 [00:03<00:16, 51.25it/s]backtest loop:  16%|█▌        | 153/971 [00:03<00:15, 52.44it/s]backtest loop:  16%|█▋        | 159/971 [00:03<00:15, 53.27it/s]backtest loop:  17%|█▋        | 165/971 [00:03<00:15, 53.31it/s]backtest loop:  18%|█▊        | 171/971 [00:03<00:15, 50.70it/s]backtest loop:  18%|█▊        | 177/971 [00:03<00:15, 52.25it/s]backtest loop:  19%|█▉        | 183/971 [00:03<00:14, 53.46it/s]backtest loop:  19%|█▉        | 189/971 [00:03<00:14, 53.97it/s]backtest loop:  20%|██        | 195/971 [00:04<00:15, 50.83it/s]backtest loop:  21%|██        | 201/971 [00:04<00:14, 52.08it/s]backtest loop:  21%|██▏       | 207/971 [00:04<00:14, 52.99it/s]backtest loop:  22%|██▏       | 213/971 [00:04<00:14, 50.88it/s]backtest loop:  23%|██▎       | 219/971 [00:04<00:14, 52.23it/s]backtest loop:  23%|██▎       | 225/971 [00:04<00:14, 49.83it/s]backtest loop:  24%|██▍       | 231/971 [00:04<00:14, 51.26it/s]backtest loop:  24%|██▍       | 237/971 [00:04<00:13, 52.46it/s]backtest loop:  25%|██▌       | 243/971 [00:04<00:13, 53.33it/s]backtest loop:  26%|██▌       | 249/971 [00:05<00:14, 50.75it/s]backtest loop:  26%|██▋       | 255/971 [00:05<00:13, 51.93it/s]backtest loop:  27%|██▋       | 261/971 [00:05<00:13, 52.94it/s]backtest loop:  27%|██▋       | 267/971 [00:05<00:13, 50.49it/s]backtest loop:  28%|██▊       | 273/971 [00:05<00:13, 51.82it/s]backtest loop:  29%|██▊       | 279/971 [00:05<00:13, 53.17it/s]backtest loop:  29%|██▉       | 285/971 [00:05<00:12, 53.87it/s]backtest loop:  30%|██▉       | 291/971 [00:05<00:13, 51.16it/s]backtest loop:  31%|███       | 297/971 [00:05<00:12, 52.39it/s]backtest loop:  31%|███       | 303/971 [00:06<00:12, 53.29it/s]backtest loop:  32%|███▏      | 309/971 [00:06<00:12, 53.97it/s]backtest loop:  32%|███▏      | 315/971 [00:06<00:12, 50.79it/s]backtest loop:  33%|███▎      | 321/971 [00:06<00:12, 52.10it/s]backtest loop:  34%|███▎      | 327/971 [00:06<00:12, 53.24it/s]backtest loop:  34%|███▍      | 333/971 [00:06<00:11, 53.86it/s]backtest loop:  35%|███▍      | 339/971 [00:06<00:11, 53.78it/s]backtest loop:  36%|███▌      | 345/971 [00:06<00:12, 50.68it/s]backtest loop:  36%|███▌      | 351/971 [00:07<00:11, 52.08it/s]backtest loop:  37%|███▋      | 357/971 [00:07<00:11, 52.96it/s]backtest loop:  37%|███▋      | 363/971 [00:07<00:11, 50.78it/s]backtest loop:  38%|███▊      | 369/971 [00:07<00:12, 49.20it/s]backtest loop:  39%|███▊      | 375/971 [00:07<00:11, 50.68it/s]backtest loop:  39%|███▉      | 381/971 [00:07<00:11, 51.59it/s]backtest loop:  40%|███▉      | 387/971 [00:07<00:11, 52.88it/s]backtest loop:  40%|████      | 393/971 [00:07<00:11, 50.59it/s]backtest loop:  41%|████      | 399/971 [00:07<00:11, 51.92it/s]backtest loop:  42%|████▏     | 405/971 [00:08<00:10, 53.02it/s]backtest loop:  42%|████▏     | 411/971 [00:08<00:10, 53.74it/s]backtest loop:  43%|████▎     | 417/971 [00:08<00:10, 54.17it/s]backtest loop:  44%|████▎     | 423/971 [00:08<00:17, 32.14it/s]backtest loop:  44%|████▍     | 429/971 [00:08<00:14, 36.78it/s]backtest loop:  45%|████▍     | 435/971 [00:08<00:13, 40.86it/s]backtest loop:  45%|████▌     | 441/971 [00:08<00:11, 44.29it/s]backtest loop:  46%|████▌     | 447/971 [00:09<00:11, 44.64it/s]backtest loop:  47%|████▋     | 453/971 [00:09<00:10, 47.32it/s]backtest loop:  47%|████▋     | 459/971 [00:09<00:10, 49.55it/s]backtest loop:  48%|████▊     | 465/971 [00:09<00:09, 51.11it/s]backtest loop:  49%|████▊     | 471/971 [00:09<00:09, 52.29it/s]backtest loop:  49%|████▉     | 477/971 [00:09<00:09, 50.25it/s]backtest loop:  50%|████▉     | 483/971 [00:09<00:09, 51.63it/s]backtest loop:  50%|█████     | 489/971 [00:09<00:09, 52.68it/s]backtest loop:  51%|█████     | 495/971 [00:09<00:09, 50.30it/s]backtest loop:  52%|█████▏    | 501/971 [00:10<00:09, 51.68it/s]backtest loop:  52%|█████▏    | 507/971 [00:10<00:09, 49.80it/s]backtest loop:  53%|█████▎    | 513/971 [00:10<00:08, 51.51it/s]backtest loop:  53%|█████▎    | 519/971 [00:10<00:08, 52.63it/s]backtest loop:  54%|█████▍    | 525/971 [00:10<00:08, 53.55it/s]backtest loop:  55%|█████▍    | 531/971 [00:10<00:08, 51.09it/s]backtest loop:  55%|█████▌    | 537/971 [00:10<00:08, 52.39it/s]backtest loop:  56%|█████▌    | 543/971 [00:10<00:08, 53.29it/s]backtest loop:  57%|█████▋    | 549/971 [00:11<00:07, 53.98it/s]backtest loop:  57%|█████▋    | 555/971 [00:11<00:07, 54.53it/s]backtest loop:  58%|█████▊    | 561/971 [00:11<00:07, 51.55it/s]backtest loop:  58%|█████▊    | 567/971 [00:11<00:07, 52.77it/s]backtest loop:  59%|█████▉    | 573/971 [00:11<00:07, 53.55it/s]backtest loop:  60%|█████▉    | 579/971 [00:11<00:07, 53.72it/s]backtest loop:  60%|██████    | 585/971 [00:11<00:07, 54.21it/s]backtest loop:  61%|██████    | 591/971 [00:11<00:07, 51.32it/s]backtest loop:  61%|██████▏   | 597/971 [00:11<00:07, 52.46it/s]backtest loop:  62%|██████▏   | 603/971 [00:12<00:06, 53.24it/s]backtest loop:  63%|██████▎   | 609/971 [00:12<00:06, 53.88it/s]backtest loop:  63%|██████▎   | 615/971 [00:12<00:06, 51.08it/s]backtest loop:  64%|██████▍   | 621/971 [00:12<00:06, 52.13it/s]backtest loop:  65%|██████▍   | 627/971 [00:12<00:06, 53.04it/s]backtest loop:  65%|██████▌   | 633/971 [00:12<00:06, 53.63it/s]backtest loop:  66%|██████▌   | 639/971 [00:12<00:06, 54.32it/s]backtest loop:  66%|██████▋   | 645/971 [00:12<00:06, 51.39it/s]backtest loop:  67%|██████▋   | 651/971 [00:12<00:06, 52.53it/s]backtest loop:  68%|██████▊   | 657/971 [00:13<00:05, 53.37it/s]backtest loop:  68%|██████▊   | 663/971 [00:13<00:05, 53.76it/s]backtest loop:  69%|██████▉   | 669/971 [00:13<00:05, 54.19it/s]backtest loop:  70%|██████▉   | 675/971 [00:13<00:05, 51.25it/s]backtest loop:  70%|███████   | 681/971 [00:13<00:05, 52.29it/s]backtest loop:  71%|███████   | 687/971 [00:13<00:05, 52.94it/s]backtest loop:  71%|███████▏  | 693/971 [00:13<00:05, 53.62it/s]backtest loop:  72%|███████▏  | 699/971 [00:13<00:05, 50.95it/s]backtest loop:  73%|███████▎  | 705/971 [00:13<00:05, 51.72it/s]backtest loop:  73%|███████▎  | 711/971 [00:14<00:04, 52.72it/s]backtest loop:  74%|███████▍  | 717/971 [00:14<00:04, 53.55it/s]backtest loop:  74%|███████▍  | 723/971 [00:14<00:04, 54.09it/s]backtest loop:  75%|███████▌  | 729/971 [00:14<00:04, 51.30it/s]backtest loop:  76%|███████▌  | 735/971 [00:14<00:04, 49.20it/s]backtest loop:  76%|███████▋  | 741/971 [00:14<00:04, 50.85it/s]backtest loop:  77%|███████▋  | 747/971 [00:14<00:04, 51.74it/s]backtest loop:  78%|███████▊  | 753/971 [00:14<00:04, 49.84it/s]backtest loop:  78%|███████▊  | 759/971 [00:15<00:04, 51.41it/s]backtest loop:  79%|███████▉  | 765/971 [00:15<00:04, 49.37it/s]backtest loop:  79%|███████▉  | 771/971 [00:15<00:03, 50.97it/s]backtest loop:  80%|████████  | 777/971 [00:15<00:03, 52.25it/s]backtest loop:  81%|████████  | 783/971 [00:15<00:03, 50.09it/s]backtest loop:  81%|████████▏ | 789/971 [00:15<00:03, 51.51it/s]backtest loop:  82%|████████▏ | 795/971 [00:15<00:03, 52.47it/s]backtest loop:  82%|████████▏ | 801/971 [00:15<00:03, 53.29it/s]backtest loop:  83%|████████▎ | 807/971 [00:15<00:03, 53.99it/s]backtest loop:  84%|████████▎ | 813/971 [00:16<00:03, 51.22it/s]backtest loop:  84%|████████▍ | 819/971 [00:16<00:02, 52.42it/s]backtest loop:  85%|████████▍ | 825/971 [00:16<00:02, 53.09it/s]backtest loop:  86%|████████▌ | 831/971 [00:16<00:02, 53.73it/s]backtest loop:  86%|████████▌ | 837/971 [00:16<00:02, 54.25it/s]backtest loop:  87%|████████▋ | 843/971 [00:16<00:02, 51.38it/s]backtest loop:  87%|████████▋ | 849/971 [00:16<00:02, 52.54it/s]backtest loop:  88%|████████▊ | 855/971 [00:16<00:02, 53.23it/s]backtest loop:  89%|████████▊ | 861/971 [00:16<00:02, 53.82it/s]backtest loop:  89%|████████▉ | 867/971 [00:17<00:02, 51.10it/s]backtest loop:  90%|████████▉ | 873/971 [00:17<00:01, 52.16it/s]backtest loop:  91%|█████████ | 879/971 [00:17<00:01, 53.14it/s]backtest loop:  91%|█████████ | 885/971 [00:17<00:01, 53.71it/s]backtest loop:  92%|█████████▏| 891/971 [00:17<00:01, 54.14it/s]backtest loop:  92%|█████████▏| 897/971 [00:17<00:01, 51.35it/s]backtest loop:  93%|█████████▎| 903/971 [00:17<00:01, 52.49it/s]backtest loop:  94%|█████████▎| 909/971 [00:17<00:01, 53.32it/s]backtest loop:  94%|█████████▍| 915/971 [00:17<00:01, 53.46it/s]backtest loop:  95%|█████████▍| 921/971 [00:18<00:00, 50.61it/s]backtest loop:  95%|█████████▌| 927/971 [00:18<00:00, 51.98it/s]backtest loop:  96%|█████████▌| 933/971 [00:18<00:00, 52.88it/s]backtest loop:  97%|█████████▋| 939/971 [00:18<00:00, 53.57it/s]backtest loop:  97%|█████████▋| 945/971 [00:18<00:00, 50.88it/s]backtest loop:  98%|█████████▊| 951/971 [00:18<00:00, 52.22it/s]backtest loop:  99%|█████████▊| 957/971 [00:18<00:00, 52.75it/s]backtest loop:  99%|█████████▉| 963/971 [00:18<00:00, 53.63it/s]backtest loop: 100%|█████████▉| 969/971 [00:19<00:00, 54.16it/s]backtest loop: 100%|██████████| 971/971 [00:19<00:00, 50.92it/s]
[2943066:MainThread](2024-04-25 01:27:18,051) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000522
std                0.005319
annualized_return  0.124159
information_ratio  1.513055
max_drawdown      -0.084562
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000323
std                0.005320
annualized_return  0.076862
information_ratio  0.936528
max_drawdown      -0.108342
[2943066:MainThread](2024-04-25 01:27:18,069) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 42
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_online`.
Round 10 Done!
{'1day.excess_return_with_cost.annualized_return': [0.051434543728465565,
                                                    0.044249284499946244,
                                                    0.06012304631775825,
                                                    0.045880009775050655,
                                                    0.06270025818975491,
                                                    0.0753799417472258,
                                                    0.00733742814004799,
                                                    0.08286283990715226,
                                                    0.04970754461816316,
                                                    0.07686233714609596],
 '1day.excess_return_with_cost.information_ratio': [0.5359466990350673,
                                                    0.506542216673835,
                                                    0.6296566548029155,
                                                    0.49843034034936584,
                                                    0.7094182267806647,
                                                    0.8372692588899964,
                                                    0.0750675890199243,
                                                    0.9561205976236687,
                                                    0.573708021394878,
                                                    0.9365276467809281],
 '1day.excess_return_with_cost.max_drawdown': [-0.20023888967815714,
                                               -0.2464977302343334,
                                               -0.24933141070803327,
                                               -0.2812966065033353,
                                               -0.1476673679402031,
                                               -0.18156490131955264,
                                               -0.24688258794279827,
                                               -0.16528792423187974,
                                               -0.1292581870630385,
                                               -0.10834240982873478],
 'IC': [0.02587224613755935,
        0.021163409656197618,
        0.022316224135223012,
        0.025285754183174552,
        0.024794335302755766,
        0.027614520063657392,
        0.02140857387664198,
        0.025598294351956503,
        0.01891527464478308,
        0.030247147064445323],
 'ICIR': [0.18518614400027864,
          0.1544866993423066,
          0.15670848538695684,
          0.18641023059651965,
          0.1718703473411494,
          0.19735804355129996,
          0.14499978059710222,
          0.18934619960171314,
          0.13439379156943246,
          0.2202180787521618],
 'Rank IC': [0.02043466903243119,
             0.01549351371921764,
             0.01806255713632389,
             0.024278838529892835,
             0.021080508001620087,
             0.025720809985435574,
             0.015033439290787839,
             0.022029561636039398,
             0.014773563851960174,
             0.027840534477291203],
 'Rank ICIR': [0.14468640124580973,
               0.11103740542301493,
               0.12281036940312468,
               0.1780547655378848,
               0.14405894542010167,
               0.18164244212693723,
               0.09908168825597151,
               0.16430282874668095,
               0.10187939426283874,
               0.20304459581771744],
 'mae': [0.7073439359664917,
         0.7074997425079346,
         0.7073977589607239,
         0.7072641253471375,
         0.7073571085929871,
         0.7073237895965576,
         0.7074754238128662,
         0.7073764204978943,
         0.7074818015098572,
         0.7072504758834839],
 'mse': [0.995890736579895,
         0.9962072968482971,
         0.9961547255516052,
         0.9959003925323486,
         0.9960064888000488,
         0.9958208799362183,
         0.9961485862731934,
         0.9959833025932312,
         0.9963239431381226,
         0.9958211779594421]}
[2943066:MainThread](2024-04-25 01:27:19,360) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_final.
[2943066:MainThread](2024-04-25 01:27:19,396) INFO - qlib.workflow - [exp.py:258] - Experiment 46 starts running ...
[2943066:MainThread](2024-04-25 01:27:19,412) INFO - qlib.workflow - [recorder.py:341] - Recorder 63113616730240859dfe560f0dfa287a starts running under Experiment 46 ...
Time cost: 835.3379565477371	57.46831388473511
Final results:
{'1day.excess_return_with_cost.annualized_return': [0.05565372340696608,
                                                    0.020644861636253283],
 '1day.excess_return_with_cost.information_ratio': [0.6258687251351244,
                                                    0.24534226644940982],
 '1day.excess_return_with_cost.max_drawdown': [-0.19563680154500665,
                                               0.055589052627896915],
 'IC': [0.024321577941639454, 0.0032070660746221376],
 'ICIR': [0.17409778007389204, 0.02508032724707968],
 'Rank IC': [0.020474799566099985, 0.004379221156150699],
 'Rank ICIR': [0.14505988362400818, 0.03433907975974461],
 'mae': [0.7073770582675933, 8.320868207209762e-05],
 'mse': [0.9960257530212402, 0.0001653902070450141]}
Your final results can be found in the experiment named `csi300_Transformer_alpha360_horizon1_step20_rankFalse_2024-04-24_22:58:31_final`.
All Done!
[2943066:MainThread](2024-04-25 01:27:20,391) INFO - qlib.timer - [log.py:127] - Time cost: 0.035s | waiting `async_log` Done
