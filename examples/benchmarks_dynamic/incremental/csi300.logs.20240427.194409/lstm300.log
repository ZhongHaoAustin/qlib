['main.py', 'run_all', '--forecast_model', 'LSTM', '-num_head', '8', '--train_start=2008-01-01', '--train_end=2018-12-31', '--valid_start=2019-01-01', '--valid_end=2020-03-31', '--test_start=2020-04-01', '--test_end=2024-03-31', '--tau', '10', '--lr_da', '0.01', '--market', 'csi300', '--data_dir', 'crowd_data', '--rank_label', 'True', '--begin_valid_epoch', '30']
[335022:MainThread](2024-04-27 20:47:27,120) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[335022:MainThread](2024-04-27 20:47:27,124) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[335022:MainThread](2024-04-27 20:47:27,124) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/home/zhonghao/.qlib/qlib_data/crowd_data')}
Handler: {'class': 'Alpha360', 'module_path': 'qlib.contrib.data.handler', 'kwargs': {'start_time': Timestamp('2008-01-01 00:00:00'), 'end_time': Timestamp('2024-03-31 00:00:00'), 'fit_start_time': Timestamp('2008-01-01 00:00:00'), 'fit_end_time': Timestamp('2018-12-31 00:00:00'), 'instruments': 'csi300', 'infer_processors': [{'class': 'RobustZScoreNorm', 'kwargs': {'fields_group': 'feature', 'clip_outlier': True}}, {'class': 'Fillna', 'kwargs': {'fields_group': 'feature'}}], 'learn_processors': [{'class': 'DropnaLabel'}, {'class': 'CSRankNorm', 'kwargs': {'fields_group': 'label'}}], 'label': ['Ref($close, -2) / Ref($close, -1) - 1']}}
Task: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-01 00:00:00'), Timestamp('2018-12-31 00:00:00')), 'valid': (Timestamp('2019-01-01 00:00:00'), Timestamp('2020-03-31 00:00:00')), 'test': (Timestamp('2020-04-01 00:00:00'), Timestamp('2024-03-31 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}
[335022:MainThread](2024-04-27 20:47:31,976) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2008-01-02 00:00:00'), Timestamp('2008-01-29 00:00:00')), 'test': (Timestamp('2008-01-31 00:00:00'), Timestamp('2008-03-05 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

creating meta tasks:   0%|          | 0/147 [00:00<?, ?it/s]
creating meta tasks:   5%|â–Œ         | 8/147 [00:00<00:01, 72.70it/s]
creating meta tasks:  11%|â–ˆ         | 16/147 [00:00<00:01, 74.47it/s]
creating meta tasks:  16%|â–ˆâ–‹        | 24/147 [00:00<00:01, 74.90it/s]
creating meta tasks:  22%|â–ˆâ–ˆâ–       | 32/147 [00:00<00:01, 74.41it/s]
creating meta tasks:  27%|â–ˆâ–ˆâ–‹       | 40/147 [00:00<00:01, 74.81it/s]
creating meta tasks:  33%|â–ˆâ–ˆâ–ˆâ–      | 48/147 [00:00<00:01, 74.68it/s]
creating meta tasks:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 56/147 [00:00<00:01, 74.90it/s]
creating meta tasks:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 64/147 [00:00<00:01, 73.79it/s]
creating meta tasks:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 72/147 [00:00<00:01, 74.04it/s]
creating meta tasks:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 80/147 [00:01<00:00, 74.12it/s]
creating meta tasks:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 88/147 [00:01<00:00, 74.28it/s]
creating meta tasks:  65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 96/147 [00:01<00:00, 75.25it/s]
creating meta tasks:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 104/147 [00:01<00:00, 75.45it/s]
creating meta tasks:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 112/147 [00:01<00:00, 75.58it/s]
creating meta tasks:  82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 120/147 [00:01<00:00, 75.72it/s]
creating meta tasks:  87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 128/147 [00:01<00:00, 75.70it/s]
creating meta tasks:  93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 136/147 [00:01<00:00, 75.48it/s]
creating meta tasks:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 144/147 [00:01<00:00, 75.10it/s]
creating meta tasks: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 147/147 [00:01<00:00, 74.86it/s]
[335022:MainThread](2024-04-27 20:47:34,219) INFO - qlib.MetaDatasetInc - [dataset.py:152] - Example task for training meta model: {'model': {'class': 'LSTM', 'module_path': 'qlib.contrib.model.pytorch_lstm', 'kwargs': {'d_feat': 6, 'hidden_size': 64, 'num_layers': 2, 'dropout': 0.0, 'n_epochs': 200, 'lr': 0.001, 'early_stop': 8, 'batch_size': 800, 'metric': 'loss', 'loss': 'mse', 'GPU': 0}}, 'dataset': {'class': 'DatasetH', 'module_path': 'qlib.data.dataset', 'kwargs': {'handler': 'file:///home/zhonghao/sjtu/qlib/examples/benchmarks/crowd_data_csi300_rankTrue_alpha360_handler_horizon1.pkl', 'segments': {'train': (Timestamp('2019-01-02 00:00:00'), Timestamp('2019-01-29 00:00:00')), 'test': (Timestamp('2019-01-31 00:00:00'), Timestamp('2019-03-06 00:00:00'))}}}, 'record': ['qlib.workflow.record_temp.SignalRecord']}

creating meta tasks:   0%|          | 0/63 [00:00<?, ?it/s]
creating meta tasks:  11%|â–ˆ         | 7/63 [00:00<00:00, 68.54it/s]
creating meta tasks:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:00, 68.28it/s]
creating meta tasks:  33%|â–ˆâ–ˆâ–ˆâ–      | 21/63 [00:00<00:00, 68.23it/s]
creating meta tasks:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:00<00:00, 68.40it/s]
creating meta tasks:  56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 35/63 [00:00<00:00, 67.97it/s]
creating meta tasks:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:00<00:00, 68.11it/s]
creating meta tasks:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 49/63 [00:00<00:00, 68.32it/s]
creating meta tasks:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:00<00:00, 66.99it/s]
creating meta tasks: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:00<00:00, 67.99it/s]
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 20:47:35,924) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 20:47:36,025) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None

epoch:   0%|          | 0/100 [00:00<?, ?it/s]
epoch:   1%|          | 1/100 [00:07<13:01,  7.89s/it]
epoch:   2%|â–         | 2/100 [00:15<12:42,  7.78s/it]
epoch:   3%|â–         | 3/100 [00:23<12:25,  7.69s/it]
epoch:   4%|â–         | 4/100 [00:30<12:08,  7.59s/it]
epoch:   5%|â–Œ         | 5/100 [00:38<12:01,  7.60s/it]
epoch:   6%|â–Œ         | 6/100 [00:45<11:52,  7.58s/it]
epoch:   7%|â–‹         | 7/100 [00:53<11:45,  7.59s/it]
epoch:   8%|â–Š         | 8/100 [01:01<11:42,  7.64s/it]
epoch:   9%|â–‰         | 9/100 [01:08<11:33,  7.62s/it]
epoch:  10%|â–ˆ         | 10/100 [01:16<11:20,  7.57s/it]
epoch:  11%|â–ˆ         | 11/100 [01:23<11:14,  7.58s/it]
epoch:  12%|â–ˆâ–        | 12/100 [01:31<11:06,  7.57s/it]
epoch:  13%|â–ˆâ–        | 13/100 [01:38<10:52,  7.50s/it]
epoch:  14%|â–ˆâ–        | 14/100 [01:46<10:49,  7.55s/it]
epoch:  15%|â–ˆâ–Œ        | 15/100 [01:53<10:42,  7.56s/it]
epoch:  16%|â–ˆâ–Œ        | 16/100 [02:01<10:35,  7.56s/it]
epoch:  17%|â–ˆâ–‹        | 17/100 [02:09<10:29,  7.58s/it]
epoch:  18%|â–ˆâ–Š        | 18/100 [02:16<10:21,  7.58s/it]
epoch:  19%|â–ˆâ–‰        | 19/100 [02:24<10:14,  7.59s/it]
epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:32<10:14,  7.68s/it]
epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:39<10:06,  7.67s/it]
epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:47<09:55,  7.63s/it]
epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:54<09:46,  7.62s/it]
epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:02<09:34,  7.56s/it]
epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:09<09:26,  7.56s/it]
epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:17<09:21,  7.59s/it]
epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:25<09:18,  7.65s/it]
epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:33<09:12,  7.68s/it]
epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:40<09:03,  7.66s/it]
epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:48<08:56,  7.66s/it]0.052397460760500704
best ic: 0.052397460760500704

epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [03:57<09:14,  8.04s/it]0.05231390573378674

epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:06<09:20,  8.24s/it]0.05123272707226618

epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:14<09:21,  8.39s/it]0.05633818468592235
best ic: 0.05633818468592235

epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:23<09:20,  8.49s/it]0.05242870724305216

epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:32<09:20,  8.62s/it]0.052934512600348246

epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:41<09:14,  8.67s/it]0.050797605033978024

epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:50<09:09,  8.72s/it]0.05009829058580807

epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [04:58<09:03,  8.76s/it]0.05029833453281105

epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:07<08:51,  8.71s/it]0.05141423410133221

epoch:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 40/100 [05:16<08:42,  8.71s/it]0.0507849991341251

epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:24<08:30,  8.66s/it]0.052098379620417315

epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:33<07:59,  8.13s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 20:53:12,355) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online.
[335022:MainThread](2024-04-27 20:53:12,420) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 20:53:13,074) INFO - qlib.workflow - [recorder.py:351] - Recorder bcd9db8d4fc5429d95b6f13d25ce89e4 starts running under Experiment 71 ...

online:   0%|          | 0/63 [00:00<?, ?it/s]
online:   3%|â–         | 2/63 [00:00<00:03, 15.81it/s]
online:   6%|â–‹         | 4/63 [00:00<00:03, 15.39it/s]
online:  10%|â–‰         | 6/63 [00:00<00:03, 15.28it/s]
online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 15.04it/s]
online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 14.94it/s]
online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 15.02it/s]
online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:03, 15.03it/s]
online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:01<00:03, 15.03it/s]
online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:03, 14.98it/s]
online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 15.04it/s]
online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 15.07it/s]
online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 15.09it/s]
online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 15.10it/s]
online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 15.11it/s]
online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:02, 15.13it/s]
online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:02<00:02, 14.92it/s]
online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 15.28it/s]
online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 15.51it/s]
online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 15.70it/s]
online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 15.72it/s]
online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 15.58it/s]
online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 15.46it/s]
online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:03<00:01, 15.25it/s]
online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:03<00:00, 15.45it/s]
online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 15.24it/s]
online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 15.09it/s]
online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 15.08it/s]
online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 15.26it/s]
online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 15.09it/s]
online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 15.23it/s]
online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:04<00:00, 15.21it/s]
online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:04<00:00, 15.21it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 20:53:23,164) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9958663 mae 0.86332864
{'IC': 0.029729565457264854,
 'ICIR': 0.21854268909662852,
 'Rank IC': 0.048009263616079774,
 'Rank ICIR': 0.35229059437440524}
[335022:MainThread](2024-04-27 20:53:24,873) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 20:53:35,908) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 20:53:35,911) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 20:53:42,110) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f05eb2d20a0>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 971/971  [ 0:00:18 < 0:00:00 , 51 it/s ]
[335022:MainThread](2024-04-27 20:54:01,159) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000462
std                0.004921
annualized_return  0.109870
information_ratio  1.447214
max_drawdown      -0.072680
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000265
std                0.004922
annualized_return  0.063094
information_ratio  0.830864
max_drawdown      -0.079456
[335022:MainThread](2024-04-27 20:54:01,177) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 1 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617],
 'IC': [0.029729565457264854],
 'ICIR': [0.21854268909662852],
 'Rank IC': [0.048009263616079774],
 'Rank ICIR': [0.35229059437440524],
 'mae': [0.8633286356925964],
 'mse': [0.9958662986755371]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 20:54:02,392) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 20:54:02,392) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None

epoch:   0%|          | 0/100 [00:00<?, ?it/s]
epoch:   1%|          | 1/100 [00:07<12:20,  7.48s/it]
epoch:   2%|â–         | 2/100 [00:14<12:12,  7.48s/it]
epoch:   3%|â–         | 3/100 [00:22<12:11,  7.54s/it]
epoch:   4%|â–         | 4/100 [00:30<12:05,  7.55s/it]
epoch:   5%|â–Œ         | 5/100 [00:37<12:03,  7.62s/it]
epoch:   6%|â–Œ         | 6/100 [00:45<12:05,  7.72s/it]
epoch:   7%|â–‹         | 7/100 [00:53<11:56,  7.70s/it]
epoch:   8%|â–Š         | 8/100 [01:00<11:37,  7.58s/it]
epoch:   9%|â–‰         | 9/100 [01:08<11:29,  7.58s/it]
epoch:  10%|â–ˆ         | 10/100 [01:16<11:24,  7.60s/it]
epoch:  11%|â–ˆ         | 11/100 [01:23<11:15,  7.59s/it]
epoch:  12%|â–ˆâ–        | 12/100 [01:31<11:08,  7.60s/it]
epoch:  13%|â–ˆâ–        | 13/100 [01:38<11:00,  7.59s/it]
epoch:  14%|â–ˆâ–        | 14/100 [01:46<10:55,  7.62s/it]
epoch:  15%|â–ˆâ–Œ        | 15/100 [01:53<10:42,  7.56s/it]
epoch:  16%|â–ˆâ–Œ        | 16/100 [02:01<10:37,  7.59s/it]
epoch:  17%|â–ˆâ–‹        | 17/100 [02:09<10:35,  7.65s/it]
epoch:  18%|â–ˆâ–Š        | 18/100 [02:16<10:26,  7.65s/it]
epoch:  19%|â–ˆâ–‰        | 19/100 [02:24<10:20,  7.66s/it]
epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:32<10:17,  7.72s/it]
epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:40<10:06,  7.67s/it]
epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:47<09:58,  7.67s/it]
epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:55<09:47,  7.63s/it]
epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:02<09:38,  7.62s/it]
epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:10<09:37,  7.70s/it]
epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:18<09:32,  7.74s/it]
epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:26<09:24,  7.73s/it]
epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:34<09:20,  7.79s/it]
epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:41<09:11,  7.76s/it]
epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:49<09:01,  7.73s/it]0.05647983080431923
best ic: 0.05647983080431923

epoch:  31%|â–ˆâ0.05308895359929004
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:25<09:28,  8.62s/it]0.05350016415305314
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:33<09:24,  8.68s/it]0.05408107492738104
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:42<09:21,  8.78s/it]0.054347065544149
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:51<09:13,  8.79s/it]0.05397063385771974
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [05:00<09:05,  8.79s/it]0.053020127736012716
epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:09<08:56,  8.79s/it]0.05111678955051491
epoch:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 40/100 [05:18<08:48,  8.81s/it]0.05125173058542798
epoch:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 40/100 [05:27<08:10,  8.18s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 20:59:29,563) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 20:59:29,578) INFO - qlib.workflow - [recorder.py:351] - Recorder 94a964013daf430abd118a174a83366f starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:03, 15.47it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 16.23it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 16.54it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 16.69it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 16.62it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 16.72it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:02, 16.75it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:00<00:02, 16.74it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 16.85it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 16.60it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 16.87it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 16.68it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 16.71it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 16.57it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:02, 16.24it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:01<00:01, 16.30it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 16.25it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 16.20it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 16.09it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 16.01it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 15.99it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 15.96it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 15.97it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:02<00:00, 15.57it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 15.56it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 15.48it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 15.50it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 15.62it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 15.57it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 15.64it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 15.57it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 16.12it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 20:59:39,450) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99574155 mae 0.863276
{'IC': 0.029405089758369793,
 'ICIR': 0.21612419371235603,
 'Rank IC': 0.04920694528309832,
 'Rank ICIR': 0.3531841992937613}
[335022:MainThread](2024-04-27 20:59:41,280) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 20:59:52,577) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 20:59:52,580) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 20:59:58,642) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f05ff45e550>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 969/971  [ 0:00:19 < 0:00:01 , 52 it/s ]
[335022:MainThread](2024-04-27 21:00:17,835) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000585
std                0.005044
annualized_return  0.139286
information_ratio  1.789861
max_drawdown      -0.067106
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000387
std                0.005046
annualized_return  0.092104
information_ratio  1.183054
max_drawdown      -0.071486
[335022:MainThread](2024-04-27 21:00:17,852) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 2 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947],
 'IC': [0.029729565457264854, 0.029405089758369793],
 'ICIR': [0.21854268909662852, 0.21612419371235603],
 'Rank IC': [0.048009263616079774, 0.04920694528309832],
 'Rank ICIR': [0.35229059437440524, 0.3531841992937613],
 'mae': [0.8633286356925964, 0.8632760047912598],
 'mse': [0.9958662986755371, 0.9957415461540222]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 21:00:19,083) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 21:00:19,083) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:07<12:41,  7.70s/it]epoch:   2%|â–         | 2/100 [00:15<12:23,  7.58s/it]epoch:   3%|â–         | 3/100 [00:22<12:15,  7.58s/it]epoch:   4%|â–         | 4/100 [00:30<12:12,  7.63s/it]epoch:   5%|â–Œ         | 5/100 [00:38<12:09,  7.68s/it]epoch:   6%|â–Œ         | 6/100 [00:45<11:59,  7.65s/it]epoch:   7%|â–‹         | 7/100 [00:53<11:52,  7.66s/it]epoch:   8%|â–Š         | 8/100 [01:01<11:45,  7.67s/it]epoch:   9%|â–‰         | 9/100 [01:08<11:37,  7.66s/it]epoch:  10%|â–ˆ         | 10/100 [01:16<11:24,  7.60s/it]epoch:  11%|â–ˆ         | 11/100 [01:23<11:14,  7.58s/it]epoch:  12%|â–ˆâ–        | 12/100 [01:31<11:07,  7.59s/it]epoch:  13%|â–ˆâ–        | 13/100 [01:39<11:00,  7.60s/it]epoch:  14%|â–ˆâ–        | 14/100 [01:46<10:55,  7.63s/it]epoch:  15%|â–ˆâ–Œ        | 15/100 [01:54<10:46,  7.61s/it]epoch:  16%|â–ˆâ–Œ        | 16/100 [02:02<10:42,  7.65s/it]epoch:  17%|â–ˆâ–‹        | 17/100 [02:09<10:35,  7.66s/it]epoch:  18%|â–ˆâ–Š        | 18/100 [02:17<10:26,  7.64s/it]epoch:  19%|â–ˆâ–‰        | 19/100 [02:25<10:23,  7.70s/it]epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:32<10:16,  7.70s/it]epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:40<10:06,  7.68s/it]epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:48<09:55,  7.64s/it]epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:55<09:44,  7.59s/it]epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:03<09:38,  7.61s/it]epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:10<09:32,  7.63s/it]epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:18<09:25,  7.65s/it]epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:26<09:26,  7.76s/it]epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:34<09:17,  7.75s/it]epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:41<09:06,  7.70s/it]epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:49<08:54,  7.64s/it]0.05275968525856787
best ic: 0.05275968525856787
epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [03:57<09:06,  7.92s/it]0.048957589370562736
epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:06<09:14,  8.16s/it]0.05220062302345778
epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:15<09:21,  8.38s/it]0.0546988745907649
best ic: 0.0546988745907649
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:24<09:22,  8.52s/it]0.05262844993412137
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:33<09:20,  8.62s/it]0.05449443997136385
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:42<09:16,  8.69s/it]0.05302785790065776
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:50<09:10,  8.73s/it]0.04979215831195005
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [04:59<09:00,  8.72s/it]0.050227459897697044
epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:08<08:53,  8.75s/it]0.053870336941492264
epoch:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 40/100 [05:17<08:48,  8.81s/it]0.05218931081753173
epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:26<08:47,  8.94s/it]0.05028874789892048
epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:35<08:03,  8.19s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 21:05:54,879) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 21:05:54,895) INFO - qlib.workflow - [recorder.py:351] - Recorder 9910f71b2c2c4ea5873550f602b0e4fa starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:03, 15.69it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 16.03it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 16.25it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 16.45it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 16.43it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 16.43it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:02, 16.45it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:00<00:02, 16.43it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 16.44it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 16.52it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 16.57it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 16.66it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 16.48it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 16.63it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:01, 16.58it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:01<00:01, 16.53it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 16.70it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 16.64it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 16.61it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 16.63it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 16.77it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 16.60it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 16.59it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:02<00:00, 16.64it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 16.51it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 16.63it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 16.58it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 16.80it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 16.67it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 16.63it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 16.81it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 16.61it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 21:06:04,740) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9955101 mae 0.8631441
{'IC': 0.031630888947913355,
 'ICIR': 0.23109538349716643,
 'Rank IC': 0.050545985610409176,
 'Rank ICIR': 0.3684279490033989}
[335022:MainThread](2024-04-27 21:06:06,495) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 21:06:18,710) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:06:18,713) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:06:24,794) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f05e659f130>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 969/971  [ 0:00:17 < 0:00:01 , 56 it/s ]
[335022:MainThread](2024-04-27 21:06:42,620) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000645
std                0.004744
annualized_return  0.153610
information_ratio  2.098990
max_drawdown      -0.061424
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000446
std                0.004745
annualized_return  0.106049
information_ratio  1.448628
max_drawdown      -0.072898
[335022:MainThread](2024-04-27 21:06:42,637) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 3 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852,
                                                    0.10604891602025349],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722,
                                                    1.4486275117859186],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947,
                                               -0.07289816911890595],
 'IC': [0.029729565457264854, 0.029405089758369793, 0.031630888947913355],
 'ICIR': [0.21854268909662852, 0.21612419371235603, 0.23109538349716643],
 'Rank IC': [0.048009263616079774, 0.04920694528309832, 0.050545985610409176],
 'Rank ICIR': [0.35229059437440524, 0.3531841992937613, 0.3684279490033989],
 'mae': [0.8633286356925964, 0.8632760047912598, 0.8631440997123718],
 'mse': [0.9958662986755371, 0.9957415461540222, 0.9955101013183594]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 21:06:43,869) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 21:06:43,870) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:07<12:44,  7.72s/it]epoch:   2%|â–         | 2/100 [00:15<12:29,  7.64s/it]epoch:   3%|â–         | 3/100 [00:22<12:19,  7.62s/it]epoch:   4%|â–         | 4/100 [00:30<12:11,  7.62s/it]epoch:   5%|â–Œ         | 5/100 [00:38<12:16,  7.75s/it]epoch:   6%|â–Œ         | 6/100 [00:46<12:04,  7.70s/it]epoch:   7%|â–‹         | 7/100 [00:53<11:56,  7.70s/it]epoch:   8%|â–Š         | 8/100 [01:01<11:45,  7.67s/it]epoch:   9%|â–‰         | 9/100 [01:09<11:36,  7.65s/it]epoch:  10%|â–ˆ         | 10/100 [01:16<11:29,  7.66s/it]epoch:  11%|â–ˆ         | 11/100 [01:24<11:21,  7.65s/it]epoch:  12%|â–ˆâ–        | 12/100 [01:32<11:20,  7.73s/it]epoch:  13%|â–ˆâ–        | 13/100 [01:39<11:10,  7.70s/it]epoch:  14%|â–ˆâ–        | 14/100 [01:47<10:58,  7.66s/it]epoch:  15%|â–ˆâ–Œ        | 15/100 [01:55<10:49,  7.64s/it]epoch:  16%|â–ˆâ–Œ        | 16/100 [02:02<10:40,  7.63s/it]epoch:  17%|â–ˆâ–‹        | 17/100 [02:10<10:36,  7.67s/it]epoch:  18%|â–ˆâ–Š        | 18/100 [02:18<10:29,  7.67s/it]epoch:  19%|â–ˆâ–‰        | 19/100 [02:25<10:19,  7.65s/it]epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:33<10:12,  7.66s/it]epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:40<10:03,  7.64s/it]epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:48<09:59,  7.69s/it]epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:56<09:52,  7.69s/it]epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:04<09:42,  7.67s/it]epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:11<09:34,  7.66s/it]epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:19<09:24,  7.63s/it]epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:26<09:13,  7.58s/it]epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:34<09:06,  7.60s/it]epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:42<09:00,  7.61s/it]epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:49<08:54,  7.64s/it]0.05395026404908356
best ic: 0.05395026404908356
epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [03:58<09:10,  7.98s/it]0.055234439609768815
best ic: 0.055234439609768815
epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:06<09:12,  8.12s/it]0.05254909500897401
epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:15<09:16,  8.31s/it]0.05353128086574517
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:24<09:24,  8.55s/it]0.052900756747399885
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:33<09:20,  8.62s/it]0.0518590342832398
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:42<09:13,  8.65s/it]0.053148635657529815
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:50<09:02,  8.61s/it]0.05478807845113975
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [04:59<09:01,  8.73s/it]0.053286904345366586
epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:08<08:59,  8.84s/it]0.05029756871279654
epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:17<08:16,  8.15s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 21:12:01,659) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 21:12:01,675) INFO - qlib.workflow - [recorder.py:351] - Recorder 4fa0c72efe0c4aa6ad2f63476442f46c starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:03, 15.47it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 15.38it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 15.52it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 15.53it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 15.55it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 15.45it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:03, 15.49it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:01<00:03, 15.53it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 15.80it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 15.66it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 15.66it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 15.66it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 15.77it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 15.74it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:02, 15.65it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:02<00:01, 15.71it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 15.88it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 15.86it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 15.87it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 15.95it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 16.03it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 15.97it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 15.98it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:03<00:00, 15.92it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 16.03it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 16.04it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 16.07it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 16.02it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 16.03it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 15.98it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 15.92it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 15.84it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 21:12:11,775) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9950946 mae 0.86298275
{'IC': 0.03467442032448001,
 'ICIR': 0.25129378927287044,
 'Rank IC': 0.05345550631625833,
 'Rank ICIR': 0.3851584033742197}
[335022:MainThread](2024-04-27 21:12:13,625) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 21:12:25,719) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:12:25,723) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:12:31,708) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f06040b24c0>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 969/971  [ 0:00:17 < 0:00:01 , 56 it/s ]
[335022:MainThread](2024-04-27 21:12:49,232) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000690
std                0.004812
annualized_return  0.164245
information_ratio  2.212696
max_drawdown      -0.050046
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000493
std                0.004813
annualized_return  0.117313
information_ratio  1.579951
max_drawdown      -0.060766
[335022:MainThread](2024-04-27 21:12:49,249) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 4 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852,
                                                    0.10604891602025349,
                                                    0.1173128835516425],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722,
                                                    1.4486275117859186,
                                                    1.5799512476215403],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947,
                                               -0.07289816911890595,
                                               -0.060765770421726595],
 'IC': [0.029729565457264854,
        0.029405089758369793,
        0.031630888947913355,
        0.03467442032448001],
 'ICIR': [0.21854268909662852,
          0.21612419371235603,
          0.23109538349716643,
          0.25129378927287044],
 'Rank IC': [0.048009263616079774,
             0.04920694528309832,
             0.050545985610409176,
             0.05345550631625833],
 'Rank ICIR': [0.35229059437440524,
               0.3531841992937613,
               0.3684279490033989,
               0.3851584033742197],
 'mae': [0.8633286356925964,
         0.8632760047912598,
         0.8631440997123718,
         0.8629827499389648],
 'mse': [0.9958662986755371,
         0.9957415461540222,
         0.9955101013183594,
         0.9950945973396301]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 21:12:50,431) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 21:12:50,431) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:07<12:59,  7.87s/it]epoch:   2%|â–         | 2/100 [00:15<12:32,  7.68s/it]epoch:   3%|â–         | 3/100 [00:22<12:17,  7.61s/it]epoch:   4%|â–         | 4/100 [00:30<12:05,  7.56s/it]epoch:   5%|â–Œ         | 5/100 [00:37<11:52,  7.50s/it]epoch:   6%|â–Œ         | 6/100 [00:44<11:34,  7.39s/it]epoch:   7%|â–‹         | 7/100 [00:52<11:37,  7.50s/it]epoch:   8%|â–Š         | 8/100 [01:00<11:32,  7.53s/it]epoch:   9%|â–‰         | 9/100 [01:07<11:26,  7.54s/it]epoch:  10%|â–ˆ         | 10/100 [01:15<11:17,  7.53s/it]epoch:  11%|â–ˆ         | 11/100 [01:22<11:11,  7.54s/it]epoch:  12%|â–ˆâ–        | 12/100 [01:30<11:04,  7.55s/it]epoch:  13%|â–ˆâ–        | 13/100 [01:38<10:56,  7.55s/it]epoch:  14%|â–ˆâ–        | 14/100 [01:45<10:52,  7.59s/it]epoch:  15%|â–ˆâ–Œ        | 15/100 [01:53<10:46,  7.61s/it]epoch:  16%|â–ˆâ–Œ        | 16/100 [02:01<10:40,  7.63s/it]epoch:  17%|â–ˆâ–‹        | 17/100 [02:08<10:35,  7.65s/it]epoch:  18%|â–ˆâ–Š        | 18/100 [02:16<10:17,  7.53s/it]epoch:  19%|â–ˆâ–‰        | 19/100 [02:23<10:10,  7.54s/it]epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:31<10:05,  7.56s/it]epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:39<10:03,  7.64s/it]epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:46<09:51,  7.58s/it]epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:53<09:41,  7.56s/it]epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:01<09:37,  7.60s/it]epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:09<09:31,  7.62s/it]epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:17<09:32,  7.74s/it]epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:24<09:20,  7.68s/it]epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:32<09:11,  7.65s/it]epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:40<09:04,  7.67s/it]epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:47<08:57,  7.67s/it]0.05573579294733863
best ic: 0.05573579294733863
epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [03:56<09:17,  8.08s/it]0.05453986363637824
epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:05<09:28,  8.36s/it]0.05179778059675273
epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:14<09:31,  8.53s/it]0.04614037834690214
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:23<09:27,  8.60s/it]0.05363239648118262
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:32<09:23,  8.66s/it]0.054784498936965124
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:41<09:17,  8.71s/it]0.051662065405698135
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:50<09:10,  8.73s/it]0.05295347332736251
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [04:58<09:03,  8.77s/it]0.05191352724528785
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [05:07<08:22,  8.11s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 21:17:58,475) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 21:17:58,492) INFO - qlib.workflow - [recorder.py:351] - Recorder 8720edb75dff4e7c9eb7af4376754857 starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:04, 14.72it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 15.14it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 16.13it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 16.13it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 16.27it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 16.42it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:02, 16.55it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:00<00:02, 16.75it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 16.73it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 16.87it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 16.93it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 16.84it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 16.66it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 16.67it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:01, 16.63it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:01<00:01, 16.83it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 16.83it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 16.91it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 16.96it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 16.94it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 16.80it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 16.80it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 16.77it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:02<00:00, 16.73it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 16.65it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 16.53it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 16.72it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 16.59it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 16.47it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 16.66it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 16.44it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 16.61it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 21:18:08,432) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9954495 mae 0.86322916
{'IC': 0.030472797772215822,
 'ICIR': 0.21732997056432965,
 'Rank IC': 0.04975131877560188,
 'Rank ICIR': 0.34866365763795726}
[335022:MainThread](2024-04-27 21:18:10,213) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 21:18:23,014) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:18:23,017) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:18:29,255) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f05ff017fd0>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 971/971  [ 0:00:18 < 0:00:00 , 52 it/s ]
[335022:MainThread](2024-04-27 21:18:48,317) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000583
std                0.005075
annualized_return  0.138852
information_ratio  1.773641
max_drawdown      -0.054529
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000386
std                0.005076
annualized_return  0.091832
information_ratio  1.172597
max_drawdown      -0.063093
[335022:MainThread](2024-04-27 21:18:48,334) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 5 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852,
                                                    0.10604891602025349,
                                                    0.1173128835516425,
                                                    0.09183246529644684],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722,
                                                    1.4486275117859186,
                                                    1.5799512476215403,
                                                    1.1725965476904165],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947,
                                               -0.07289816911890595,
                                               -0.060765770421726595,
                                               -0.06309258060263781],
 'IC': [0.029729565457264854,
        0.029405089758369793,
        0.031630888947913355,
        0.03467442032448001,
        0.030472797772215822],
 'ICIR': [0.21854268909662852,
          0.21612419371235603,
          0.23109538349716643,
          0.25129378927287044,
          0.21732997056432965],
 'Rank IC': [0.048009263616079774,
             0.04920694528309832,
             0.050545985610409176,
             0.05345550631625833,
             0.04975131877560188],
 'Rank ICIR': [0.35229059437440524,
               0.3531841992937613,
               0.3684279490033989,
               0.3851584033742197,
               0.34866365763795726],
 'mae': [0.8633286356925964,
         0.8632760047912598,
         0.8631440997123718,
         0.8629827499389648,
         0.8632291555404663],
 'mse': [0.9958662986755371,
         0.9957415461540222,
         0.9955101013183594,
         0.9950945973396301,
         0.9954494833946228]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 21:18:49,565) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 21:18:49,565) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:07<12:38,  7.66s/it]epoch:   2%|â–         | 2/100 [00:15<12:39,  7.75s/it]epoch:   3%|â–         | 3/100 [00:23<12:36,  7.80s/it]epoch:   4%|â–         | 4/100 [00:31<12:26,  7.77s/it]epoch:   5%|â–Œ         | 5/100 [00:38<12:15,  7.74s/it]epoch:   6%|â–Œ         | 6/100 [00:46<11:57,  7.63s/it]epoch:   7%|â–‹         | 7/100 [00:53<11:45,  7.58s/it]epoch:   8%|â–Š         | 8/100 [01:01<11:44,  7.66s/it]epoch:   9%|â–‰         | 9/100 [01:09<11:40,  7.70s/it]epoch:  10%|â–ˆ         | 10/100 [01:17<11:44,  7.83s/it]epoch:  11%|â–ˆ         | 11/100 [01:25<11:38,  7.85s/it]epoch:  12%|â–ˆâ–        | 12/100 [01:33<11:27,  7.81s/it]epoch:  13%|â–ˆâ–        | 13/100 [01:40<11:17,  7.79s/it]epoch:  14%|â–ˆâ–        | 14/100 [01:48<11:00,  7.69s/it]epoch:  15%|â–ˆâ–Œ        | 15/100 [01:55<10:42,  7.56s/it]epoch:  16%|â–ˆâ–Œ        | 16/100 [02:03<10:41,  7.64s/it]epoch:  17%|â–ˆâ–‹        | 17/100 [02:10<10:34,  7.65s/it]epoch:  18%|â–ˆâ–Š        | 18/100 [02:18<10:28,  7.66s/it]epoch:  19%|â–ˆâ–‰        | 19/100 [02:26<10:20,  7.66s/it]epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:34<10:19,  7.74s/it]epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:42<10:15,  7.79s/it]epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:49<10:05,  7.76s/it]epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:57<10:00,  7.79s/it]epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:05<09:55,  7.84s/it]epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:13<09:45,  7.80s/it]epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:21<09:38,  7.81s/it]epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:28<09:28,  7.78s/it]epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:36<09:17,  7.75s/it]epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:43<09:00,  7.61s/it]epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:51<08:46,  7.52s/it]0.052844859886066256
best ic: 0.052844859886066256
epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [03:59<08:56,  7.77s/it]0.05139229085126364
epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:08<09:07,  8.06s/it]0.051495129534587875
epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:17<09:19,  8.35s/it]0.05126516991962483
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:26<09:19,  8.48s/it]0.052187198900623705
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:34<09:16,  8.56s/it]0.049975020618968746
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:43<09:16,  8.70s/it]0.05298562141534812
best ic: 0.05298562141534812
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:52<09:16,  8.83s/it]0.05225925442295393
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [05:01<09:10,  8.87s/it]0.05091350884785952
epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:10<08:58,  8.83s/it]0.05301865219908958
best ic: 0.05301865219908958
epoch:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 40/100 [05:19<08:49,  8.83s/it]0.048346400978752146
epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:28<08:43,  8.87s/it]0.04930951899146923
epoch:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 42/100 [05:37<08:42,  9.01s/it]0.0511298883617345
epoch:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 43/100 [05:47<08:37,  9.08s/it]0.04708740515476836
epoch:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 44/100 [05:55<08:25,  9.03s/it]0.04822251230471381
epoch:  45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 45/100 [06:04<08:13,  8.97s/it]0.04838317244410339
epoch:  46%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 46/100 [06:13<08:06,  9.00s/it]0.04710574313443519
epoch:  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 47/100 [06:22<07:55,  8.97s/it]0.04640094713843124
epoch:  47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 47/100 [06:31<07:21,  8.33s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 21:25:21,112) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 21:25:21,128) INFO - qlib.workflow - [recorder.py:351] - Recorder 1982e7c7d01d4961a4f76f73f8ca3766 starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:03, 16.17it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 16.09it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 16.45it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 16.71it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 16.76it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 16.50it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:02, 16.63it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:00<00:02, 16.63it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 16.55it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 16.64it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 16.87it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 16.77it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 16.68it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 16.54it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:01, 16.55it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:01<00:01, 16.42it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 16.50it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 16.52it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 16.50it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 16.50it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 16.52it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 16.42it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 16.52it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:02<00:00, 16.60it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 16.54it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 16.48it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 16.46it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 16.41it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 16.52it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 16.33it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 16.56it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 16.56it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 21:25:31,017) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.99602413 mae 0.8631969
{'IC': 0.030611293982400384,
 'ICIR': 0.22349433439346356,
 'Rank IC': 0.050263022538089126,
 'Rank ICIR': 0.36007850202420655}
[335022:MainThread](2024-04-27 21:25:32,797) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 21:25:45,214) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:25:45,217) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:25:51,413) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f05be02ea60>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 969/971  [ 0:00:19 < 0:00:01 , 51 it/s ]
[335022:MainThread](2024-04-27 21:26:10,791) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000537
std                0.004944
annualized_return  0.127808
information_ratio  1.675688
max_drawdown      -0.056904
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000339
std                0.004945
annualized_return  0.080762
information_ratio  1.058596
max_drawdown      -0.062783
[335022:MainThread](2024-04-27 21:26:10,808) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 6 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852,
                                                    0.10604891602025349,
                                                    0.1173128835516425,
                                                    0.09183246529644684,
                                                    0.08076206594442475],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722,
                                                    1.4486275117859186,
                                                    1.5799512476215403,
                                                    1.1725965476904165,
                                                    1.0585961405376947],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947,
                                               -0.07289816911890595,
                                               -0.060765770421726595,
                                               -0.06309258060263781,
                                               -0.06278285964917886],
 'IC': [0.029729565457264854,
        0.029405089758369793,
        0.031630888947913355,
        0.03467442032448001,
        0.030472797772215822,
        0.030611293982400384],
 'ICIR': [0.21854268909662852,
          0.21612419371235603,
          0.23109538349716643,
          0.25129378927287044,
          0.21732997056432965,
          0.22349433439346356],
 'Rank IC': [0.048009263616079774,
             0.04920694528309832,
             0.050545985610409176,
             0.05345550631625833,
             0.04975131877560188,
             0.050263022538089126],
 'Rank ICIR': [0.35229059437440524,
               0.3531841992937613,
               0.3684279490033989,
               0.3851584033742197,
               0.34866365763795726,
               0.36007850202420655],
 'mae': [0.8633286356925964,
         0.8632760047912598,
         0.8631440997123718,
         0.8629827499389648,
         0.8632291555404663,
         0.8631969094276428],
 'mse': [0.9958662986755371,
         0.9957415461540222,
         0.9955101013183594,
         0.9950945973396301,
         0.9954494833946228,
         0.9960241317749023]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 21:26:12,034) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 21:26:12,034) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:07<12:52,  7.80s/it]epoch:   2%|â–         | 2/100 [00:15<12:19,  7.55s/it]epoch:   3%|â–         | 3/100 [00:22<12:12,  7.55s/it]epoch:   4%|â–         | 4/100 [00:30<12:06,  7.57s/it]epoch:   5%|â–Œ         | 5/100 [00:38<12:10,  7.68s/it]epoch:   6%|â–Œ         | 6/100 [00:45<12:01,  7.68s/it]epoch:   7%|â–‹         | 7/100 [00:53<11:53,  7.68s/it]epoch:   8%|â–Š         | 8/100 [01:01<11:48,  7.70s/it]epoch:   9%|â–‰         | 9/100 [01:08<11:40,  7.70s/it]epoch:  10%|â–ˆ         | 10/100 [01:16<11:32,  7.69s/it]epoch:  11%|â–ˆ         | 11/100 [01:24<11:25,  7.70s/it]epoch:  12%|â–ˆâ–        | 12/100 [01:32<11:22,  7.75s/it]epoch:  13%|â–ˆâ–        | 13/100 [01:39<11:12,  7.73s/it]epoch:  14%|â–ˆâ–        | 14/100 [01:47<11:03,  7.72s/it]epoch:  15%|â–ˆâ–Œ        | 15/100 [01:55<10:56,  7.72s/it]epoch:  16%|â–ˆâ–Œ        | 16/100 [02:02<10:43,  7.66s/it]epoch:  17%|â–ˆâ–‹        | 17/100 [02:10<10:37,  7.68s/it]epoch:  18%|â–ˆâ–Š        | 18/100 [02:18<10:30,  7.69s/it]epoch:  19%|â–ˆâ–‰        | 19/100 [02:25<10:22,  7.69s/it]epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:33<10:17,  7.72s/it]epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:41<10:10,  7.73s/it]epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:49<10:04,  7.75s/it]epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:57<09:57,  7.76s/it]epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:04<09:48,  7.74s/it]epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:12<09:40,  7.74s/it]epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:20<09:32,  7.73s/it]epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:28<09:27,  7.78s/it]epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:36<09:25,  7.86s/it]epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:43<09:13,  7.79s/it]epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:51<09:03,  7.76s/it]0.05089649090043944
best ic: 0.05089649090043944
epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [04:00<09:18,  8.10s/it]0.049789860589946444
epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:09<09:28,  8.36s/it]0.048747721685128725
epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:18<09:30,  8.51s/it]0.0512868145245096
best ic: 0.0512868145245096
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:27<09:27,  8.60s/it]0.053667219938066425
best ic: 0.053667219938066425
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:35<09:23,  8.67s/it]0.048927658744522165
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:44<09:16,  8.69s/it]0.048029220101206097
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:53<09:11,  8.75s/it]0.04715102146547565
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [05:02<09:01,  8.74s/it]0.04828206502379318
epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:11<09:02,  8.89s/it]0.048963207977388706
epoch:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 40/100 [05:20<08:54,  8.90s/it]0.044329878966874604
epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:29<08:47,  8.95s/it]0.04330511427628671
epoch:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 42/100 [05:38<08:36,  8.90s/it]0.04831043809569683
epoch:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 42/100 [05:47<07:59,  8.27s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 21:31:59,312) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 21:31:59,328) INFO - qlib.workflow - [recorder.py:351] - Recorder 59ec73adf80d479b86363b286fe5f2f3 starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:03, 15.40it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 15.80it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 16.08it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 16.23it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 16.31it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 16.40it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:02, 16.47it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:00<00:02, 16.41it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 16.58it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 16.50it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 16.50it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 16.52it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 16.47it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 16.60it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:01, 16.52it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:01<00:01, 16.63it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 16.95it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 16.99it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 17.11it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 17.12it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 16.69it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 16.50it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 16.22it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:02<00:00, 16.19it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 16.16it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 16.12it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 16.13it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 16.15it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 16.14it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 16.11it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 16.14it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 16.43it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 21:32:09,322) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9959527 mae 0.8633372
{'IC': 0.03127913460553676,
 'ICIR': 0.22598175933226083,
 'Rank IC': 0.04827531575352885,
 'Rank ICIR': 0.3498069105563464}
[335022:MainThread](2024-04-27 21:32:11,111) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 21:32:23,847) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:32:23,851) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:32:30,003) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f05f9fbc130>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 967/971  [ 0:00:18 < 0:00:01 , 53 it/s ]
[335022:MainThread](2024-04-27 21:32:48,732) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000580
std                0.004883
annualized_return  0.138125
information_ratio  1.833655
max_drawdown      -0.060619
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000382
std                0.004884
annualized_return  0.090944
information_ratio  1.206924
max_drawdown      -0.071490
[335022:MainThread](2024-04-27 21:32:48,749) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 7 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852,
                                                    0.10604891602025349,
                                                    0.1173128835516425,
                                                    0.09183246529644684,
                                                    0.08076206594442475,
                                                    0.09094384089851285],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722,
                                                    1.4486275117859186,
                                                    1.5799512476215403,
                                                    1.1725965476904165,
                                                    1.0585961405376947,
                                                    1.2069241859273934],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947,
                                               -0.07289816911890595,
                                               -0.060765770421726595,
                                               -0.06309258060263781,
                                               -0.06278285964917886,
                                               -0.07149028600573473],
 'IC': [0.029729565457264854,
        0.029405089758369793,
        0.031630888947913355,
        0.03467442032448001,
        0.030472797772215822,
        0.030611293982400384,
        0.03127913460553676],
 'ICIR': [0.21854268909662852,
          0.21612419371235603,
          0.23109538349716643,
          0.25129378927287044,
          0.21732997056432965,
          0.22349433439346356,
          0.22598175933226083],
 'Rank IC': [0.048009263616079774,
             0.04920694528309832,
             0.050545985610409176,
             0.05345550631625833,
             0.04975131877560188,
             0.050263022538089126,
             0.04827531575352885],
 'Rank ICIR': [0.35229059437440524,
               0.3531841992937613,
               0.3684279490033989,
               0.3851584033742197,
               0.34866365763795726,
               0.36007850202420655,
               0.3498069105563464],
 'mae': [0.8633286356925964,
         0.8632760047912598,
         0.8631440997123718,
         0.8629827499389648,
         0.8632291555404663,
         0.8631969094276428,
         0.8633372187614441],
 'mse': [0.9958662986755371,
         0.9957415461540222,
         0.9955101013183594,
         0.9950945973396301,
         0.9954494833946228,
         0.9960241317749023,
         0.9959527254104614]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 21:32:49,974) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 21:32:49,974) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:07<12:36,  7.65s/it]epoch:   2%|â–         | 2/100 [00:15<12:23,  7.59s/it]epoch:   3%|â–         | 3/100 [00:22<12:13,  7.56s/it]epoch:   4%|â–         | 4/100 [00:30<12:08,  7.59s/it]epoch:   5%|â–Œ         | 5/100 [00:37<12:02,  7.61s/it]epoch:   6%|â–Œ         | 6/100 [00:45<11:51,  7.57s/it]epoch:   7%|â–‹         | 7/100 [00:53<11:51,  7.65s/it]epoch:   8%|â–Š         | 8/100 [01:01<11:51,  7.73s/it]epoch:   9%|â–‰         | 9/100 [01:08<11:40,  7.69s/it]epoch:  10%|â–ˆ         | 10/100 [01:16<11:29,  7.66s/it]epoch:  11%|â–ˆ         | 11/100 [01:23<11:19,  7.64s/it]epoch:  12%|â–ˆâ–        | 12/100 [01:31<11:12,  7.64s/it]epoch:  13%|â–ˆâ–        | 13/100 [01:39<11:05,  7.65s/it]epoch:  14%|â–ˆâ–        | 14/100 [01:47<11:06,  7.75s/it]epoch:  15%|â–ˆâ–Œ        | 15/100 [01:54<10:54,  7.70s/it]epoch:  16%|â–ˆâ–Œ        | 16/100 [02:02<10:47,  7.70s/it]epoch:  17%|â–ˆâ–‹        | 17/100 [02:10<10:35,  7.66s/it]epoch:  18%|â–ˆâ–Š        | 18/100 [02:17<10:25,  7.62s/it]epoch:  19%|â–ˆâ–‰        | 19/100 [02:25<10:18,  7.63s/it]epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:32<10:07,  7.59s/it]epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:40<10:02,  7.62s/it]epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:48<09:57,  7.66s/it]epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:56<09:51,  7.68s/it]epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:03<09:38,  7.61s/it]epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:11<09:32,  7.63s/it]epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:18<09:25,  7.64s/it]epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:26<09:18,  7.65s/it]epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:34<09:13,  7.69s/it]epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:41<09:03,  7.66s/it]epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:49<08:55,  7.64s/it]0.05490524203890973
best ic: 0.05490524203890973
epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [03:58<09:11,  7.99s/it]0.05550303940337531
best ic: 0.05550303940337531
epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:07<09:19,  8.23s/it]0.05507974661866879
epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:15<09:23,  8.41s/it]0.05317374657930754
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:24<09:25,  8.57s/it]0.0563844601923354
best ic: 0.0563844601923354
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:33<09:21,  8.63s/it]0.05023947560442695
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:42<09:17,  8.72s/it]0.05158716098151213
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:51<09:09,  8.73s/it]0.049582627828217936
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [05:00<09:03,  8.77s/it]0.05329359178563423
epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:08<08:53,  8.75s/it]0.051158852429221906
epoch:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 40/100 [05:17<08:45,  8.76s/it]0.048635617876638344
epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:26<08:38,  8.80s/it]0.04836265840862814
epoch:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 42/100 [05:35<08:25,  8.72s/it]0.049079602103161916
epoch:  42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 42/100 [05:43<07:54,  8.18s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 21:38:33,735) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 21:38:33,752) INFO - qlib.workflow - [recorder.py:351] - Recorder a0adeffea5724901a5e3606e9c9acfa7 starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:03, 15.58it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 15.86it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 16.13it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 16.19it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 16.28it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 16.25it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:03, 16.23it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:00<00:02, 16.45it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 16.61it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 16.45it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 16.67it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 16.54it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 16.54it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 16.58it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:01, 16.58it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:01<00:01, 16.64it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 16.49it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 16.39it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 16.44it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 16.86it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 16.55it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 16.52it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 16.55it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:02<00:00, 16.49it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 16.63it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 16.52it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 16.52it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 16.53it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 16.60it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 16.61it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 16.49it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 16.51it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 21:38:43,652) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.995358 mae 0.8631197
{'IC': 0.03276662664250109,
 'ICIR': 0.24670373815208668,
 'Rank IC': 0.0509523790339583,
 'Rank ICIR': 0.37316598791246774}
[335022:MainThread](2024-04-27 21:38:45,446) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 21:38:57,935) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:38:57,939) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:39:04,091) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f0484089850>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 968/971  [ 0:00:17 < 0:00:01 , 55 it/s ]
[335022:MainThread](2024-04-27 21:39:21,979) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000557
std                0.004837
annualized_return  0.132520
information_ratio  1.775968
max_drawdown      -0.070396
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000360
std                0.004838
annualized_return  0.085592
information_ratio  1.146708
max_drawdown      -0.095252
[335022:MainThread](2024-04-27 21:39:21,996) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 8 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852,
                                                    0.10604891602025349,
                                                    0.1173128835516425,
                                                    0.09183246529644684,
                                                    0.08076206594442475,
                                                    0.09094384089851285,
                                                    0.08559244510248455],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722,
                                                    1.4486275117859186,
                                                    1.5799512476215403,
                                                    1.1725965476904165,
                                                    1.0585961405376947,
                                                    1.2069241859273934,
                                                    1.1467080854833052],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947,
                                               -0.07289816911890595,
                                               -0.060765770421726595,
                                               -0.06309258060263781,
                                               -0.06278285964917886,
                                               -0.07149028600573473,
                                               -0.09525223871405032],
 'IC': [0.029729565457264854,
        0.029405089758369793,
        0.031630888947913355,
        0.03467442032448001,
        0.030472797772215822,
        0.030611293982400384,
        0.03127913460553676,
        0.03276662664250109],
 'ICIR': [0.21854268909662852,
          0.21612419371235603,
          0.23109538349716643,
          0.25129378927287044,
          0.21732997056432965,
          0.22349433439346356,
          0.22598175933226083,
          0.24670373815208668],
 'Rank IC': [0.048009263616079774,
             0.04920694528309832,
             0.050545985610409176,
             0.05345550631625833,
             0.04975131877560188,
             0.050263022538089126,
             0.04827531575352885,
             0.0509523790339583],
 'Rank ICIR': [0.35229059437440524,
               0.3531841992937613,
               0.3684279490033989,
               0.3851584033742197,
               0.34866365763795726,
               0.36007850202420655,
               0.3498069105563464,
               0.37316598791246774],
 'mae': [0.8633286356925964,
         0.8632760047912598,
         0.8631440997123718,
         0.8629827499389648,
         0.8632291555404663,
         0.8631969094276428,
         0.8633372187614441,
         0.8631197214126587],
 'mse': [0.9958662986755371,
         0.9957415461540222,
         0.9955101013183594,
         0.9950945973396301,
         0.9954494833946228,
         0.9960241317749023,
         0.9959527254104614,
         0.9953579902648926]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 21:39:23,243) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 21:39:23,243) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:07<12:39,  7.67s/it]epoch:   2%|â–         | 2/100 [00:15<12:44,  7.80s/it]epoch:   3%|â–         | 3/100 [00:23<12:24,  7.68s/it]epoch:   4%|â–         | 4/100 [00:30<12:16,  7.67s/it]epoch:   5%|â–Œ         | 5/100 [00:38<12:07,  7.65s/it]epoch:   6%|â–Œ         | 6/100 [00:46<12:00,  7.67s/it]epoch:   7%|â–‹         | 7/100 [00:53<11:52,  7.66s/it]epoch:   8%|â–Š         | 8/100 [01:01<11:45,  7.67s/it]epoch:   9%|â–‰         | 9/100 [01:08<11:28,  7.57s/it]epoch:  10%|â–ˆ         | 10/100 [01:16<11:22,  7.59s/it]epoch:  11%|â–ˆ         | 11/100 [01:24<11:16,  7.60s/it]epoch:  12%|â–ˆâ–        | 12/100 [01:31<11:09,  7.61s/it]epoch:  13%|â–ˆâ–        | 13/100 [01:39<11:07,  7.67s/it]epoch:  14%|â–ˆâ–        | 14/100 [01:47<11:03,  7.72s/it]epoch:  15%|â–ˆâ–Œ        | 15/100 [01:54<10:53,  7.69s/it]epoch:  16%|â–ˆâ–Œ        | 16/100 [02:02<10:46,  7.70s/it]epoch:  17%|â–ˆâ–‹        | 17/100 [02:10<10:39,  7.71s/it]epoch:  18%|â–ˆâ–Š        | 18/100 [02:17<10:28,  7.66s/it]epoch:  19%|â–ˆâ–‰        | 19/100 [02:25<10:17,  7.63s/it]epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:33<10:12,  7.66s/it]epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:40<10:05,  7.66s/it]epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:48<09:58,  7.68s/it]epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:56<09:50,  7.67s/it]epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:04<09:48,  7.74s/it]epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:11<09:38,  7.71s/it]epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:19<09:30,  7.71s/it]epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:27<09:21,  7.69s/it]epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:34<09:14,  7.71s/it]epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:42<09:11,  7.76s/it]epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:50<09:01,  7.74s/it]0.05254660357222201
best ic: 0.05254660357222201
epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [03:59<09:12,  8.00s/it]0.05123228796719081
epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:07<09:19,  8.22s/it]0.04799604290322372
epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:16<09:21,  8.39s/it]0.04431294606212047
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:25<09:23,  8.54s/it]0.049582758379897306
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:34<09:19,  8.61s/it]0.04911953387444637
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:42<09:13,  8.66s/it]0.04558833588039533
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:51<09:07,  8.69s/it]0.051186439309115955
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [05:00<09:00,  8.72s/it]0.044669391338849826
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [05:09<08:24,  8.14s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 21:44:32,663) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 21:44:32,679) INFO - qlib.workflow - [recorder.py:351] - Recorder a35f8053dbeb4b20bfaad82be5eeb140 starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:03, 15.60it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 16.14it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 16.12it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 16.23it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 16.29it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 16.43it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:02, 16.53it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:00<00:02, 16.51it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 16.45it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 16.50it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 16.51it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 16.43it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 16.70it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 16.49it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:01, 16.53it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:01<00:01, 16.57it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 16.46it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 16.39it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 16.40it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 16.33it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 16.39it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 16.48it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 16.45it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:02<00:00, 16.44it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 16.41it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 16.77it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 16.45it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 16.38it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 16.57it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 16.46it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 16.49it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 16.47it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 21:44:42,665) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9954154 mae 0.863181
{'IC': 0.03163844876655495,
 'ICIR': 0.22121545511601945,
 'Rank IC': 0.05074433004567612,
 'Rank ICIR': 0.3563704596235239}
[335022:MainThread](2024-04-27 21:44:44,452) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 21:44:57,002) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:44:57,005) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:45:03,059) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7eff4a968be0>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 970/971  [ 0:00:17 < 0:00:01 , 56 it/s ]
[335022:MainThread](2024-04-27 21:45:20,619) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000691
std                0.005078
annualized_return  0.164476
information_ratio  2.099591
max_drawdown      -0.055896
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000494
std                0.005079
annualized_return  0.117481
information_ratio  1.499478
max_drawdown      -0.061289
[335022:MainThread](2024-04-27 21:45:20,635) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 9 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852,
                                                    0.10604891602025349,
                                                    0.1173128835516425,
                                                    0.09183246529644684,
                                                    0.08076206594442475,
                                                    0.09094384089851285,
                                                    0.08559244510248455,
                                                    0.11748093720226269],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722,
                                                    1.4486275117859186,
                                                    1.5799512476215403,
                                                    1.1725965476904165,
                                                    1.0585961405376947,
                                                    1.2069241859273934,
                                                    1.1467080854833052,
                                                    1.499478382445685],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947,
                                               -0.07289816911890595,
                                               -0.060765770421726595,
                                               -0.06309258060263781,
                                               -0.06278285964917886,
                                               -0.07149028600573473,
                                               -0.09525223871405032,
                                               -0.06128856813029193],
 'IC': [0.029729565457264854,
        0.029405089758369793,
        0.031630888947913355,
        0.03467442032448001,
        0.030472797772215822,
        0.030611293982400384,
        0.03127913460553676,
        0.03276662664250109,
        0.03163844876655495],
 'ICIR': [0.21854268909662852,
          0.21612419371235603,
          0.23109538349716643,
          0.25129378927287044,
          0.21732997056432965,
          0.22349433439346356,
          0.22598175933226083,
          0.24670373815208668,
          0.22121545511601945],
 'Rank IC': [0.048009263616079774,
             0.04920694528309832,
             0.050545985610409176,
             0.05345550631625833,
             0.04975131877560188,
             0.050263022538089126,
             0.04827531575352885,
             0.0509523790339583,
             0.05074433004567612],
 'Rank ICIR': [0.35229059437440524,
               0.3531841992937613,
               0.3684279490033989,
               0.3851584033742197,
               0.34866365763795726,
               0.36007850202420655,
               0.3498069105563464,
               0.37316598791246774,
               0.3563704596235239],
 'mae': [0.8633286356925964,
         0.8632760047912598,
         0.8631440997123718,
         0.8629827499389648,
         0.8632291555404663,
         0.8631969094276428,
         0.8633372187614441,
         0.8631197214126587,
         0.8631809949874878],
 'mse': [0.9958662986755371,
         0.9957415461540222,
         0.9955101013183594,
         0.9950945973396301,
         0.9954494833946228,
         0.9960241317749023,
         0.9959527254104614,
         0.9953579902648926,
         0.9954153895378113]}
Traceback (most recent call last):
  File "main.py", line 479, in run_all
    assert self.reload_tag is not None
AssertionError
No valid experiment to reload. Restart offline training...
[335022:MainThread](2024-04-27 21:45:21,824) INFO - qlib.LSTM - [pytorch_lstm.py:60] - LSTM pytorch version...
[335022:MainThread](2024-04-27 21:45:21,824) INFO - qlib.LSTM - [pytorch_lstm.py:77] - LSTM parameters setting:
d_feat : 6
hidden_size : 64
num_layers : 2
dropout : 0.0
n_epochs : 200
lr : 0.001
metric : loss
batch_size : 800
early_stop : 8
optimizer : adam
loss_type : mse
visible_GPU : 0
use_GPU : True
seed : None
epoch:   0%|          | 0/100 [00:00<?, ?it/s]epoch:   1%|          | 1/100 [00:07<12:27,  7.55s/it]epoch:   2%|â–         | 2/100 [00:15<12:24,  7.60s/it]epoch:   3%|â–         | 3/100 [00:22<12:14,  7.58s/it]epoch:   4%|â–         | 4/100 [00:30<12:06,  7.57s/it]epoch:   5%|â–Œ         | 5/100 [00:38<12:05,  7.64s/it]epoch:   6%|â–Œ         | 6/100 [00:45<11:55,  7.62s/it]epoch:   7%|â–‹         | 7/100 [00:53<11:41,  7.54s/it]epoch:   8%|â–Š         | 8/100 [01:00<11:33,  7.54s/it]epoch:   9%|â–‰         | 9/100 [01:08<11:24,  7.52s/it]epoch:  10%|â–ˆ         | 10/100 [01:15<11:19,  7.55s/it]epoch:  11%|â–ˆ         | 11/100 [01:23<11:12,  7.56s/it]epoch:  12%|â–ˆâ–        | 12/100 [01:30<11:05,  7.57s/it]epoch:  13%|â–ˆâ–        | 13/100 [01:38<10:57,  7.56s/it]epoch:  14%|â–ˆâ–        | 14/100 [01:45<10:51,  7.58s/it]epoch:  15%|â–ˆâ–Œ        | 15/100 [01:53<10:52,  7.68s/it]epoch:  16%|â–ˆâ–Œ        | 16/100 [02:01<10:46,  7.70s/it]epoch:  17%|â–ˆâ–‹        | 17/100 [02:09<10:31,  7.61s/it]epoch:  18%|â–ˆâ–Š        | 18/100 [02:16<10:21,  7.58s/it]epoch:  19%|â–ˆâ–‰        | 19/100 [02:24<10:13,  7.57s/it]epoch:  20%|â–ˆâ–ˆ        | 20/100 [02:31<10:00,  7.51s/it]epoch:  21%|â–ˆâ–ˆ        | 21/100 [02:38<09:48,  7.44s/it]epoch:  22%|â–ˆâ–ˆâ–       | 22/100 [02:46<09:40,  7.45s/it]epoch:  23%|â–ˆâ–ˆâ–       | 23/100 [02:53<09:34,  7.46s/it]epoch:  24%|â–ˆâ–ˆâ–       | 24/100 [03:01<09:38,  7.61s/it]epoch:  25%|â–ˆâ–ˆâ–Œ       | 25/100 [03:09<09:30,  7.60s/it]epoch:  26%|â–ˆâ–ˆâ–Œ       | 26/100 [03:16<09:24,  7.62s/it]epoch:  27%|â–ˆâ–ˆâ–‹       | 27/100 [03:24<09:21,  7.69s/it]epoch:  28%|â–ˆâ–ˆâ–Š       | 28/100 [03:32<09:13,  7.69s/it]epoch:  29%|â–ˆâ–ˆâ–‰       | 29/100 [03:40<09:05,  7.68s/it]epoch:  30%|â–ˆâ–ˆâ–ˆ       | 30/100 [03:47<09:00,  7.72s/it]0.05278100669781496
best ic: 0.05278100669781496
epoch:  31%|â–ˆâ–ˆâ–ˆ       | 31/100 [03:56<09:17,  8.07s/it]0.05343975494069791
best ic: 0.05343975494069791
epoch:  32%|â–ˆâ–ˆâ–ˆâ–      | 32/100 [04:05<09:24,  8.30s/it]0.05168941366370587
epoch:  33%|â–ˆâ–ˆâ–ˆâ–      | 33/100 [04:14<09:26,  8.46s/it]0.05442746145897151
best ic: 0.05442746145897151
epoch:  34%|â–ˆâ–ˆâ–ˆâ–      | 34/100 [04:23<09:23,  8.53s/it]0.05269179118922316
epoch:  35%|â–ˆâ–ˆâ–ˆâ–Œ      | 35/100 [04:31<09:15,  8.55s/it]0.05377994330097298
epoch:  36%|â–ˆâ–ˆâ–ˆâ–Œ      | 36/100 [04:40<09:06,  8.54s/it]0.052002811932854096
epoch:  37%|â–ˆâ–ˆâ–ˆâ–‹      | 37/100 [04:49<09:07,  8.69s/it]0.049404310155953174
epoch:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 38/100 [04:58<09:05,  8.80s/it]0.05048375220350485
epoch:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 39/100 [05:07<08:58,  8.83s/it]0.05072249291593067
epoch:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 40/100 [05:16<08:50,  8.85s/it]0.05196237839584041
epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:25<08:42,  8.86s/it]0.051181980154166445
epoch:  41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 41/100 [05:34<08:00,  8.15s/it]
Test segment: 2020-04-01 00:00:00 2024-03-29 00:00:00
[335022:MainThread](2024-04-27 21:50:55,899) INFO - qlib.workflow - [exp.py:258] - Experiment 71 starts running ...
[335022:MainThread](2024-04-27 21:50:55,915) INFO - qlib.workflow - [recorder.py:351] - Recorder 222b59e257164bd0a67e0f35bf98072d starts running under Experiment 71 ...
online:   0%|          | 0/63 [00:00<?, ?it/s]online:   3%|â–         | 2/63 [00:00<00:03, 16.12it/s]online:   6%|â–‹         | 4/63 [00:00<00:03, 16.20it/s]online:  10%|â–‰         | 6/63 [00:00<00:03, 16.38it/s]online:  13%|â–ˆâ–        | 8/63 [00:00<00:03, 16.41it/s]online:  16%|â–ˆâ–Œ        | 10/63 [00:00<00:03, 16.91it/s]online:  19%|â–ˆâ–‰        | 12/63 [00:00<00:03, 16.66it/s]online:  22%|â–ˆâ–ˆâ–       | 14/63 [00:00<00:02, 16.74it/s]online:  25%|â–ˆâ–ˆâ–Œ       | 16/63 [00:00<00:02, 16.54it/s]online:  29%|â–ˆâ–ˆâ–Š       | 18/63 [00:01<00:02, 16.68it/s]online:  32%|â–ˆâ–ˆâ–ˆâ–      | 20/63 [00:01<00:02, 16.54it/s]online:  35%|â–ˆâ–ˆâ–ˆâ–      | 22/63 [00:01<00:02, 16.29it/s]online:  38%|â–ˆâ–ˆâ–ˆâ–Š      | 24/63 [00:01<00:02, 16.22it/s]online:  41%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 26/63 [00:01<00:02, 16.52it/s]online:  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 28/63 [00:01<00:02, 16.73it/s]online:  48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 30/63 [00:01<00:01, 16.85it/s]online:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 32/63 [00:01<00:01, 16.84it/s]online:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 34/63 [00:02<00:01, 16.57it/s]online:  57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 36/63 [00:02<00:01, 16.92it/s]online:  60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 38/63 [00:02<00:01, 16.67it/s]online:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 40/63 [00:02<00:01, 16.53it/s]online:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 42/63 [00:02<00:01, 16.51it/s]online:  70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 44/63 [00:02<00:01, 16.46it/s]online:  73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 46/63 [00:02<00:01, 16.84it/s]online:  76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 48/63 [00:02<00:00, 16.66it/s]online:  79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 50/63 [00:03<00:00, 16.57it/s]online:  83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 52/63 [00:03<00:00, 16.51it/s]online:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 54/63 [00:03<00:00, 16.54it/s]online:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 56/63 [00:03<00:00, 16.47it/s]online:  92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 58/63 [00:03<00:00, 16.48it/s]online:  95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 60/63 [00:03<00:00, 16.41it/s]online:  98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 62/63 [00:03<00:00, 16.52it/s]online: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 63/63 [00:03<00:00, 16.59it/s]
lr_model: 0.001 lr_ma: 0.001 lr_da: 0.01
[335022:MainThread](2024-04-27 21:51:05,801) INFO - qlib.timer - [log.py:127] - Time cost: 0.000s | waiting `async_log` Done
mse: 0.9959741 mae 0.8634602
{'IC': 0.029045004323401395,
 'ICIR': 0.2133324494982522,
 'Rank IC': 0.04696830340659521,
 'Rank ICIR': 0.3417017750679748}
[335022:MainThread](2024-04-27 21:51:07,578) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[335022:MainThread](2024-04-27 21:51:20,016) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:51:20,019) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[335022:MainThread](2024-04-27 21:51:26,177) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x7f05ff288d90>
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/backtest/backtest.py:88: TqdmExperimentalWarning: rich is experimental/alpha
  with tqdm(
/home/zhonghao/miniconda3/envs/sjtu_qlib/lib/python3.8/site-packages/qlib/utils/index_data.py:481: RuntimeWarning: Mean of empty slice
  return np.nanmean(self.data)
backtest loop 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¸ 969/971  [ 0:00:18 < 0:00:01 , 53 it/s ]
[335022:MainThread](2024-04-27 21:51:44,934) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of benchmark return(1day).'
                       risk
mean               0.000039
std                0.011364
annualized_return  0.009266
information_ratio  0.052853
max_drawdown      -0.558443
'The following are analysis results of the excess return without cost(1day).'
                       risk
mean               0.000457
std                0.004912
annualized_return  0.108845
information_ratio  1.436250
max_drawdown      -0.069502
'The following are analysis results of the excess return with cost(1day).'
                       risk
mean               0.000260
std                0.004913
annualized_return  0.061985
information_ratio  0.817729
max_drawdown      -0.088095
[335022:MainThread](2024-04-27 21:51:44,950) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1day.pkl' has been saved as the artifact of the Experiment 71
'The following are analysis results of indicators(1day).'
     value
ffr    1.0
pa     0.0
pos    0.0
Your evaluation results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_online`.
Round 10 Done!
{'1day.excess_return_with_cost.annualized_return': [0.06309412979385907,
                                                    0.0921035458756852,
                                                    0.10604891602025349,
                                                    0.1173128835516425,
                                                    0.09183246529644684,
                                                    0.08076206594442475,
                                                    0.09094384089851285,
                                                    0.08559244510248455,
                                                    0.11748093720226269,
                                                    0.06198498974429491],
 '1day.excess_return_with_cost.information_ratio': [0.8308644177320498,
                                                    1.1830544227160722,
                                                    1.4486275117859186,
                                                    1.5799512476215403,
                                                    1.1725965476904165,
                                                    1.0585961405376947,
                                                    1.2069241859273934,
                                                    1.1467080854833052,
                                                    1.499478382445685,
                                                    0.8177292949346497],
 '1day.excess_return_with_cost.max_drawdown': [-0.07945640500622617,
                                               -0.07148576038765947,
                                               -0.07289816911890595,
                                               -0.060765770421726595,
                                               -0.06309258060263781,
                                               -0.06278285964917886,
                                               -0.07149028600573473,
                                               -0.09525223871405032,
                                               -0.06128856813029193,
                                               -0.08809469779374532],
 'IC': [0.029729565457264854,
        0.029405089758369793,
        0.031630888947913355,
        0.03467442032448001,
        0.030472797772215822,
        0.030611293982400384,
        0.03127913460553676,
        0.03276662664250109,
        0.03163844876655495,
        0.029045004323401395],
 'ICIR': [0.21854268909662852,
          0.21612419371235603,
          0.23109538349716643,
          0.25129378927287044,
          0.21732997056432965,
          0.22349433439346356,
          0.22598175933226083,
          0.24670373815208668,
          0.22121545511601945,
          0.2133324494982522],
 'Rank IC': [0.048009263616079774,
             0.04920694528309832,
             0.050545985610409176,
             0.05345550631625833,
             0.04975131877560188,
             0.050263022538089126,
             0.04827531575352885,
             0.0509523790339583,
             0.05074433004567612,
             0.04696830340659521],
 'Rank ICIR': [0.35229059437440524,
               0.3531841992937613,
               0.3684279490033989,
               0.3851584033742197,
               0.34866365763795726,
               0.36007850202420655,
               0.3498069105563464,
               0.37316598791246774,
               0.3563704596235239,
               0.3417017750679748],
 'mae': [0.8633286356925964,
         0.8632760047912598,
         0.8631440997123718,
         0.8629827499389648,
         0.8632291555404663,
         0.8631969094276428,
         0.8633372187614441,
         0.8631197214126587,
         0.8631809949874878,
         0.8634601831436157],
 'mse': [0.9958662986755371,
         0.9957415461540222,
         0.9955101013183594,
         0.9950945973396301,
         0.9954494833946228,
         0.9960241317749023,
         0.9959527254104614,
         0.9953579902648926,
         0.9954153895378113,
         0.9959741234779358]}
[335022:MainThread](2024-04-27 21:51:46,186) WARNING - qlib.workflow - [expm.py:230] - No valid experiment found. Create a new experiment with name csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_final.
[335022:MainThread](2024-04-27 21:51:46,253) INFO - qlib.workflow - [exp.py:258] - Experiment 72 starts running ...
[335022:MainThread](2024-04-27 21:51:46,273) INFO - qlib.workflow - [recorder.py:351] - Recorder 1873e5a28e1e410e88d9fe3ff8815f1d starts running under Experiment 72 ...
Time cost: 335.11803340911865	49.92031962871552
Final results:
{'1day.excess_return_with_cost.annualized_return': [0.09071562194298669,
                                                    0.01837348187501441],
 '1day.excess_return_with_cost.information_ratio': [1.1944530236874726,
                                                    0.24533065403370688],
 '1day.excess_return_with_cost.max_drawdown': [-0.07266073358301572,
                                               0.011213873689371547],
 'IC': [0.031125327058063847, 0.0016049175922485729],
 'ICIR': [0.2265113762635434, 0.012287059330350293],
 'Rank IC': [0.04981723703792951, 0.00173937818062403],
 'Rank ICIR': [0.3588848438868262, 0.012454676460614088],
 'mae': [0.8632255673408509, 0.00012660928389204512],
 'mse': [0.9956386387348175, 0.000299851753311254]}
Your final results can be found in the experiment named `csi300_LSTM_alpha360_horizon1_step20_rankTrue_2024-04-27_20:47:35_final`.
All Done!
[335022:MainThread](2024-04-27 21:51:47,022) INFO - qlib.timer - [log.py:127] - Time cost: 0.049s | waiting `async_log` Done
